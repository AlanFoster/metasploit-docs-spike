{
  "name": "Group Policy Script Execution From Shared Resource",
  "fullname": "exploit/windows/smb/group_policy_startup",
  "aliases": [

  ],
  "rank": 0,
  "disclosure_date": "2015-01-26",
  "type": "exploit",
  "author": [
    "Sam Bertram <sbertram@gdssecurity.com>",
    "juan vazquez <juan.vazquez@metasploit.com>"
  ],
  "description": "This is a general-purpose module for exploiting systems with Windows Group Policy\n        configured to load VBS startup/logon scripts from remote locations. This module runs\n        a SMB shared resource that will provide a payload through a VBS file. Startup scripts\n        will be executed with SYSTEM privileges, while logon scripts will be executed with the\n        user privileges. Have into account which the attacker still needs to redirect the\n        target traffic to the fake SMB share to exploit it successfully. Please note in some\n        cases, it will take 5 to 10 minutes to receive a session.",
  "references": [
    "http://blog.gdssecurity.com/labs/2015/1/26/badsamba-exploiting-windows-startup-scripts-using-a-maliciou.html",
    "https://github.com/GDSSecurity/BadSamba"
  ],
  "platform": "Windows",
  "arch": "x86, x64",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Windows x86",
    "Windows x64"
  ],
  "path": "/modules/exploits/windows/smb/group_policy_startup.rb",
  "ref_name": "windows/smb/group_policy_startup",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
    "AKA": [
      "badsamba"
    ]
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "address",
      "name": "SRVHOST",
      "required": true,
      "default": "0.0.0.0",
      "aliases": [

      ],
      "advanced": false,
      "description": "The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses."
    },
    {
      "type": "port",
      "name": "SRVPORT",
      "required": true,
      "default": 445,
      "aliases": [

      ],
      "advanced": false,
      "description": "The local port to listen on."
    },
    {
      "type": "string",
      "name": "ListenerComm",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The specific communication channel to use for this service"
    },
    {
      "type": "bool",
      "name": "SSLCompression",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable SSL/TLS-level compression"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher spec - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maximum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "SMBServerMaximumBuffer",
      "required": true,
      "default": 2,
      "aliases": [

      ],
      "advanced": true,
      "description": "The maximum number of data in megabytes to buffer"
    },
    {
      "type": "integer",
      "name": "SMBServerIdleTimeout",
      "required": true,
      "default": 120,
      "aliases": [

      ],
      "advanced": true,
      "description": "The maximum amount of time to keep an idle session open in seconds"
    },
    {
      "type": "string",
      "name": "SHARE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Share (Default Random)"
    },
    {
      "type": "string",
      "name": "FILE_NAME",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "VBS File name to share (Default: random .vbs)"
    },
    {
      "type": "string",
      "name": "FOLDER_NAME",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Folder name to share (Default none)"
    }
  ]
}