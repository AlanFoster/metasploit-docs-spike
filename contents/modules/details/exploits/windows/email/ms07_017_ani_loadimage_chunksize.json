{
  "name": "Windows ANI LoadAniIcon() Chunk Size Stack Buffer Overflow (SMTP)",
  "fullname": "exploit/windows/email/ms07_017_ani_loadimage_chunksize",
  "aliases": [

  ],
  "rank": 500,
  "disclosure_date": "2007-03-28",
  "type": "exploit",
  "author": [
    "hdm <x@hdm.io>",
    "skape <mmiller@hick.org>"
  ],
  "description": "This module exploits a buffer overflow vulnerability in the\n        LoadAniIcon() function of USER32.dll. The flaw is triggered\n        through Outlook Express by using the CURSOR style sheet\n        directive to load a malicious .ANI file.\n\n        This vulnerability was discovered by Alexander Sotirov of Determina\n        and was rediscovered, in the wild, by McAfee.",
  "references": [
    "https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2007/MS07-017",
    "https://cvedetails.com/cve/CVE-2007-0038/",
    "https://cvedetails.com/cve/CVE-2007-1765/",
    "OSVDB (33629)",
    "http://www.securityfocus.com/bid/23194"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [
    25,
    465,
    587,
    2525,
    25025,
    25000
  ],
  "autofilter_services": [
    "smtp",
    "smtps"
  ],
  "targets": [
    "Automatic",
    "Windows XP SP2 user32.dll 5.1.2600.2622",
    "Windows XP SP2 userenv.dll English",
    "Windows XP SP2 userenv.dll French",
    "Windows XP SP0/SP1 netui2.dll English",
    "Windows 2000 SP0-SP4 netui2.dll English",
    "Windows Vista user32.dll 6.0.6000.16386",
    "Windows XP SP2 user32.dll (5.1.2600.2180) Multi Language",
    "Windows XP SP2 user32.dll (5.1.2600.2180) English",
    "Windows XP SP2 userenv.dll Portuguese (Brazil)",
    "Windows XP SP1a userenv.dll English",
    "Windows XP SP1a shell32.dll English"
  ],
  "path": "/modules/exploits/windows/email/ms07_017_ani_loadimage_chunksize.rb",
  "ref_name": "windows/email/ms07_017_ani_loadimage_chunksize",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "string",
      "name": "VERBOSE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Display verbose information"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "addressrange",
      "name": "RHOSTS",
      "required": true,
      "default": null,
      "aliases": [
        "RHOST"
      ],
      "advanced": false,
      "description": "The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'"
    },
    {
      "type": "port",
      "name": "RPORT",
      "required": true,
      "default": 25,
      "aliases": [

      ],
      "advanced": false,
      "description": "The SMTP server port (e.g. 25, 465, 587, 2525)"
    },
    {
      "type": "bool",
      "name": "SSL",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Negotiate SSL/TLS for outgoing connections"
    },
    {
      "type": "enum",
      "name": "SSLVersion",
      "required": true,
      "default": "Auto",
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)"
    },
    {
      "type": "enum",
      "name": "SSLVerifyMode",
      "required": false,
      "default": "PEER",
      "aliases": [

      ],
      "advanced": true,
      "description": "SSL verification method (Accepted: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER)"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "string",
      "name": "Proxies",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "A proxy chain of format type:host:port[,type:host:port][...]"
    },
    {
      "type": "port",
      "name": "CPORT",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client port"
    },
    {
      "type": "address",
      "name": "CHOST",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client address"
    },
    {
      "type": "integer",
      "name": "ConnectTimeout",
      "required": true,
      "default": 10,
      "aliases": [

      ],
      "advanced": true,
      "description": "Maximum number of seconds to establish a TCP connection"
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maxiumum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "address",
      "name": "RHOST",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The SMTP server to send through"
    },
    {
      "type": "string",
      "name": "DATE",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": false,
      "description": "Override the DATE: field with this value"
    },
    {
      "type": "string",
      "name": "MAILFROM",
      "required": true,
      "default": "random@example.com",
      "aliases": [

      ],
      "advanced": false,
      "description": "The FROM address of the e-mail"
    },
    {
      "type": "string",
      "name": "MAILTO",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The TO address of the email"
    },
    {
      "type": "string",
      "name": "SUBJECT",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Subject line of the email"
    },
    {
      "type": "string",
      "name": "USERNAME",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": false,
      "description": "SMTP Username for sending email"
    },
    {
      "type": "string",
      "name": "PASSWORD",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": false,
      "description": "SMTP Password for sending email"
    },
    {
      "type": "string",
      "name": "DOMAIN",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": false,
      "description": "SMTP Domain to EHLO to"
    }
  ]
}