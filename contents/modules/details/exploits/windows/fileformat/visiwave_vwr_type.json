{
  "name": "VisiWave VWR File Parsing Vulnerability",
  "fullname": "exploit/windows/fileformat/visiwave_vwr_type",
  "aliases": [

  ],
  "rank": 500,
  "disclosure_date": "2011-05-20",
  "type": "exploit",
  "author": [
    "mr_me <steventhomasseeley@gmail.com>",
    "TecR0c <roccogiovannicalvi@gmail.com>"
  ],
  "description": "This module exploits a vulnerability found in VisiWave's Site Survey Report application.\n        When processing .VWR files, VisiWaveReport.exe attempts to match a valid pointer based on the 'Type'\n        property (valid ones include 'Properties', 'TitlePage', 'Details', 'Graph', 'Table', 'Text',\n        'Image'), but if a match isn't found, the function that's supposed to handle this routine\n        ends up returning the input as a pointer, and later used in a CALL DWORD PTR [EDX+10]\n        instruction.  This allows attackers to overwrite it with any arbitrary value, and results code\n        execution.  A patch is available at visiwave.com; the fix is done by XORing the return value as\n        null if no match is found, and then it is validated before use.\n\n        NOTE: During installation, the application will register two file handles, VWS and VWR, which allows a\n        victim user to 'double click' the malicious VWR file and execute code.  This module was also built\n        to bypass ASLR and DEP.",
  "references": [
    "https://cvedetails.com/cve/CVE-2011-2386/",
    "OSVDB (72464)",
    "http://www.visiwave.com/blog/index.php?/archives/4-Version-2.1.9-Released.html",
    "http://www.stratsec.net/Research/Advisories/VisiWave-Site-Survey-Report-Trusted-Pointer-%28SS-20"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Windows XP SP3/Windows 7 SP0"
  ],
  "path": "/modules/exploits/windows/fileformat/visiwave_vwr_type.rb",
  "ref_name": "windows/fileformat/visiwave_vwr_type",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "string",
      "name": "FILENAME",
      "required": true,
      "default": "msf.vwr",
      "aliases": [

      ],
      "advanced": false,
      "description": "The file name."
    }
  ]
}