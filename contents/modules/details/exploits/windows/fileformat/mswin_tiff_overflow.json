{
  "name": "MS13-096 Microsoft Tagged Image File Format (TIFF) Integer Overflow",
  "fullname": "exploit/windows/fileformat/mswin_tiff_overflow",
  "aliases": [

  ],
  "rank": 200,
  "disclosure_date": "2013-11-05",
  "type": "exploit",
  "author": [
    "Unknown",
    "sinn3r <sinn3r@metasploit.com>"
  ],
  "description": "This module exploits a vulnerability found in Microsoft's Tagged Image File Format.\n          It was originally discovered in the wild, targeting Windows XP and Windows Server 2003\n          users running Microsoft Office, specifically in the Middle East and South Asia region.\n\n          The flaw is due to a DWORD value extracted from the TIFF file that is embedded as a\n          drawing in Microsoft Office, and how it gets calculated with user-controlled inputs,\n          and stored in the EAX register. The 32-bit register will run out of storage space to\n          represent the large value, which ends up being 0, but it still gets pushed as a\n          dwBytes argument (size) for a HeapAlloc call. The HeapAlloc function will allocate a\n          chunk anyway with size 0, and the address of this chunk is used as the destination buffer\n          of a memcpy function, where the source buffer is the EXIF data (an extended image format\n          supported by TIFF), and is also user-controlled. A function pointer in the chunk returned\n          by HeapAlloc will end up being overwritten by the memcpy function, and then later used\n          in OGL!GdipCreatePath. By successfully controlling this function pointer, and the\n          memory layout using ActiveX, it is possible to gain arbitrary code execution under the\n          context of the user.",
  "references": [
    "https://cvedetails.com/cve/CVE-2013-3906/",
    "https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2013/MS13-096",
    "OSVDB (99376)",
    "http://technet.microsoft.com/en-us/security/advisory/2896666",
    "http://blogs.technet.com/b/srd/archive/2013/11/05/cve-2013-3906-a-graphics-vulnerability-exploited-through-word-documents.aspx"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Windows XP SP3 with Office Standard 2010"
  ],
  "path": "/modules/exploits/windows/fileformat/mswin_tiff_overflow.rb",
  "ref_name": "windows/fileformat/mswin_tiff_overflow",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "string",
      "name": "FILENAME",
      "required": true,
      "default": "msf.docx",
      "aliases": [

      ],
      "advanced": false,
      "description": "The docx file"
    }
  ]
}