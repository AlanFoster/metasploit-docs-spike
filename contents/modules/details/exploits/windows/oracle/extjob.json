{
  "name": "Oracle Job Scheduler Named Pipe Command Execution",
  "fullname": "exploit/windows/oracle/extjob",
  "aliases": [

  ],
  "rank": 600,
  "disclosure_date": "2007-01-01",
  "type": "exploit",
  "author": [
    "David Litchfield",
    "juan vazquez <juan.vazquez@metasploit.com>",
    "sinn3r <sinn3r@metasploit.com>"
  ],
  "description": "This module exploits the Oracle Job Scheduler to execute arbitrary commands. The Job\n        Scheduler is implemented via the component extjob.exe which listens on a named pipe\n        called \"orcljsex<SID>\" and execute arbitrary commands received over this channel via\n        CreateProcess(). In order to connect to the Named Pipe remotely, SMB access is required.\n        Note that the Job Scheduler is disabled in default installations.",
  "references": [
    "http://www.amazon.com/Oracle-Hackers-Handbook-Hacking-Defending/dp/0470080221"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [
    139,
    445
  ],
  "autofilter_services": [
    "netbios-ssn",
    "microsoft-ds"
  ],
  "targets": [
    "Automatic"
  ],
  "path": "/modules/exploits/windows/oracle/extjob.rb",
  "ref_name": "windows/oracle/extjob",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "addressrange",
      "name": "RHOSTS",
      "required": true,
      "default": null,
      "aliases": [
        "RHOST"
      ],
      "advanced": false,
      "description": "The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'"
    },
    {
      "type": "port",
      "name": "RPORT",
      "required": true,
      "default": 445,
      "aliases": [

      ],
      "advanced": false,
      "description": "The SMB service port"
    },
    {
      "type": "bool",
      "name": "SSL",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Negotiate SSL for incoming connections"
    },
    {
      "type": "enum",
      "name": "SSLVersion",
      "required": true,
      "default": "Auto",
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)"
    },
    {
      "type": "enum",
      "name": "SSLVerifyMode",
      "required": false,
      "default": "PEER",
      "aliases": [

      ],
      "advanced": true,
      "description": "SSL verification method (Accepted: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER)"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher spec - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "string",
      "name": "Proxies",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "A proxy chain of format type:host:port[,type:host:port][...]"
    },
    {
      "type": "port",
      "name": "CPORT",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client port"
    },
    {
      "type": "address",
      "name": "CHOST",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client address"
    },
    {
      "type": "integer",
      "name": "ConnectTimeout",
      "required": true,
      "default": 10,
      "aliases": [

      ],
      "advanced": true,
      "description": "Maximum number of seconds to establish a TCP connection"
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maximum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "bool",
      "name": "NTLM::UseNTLMv2",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use NTLMv2 instead of NTLM2_session when 'Negotiate NTLM2' key is true"
    },
    {
      "type": "bool",
      "name": "NTLM::UseNTLM2_session",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Activate the 'Negotiate NTLM2 key' flag, forcing the use of a NTLMv2_session"
    },
    {
      "type": "bool",
      "name": "NTLM::SendLM",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Always send the LANMAN response (except when NTLMv2_session is specified)"
    },
    {
      "type": "bool",
      "name": "NTLM::UseLMKey",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Activate the 'Negotiate Lan Manager Key' flag, using the LM key when the LM response is sent"
    },
    {
      "type": "bool",
      "name": "NTLM::SendNTLM",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Activate the 'Negotiate NTLM key' flag, indicating the use of NTLM responses"
    },
    {
      "type": "bool",
      "name": "NTLM::SendSPN",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Send an avp of type SPN in the ntlmv2 client blob, this allows authentication on Windows 7+/Server 2008 R2+ when SPN is required"
    },
    {
      "type": "bool",
      "name": "SMB::pipe_evasion",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Enable segmented read/writes for SMB Pipes"
    },
    {
      "type": "integer",
      "name": "SMB::pipe_write_min_size",
      "required": true,
      "default": 1,
      "aliases": [

      ],
      "advanced": false,
      "description": "Minimum buffer size for pipe writes"
    },
    {
      "type": "integer",
      "name": "SMB::pipe_write_max_size",
      "required": true,
      "default": 1024,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maximum buffer size for pipe writes"
    },
    {
      "type": "integer",
      "name": "SMB::pipe_read_min_size",
      "required": true,
      "default": 1,
      "aliases": [

      ],
      "advanced": false,
      "description": "Minimum buffer size for pipe reads"
    },
    {
      "type": "integer",
      "name": "SMB::pipe_read_max_size",
      "required": true,
      "default": 1024,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maximum buffer size for pipe reads"
    },
    {
      "type": "integer",
      "name": "SMB::pad_data_level",
      "required": true,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Place extra padding between headers and data (level 0-3)"
    },
    {
      "type": "integer",
      "name": "SMB::pad_file_level",
      "required": true,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Obscure path names used in open/create (level 0-3)"
    },
    {
      "type": "integer",
      "name": "SMB::obscure_trans_pipe_level",
      "required": true,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Obscure PIPE string in TransNamedPipe (level 0-3)"
    },
    {
      "type": "bool",
      "name": "SMBDirect",
      "required": false,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "The target port is a raw SMB service (not NetBIOS)"
    },
    {
      "type": "string",
      "name": "SMBUser",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": true,
      "description": "The username to authenticate as"
    },
    {
      "type": "string",
      "name": "SMBPass",
      "required": false,
      "default": "",
      "aliases": [

      ],
      "advanced": true,
      "description": "The password for the specified username"
    },
    {
      "type": "string",
      "name": "SMBDomain",
      "required": false,
      "default": ".",
      "aliases": [

      ],
      "advanced": true,
      "description": "The Windows domain to use for authentication"
    },
    {
      "type": "string",
      "name": "SMBName",
      "required": true,
      "default": "*SMBSERVER",
      "aliases": [

      ],
      "advanced": true,
      "description": "The NetBIOS hostname (required for port 139 connections)"
    },
    {
      "type": "bool",
      "name": "SMB::VerifySignature",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enforces client-side verification of server response signatures"
    },
    {
      "type": "integer",
      "name": "SMB::ChunkSize",
      "required": true,
      "default": 500,
      "aliases": [

      ],
      "advanced": true,
      "description": "The chunk size for SMB segments, bigger values will increase speed but break NT 4.0 and SMB signing"
    },
    {
      "type": "string",
      "name": "SMB::Native_OS",
      "required": true,
      "default": "Windows 2000 2195",
      "aliases": [

      ],
      "advanced": true,
      "description": "The Native OS to send during authentication"
    },
    {
      "type": "string",
      "name": "SMB::Native_LM",
      "required": true,
      "default": "Windows 2000 5.0",
      "aliases": [

      ],
      "advanced": true,
      "description": "The Native LM to send during authentication"
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "address",
      "name": "SRVHOST",
      "required": true,
      "default": "0.0.0.0",
      "aliases": [

      ],
      "advanced": false,
      "description": "The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses."
    },
    {
      "type": "port",
      "name": "SRVPORT",
      "required": true,
      "default": 8080,
      "aliases": [

      ],
      "advanced": false,
      "description": "The local port to listen on."
    },
    {
      "type": "string",
      "name": "ListenerComm",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The specific communication channel to use for this service"
    },
    {
      "type": "path",
      "name": "SSLCert",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Path to a custom SSL certificate (default is randomly generated)"
    },
    {
      "type": "bool",
      "name": "SSLCompression",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable SSL/TLS-level compression"
    },
    {
      "type": "string",
      "name": "URIPATH",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The URI to use for this exploit (default is random)"
    },
    {
      "type": "bool",
      "name": "HTTP::no_cache",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Disallow the browser to cache HTTP content"
    },
    {
      "type": "bool",
      "name": "HTTP::chunked",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Enable chunking of HTTP responses via \"Transfer-Encoding: chunked\""
    },
    {
      "type": "bool",
      "name": "HTTP::header_folding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Enable folding of HTTP headers"
    },
    {
      "type": "bool",
      "name": "HTTP::junk_headers",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Enable insertion of random junk HTTP headers"
    },
    {
      "type": "enum",
      "name": "HTTP::compression",
      "required": false,
      "default": "none",
      "aliases": [

      ],
      "advanced": false,
      "description": "Enable compression of HTTP responses via content encoding (Accepted: none, gzip, deflate)"
    },
    {
      "type": "string",
      "name": "HTTP::server_name",
      "required": true,
      "default": "Apache",
      "aliases": [

      ],
      "advanced": false,
      "description": "Configures the Server header of all outgoing replies"
    },
    {
      "type": "address",
      "name": "URIHOST",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Host to use in URI (useful for tunnels)"
    },
    {
      "type": "port",
      "name": "URIPORT",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Port to use in URI (useful for tunnels)"
    },
    {
      "type": "bool",
      "name": "SendRobots",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Return a robots.txt file if asked for one"
    },
    {
      "type": "enum",
      "name": "CMDSTAGER::FLAVOR",
      "required": false,
      "default": "auto",
      "aliases": [

      ],
      "advanced": true,
      "description": "The CMD Stager to use. (Accepted: auto, vbs)"
    },
    {
      "type": "string",
      "name": "CMDSTAGER::DECODER",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The decoder stub to use."
    },
    {
      "type": "string",
      "name": "CMDSTAGER::TEMP",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Writable directory for staged files"
    },
    {
      "type": "bool",
      "name": "CMDSTAGER::SSL",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use SSL/TLS for supported stagers"
    },
    {
      "type": "string",
      "name": "SID",
      "required": true,
      "default": "ORCL",
      "aliases": [

      ],
      "advanced": false,
      "description": "The database sid"
    }
  ]
}