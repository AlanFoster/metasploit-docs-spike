{
  "name": "CVE-2019-0708 BlueKeep RDP Remote Windows Kernel Use After Free",
  "fullname": "exploit/windows/rdp/cve_2019_0708_bluekeep_rce",
  "aliases": [

  ],
  "rank": 0,
  "disclosure_date": "2019-05-14",
  "type": "exploit",
  "author": [
    "Sean Dillon <sean.dillon@risksense.com>",
    "Ryan Hanson",
    "OJ Reeves <oj@beyondbinary.io>",
    "Brent Cook <bcook@rapid7.com>"
  ],
  "description": "The RDP termdd.sys driver improperly handles binds to internal-only channel MS_T120,\n        allowing a malformed Disconnect Provider Indication message to cause use-after-free.\n        With a controllable data/size remote nonpaged pool spray, an indirect call gadget of\n        the freed channel is used to achieve arbitrary code execution.\n\n        Windows 7 SP1 and Windows Server 2008 R2 are the only currently supported targets.\n\n        Windows 7 SP1 should be exploitable in its default configuration, assuming your target\n        selection is correctly matched to the system's memory layout.\n\n        HKLM\\SYSTEM\\CurrentControlSet\\Control\\TerminalServer\\Winstations\\RDP-Tcp\\fDisableCam\n        *needs* to be set to 0 for exploitation to succeed against Windows Server 2008 R2.\n        This is a non-standard configuration for normal servers, and the target will crash if\n        the aforementioned Registry key is not set!\n\n        If the target is crashing regardless, you will likely need to determine the non-paged\n        pool base in kernel memory and set it as the GROOMBASE option.",
  "references": [
    "https://cvedetails.com/cve/CVE-2019-0708/",
    "https://github.com/zerosum0x0/CVE-2019-0708",
    "https://zerosum0x0.blogspot.com/2019/11/fixing-remote-windows-kernel-payloads-meltdown.html"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Automatic targeting via fingerprinting",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Virtualbox 6)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 14)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - Hyper-V)",
    "Windows 7 SP1 / 2008 R2 (6.1.7601 x64 - AWS)"
  ],
  "path": "/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb",
  "ref_name": "windows/rdp/cve_2019_0708_bluekeep_rce",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
    "AKA": [
      "Bluekeep"
    ]
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "addressrange",
      "name": "RHOSTS",
      "required": true,
      "default": null,
      "aliases": [
        "RHOST"
      ],
      "advanced": false,
      "description": "The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'"
    },
    {
      "type": "port",
      "name": "RPORT",
      "required": true,
      "default": 3389,
      "aliases": [

      ],
      "advanced": false,
      "description": "The target port"
    },
    {
      "type": "bool",
      "name": "SSL",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Negotiate SSL/TLS for outgoing connections"
    },
    {
      "type": "enum",
      "name": "SSLVersion",
      "required": true,
      "default": "Auto",
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)"
    },
    {
      "type": "enum",
      "name": "SSLVerifyMode",
      "required": false,
      "default": "PEER",
      "aliases": [

      ],
      "advanced": true,
      "description": "SSL verification method (Accepted: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER)"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "string",
      "name": "Proxies",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "A proxy chain of format type:host:port[,type:host:port][...]"
    },
    {
      "type": "port",
      "name": "CPORT",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client port"
    },
    {
      "type": "address",
      "name": "CHOST",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client address"
    },
    {
      "type": "integer",
      "name": "ConnectTimeout",
      "required": true,
      "default": 10,
      "aliases": [

      ],
      "advanced": true,
      "description": "Maximum number of seconds to establish a TCP connection"
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maxiumum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "string",
      "name": "RDP_USER",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The username to report during connect, UNSET = random"
    },
    {
      "type": "string",
      "name": "RDP_CLIENT_NAME",
      "required": false,
      "default": "rdesktop",
      "aliases": [

      ],
      "advanced": false,
      "description": "The client computer name to report during connect, UNSET = random"
    },
    {
      "type": "string",
      "name": "RDP_DOMAIN",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The client domain name to report during connect"
    },
    {
      "type": "address",
      "name": "RDP_CLIENT_IP",
      "required": true,
      "default": "192.168.0.100",
      "aliases": [

      ],
      "advanced": false,
      "description": "The client IPv4 address to report during connect"
    },
    {
      "type": "integer",
      "name": "RDP_TLS_SECURITY_LEVEL",
      "required": true,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Change default TLS security level. \"0\" (default) means everything is permitted. \"1\" rejects very weak parameters and \"2\" is even stricter."
    },
    {
      "type": "string",
      "name": "CheckModule",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Module to check with"
    },
    {
      "type": "bool",
      "name": "ForceExploit",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Override check result"
    },
    {
      "type": "integer",
      "name": "GROOMSIZE",
      "required": true,
      "default": 250,
      "aliases": [

      ],
      "advanced": true,
      "description": "Size of the groom in MB"
    },
    {
      "type": "enum",
      "name": "GROOMCHANNEL",
      "required": true,
      "default": "RDPSND",
      "aliases": [

      ],
      "advanced": true,
      "description": "Channel to use for grooming (Accepted: RDPSND, MS_T120)"
    },
    {
      "type": "integer",
      "name": "GROOMCHANNELCOUNT",
      "required": true,
      "default": 1,
      "aliases": [

      ],
      "advanced": true,
      "description": "Number of channels to groom"
    },
    {
      "type": "float",
      "name": "GROOMDELAY",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Delay in seconds between sending 1 MB of groom packets"
    }
  ]
}