{
  "name": "Persistent Payload in Windows Volume Shadow Copy",
  "fullname": "exploit/windows/local/vss_persistence",
  "aliases": [

  ],
  "rank": 600,
  "disclosure_date": "2011-10-21",
  "type": "exploit",
  "author": [
    "Jedediah Rodriguez <Jedi.rodriguez@gmail.com>"
  ],
  "description": "This module will attempt to create a persistent payload in a new volume shadow copy. This is\n        based on the VSSOwn Script originally posted by Tim Tomes and Mark Baggett. This module has\n        been tested successfully on Windows 7. In order to achieve persistence through the RUNKEY\n        option, the user should need password in order to start session on the target machine.",
  "references": [
    "http://pauldotcom.com/2011/11/safely-dumping-hashes-from-liv.html",
    "http://www.irongeek.com/i.php?page=videos/hack3rcon2/tim-tomes-and-mark-baggett-lurking-in-the-shadows"
  ],
  "platform": "Windows",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Windows 7"
  ],
  "path": "/modules/exploits/windows/local/vss_persistence.rb",
  "ref_name": "windows/local/vss_persistence",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    },
    {
      "type": "string",
      "name": "SMBUser",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The username to authenticate as"
    },
    {
      "type": "string",
      "name": "SMBPass",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The password for the specified username"
    },
    {
      "type": "string",
      "name": "SMBDomain",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The Windows domain to use for authentication"
    },
    {
      "type": "address",
      "name": "RHOST",
      "required": true,
      "default": "localhost",
      "aliases": [

      ],
      "advanced": false,
      "description": "Target address range"
    },
    {
      "type": "integer",
      "name": "TIMEOUT",
      "required": true,
      "default": 60,
      "aliases": [

      ],
      "advanced": false,
      "description": "Timeout for WMI command in seconds"
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "string",
      "name": "VOLUME",
      "required": true,
      "default": "C:\\",
      "aliases": [

      ],
      "advanced": false,
      "description": "Volume to make a copy of."
    },
    {
      "type": "bool",
      "name": "EXECUTE",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": false,
      "description": "Run the EXE on the remote system."
    },
    {
      "type": "bool",
      "name": "SCHTASK",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Create a Scheduled Task for the EXE."
    },
    {
      "type": "bool",
      "name": "RUNKEY",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": false,
      "description": "Create AutoRun Key for the EXE"
    },
    {
      "type": "integer",
      "name": "DELAY",
      "required": true,
      "default": 1,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delay in Minutes for Reconnect attempt. Needs SCHTASK set to true to work. Default delay is 1 minute."
    },
    {
      "type": "string",
      "name": "RPATH",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "Path on remote system to place Executable. Example: \\\\Windows\\\\Temp (DO NOT USE C:\\ in your RPATH!)"
    }
  ]
}