{
  "name": "MS11-080 AfdJoinLeaf Privilege Escalation",
  "fullname": "exploit/windows/local/ms11_080_afdjoinleaf",
  "aliases": [

  ],
  "rank": 200,
  "disclosure_date": "2011-11-30",
  "type": "exploit",
  "author": [
    "Matteo Memelli",
    "Spencer McIntyre"
  ],
  "description": "This module exploits a flaw in the AfdJoinLeaf function of the\n        afd.sys driver to overwrite data in kernel space.  An address\n        within the HalDispatchTable is overwritten and when triggered\n        with a call to NtQueryIntervalProfile will execute shellcode.\n\n        This module will elevate itself to SYSTEM, then inject the payload\n        into another SYSTEM process before restoring its own token to\n        avoid causing system instability.",
  "references": [
    "https://cvedetails.com/cve/CVE-2011-2005/",
    "OSVDB (76232)",
    "https://www.exploit-db.com/exploits/18176",
    "https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2011/MS11-080",
    "http://www.offensive-security.com/vulndev/ms11-080-voyage-into-ring-zero/"
  ],
  "platform": "Windows",
  "arch": "x86",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Automatic",
    "Windows XP SP2 / SP3",
    "Windows Server 2003 SP2"
  ],
  "path": "/modules/exploits/windows/local/ms11_080_afdjoinleaf.rb",
  "ref_name": "windows/local/ms11_080_afdjoinleaf",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
    "Stability": [
      "crash-os-restarts"
    ]
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    }
  ]
}