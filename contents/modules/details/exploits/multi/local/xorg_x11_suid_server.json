{
  "name": "Xorg X11 Server SUID logfile Privilege Escalation",
  "fullname": "exploit/multi/local/xorg_x11_suid_server",
  "aliases": [

  ],
  "rank": 400,
  "disclosure_date": "2018-10-25",
  "type": "exploit",
  "author": [
    "Narendra Shinde",
    "Raptor - 0xdea",
    "Aaron Ringo",
    "bcoles <bcoles@gmail.com>"
  ],
  "description": "This module attempts to gain root privileges with SUID Xorg X11 server\n        versions 1.19.0 < 1.20.3.\n\n        A permission check flaw exists for -modulepath and -logfile options when\n        starting Xorg. This allows unprivileged users that can start the server\n        the ability to elevate privileges and run arbitrary code under root\n        privileges.\n\n        This module has been tested with OpenBSD 6.3, 6.4, CentOS 7.4.1708, and\n        CentOS 7.5.1804, and RHEL 7.5. The default PAM configuration for CentOS\n        and RHEL systems requires console auth for the user's session to start\n        the Xorg server.\n\n        Cron launches the payload, so if SELinux is enforcing, exploitation\n        may still be possible, but the module will bail.\n\n        Xorg must have SUID permissions and may not start if already running.\n\n        On exploitation a crontab.old backup file will be created by Xorg.\n        This module will remove the .old file and restore crontab after\n        successful exploitation. Failed exploitation may result in a corrupted\n        crontab. On successful exploitation artifacts will be created consistant\n        with starting Xorg and running a cron.",
  "references": [
    "https://cvedetails.com/cve/CVE-2018-14665/",
    "http://www.securityfocus.com/bid/105741",
    "https://www.exploit-db.com/exploits/45697",
    "https://www.exploit-db.com/exploits/45742",
    "https://www.exploit-db.com/exploits/45832",
    "https://www.securepatterns.com/2018/10/cve-2018-14665-xorg-x-server.html",
    "https://github.com/0xdea/exploits/blob/master/openbsd/raptor_xorgasm"
  ],
  "platform": "OpenBSD, Linux",
  "arch": "cmd, x86, x64",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "OpenBSD",
    "Linux x64",
    "Linux x86"
  ],
  "path": "/modules/exploits/multi/local/xorg_x11_suid_server.rb",
  "ref_name": "multi/local/xorg_x11_suid_server",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "integer",
      "name": "FileDropperDelay",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Delay in seconds before attempting cleanup"
    },
    {
      "type": "string",
      "name": "WritableDir",
      "required": true,
      "default": "/tmp",
      "aliases": [

      ],
      "advanced": true,
      "description": "A directory where we can write files"
    },
    {
      "type": "string",
      "name": "Xdisplay",
      "required": true,
      "default": ":1",
      "aliases": [

      ],
      "advanced": true,
      "description": "Display exploit will attempt to use"
    },
    {
      "type": "bool",
      "name": "ConsoleLock",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Will check for console lock on linux systems"
    }
  ]
}