{
  "name": "glibc '$ORIGIN' Expansion Privilege Escalation",
  "fullname": "exploit/linux/local/glibc_origin_expansion_priv_esc",
  "aliases": [

  ],
  "rank": 600,
  "disclosure_date": "2010-10-18",
  "type": "exploit",
  "author": [
    "Tavis Ormandy",
    "bcoles <bcoles@gmail.com>"
  ],
  "description": "This module attempts to gain root privileges on Linux systems by abusing\n        a vulnerability in the GNU C Library (glibc) dynamic linker.\n\n        glibc `ld.so` versions before 2.11.3, and 2.12.x before 2.12.2 does not\n        properly restrict use of the `LD_AUDIT` environment variable when loading\n        setuid executables which allows control over the `$ORIGIN` library search\n        path resulting in execution of arbitrary shared objects.\n\n        This module opens a file descriptor to the specified suid executable via\n        a hard link, then replaces the hard link with a shared object before\n        instructing the linker to execute the file descriptor, resulting in\n        arbitrary code execution.\n\n        The specified setuid binary must be readable and located on the same\n        file system partition as the specified writable directory.\n\n        This module has been tested successfully on:\n\n        glibc 2.5 on CentOS 5.4 (x86_64);\n        glibc 2.5 on CentOS 5.5 (x86_64);\n        glibc 2.12 on Fedora 13 (i386); and\n        glibc 2.5-49 on RHEL 5.5 (x86_64).\n\n        Some versions of `ld.so`, such as the version shipped with Ubuntu 14,\n        hit a failed assertion in `dl_open_worker` causing exploitation to fail.",
  "references": [
    "https://cvedetails.com/cve/CVE-2010-3847/",
    "http://www.securityfocus.com/bid/44154",
    "https://www.exploit-db.com/exploits/15274",
    "https://seclists.org/fulldisclosure/2010/Oct/257",
    "https://www.ubuntu.com/usn/usn-1009-1",
    "https://security-tracker.debian.org/tracker/CVE-2010-3847",
    "https://access.redhat.com/security/cve/CVE-2010-3847"
  ],
  "platform": "Linux",
  "arch": "x86, x64",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Automatic",
    "Linux x86",
    "Linux x64"
  ],
  "path": "/modules/exploits/linux/local/glibc_origin_expansion_priv_esc.rb",
  "ref_name": "linux/local/glibc_origin_expansion_priv_esc",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "integer",
      "name": "FileDropperDelay",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Delay in seconds before attempting cleanup"
    },
    {
      "type": "string",
      "name": "SUID_EXECUTABLE",
      "required": true,
      "default": "/bin/ping",
      "aliases": [

      ],
      "advanced": false,
      "description": "Path to a suid executable"
    },
    {
      "type": "string",
      "name": "WritableDir",
      "required": true,
      "default": "/tmp",
      "aliases": [

      ],
      "advanced": true,
      "description": "A directory where we can write files"
    }
  ]
}