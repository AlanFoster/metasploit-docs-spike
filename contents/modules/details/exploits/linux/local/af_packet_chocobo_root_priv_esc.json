{
  "name": "AF_PACKET chocobo_root Privilege Escalation",
  "fullname": "exploit/linux/local/af_packet_chocobo_root_priv_esc",
  "aliases": [

  ],
  "rank": 400,
  "disclosure_date": "2016-08-12",
  "type": "exploit",
  "author": [
    "rebel",
    "bcoles <bcoles@gmail.com>"
  ],
  "description": "This module exploits a race condition and use-after-free in the\n        packet_set_ring function in net/packet/af_packet.c (AF_PACKET) in\n        the Linux kernel to execute code as root (CVE-2016-8655).\n\n        The bug was initially introduced in 2011 and patched in 2016 in version\n        4.4.0-53.74, potentially affecting a large number of kernels; however\n        this exploit targets only systems using Ubuntu (Trusty / Xenial) kernels\n        4.4.0 < 4.4.0-53, including Linux distros based on Ubuntu, such as\n        Linux Mint.\n\n        The target system must have unprivileged user namespaces enabled,\n        two or more CPU cores, and SMAP must be disabled.\n\n        Bypasses for SMEP and KASLR are included. Failed exploitation\n        may crash the kernel.\n\n        This module has been tested successfully on\n\n        Linux Mint 17.3 (x86_64);\n        Linux Mint 18 (x86_64);\n        Ubuntu 16.04 (x86_64); and\n        Ubuntu 16.04.2 (x86_64).",
  "references": [
    "https://www.exploit-db.com/exploits/40871",
    "https://cvedetails.com/cve/CVE-2016-8655/",
    "http://www.securityfocus.com/bid/94692",
    "https://seclists.org/oss-sec/2016/q4/607",
    "https://seclists.org/oss-sec/2016/q4/att-621/chocobo_root_c.bin",
    "https://github.com/bcoles/kernel-exploits/blob/master/CVE-2016-8655/chocobo_root.c",
    "https://bitbucket.org/externalist/1day_exploits/src/master/CVE-2016-8655/CVE-2016-8655_chocobo_root_commented.c",
    "https://usn.ubuntu.com/3151-1/",
    "https://www.securitytracker.com/id/1037403",
    "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=84ac7260236a49c79eede91617700174c2c19b0c"
  ],
  "platform": "Linux",
  "arch": "x86, x64",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Auto"
  ],
  "path": "/modules/exploits/linux/local/af_packet_chocobo_root_priv_esc.rb",
  "ref_name": "linux/local/af_packet_chocobo_root_priv_esc",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
    "AKA": [
      "chocobo_root.c"
    ],
    "Reliability": [
      "repeatable-session"
    ],
    "Stability": [
      "crash-os-down"
    ]
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    },
    {
      "type": "enum",
      "name": "COMPILE",
      "required": true,
      "default": "Auto",
      "aliases": [

      ],
      "advanced": false,
      "description": "Compile on target (Accepted: Auto, True, False)"
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "integer",
      "name": "FileDropperDelay",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Delay in seconds before attempting cleanup"
    },
    {
      "type": "integer",
      "name": "TIMEOUT",
      "required": true,
      "default": "600",
      "aliases": [

      ],
      "advanced": false,
      "description": "Race timeout (seconds)"
    },
    {
      "type": "bool",
      "name": "ForceExploit",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Override check result"
    },
    {
      "type": "string",
      "name": "WritableDir",
      "required": true,
      "default": "/tmp",
      "aliases": [

      ],
      "advanced": true,
      "description": "A directory where we can write files"
    }
  ]
}