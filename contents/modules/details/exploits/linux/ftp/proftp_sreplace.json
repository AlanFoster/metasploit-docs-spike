{
  "name": "ProFTPD 1.2 - 1.3.0 sreplace Buffer Overflow (Linux)",
  "fullname": "exploit/linux/ftp/proftp_sreplace",
  "aliases": [

  ],
  "rank": 500,
  "disclosure_date": "2006-11-26",
  "type": "exploit",
  "author": [
    "Evgeny Legerov <admin@gleg.net>",
    "jduck <jduck@metasploit.com>"
  ],
  "description": "This module exploits a stack-based buffer overflow in versions 1.2 through\n        1.3.0 of ProFTPD server. The vulnerability is within the \"sreplace\" function\n        within the \"src/support.c\" file.\n\n        The off-by-one heap overflow bug in the ProFTPD sreplace function has been\n        discovered about 2 (two) years ago by Evgeny Legerov. We tried to exploit\n        this off-by-one bug via MKD command, but failed. We did not work on this bug\n        since then.\n\n        Actually, there are exists at least two bugs in sreplace function, one is the\n        mentioned off-by-one heap overflow bug the other is a stack-based buffer overflow\n        via 'sstrncpy(dst,src,negative argument)'.\n\n        We were unable to reach the \"sreplace\" stack bug on ProFTPD 1.2.10 stable\n        version, but the version 1.3.0rc3 introduced some interesting changes, among them:\n\n        1. another (integer) overflow in sreplace!\n        2. now it is possible to reach sreplace stack-based buffer overflow bug via\n          the \"pr_display_file\" function!\n        3. stupid '.message' file display bug\n\n        So we decided to choose ProFTPD 1.3.0 as a target for our exploit.\n        To reach the bug, you need to upload a specially created .message file to a\n        writeable directory, then do \"CWD <writeable directory>\" to trigger the invocation\n        of sreplace function.\n\n        Note that ProFTPD 1.3.0rc3 has introduced a stupid bug: to display '.message'\n        file you also have to upload a file named '250'. ProFTPD 1.3.0 fixes this bug.\n\n        The exploit is a part of VulnDisco Pack since Dec 2005.",
  "references": [
    "https://cvedetails.com/cve/CVE-2006-5815/",
    "OSVDB (68985)",
    "http://www.securityfocus.com/bid/20992",
    "https://seclists.org/bugtraq/2006/Nov/94",
    "https://seclists.org/bugtraq/2006/Nov/538",
    "http://bugs.proftpd.org/show_bug.cgi?id=2858",
    "http://proftp.cvs.sourceforge.net/proftp/proftpd/src/main.c?view=diff&r1=text&tr1=1.292&r2=text&tr2=1.294&diff_format=h"
  ],
  "platform": "Linux",
  "arch": "",
  "autofilter_ports": [
    21,
    2121
  ],
  "autofilter_services": [
    "ftp"
  ],
  "targets": [
    "Automatic Targeting",
    "Debug",
    "ProFTPD 1.3.0 (source install) / Debian 3.1"
  ],
  "path": "/modules/exploits/linux/ftp/proftp_sreplace.rb",
  "ref_name": "linux/ftp/proftp_sreplace",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "addressrange",
      "name": "RHOSTS",
      "required": true,
      "default": null,
      "aliases": [
        "RHOST"
      ],
      "advanced": false,
      "description": "The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'"
    },
    {
      "type": "port",
      "name": "RPORT",
      "required": true,
      "default": 21,
      "aliases": [

      ],
      "advanced": false,
      "description": "The target port"
    },
    {
      "type": "bool",
      "name": "SSL",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Negotiate SSL/TLS for outgoing connections"
    },
    {
      "type": "enum",
      "name": "SSLVersion",
      "required": true,
      "default": "Auto",
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2)"
    },
    {
      "type": "enum",
      "name": "SSLVerifyMode",
      "required": false,
      "default": "PEER",
      "aliases": [

      ],
      "advanced": true,
      "description": "SSL verification method (Accepted: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER)"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "string",
      "name": "Proxies",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "A proxy chain of format type:host:port[,type:host:port][...]"
    },
    {
      "type": "port",
      "name": "CPORT",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client port"
    },
    {
      "type": "address",
      "name": "CHOST",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The local client address"
    },
    {
      "type": "integer",
      "name": "ConnectTimeout",
      "required": true,
      "default": 10,
      "aliases": [

      ],
      "advanced": true,
      "description": "Maximum number of seconds to establish a TCP connection"
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maxiumum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "string",
      "name": "FTPUSER",
      "required": false,
      "default": "anonymous",
      "aliases": [

      ],
      "advanced": false,
      "description": "The username to authenticate as"
    },
    {
      "type": "string",
      "name": "FTPPASS",
      "required": false,
      "default": "mozilla@example.com",
      "aliases": [

      ],
      "advanced": false,
      "description": "The password for the specified username"
    },
    {
      "type": "integer",
      "name": "FTPTimeout",
      "required": true,
      "default": 16,
      "aliases": [

      ],
      "advanced": true,
      "description": "The number of seconds to wait for a reply from an FTP command"
    },
    {
      "type": "bool",
      "name": "FTPDEBUG",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Whether or not to print verbose debug statements"
    },
    {
      "type": "bool",
      "name": "PassiveMode",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set true for extended passive (EPSV) ftp mode."
    },
    {
      "type": "string",
      "name": "WRITABLE",
      "required": true,
      "default": "/incoming",
      "aliases": [

      ],
      "advanced": false,
      "description": "A writable directory on the target host"
    }
  ]
}