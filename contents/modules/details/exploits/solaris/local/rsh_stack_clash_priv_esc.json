{
  "name": "Solaris RSH Stack Clash Privilege Escalation",
  "fullname": "exploit/solaris/local/rsh_stack_clash_priv_esc",
  "aliases": [

  ],
  "rank": 400,
  "disclosure_date": "2017-06-19",
  "type": "exploit",
  "author": [
    "Qualys Corporation",
    "bcoles <bcoles@gmail.com>"
  ],
  "description": "This module exploits a vulnerability in RSH on unpatched Solaris\n        systems which allows users to gain root privileges.\n\n        The stack guard page on unpatched Solaris systems is of\n        insufficient size to prevent collisions between the stack\n        and heap memory, aka Stack Clash.\n\n        This module uploads and executes Qualys' Solaris_rsh.c exploit,\n        which exploits a vulnerability in RSH to bypass the stack guard\n        page to write to the stack and create a SUID root shell.\n\n        This module has offsets for Solaris versions 11.1 (x86) and\n        Solaris 11.3 (x86).\n\n        Exploitation will usually complete within a few minutes using\n        the default number of worker threads (10). Occasionally,\n        exploitation will fail. If the target system is vulnerable,\n        usually re-running the exploit will be successful.\n\n        This module has been tested successfully on Solaris 11.1 (x86)\n        and Solaris 11.3 (x86).",
  "references": [
    "http://www.securityfocus.com/bid/99151",
    "http://www.securityfocus.com/bid/99153",
    "https://cvedetails.com/cve/CVE-2017-1000364/",
    "https://cvedetails.com/cve/CVE-2017-3629/",
    "https://cvedetails.com/cve/CVE-2017-3630/",
    "https://cvedetails.com/cve/CVE-2017-3631/",
    "https://www.exploit-db.com/exploits/42270",
    "http://www.oracle.com/technetwork/security-advisory/alert-cve-2017-3629-3757403.html",
    "https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash",
    "https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt"
  ],
  "platform": "Unix",
  "arch": "x86, x64",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": [
    "Automatic",
    "Solaris 11.1",
    "Solaris 11.3"
  ],
  "path": "/modules/exploits/solaris/local/rsh_stack_clash_priv_esc.rb",
  "ref_name": "solaris/local/rsh_stack_clash_priv_esc",
  "check": true,
  "post_auth": false,
  "default_credential": false,
  "notes": {
    "AKA": [
      "Stack Clash",
      "Solaris_rsh.c"
    ]
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "integer",
      "name": "WfsDelay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": true,
      "description": "Additional delay when waiting for a session"
    },
    {
      "type": "bool",
      "name": "EnableContextEncoding",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use transient context when encoding payloads"
    },
    {
      "type": "path",
      "name": "ContextInformationFile",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The information file that contains context information"
    },
    {
      "type": "bool",
      "name": "DisablePayloadHandler",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Disable the handler code for the selected payload"
    },
    {
      "type": "integer",
      "name": "SESSION",
      "required": true,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The session to run this module on."
    },
    {
      "type": "bool",
      "name": "EXE::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom exe instead of automatically generating a payload exe"
    },
    {
      "type": "path",
      "name": "EXE::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the executable template"
    },
    {
      "type": "path",
      "name": "EXE::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The executable template file name."
    },
    {
      "type": "bool",
      "name": "EXE::Inject",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to preserve the original EXE function"
    },
    {
      "type": "bool",
      "name": "EXE::OldMethod",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Set to use the substitution EXE generation method."
    },
    {
      "type": "bool",
      "name": "EXE::FallBack",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use the default template in case the specified one is missing"
    },
    {
      "type": "bool",
      "name": "MSI::EICAR",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Generate an EICAR file instead of regular payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Custom",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use custom msi instead of automatically generating a payload msi"
    },
    {
      "type": "path",
      "name": "MSI::Path",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The directory in which to look for the msi template"
    },
    {
      "type": "path",
      "name": "MSI::Template",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The msi template file name"
    },
    {
      "type": "bool",
      "name": "MSI::UAC",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Create an MSI with a UAC prompt (elevation to SYSTEM if accepted)"
    },
    {
      "type": "integer",
      "name": "FileDropperDelay",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Delay in seconds before attempting cleanup"
    },
    {
      "type": "integer",
      "name": "WORKERS",
      "required": true,
      "default": "10",
      "aliases": [

      ],
      "advanced": false,
      "description": "Number of workers"
    },
    {
      "type": "string",
      "name": "RSH_PATH",
      "required": true,
      "default": "/usr/bin/rsh",
      "aliases": [

      ],
      "advanced": false,
      "description": "Path to rsh executable"
    },
    {
      "type": "bool",
      "name": "ForceExploit",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Override check result"
    },
    {
      "type": "string",
      "name": "WritableDir",
      "required": true,
      "default": "/tmp",
      "aliases": [

      ],
      "advanced": true,
      "description": "A directory where we can write files"
    }
  ]
}