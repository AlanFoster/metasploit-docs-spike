{
  "name": "NetBIOS Response \"BadTunnel\" Brute Force Spoof (NAT Tunnel)",
  "fullname": "auxiliary/server/netbios_spoof_nat",
  "aliases": [

  ],
  "rank": 300,
  "disclosure_date": "2016-06-14",
  "type": "auxiliary",
  "author": [
    "vvalien",
    "hdm <x@hdm.io>",
    "tombkeeper"
  ],
  "description": "This module listens for a NetBIOS name request and then continuously spams\n        NetBIOS responses to a target for given hostname, causing the target to cache\n        a malicious address for this name. On high-speed networks, the PPSRATE value\n        should be increased to speed up this attack. As an example, a value of around\n        30,000 is almost 100% successful when spoofing a response for a 'WPAD' lookup.\n        Distant targets may require more time and lower rates for a successful attack.\n\n        This module works when the target is behind a NAT gateway, since the stream of\n        NetBIOS responses will keep the NAT mapping alive after the initial setup. To\n        trigger the initial NetBIOS request to the Metasploit system, force the target\n        to access a UNC link pointing to the same address (HTML, Office attachment, etc).\n\n        This NAT-piercing issue was named the 'BadTunnel' vulnerability by the discoverer,\n        Yu Yang (@tombkeeper). The Microsoft patches (MS16-063/MS16-077) impact the way\n        that the proxy host (WPAD) host is identified, but do change the predictability\n        of NetBIOS requests.",
  "references": [
    "http://xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/",
    "https://cvedetails.com/cve/CVE-2016-3213/",
    "https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2016/MS16-063",
    "https://cvedetails.com/cve/CVE-2016-3236/",
    "https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2016/MS16-077"
  ],
  "platform": "",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": null,
  "path": "/modules/auxiliary/server/netbios_spoof_nat.rb",
  "ref_name": "server/netbios_spoof_nat",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "address",
      "name": "SRVHOST",
      "required": true,
      "default": "0.0.0.0",
      "aliases": [

      ],
      "advanced": false,
      "description": "The local host to listen on."
    },
    {
      "type": "port",
      "name": "SRVPORT",
      "required": true,
      "default": 137,
      "aliases": [

      ],
      "advanced": false,
      "description": "The local port to listen on."
    },
    {
      "type": "string",
      "name": "NBNAME",
      "required": true,
      "default": "WPAD",
      "aliases": [

      ],
      "advanced": false,
      "description": "The NetBIOS name to spoof a reply for"
    },
    {
      "type": "address",
      "name": "NBADDR",
      "required": true,
      "default": "192.168.1.205",
      "aliases": [

      ],
      "advanced": false,
      "description": "The address that the NetBIOS name should resolve to"
    },
    {
      "type": "integer",
      "name": "PPSRATE",
      "required": true,
      "default": 1000,
      "aliases": [

      ],
      "advanced": false,
      "description": "The rate at which to send NetBIOS replies"
    }
  ]
}