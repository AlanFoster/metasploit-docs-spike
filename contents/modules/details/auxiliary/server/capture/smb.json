{
  "name": "Authentication Capture: SMB",
  "fullname": "auxiliary/server/capture/smb",
  "aliases": [

  ],
  "rank": 300,
  "disclosure_date": null,
  "type": "auxiliary",
  "author": [
    "hdm <x@hdm.io>"
  ],
  "description": "This module provides a SMB service that can be used to capture the\n        challenge-response password hashes of SMB client systems. Responses\n        sent by this service have by default the configurable challenge string\n        (\\x11\\x22\\x33\\x44\\x55\\x66\\x77\\x88), allowing for easy cracking using\n        Cain & Abel, L0phtcrack or John the ripper (with jumbo patch).\n\n        To exploit this, the target system must try to authenticate to this\n        module. One way to force an SMB authentication attempt is by embedding\n        a UNC path (\\\\SERVER\\SHARE) into a web page or email message. When\n        the victim views the web page or email, their system will\n        automatically connect to the server specified in the UNC share (the IP\n        address of the system running this module) and attempt to\n        authenticate. Another option is using auxiliary/spoof/{nbns,llmnr} to\n        respond to queries for names the victim is already looking for.",
  "references": [

  ],
  "platform": "",
  "arch": "",
  "autofilter_ports": [

  ],
  "autofilter_services": [

  ],
  "targets": null,
  "path": "/modules/auxiliary/server/capture/smb.rb",
  "ref_name": "server/capture/smb",
  "check": false,
  "post_auth": false,
  "default_credential": false,
  "notes": {
  },
  "needs_cleanup": null,
  "options": [
    {
      "type": "string",
      "name": "WORKSPACE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "Specify the workspace for this module"
    },
    {
      "type": "bool",
      "name": "VERBOSE",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable detailed status messages"
    },
    {
      "type": "address",
      "name": "SRVHOST",
      "required": true,
      "default": "0.0.0.0",
      "aliases": [

      ],
      "advanced": false,
      "description": "The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses."
    },
    {
      "type": "port",
      "name": "SRVPORT",
      "required": true,
      "default": 445,
      "aliases": [

      ],
      "advanced": false,
      "description": "The local port to listen on."
    },
    {
      "type": "string",
      "name": "ListenerComm",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "The specific communication channel to use for this service"
    },
    {
      "type": "bool",
      "name": "SSLCompression",
      "required": false,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Enable SSL/TLS-level compression"
    },
    {
      "type": "string",
      "name": "SSLCipher",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": true,
      "description": "String for SSL cipher spec - \"DHE-RSA-AES256-SHA\" or \"ADH\""
    },
    {
      "type": "integer",
      "name": "TCP::max_send_size",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Maximum tcp segment size.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "TCP::send_delay",
      "required": false,
      "default": 0,
      "aliases": [

      ],
      "advanced": false,
      "description": "Delays inserted before every send.  (0 = disable)"
    },
    {
      "type": "integer",
      "name": "SMBServerMaximumBuffer",
      "required": true,
      "default": 2,
      "aliases": [

      ],
      "advanced": true,
      "description": "The maximum number of data in megabytes to buffer"
    },
    {
      "type": "integer",
      "name": "SMBServerIdleTimeout",
      "required": true,
      "default": 120,
      "aliases": [

      ],
      "advanced": true,
      "description": "The maximum amount of time to keep an idle session open in seconds"
    },
    {
      "type": "string",
      "name": "CAINPWFILE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The local filename to store the hashes in Cain&Abel format"
    },
    {
      "type": "string",
      "name": "JOHNPWFILE",
      "required": false,
      "default": null,
      "aliases": [

      ],
      "advanced": false,
      "description": "The prefix to the local filename to store the hashes in John format"
    },
    {
      "type": "string",
      "name": "CHALLENGE",
      "required": true,
      "default": "1122334455667788",
      "aliases": [

      ],
      "advanced": false,
      "description": "The 8 byte server challenge"
    },
    {
      "type": "bool",
      "name": "SMB_EXTENDED_SECURITY",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Use smb extended security negotiation, when set client will use ntlmssp, if not then client will use classic lanman authentification"
    },
    {
      "type": "bool",
      "name": "NTLM_UseNTLM2_session",
      "required": true,
      "default": false,
      "aliases": [

      ],
      "advanced": true,
      "description": "Activate the 'negotiate NTLM2 key' flag in NTLM authentication. When SMB_EXTENDED_SECURITY negotiate is set, client will use ntlm2_session instead of ntlmv1 (default on win 2K and above)"
    },
    {
      "type": "bool",
      "name": "USE_GSS_NEGOTIATION",
      "required": true,
      "default": true,
      "aliases": [

      ],
      "advanced": true,
      "description": "Send a gss_security blob in smb_negotiate response when SMB extended security is set. When this flag is not set, Windows will respond without gss encapsulation, Ubuntu will still use gss."
    },
    {
      "type": "string",
      "name": "DOMAIN_NAME",
      "required": true,
      "default": "anonymous",
      "aliases": [

      ],
      "advanced": true,
      "description": "The domain name used during smb exchange with SMB_EXTENDED_SECURITY set."
    }
  ]
}