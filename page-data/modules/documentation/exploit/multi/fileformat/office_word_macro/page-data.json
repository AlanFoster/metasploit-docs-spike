{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/fileformat/office_word_macro","result":{"data":{"moduleMetadataJson":{"id":"4e233be3-446b-5eec-9b57-2a4be3e483f2","name":"Microsoft Office Word Malicious Macro Execution","fullname":"exploit/multi/fileformat/office_word_macro","description":"This module injects a malicious macro into a Microsoft Office Word document (docx). The\n        comments field in the metadata is injected with a Base64 encoded payload, which will be\n        decoded by the macro and execute as a Windows executable.\n\n        For a successful attack, the victim is required to manually enable macro execution.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/fileformat/office_word_macro","documentationSlug":"/modules/documentation/exploit/multi/fileformat/office_word_macro","referencesSlug":"/modules/references/exploit/multi/fileformat/office_word_macro"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module generates a macro-enabled Microsoft Office Word document (docm). It does not target a\nspecific CVE or vulnerability, instead it's more of a feature-abuse in Office, and yet it's still a\npopular type of social-engineering attack such as in ransomware.</p>\n<p>By default, the module uses a built-in Office document (docx) as the template. It injects the\nBase64-encoded payload into the comments field, which will get decoded back by the macro and executed\nas a Windows executable when the Office document is launched.</p>\n<p>If you do not wish to use the built-in docx template, you can also choose your own. Please see more\ndetails below.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>A Windows or OSX machine with Microsoft Office installed. The Office application must support the docm\nformat.</p>\n<p>Specifically, this module was tested specifically against:</p>\n<ul>\n<li>Microsoft Office 2010.</li>\n<li>Microsoft Office 2013.</li>\n<li>Microsoft Office 2016.</li>\n<li>Microsoft Office Word 15.29.1 (161215).</li>\n</ul>\n<h2 id=\"building-the-office-document-template\" style=\"position:relative;\"><a href=\"#building-the-office-document-template\" aria-label=\"building the office document template permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Building the Office Document Template</h2>\n<p>It is recommended that you build your Office document (docx) template from either one of these\napplications:</p>\n<ul>\n<li>Google Docs</li>\n<li>Microsoft Office Word</li>\n</ul>\n<p><strong>Google Docs</strong></p>\n<p>Google Docs is ideal in case you don't have Microsoft Office available.</p>\n<p>Before you start, make sure you have a Gmail account.</p>\n<p>Next, to create a new document, please go to the following:</p>\n<p><a href=\"https://docs.google.com/document/?usp=mkt_docs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.google.com/document/?usp=mkt_docs</a></p>\n<p>To save the document as a docx on Google docs:</p>\n<ol>\n<li>Click on File</li>\n<li>Go to Download as</li>\n<li>Click on Microsoft Word (.docx)</li>\n</ol>\n<p><strong>Microsoft Office Word</strong></p>\n<p>If you already have Microsoft Office, you can use it to create a docx file and use it as a template.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p><strong>To use the default template</strong></p>\n<ol>\n<li><code class=\"language-text\">use exploit/multi/fileformat/office_word_macro</code></li>\n<li><code class=\"language-text\">set PAYLOAD [PAYLOAD NAME]</code></li>\n<li>Configure the rest of the settings accordingly (LHOST, LPORT, etc)</li>\n<li><code class=\"language-text\">exploit</code></li>\n<li>The module should generate the malicious docm.</li>\n</ol>\n<p><strong>To use the custom template</strong></p>\n<ol>\n<li><code class=\"language-text\">use exploit/multi/fileformat/office_word_macro</code></li>\n<li><code class=\"language-text\">set PAYLOAD [PAYLOAD NAME]</code></li>\n<li><code class=\"language-text\">set CUSTOMTEMPLATE [DOCX PATH]</code></li>\n<li>Configure the rest of the settings accordingly</li>\n<li><code class=\"language-text\">exploit</code></li>\n<li>The module should generate the malicious docm.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>CUSTOMTEMPLATE</strong> </p>\n<p>A docx file that will be used as a template to build the exploit.</p>\n<h2 id=\"trusted-document\" style=\"position:relative;\"><a href=\"#trusted-document\" aria-label=\"trusted document permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Trusted Document</h2>\n<p>By default, Microsoft Office does not execute macros automatically unless it is considered as a\ntrusted document. This means that if a macro is present, the user will most likely need to manually\nclick on the \"Enable Content\" or \"Enable Macro\" button in order to run the macro.</p>\n<p>Many in-the-wild attacks face this type of challenge, and most rely on social-engineering to trick\nthe user into allowing the macro to run. For example, making the document look like something\nwritten from a legit source, such as <a href=\"https://motherboard.vice.com/en_us/article/these-hackers-cleverly-disguised-their-malware-as-a-document-about-trumps-victory\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this attack</a>.</p>\n<p>To truly make the macro document run without any warnings, you must somehow figure out a way to\nsign the macro by a trusted publisher, or using a certificate that the targeted machine trusts.</p>\n<p>If money is not an issue, you can easily buy a certificate on-line:\n<a href=\"https://www.sslshopper.com/microsoft-vba-code-signing-certificates.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.sslshopper.com/microsoft-vba-code-signing-certificates.html</a></p>\n<p>For testing purposes, another way to have a certificate is to create a self-signed one using\nMicrosoft Office's SELFCERT.exe utility. This tool can be found in the following path on\nWindows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">C:\\Program Files\\Microsoft Office\\root\\Office16\\SELFCERT.exe</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>In Office 2010, the self-signing tool is actually an option in the Office tools folder in the\nstart menu. It should be named \"Digital Certificate for VBA Projects\".</p>\n<p>Double-click on the executable, enter a random name and click \"OK\", at this point you have a\ncertificate to play with.</p>\n<p>Next, we want to flag this certificate as trusted:</p>\n<ol>\n<li>Click on Start, and then enter \"Internet Options\".</li>\n<li>Click on the Content tab, and then click on the Certificates button.</li>\n<li>You should see your new certificate under the Personal tab, export it.</li>\n<li>Click on the Trusted Publishers, and then import your personal certificate.</li>\n<li>Try the macro exploit again, it should run the malicious code without warning.</li>\n</ol>"}}},"pageContext":{"id":"4e233be3-446b-5eec-9b57-2a4be3e483f2"}}}