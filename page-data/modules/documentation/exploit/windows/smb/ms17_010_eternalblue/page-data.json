{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/smb/ms17_010_eternalblue","result":{"data":{"moduleMetadataJson":{"id":"7552e33e-3048-5a19-8568-50cc2557510a","name":"MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption","fullname":"exploit/windows/smb/ms17_010_eternalblue","description":"This module is a port of the Equation Group ETERNALBLUE exploit, part of\n          the FuzzBunch toolkit released by Shadow Brokers.\n\n          There is a buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size\n          is calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error where a\n          DWORD is subtracted into a WORD. The kernel pool is groomed so that overflow\n          is well laid-out to overwrite an SMBv1 buffer. Actual RIP hijack is later\n          completed in srvnet!SrvNetWskReceiveComplete.\n\n          This exploit, like the original may not trigger 100% of the time, and should be\n          run continuously until triggered. It seems like the pool will get hot streaks\n          and need a cool down period before the shells rain in again.\n\n          The module will attempt to use Anonymous login, by default, to authenticate to perform the\n          exploit. If the user supplies credentials in the SMBUser, SMBPass, and SMBDomain options it will use\n          those instead.\n\n          On some systems, this module may cause system instability and crashes, such as a BSOD or\n          a reboot. This may be more likely with some payloads.","rank":200,"fields":{"detailsSlug":"/modules/details/exploit/windows/smb/ms17_010_eternalblue","documentationSlug":"/modules/documentation/exploit/windows/smb/ms17_010_eternalblue"},"documentation":{"html":"<p>ms17<em>010</em>eternalblue is a remote exploit against Microsoft Windows, originally written by the\nEquation Group (NSA) and leaked by Shadow Brokers (an unknown hacking entity). It is\nconsidered a reliable exploit and allows you to gain access not only as SYSTEM - the highest Windows\nuser mode privilege, but also full control of the kernel in <a href=\"https://en.wikipedia.org/wiki/Protection_ring\">ring 0</a>. In modern day penetration tests,\nthis exploit can be used in internal and external environments.</p>\n<p>As far as remote kernel exploits go, this one is highly reliable and safe to use.</p>\n<p>The check command of ms17<em>010</em>eternalblue is also highly accurate, because Microsoft's patch\ninadvertently added an information disclosure with extra checks on vulnerable code paths.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This exploit works against a vulnerable SMB service from one of these Windows systems:</p>\n<ul>\n<li>Windows XP x86 (All Service Packs))</li>\n<li>Windows 2003 x86 (All Service Packs))</li>\n<li>Windows 7 x86 (All Service Packs))</li>\n<li>Windows 7 x64 (All Service Packs)</li>\n<li>Windows 2008 R2 x64 (All Service Packs)</li>\n</ul>\n<p>To reliability determine whether the machine is vulnerable, you will have to either examine\nthe system's patch level, or use a vulnerability check.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> Start <code class=\"language-text\">msfconsole</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <code class=\"language-text\">use exploit/windows/smb/ms17_010_eternalblue</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <code class=\"language-text\">set RHOST</code> to Windows 7/2008 x64</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <code class=\"language-text\">set PAYLOAD</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <code class=\"language-text\">exploit</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <strong>Verify</strong> that you get a shell</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" checked disabled> <strong>Verify</strong> that you do not crash (post an Issue with core dump if you do)</li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set ProcessName [string]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This is the usermode process that an APC containing shellcode will be queued into.\nThis should probably be a SYSTEM process, such as <code class=\"language-text\">lsass.exe</code> or <code class=\"language-text\">spoolsv.exe</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set MaxExploitAttempts [integer]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Grooming the kernel does not always succeed, so this is the amount of times to retry\nthe exploit.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set GroomAllocations [integer]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This is the base number of groom packets that will be sent per exploit.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set GroomDelta [integer]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>This is the number the grooms will increase per exploit try, if previous try failed.</p>\n<p><strong>Unsafe configuration of Target</strong>\nIt is not possible to determine the Architecture (x86 or x64) of a machine from its\nSMB headers. The exploit has safeguards to silently fail if you use the wrong arch.\nIf the shells aren't poppin', try to change the architecture.</p>"}}},"pageContext":{"id":"7552e33e-3048-5a19-8568-50cc2557510a"}}}