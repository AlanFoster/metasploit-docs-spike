{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/rdp/cve_2019_0708_bluekeep_rce","result":{"data":{"moduleMetadataJson":{"id":"4f7ae279-f139-58e8-b422-f087dc1fb1a7","name":"CVE-2019-0708 BlueKeep RDP Remote Windows Kernel Use After Free","fullname":"exploit/windows/rdp/cve_2019_0708_bluekeep_rce","description":"The RDP termdd.sys driver improperly handles binds to internal-only channel MS_T120,\n        allowing a malformed Disconnect Provider Indication message to cause use-after-free.\n        With a controllable data/size remote nonpaged pool spray, an indirect call gadget of\n        the freed channel is used to achieve arbitrary code execution.\n\n        Windows 7 SP1 and Windows Server 2008 R2 are the only currently supported targets.\n\n        Windows 7 SP1 should be exploitable in its default configuration, assuming your target\n        selection is correctly matched to the system's memory layout.\n\n        HKLM\\SYSTEM\\CurrentControlSet\\Control\\TerminalServer\\Winstations\\RDP-Tcp\\fDisableCam\n        *needs* to be set to 0 for exploitation to succeed against Windows Server 2008 R2.\n        This is a non-standard configuration for normal servers, and the target will crash if\n        the aforementioned Registry key is not set!\n\n        If the target is crashing regardless, you will likely need to determine the non-paged\n        pool base in kernel memory and set it as the GROOMBASE option.","rank":0,"fields":{"detailsSlug":"/modules/details/exploit/windows/rdp/cve_2019_0708_bluekeep_rce","documentationSlug":"/modules/documentation/exploit/windows/rdp/cve_2019_0708_bluekeep_rce","referencesSlug":"/modules/references/exploit/windows/rdp/cve_2019_0708_bluekeep_rce"},"documentation":{"html":"<p>CVE-2019-0708 BlueKeep RDP Remote Windows Kernel Use After Free</p>\n<p>The RDP <code class=\"language-text\">termdd.sys</code> driver improperly handles binds to internal-only channel <code class=\"language-text\">MS_T120</code>,\nallowing a malformed <code class=\"language-text\">Disconnect Provider Indication</code> message to cause use-after-free.\nWith a controllable data/size remote nonpaged pool spray, an indirect call gadget of\nthe freed channel is used to achieve arbitrary code execution.</p>\n<p><strong>Windows 7 SP1</strong> and <strong>Windows Server 2008 R2</strong> are the <strong>only</strong> currently supported targets.</p>\n<p>Windows 7 SP1 should be exploitable in its default configuration, assuming your target\nselection is correctly matched to the system's memory layout.</p>\n<p><code class=\"language-text\">HKLM\\SYSTEM\\CurrentControlSet\\Control\\TerminalServer\\Winstations\\RDP-Tcp\\fDisableCam</code>\n<strong>needs</strong> to be set to <code class=\"language-text\">0</code> for exploitation to succeed against <strong>Windows Server 2008 R2</strong>.\nThis is a <strong>non-standard</strong> configuration for normal servers, and the target <strong>will crash</strong> if\nthe aforementioned Registry key is not set!</p>\n<p>If the target is crashing regardless, you will likely need to determine the non-paged\npool base in kernel memory and set it as the <code class=\"language-text\">GROOMBASE</code> option.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This exploit module currently targets these Windows systems running on several virtualized and physical targets.</p>\n<ul>\n<li>Windows 7 SP1 x64</li>\n<li>Windows 2008 R2 x64</li>\n</ul>\n<p>XP and 2003 are currently not supported. Please see available targets by running the <code class=\"language-text\">show targets</code> command.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> Start <code class=\"language-text\">msfconsole</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">use exploit/windows/rdp/cve_2019_0708_bluekeep_rce</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set RHOSTS</code> to Windows 7/2008 x64</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set TARGET</code> based on target host characteristics</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">set PAYLOAD</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <code class=\"language-text\">exploit</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <strong>Verify</strong> that you get a shell</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> <strong>Verify</strong> that you do not crash</li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>"}}},"pageContext":{"id":"4f7ae279-f139-58e8-b422-f087dc1fb1a7"}}}