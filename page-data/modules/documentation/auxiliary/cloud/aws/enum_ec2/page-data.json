{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/auxiliary/cloud/aws/enum_ec2","result":{"data":{"moduleMetadataJson":{"id":"82719961-6569-5803-a511-cc04a558cee5","name":"Amazon Web Services EC2 instance enumeration","fullname":"auxiliary/cloud/aws/enum_ec2","description":"Provided AWS credentials, this module will call the authenticated\n                          API of Amazon Web Services to list all EC2 instances associated\n                          with the account","rank":300,"fields":{"detailsSlug":"/modules/details/auxiliary/cloud/aws/enum_ec2","documentationSlug":"/modules/documentation/auxiliary/cloud/aws/enum_ec2"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>Amazon Web Services (AWS) resources can be managed through an API that authenticates based on an <code class=\"language-text\">ACCESS_KEY_ID</code> and a <code class=\"language-text\">SECRET_ACCESS_KEY</code>.  With these two pieces of information, an attacker can gain privileges which may include enumerating resources within the AWS account.</p>\n<p>This module authenticates to AWS EC2 (Elastic Compute Cloud) to identify compute instances that the credentials can see.  The instances themselves may be connected to the public Internet, but are likely to be protected by security groups and subnet network ACLs.  In any case, knowledge of the instances is the first step in evaluating their security.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<h3 id=\"create-or-acquire-the-credentials\" style=\"position:relative;\"><a href=\"#create-or-acquire-the-credentials\" aria-label=\"create or acquire the credentials permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create or acquire the credentials</h3>\n<ol>\n<li>(If necessary) Create an AWS account.  Free trials are available.</li>\n<li>Login to the [AWS Console](https:\\console.aws.amazon.com).</li>\n<li>Use the dropbown menu in the top-right with your username, then click on \"My Security Credentials\".</li>\n<li>Expand the \"Access Keys\" pane and click  \"Create New Access Key\".</li>\n<li>Follow the steps in the AWS console, making sure to record both the 'access key ID' and 'secret access key'.  (The 'secret access key' is only shown once, then can never be retrieved.)</li>\n</ol>\n<h3 id=\"enumerate-aws-resources-using-the-credentials\" style=\"position:relative;\"><a href=\"#enumerate-aws-resources-using-the-credentials\" aria-label=\"enumerate aws resources using the credentials permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enumerate AWS resources using the credentials</h3>\n<ol>\n<li>Start msfconsole</li>\n<li><code class=\"language-text\">use auxiliary/cloud/aws/enum_ec2</code></li>\n<li>Set the <code class=\"language-text\">ACCESS_KEY_ID</code> and <code class=\"language-text\">SECRET_ACCESS_KEY</code> options.</li>\n<li>Optionally, set the <code class=\"language-text\">REGION</code> and <code class=\"language-text\">LIMIT</code> options.</li>\n<li><code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>ACCESS<em>KEY</em>ID</strong></p>\n<p>  This AWS credential is like a username.  It uniquely identifies the user, and is paired with a 'secret access key'.  The access key ID is retrievable through the AWS console.</p>\n<p>  An example <code class=\"language-text\">ACCESS_KEY_ID</code> would be <code class=\"language-text\">AKIA5C76TR3KXHXA5CRC</code></p>\n<p>  <strong>SECRET<em>ACCESS</em>KEY</strong></p>\n<p>  This AWS credential is like a password, and should be treated as such.  It is paired with a 'access key ID'.  The access key ID cannot be retrieved from AWS after it has been generated, but it may be discoverable through environment variables, configuration files, source code, or backups.</p>\n<p>  An example <code class=\"language-text\">SECRET_ACCESS_KEY</code> would be <code class=\"language-text\">EKfx3wOWWiGk1WgBTAZfF\\2dq3SbDsQj4jdyOMOv</code>.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"provided-a-valid-access-key-id-and-secret-access-key-with-sufficient-privileges\" style=\"position:relative;\"><a href=\"#provided-a-valid-access-key-id-and-secret-access-key-with-sufficient-privileges\" aria-label=\"provided a valid access key id and secret access key with sufficient privileges permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provided a valid 'access key ID' and 'secret access key' with sufficient privileges</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 auxiliary(cloud/aws/enum_iam) &gt; run\n\n[+] Found 3 users.\n[+]   User Name:       test1\n[+]   User ID:         AIDA5C76TR3KTTO3PTAJ7\n[+]   Creation Date:   2019-06-14 18:18:23 UTC\n[+]   Tags:            []\n[+]   Groups:          []\n[+]   SSH Pub Keys:    []\n[+]   Policies:        IAMUserChangePassword\n[+]   Signing certs:   []\n[+]   Password Used:   2019-06-17 19:55:57 UTC\n[+]   AWS Access Keys: AKIA5C76TR3K3JN3FYUE (Active)\n[+]   Console login:   Enabled\n[+]   Two-factor auth: Enabled on 2019-06-17 20:01:05 UTC\n[*] \n[+]   User Name:       test2\n[+]   User ID:         AIDA5C76TR3KVHWFEQSDL\n[+]   Creation Date:   2019-06-14 18:18:35 UTC\n[+]   Tags:            []\n[+]   Groups:          [&quot;mygroup&quot;, &quot;mygroup2&quot;]\n[+]   SSH Pub Keys:    []\n[+]   Policies:        IAMUserChangePassword\n[+]   Signing certs:   []\n[+]   Password Used:   (Never)\n[+]   AWS Access Keys: AKIA5C76TR3KXHXA5CRC (Inactive)\n[+]   Console login:   Enabled\n[+]   Two-factor auth: Disabled\n[*] \n[+]   User Name:       test3\n[+]   User ID:         AIDA5C76TR3KYI2HC4MOL\n[+]   Creation Date:   2019-06-14 18:18:44 UTC\n[+]   Tags:            []\n[+]   Groups:          [&quot;mygroup&quot;]\n[+]   SSH Pub Keys:    []\n[+]   Policies:        []\n[+]   Signing certs:   []\n[+]   Password Used:   (Never)\n[+]   AWS Access Keys: AKIA5C76TR3KWWADYZNB (Active)\n[+]   Console login:   Disabled\n[+]   Two-factor auth: Disabled\n[*] \n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"provided-an-invalid-or-inactive-access-key-id\" style=\"position:relative;\"><a href=\"#provided-an-invalid-or-inactive-access-key-id\" aria-label=\"provided an invalid or inactive access key id permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provided an invalid or inactive 'access key ID'</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 auxiliary(cloud/aws/enum_iam) &gt; run\n\n[-] Auxiliary aborted due to failure: unexpected-reply: The security token included in the request is invalid.\n[*] Auxiliary module execution completed\nmsf5 auxiliary(cloud/aws/enum_iam) &gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"provided-an-invalid-secret-access-key\" style=\"position:relative;\"><a href=\"#provided-an-invalid-secret-access-key\" aria-label=\"provided an invalid secret access key permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provided an invalid 'secret access key'</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 auxiliary(cloud/aws/enum_iam) &gt; run\n\n[-] Auxiliary aborted due to failure: unexpected-reply: The request signature we calculated does not match the signature you provided. Check your AWS Secret Access Key and signing method. Consult the service documentation for details.\n[*] Auxiliary module execution completed\nmsf5 auxiliary(cloud/aws/enum_iam) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"provided-an-access-key-id-or-secret-access-key-with-insufficient-privileges\" style=\"position:relative;\"><a href=\"#provided-an-access-key-id-or-secret-access-key-with-insufficient-privileges\" aria-label=\"provided an access key id or secret access key with insufficient privileges permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Provided an 'access key ID' or 'secret access key' with insufficient privileges</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 auxiliary(cloud\\aws\\enum_ec2) &gt; run\n\n[-] Auxiliary aborted due to failure: unexpected-reply: User: arn:aws:iam::899712345657:user/test1 is not authorized to perform: iam:ListUsers on resource: arn:aws:iam::899712345657:user/\n[*] Auxiliary module execution completed\nmsf5 auxiliary(cloud\\aws\\enum_ec2) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"82719961-6569-5803-a511-cc04a558cee5"}}}