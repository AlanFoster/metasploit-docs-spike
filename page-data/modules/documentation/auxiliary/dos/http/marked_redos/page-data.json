{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/auxiliary/dos/http/marked_redos","result":{"data":{"moduleMetadataJson":{"id":"08f42230-0b4d-5110-835b-7128780e57c8","name":"marked npm module \"heading\" ReDoS","fullname":"auxiliary/dos/http/marked_redos","description":"This module exploits a Regular Expression Denial of Service vulnerability\n        in the npm module \"marked\". The vulnerable portion of code that this module\n        targets is in the \"heading\" regular expression. Web applications that use\n        \"marked\" for generating html from markdown are vulnerable. Versions up to\n        0.4.0 are vulnerable.","rank":300,"fields":{"detailsSlug":"/modules/details/auxiliary/dos/http/marked_redos","documentationSlug":"/modules/documentation/auxiliary/dos/http/marked_redos"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>This auxiliary module exploits a Regular Expression Denial of Service vulnerability\nin the npm module <code class=\"language-text\">marked</code>.  The vulnerable regex is in the \"heading\" processing.\nVersions before 0.3.19 are vulnerable.\nAny application that uses a vulnerable version of this module and passes untrusted input\nto the module will be vulnerable.</p>\n<h3 id=\"how-to-install\" style=\"position:relative;\"><a href=\"#how-to-install\" aria-label=\"how to install permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to Install</h3>\n<p>To install a vulnerable version of <code class=\"language-text\">marked</code>, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">npm i marked@0.3.19</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Create a new directory for test application.</li>\n<li>Copy below example server into test application directory as <code class=\"language-text\">server.js</code>.</li>\n<li>Run <code class=\"language-text\">npm i express</code> to install express in the test application directory.</li>\n<li>To test vulnerable versions of the module, run <code class=\"language-text\">npm i marked@0.3.19</code> to install a vulnerable version of marked.</li>\n<li>To test non-vulnerable versions of the module, run <code class=\"language-text\">npm i marked</code> to install the latest version of marked.</li>\n<li>Once all dependencies are installed, run the server with <code class=\"language-text\">node server.js</code>.</li>\n<li>Open up a new terminal.</li>\n<li>Start msfconsole.</li>\n<li><code class=\"language-text\">use auxiliary/dos/http/marked_redos</code>.</li>\n<li><code class=\"language-text\">set RHOST [IP]</code>.</li>\n<li><code class=\"language-text\">set HTTP_METHOD get</code> (optional)</li>\n<li><code class=\"language-text\">set HTTP_PARAMETER foo</code> (required)</li>\n<li><code class=\"language-text\">set TARGETURI /path/to/vulnerable/route</code> (optional)</li>\n<li><code class=\"language-text\">run</code>.</li>\n<li>In vulnerable installations, Module should have positive output and the test application should accept no further requests.</li>\n<li>In non-vulnerable installations, module should have negative output and the test application should accept further requests.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"marked-npm-module-version-0319\" style=\"position:relative;\"><a href=\"#marked-npm-module-version-0319\" aria-label=\"marked npm module version 0319 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>marked npm module version 0.3.19</h3>\n<p>Expected output for successful exploitation:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Testing Service to make sure it is working.\n[*] Test request successful, attempting to send payload\n[*] Sending ReDoS request to 192.168.3.24:3000.\n[*] No response received from 192.168.3.24:3000, service is most likely unresponsive.\n[*] Testing for service unresponsiveness.\n[+] Service not responding.\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"example-vulnerable-application\" style=\"position:relative;\"><a href=\"#example-vulnerable-application\" aria-label=\"example vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Vulnerable Application</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">// npm i express body-parser\n// npm i marked@0.3.19 (vulnerable)\n// npm i marked (non-vulnerable)\n\nconst marked = require(&#39;marked&#39;);\nconst express = require(&#39;express&#39;);\nconst bodyParser = require(&#39;body-parser&#39;);\n\nvar app = express();\napp.use(bodyParser.text({ type: &#39;text/html&#39; }));\n\n// create application/json parser\nconst jsonParser = bodyParser.json();\n\n// create application/x-www-form-urlencoded parser\nconst urlencodedParser = bodyParser.urlencoded({ extended: false });\n\napp.get(&quot;/&quot;, urlencodedParser, function(req, res) {\n  var result = req.query.foo ? marked(req.query.foo) : &#39;nothing&#39;;\n  res.end(result);\n});\n\napp.post(&quot;/cat&quot;, urlencodedParser, function(req, res) {\n  var result = req.body.bar ? marked(req.body.bar) : &#39;nothing&#39;\n  res.end(result);\n});\n\napp.listen(3000, &#39;0.0.0.0&#39;, function() { console.log(&#39;Application listening on port 3000 on all interfaces!&#39;); });</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"08f42230-0b4d-5110-835b-7128780e57c8"}}}