{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/windows/capture/keylog_recorder","result":{"data":{"moduleMetadataJson":{"id":"aa6bf3de-2001-5624-9f76-74c4688a7f66","name":"Windows Capture Keystroke Recorder","fullname":"post/windows/capture/keylog_recorder","description":"This module can be used to capture keystrokes. To capture keystrokes when the session is running\n          as SYSTEM, the MIGRATE option must be enabled and the CAPTURE_TYPE option should be set to one of\n          Explorer, Winlogon, or a specific PID. To capture the keystrokes of the interactive user, the\n          Explorer option should be used with MIGRATE enabled. Keep in mind that this will demote this session\n          to the user's privileges, so it makes sense to create a separate session for this task. The Winlogon\n          option will capture the username and password entered into the logon and unlock dialog. The LOCKSCREEN\n          option can be combined with the Winlogon CAPTURE_TYPE to for the user to enter their clear-text\n          password. It is recommended to run this module as a job, otherwise it will tie up your framework user interface.","rank":300,"fields":{"detailsSlug":"/modules/details/post/windows/capture/keylog_recorder","documentationSlug":"/modules/documentation/post/windows/capture/keylog_recorder","referencesSlug":"/modules/references/post/windows/capture/keylog_recorder"},"documentation":{"html":"<h2 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p>This module captures keystrokes from a Windows target and saves them to a text file in loot. Keystrokes can be captured from explorer.exe, winlogon.exe, or a specific process of your choice. The module is capable of being run as a job to keep the Framework's user interface available for other tasks.</p>\n<h2 id=\"requirements\" style=\"position:relative;\"><a href=\"#requirements\" aria-label=\"requirements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Requirements</h2>\n<ul>\n<li>Windows Meterpreter Session</li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<ul>\n<li><strong>CAPTURE_TYPE</strong> - This option sets the process where the module records keystrokes. Accepted: explorer, winlogon, or pid. Default value is explorer.</li>\n<li><strong>INTERVAL</strong> - The interval in seconds that the module uses for recording keystrokes. The log file goes to a new line at the end of each interval. Default value is 5 seconds.</li>\n<li><strong>LOCKSCREEN</strong> - This option locks the screen of the target when set to TRUE. CAPTURE_TYPE must be set to winlogon. MIGRATE must be set to TRUE or the session must already be in winlogon.exe. Defalt value is FALSE.</li>\n<li><strong>MIGRATE</strong> - This option migrates the session based on the CAPTURE_TYPE. Explorer.exe for explorer, winlogon.exe for winlogon, or a specified PID for pid. Default value is FALSE.</li>\n<li><strong>PID</strong> - The PID of a process to migrate the session into. CAPTURE_TYPE of pid must be set, and the sepecified PID must exist on the target machine.</li>\n<li><strong>SESSION</strong> - The session to run the module on.</li>\n</ul>\n<h3 id=\"advanced-options\" style=\"position:relative;\"><a href=\"#advanced-options\" aria-label=\"advanced options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced Options</h3>\n<ul>\n<li><strong>ShowKeystrokes</strong> - This option prints the captured keystrokes to the Framework UI on the specified interval. Default is FALSE.</li>\n<li><strong>TimeOutAction</strong> - This option sets the behavior the module takes if the key capture request times out. (See below.) Accepted: wait or exit. Default value is wait.</li>\n</ul>\n<h2 id=\"usage\" style=\"position:relative;\"><a href=\"#usage\" aria-label=\"usage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<p>The Meterpreter session must be located in an appropriate process for keystroke recording to work properly. This is described in the below-listed capture types. This module can migrate the session if MIGRATE is set to TRUE. If winlogon or PID migration fails, the module will exit. Set MIGRATE to FALSE if migration will be performed manually or through another module. </p>\n<h3 id=\"capture-types\" style=\"position:relative;\"><a href=\"#capture-types\" aria-label=\"capture types permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Capture Types</h3>\n<ul>\n<li><strong>Explorer.exe</strong> - <strong>Session must be in explorer.exe</strong> - The most common capture type. Keystrokes are recorded from most user level applications. Applications running at an elevated level will likely not get recorded. <strong>NOTE: Sessions running with elevated privileges are downgraded to user level when migrated into explorer.exe.</strong> It is recommended that a second session be opened for keystroke recording if elevated priveledges are to be maintained.</li>\n<li><strong>Winlogon.exe</strong> - <strong>Session must be in winlogon.exe</strong> - Administrator or SYSTEM rights are required to migrate to winlogon.exe. Keylogging from this process records usernames and passwords as users log in. This capture type does not record keystrokes from any other process. Setting LOCKSCREEN to true locks Windows when the module is executed. This forces the user to unlock the computer, and their password is captured.</li>\n<li><strong>PID</strong> - <strong>Session must be in the specific process to be recorded.</strong> - This option is useful for recording keystrokes in applications or process that run with elevated priveledges. However, admin or SYSTEM rights are required to migrate to these processes. Only keystrokes from the specified process are recorded.</li>\n</ul>\n<h2 id=\"running-module-as-a-job\" style=\"position:relative;\"><a href=\"#running-module-as-a-job\" aria-label=\"running module as a job permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running Module as a Job</h2>\n<p>It is recommended to run this module as a job using: <code class=\"language-text\">exploit -j</code> or <code class=\"language-text\">run -j</code>. As a job, the module runs in the background preventing it from tying up the Framework's user interface. To stop capturing keystrokes, kill the job using <code class=\"language-text\">jobs -k</code>. The module records the last few keystrokes before exit. Stopping the job can take up to 30 seconds. If the session is killed, the key log job shuts down automatically.</p>\n<h3 id=\"timeoutaction\" style=\"position:relative;\"><a href=\"#timeoutaction\" aria-label=\"timeoutaction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TimeOutAction</h3>\n<p>This module has two actions it can take if module requests time out. This occurs with packet-based payloads like <code class=\"language-text\">reverse_http</code> or <code class=\"language-text\">reverse_https</code> when the target system stops responding to requests for a specific period of time. The default is 300 seconds. Sessions can stop responding due to various events such as network problems, system shut down, system sleep, or user log off.</p>\n<ul>\n<li><strong>WAIT</strong> - With this option selected, the module suspends attempting to gather keystrokes after the timeout. It waits for the session to become active again, then resumes capturing keystrokes. The output log reflects that recording was suspended along with a timestamp. If the session becomes active again, the log indicates this along with a timestamp. The wait option allows keystrokes to be logged over multiple system sleep cycles. In the event that the session dies, the recording job is stopped automatically.</li>\n<li><strong>EXIT</strong> - With this option selected, the module exits and the job is killed when the timeout occurs. The output log reflects the exit along with a timestamp.</li>\n</ul>\n<h3 id=\"running-module-stand-alone\" style=\"position:relative;\"><a href=\"#running-module-stand-alone\" aria-label=\"running module stand alone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running Module Stand Alone</h3>\n<p>When running the module stand alone, it will prevent the Framework UI from being use for anything else until you exit the module. Use <code class=\"language-text\">CTRL-C</code> to exit. The module will save the last few keystrokes. This may take up to 30 seconds to complete.</p>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Keystroke log from explorer.exe on JULY with user JULY\\User started at 2016-07-13 21:01:56 -0500\n\nThis is an ex\nample output from keylog_recorder.\n &lt;Return&gt;  &lt;Return&gt; On this line I make a typpor &lt;Back&gt;  &lt;Back&gt;  &lt;Back&gt; \no. &lt;Return&gt; \n &lt;Return&gt; Username &lt;Tab&gt; Password &lt;Return&gt; \n &lt;Return&gt; \n &lt;N1&gt;  &lt;N9&gt;  &lt;N2&gt;  &lt;Decimal&gt;  &lt;N1&gt;  &lt;N6&gt;  &lt;N8&gt;  &lt;Decimal&gt;  &lt;N1&gt;  &lt;Decimal&gt;  &lt;N1&gt;  &lt;N0&gt;  &lt;N0&gt;  &lt;Return&gt; \n Copy &lt;Left&gt;  &lt;Left&gt;  &lt;Left&gt;  &lt;Left&gt;  &lt;Ctrl&gt;  &lt;LCtrl&gt; c &lt;Right&gt;  &lt;Right&gt;  &lt;Right&gt;  &lt;Right&gt;  &lt;Return&gt;  &lt;Return&gt;  &lt;Ctrl&gt;  &lt;LCtrl&gt; v &lt;Return&gt;  &lt;Return&gt; \n\nKeylog Recorder timed out - now waiting at 2016-07-13 21:09:33 -0500\n\n\nKeylog Recorder resumed at 2016-07-13 21:11:36 -0500\n\n &lt;Return&gt; T\nhis is keys logged after the computer\n was put to sleep and then woken back up.\n &lt;Return&gt; \n\nKeylog Recorder exited at 2016-07-13 21:12:44 -0500</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"aa6bf3de-2001-5624-9f76-74c4688a7f66"}}}