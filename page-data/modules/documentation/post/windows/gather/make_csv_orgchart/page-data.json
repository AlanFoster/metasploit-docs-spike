{"componentChunkName":"component---src-templates-module-documentation-template-tsx","path":"/modules/documentation/post/windows/gather/make_csv_orgchart","result":{"data":{"moduleMetadataJson":{"id":"a29a7358-5e75-5dc9-bfe5-e7d2a7a55935","name":"Generate CSV Organizational Chart Data Using Manager Information","fullname":"post/windows/gather/make_csv_orgchart","description":"This module will generate a CSV file containing all users and their managers, which can be\n        imported into Visio which will render it.","rank":300,"fields":{"detailsSlug":"/modules/details/post/windows/gather/make_csv_orgchart","documentationSlug":"/modules/documentation/post/windows/gather/make_csv_orgchart","referencesSlug":"/modules/references/post/windows/gather/make_csv_orgchart"},"documentation":{"html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>This module can be used to aid the generation of an organizational chart based on information\ncontained in Active Directory. The module itself uses ADSI to retrieve key information from AD\n(manager, title, description etc) fields and then present it in a CSV file in the form:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">cn,description,title,phone,department,division,e-mail,company,reports_to</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>The reports_to field is the only one which is generated; everything else is taken directly from AD.\nThe 'manager' field contains the DN of the manager assigned to that user, and this module simply\nuses a regular expression to obtain the CN field of the manager.</p>\n<p>This can then be imported into tools like <a href=\"https://products.office.com/en-us/visio/flowchart-software\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Microsoft Visio</a>\n(using the organizational chart wizard) and it will construct a visual org chart from the\ninformation there. Although visio supports the ability to generate Org charts if it is on a domain\njoined machine, but there does not seem to be a way of doing this remotely (e.g. during a\nred teaming exercise).</p>\n<p>This should not be confused with security groups and AD managed groups; this is purely an\ninternal organizational hierarchy representation but could be very useful for situational awareness\nor in order to construct a more plausible or targeted internal phishing exercise.</p>\n<h2 id=\"options\" style=\"position:relative;\"><a href=\"#options\" aria-label=\"options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Options</h2>\n<table>\n<thead>\n<tr>\n<th>Option</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ACTIVE<em>USERS</em>ONLY</td>\n<td>This will restrict the search for users to those whose accounts are Active. This would have the effect of excluding disabled accounts (e.g. employees who have resigned).</td>\n</tr>\n<tr>\n<td>FILTER</td>\n<td>Any additional LDAP filtering that is required when searching for users.</td>\n</tr>\n<tr>\n<td>WITH<em>MANAGERS</em>ONLY</td>\n<td>If this is TRUE, the module will only include users who have a manger set (internally, this is implemented by adding (manager=*) to the ADSI query filter). This could be useful if not everyone has a manager set, but could mean that the top executive is not included either.</td>\n</tr>\n<tr>\n<td>STORE_LOOT</td>\n<td>Store the results in a CSV file in loot. You'll almost certainly want this set to TRUE.</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo</h1>\n<p>For the purposes of this contrived example, the module has been configured to generate the CSV\nreporting information for everyone with 'IT' somewhere in their common name.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf post(make_csv_orgchart) &gt; show options\n\nModule options (post/windows/gather/make_csv_orgchart):\n\n   Name                Current Setting  Required  Description\n   ----                ---------------  --------  -----------\n   ACTIVE_USERS_ONLY   true             yes       Only include active users (i.e. not disabled ones)\n   DOMAIN                               no        The domain to query or distinguished name (e.g. DC=test,DC=com)\n   FILTER              cn=*IT*          no        Additional LDAP filter to use when searching for users\n   MAX_SEARCH          500              yes       Maximum values to retrieve, 0 for all.\n   SESSION             2                yes       The session to run this module on.\n   STORE_LOOT          true             yes       Store the organisational chart information in CSV format in loot\n   WITH_MANAGERS_ONLY  false            no        Only users with managers\n\nmsf post(make_csv_orgchart) &gt; run\n\nUsers &amp; Managers\n================\n\n cn                                description                title                                phone  department  division  e-mail                     company  reports_to\n --                                -----------                -----                                -----  ----------  --------  ------                     -------  ----------\n IT Manager                                                   Deputy GOAT IT Director                                           it.manager@goat.stu                 IT Director\n IT Director                                                  Director of Goat IT                                               it.director@goat.stu                \n IT Leader: Badger                                            Team Leader of Blue Team Operations                               it.leader.badger@goat.stu           IT Manager\n IT Leader: Otter                                             Team Leader: Offensive Operations                                 it.leader.otter@goat.stu            IT Manager\n Oswold Otter (IT Team)                                       Consultant                                                        oswold.otter@goat.stu               IT Leader: Otter\n Bertie Badger (IT Security Team)  Default pass is badger123  IT Security Team Deputy                                           bertie.badger@goat.stu              IT Leader: Badger\n\n[*] CSV Organisational Chart Information saved to: /usr/home/s/stuart/.msf4/loot/20151221175733_stufusdev_192.0.2.140_ad.orgchart_189769.txt\n[*] Post module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The contents of the CSV file are shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ cat /usr/home/s/stuart/.msf4/loot/20151221175733_stufusdev_192.0.2.140_ad.orgchart_189769.txt\ncn,description,title,phone,department,division,e-mail,company,reports_to\n&quot;IT Manager&quot;,&quot;&quot;,&quot;Deputy GOAT IT Director&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;it.manager@goat.stu&quot;,&quot;&quot;,&quot;IT Director&quot;\n&quot;IT Director&quot;,&quot;&quot;,&quot;Director of Goat IT&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;it.director@goat.stu&quot;,&quot;&quot;,&quot;&quot;\n&quot;IT Leader: Badger&quot;,&quot;&quot;,&quot;Team Leader of Blue Team Operations&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;it.leader.badger@goat.stu&quot;,&quot;&quot;,&quot;IT Manager&quot;\n&quot;IT Leader: Otter&quot;,&quot;&quot;,&quot;Team Leader: Offensive Operations&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;it.leader.otter@goat.stu&quot;,&quot;&quot;,&quot;IT Manager&quot;\n&quot;Oswold Otter (IT Team)&quot;,&quot;&quot;,&quot;Consultant&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;oswold.otter@goat.stu&quot;,&quot;&quot;,&quot;IT Leader: Otter&quot;\n&quot;Bertie Badger (IT Security Team)&quot;,&quot;Default pass is badger123&quot;,&quot;IT Security Team Deputy&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;bertie.badger@goat.stu&quot;,&quot;&quot;,&quot;IT Leader: Badger&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>When this was imported into Visio with default options set, it produced the following organisational chart:</p>\n<p><img src=\"https://cloud.githubusercontent.com/assets/12296344/11937572/f5906320-a80c-11e5-8faa-6439872df362.png\" alt=\"screenshot_orgchart\"></p>"}}},"pageContext":{"id":"a29a7358-5e75-5dc9-bfe5-e7d2a7a55935"}}}