{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/wiki/Misc/How-to-get-Oracle-Support-working-with-Kali-Linux","result":{"data":{"markdownRemark":{"id":"83b23c65-d962-5406-b07e-c58b5cfad831","frontmatter":{"title":"How to get Oracle Support working with Kali Linux","root":null},"html":"<p>This is an update of the original blog post about how to get Oracle support working with Metasploit and Kali Linux, found here: <a href=\"http://leonjza.github.io/blog/2014/08/17/kali-linux-oracle-support/\">http://leonjza.github.io/blog/2014/08/17/kali-linux-oracle-support/</a></p>\n<p>Due to licensing issues, we cannot ship Oracle's proprietary client access libraries by default. As a result, you may see this error when running a Metasploit module:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf auxiliary(oracle_login) &gt; run\n\n[-] Failed to load the OCI library: cannot load such file -- oci8\n[-] See http://www.metasploit.com/redmine/projects/framework/wiki/OracleUsage for installation instructions\n[*] Auxiliary module execution completed\nmsf auxiliary(oracle_login) &gt; run</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>or</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf5 auxiliary(scanner/oracle/oracle_hashdump) &gt; run\n\n[-] Failed to load the OCI library: cannot load such file -- oci8\n[-] Try &#39;gem install ruby-oci8&#39;\n[*] Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The general steps to getting Oracle support working are to install the Oracle Instant Client and development libraries, install the required dependencies for Kali Linux, then install the gem.</p>\n<h2 id=\"install-the-oracle-instant-client\" style=\"position:relative;\"><a href=\"#install-the-oracle-instant-client\" aria-label=\"install the oracle instant client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install the Oracle Instant Client</h2>\n<p>As root, create the directory <code class=\"language-text\">/opt/oracle</code>. Then download the <a href=\"http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html\">Oracle Instant Client</a> packages for your version of Kali Linux. The packages you will need are:</p>\n<ul>\n<li>instantclient-basic-linux-12.2.0.1.0.zip</li>\n<li>instantclient-sqlplus-linux-12.2.0.1.0.zip</li>\n<li>instantclient-sdk-linux-12.2.0.1.0.zip</li>\n</ul>\n<p>Unzip these under <code class=\"language-text\">/opt/oracle</code>, and you should now have a path called <code class=\"language-text\">/opt/oracle/instantclient_12_2/</code>. Next symlink the shared library that we need to access the library from oracle:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:/opt/oracle/instantclient_12_2# ln libclntsh.so.12.1 libclntsh.so\n\nroot@kali:/opt/oracle/instantclient_12_2# ls -lh libclntsh.so\nlrwxrwxrwx 1 root root 17 Jun  1 15:41 libclntsh.so -&gt; libclntsh.so.12.1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You also need to configure the appropriate environment variables, perhaps by inserting them into your .bashrc file, logging out and back in for them to apply.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">export PATH=$PATH:/opt/oracle/instantclient_12_2\nexport SQLPATH=/opt/oracle/instantclient_12_2\nexport TNS_ADMIN=/opt/oracle/instantclient_12_2\nexport LD_LIBRARY_PATH=/opt/oracle/instantclient_12_2\nexport ORACLE_HOME=/opt/oracle/instantclient_12_2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you have succeeded, you should be able to run <code class=\"language-text\">sqlplus</code> from a command prompt:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:/opt/oracle/instantclient_12_2# sqlplus\n\nSQL*Plus: Release 12.2.0.1.0 Production on Tue Mar 26 20:40:24 2019\n\nCopyright (c) 1982, 2016, Oracle.  All rights reserved.\n\nEnter user-name:</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"install-the-ruby-gem\" style=\"position:relative;\"><a href=\"#install-the-ruby-gem\" aria-label=\"install the ruby gem permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install the ruby gem</h2>\n<p>First, download and extract the gem source release:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:~# wget https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.2.7.zip\n--2019-03-26 20:31:11--  https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.2.7.zip\nResolving github.com (github.com)... 192.30.253.113, 192.30.253.112\nConnecting to github.com (github.com)|192.30.253.113|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nLocation: https://codeload.github.com/kubo/ruby-oci8/zip/ruby-oci8-2.2.7 [following]\n--2019-03-26 20:31:11--  https://codeload.github.com/kubo/ruby-oci8/zip/ruby-oci8-2.2.7\nResolving codeload.github.com (codeload.github.com)... 192.30.253.120, 192.30.253.121\nConnecting to codeload.github.com (codeload.github.com)|192.30.253.120|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: unspecified [application/zip]\nSaving to: ‘ruby-oci8-2.2.7.zip’\n\nruby-oci8-2.2.7.zip                     [ &lt;=&gt;                                                                ] 376.97K  2.36MB/s    in 0.2s    \n\n2019-03-26 20:31:11 (2.36 MB/s) - ‘ruby-oci8-2.2.7.zip’ saved [386016]\n\nroot@kali:~# unzip ruby-oci8-2.2.7.zip \nArchive:  ruby-oci8-2.2.7.zip\n0c85bf6da2f541de3236267b1a1b18f0136a8f5a\n   creating: ruby-oci8-ruby-oci8-2.2.7/\n  inflating: ruby-oci8-ruby-oci8-2.2.7/.gitignore  \n  inflating: ruby-oci8-ruby-oci8-2.2.7/.travis.yml \n[...]\n  inflating: ruby-oci8-ruby-oci8-2.2.7/test/test_rowid.rb\nroot@kali:~# cd ruby-oci8-ruby-oci8-2.2.7/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Install libgmp (needed to build the gem) and set the path to prefer the correct version of ruby so that Metasploit can use it.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:~/ruby-oci8-ruby-oci8-2.2.7# export PATH=/opt/metasploit/ruby/bin:$PATH\n\nroot@kali:~/ruby-oci8-ruby-oci8-2.2.7# apt-get install libgmp-dev\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nSuggested packages:\n  libgmp10-doc libmpfr-dev\nThe following NEW packages will be installed:\n  libgmp-dev\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 0 B/610 kB of archives.\nAfter this operation, 1,740 kB of additional disk space will be used.\nSelecting previously unselected package libgmp-dev:amd64.\n(Reading database ... 322643 files and directories currently installed.)\nUnpacking libgmp-dev:amd64 (from .../libgmp-dev_2%3a5.0.5+dfsg-2_amd64.deb) ...\nSetting up libgmp-dev:amd64 (2:5.0.5+dfsg-2) ...</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Build and install the gem</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">root@kali:~/ruby-oci8-ruby-oci8-2.2.7# make\nruby -w setup.rb config\nsetup.rb:280: warning: assigned but unused variable - vname\nsetup.rb:280: warning: assigned but unused variable - desc\nsetup.rb:280: warning: assigned but unused variable - default2\n---&gt; lib\n---&gt; lib/dbd\n&lt;--- lib/dbd\n---&gt; lib/oci8\n&lt;--- lib/oci8\n&lt;--- lib\n---&gt; ext\n---&gt; ext/oci8\n/opt/metasploit/ruby/bin/ruby /root/ruby-oci8-ruby-oci8-2.2.7/ext/oci8/extconf.rb\nchecking for load library path...\n  LD_LIBRARY_PATH...\n    checking /opt/metasploit/ruby/lib... no\n    checking /opt/oracle/instantclient_12_2... yes\n  /opt/oracle/instantclient_12_2/libclntsh.so.12.1 looks like an instant client.\nchecking for cc... ok\nchecking for gcc... yes\nchecking for LP64... yes\nchecking for sys/types.h... yes\nchecking for ruby header... ok\nchecking for OCIInitialize() in oci.h... yes\n[...]\nlinking shared-object oci8lib_250.so\nmake[1]: Leaving directory `/root/ruby-oci8-ruby-oci8-2.2.7/ext/oci8&#39;\n&lt;--- ext/oci8\n&lt;--- ext\n\nroot@kali:~/ruby-oci8-ruby-oci8-2.2.7# make install\nruby -w setup.rb install\nsetup.rb:280: warning: assigned but unused variable - vname\nsetup.rb:280: warning: assigned but unused variable - desc\nsetup.rb:280: warning: assigned but unused variable - default2\n---&gt; lib\nmkdir -p /opt/metasploit/ruby/lib/ruby/site_ruby/2.5.0/\ninstall oci8.rb /opt/metasploit/ruby/lib/ruby/site_ruby/2.5.0/\n[...]\n&lt;--- ext\nroot@kali:~/ruby-oci8-ruby-oci8-2.2.7#</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}},"pageContext":{"id":"83b23c65-d962-5406-b07e-c58b5cfad831"}}}