{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/wiki/Misc/How-to-use-datastore-options","result":{"data":{"markdownRemark":{"id":"ef1450dc-7bd3-5f3f-bc74-9156a9cacf3c","frontmatter":{"title":"How to use datastore options","root":null},"html":"<p><strong>Note: This documentation may need to be vetted</strong></p>\n<p>A datastore option is a type of variable that can be set by the user, allowing various components of Metasploit to be more configurable during use. For example, in msfconsole, you can set the ConsoleLogging option in order to log all the console input/output - something that's kind of handy for documentation purposes during a pentest. When you load a module, there will be a lot more options registered by the mixin(s) or the module. Some common ones include: RHOST and RPORT for a server-side exploit or auxiliary module, SRVHOST for a client-side module, etc. The best way to find out exactly what datastore options you can set is by using these commands:</p>\n<ul>\n<li><code class=\"language-text\">show options</code> - Shows you all the basic options.</li>\n<li><code class=\"language-text\">show advanced</code> - Shows you all the advanced options.</li>\n<li><code class=\"language-text\">show missing</code> - Shows you all the required options you have not configured.</li>\n<li><code class=\"language-text\">set</code> - Shows you everything. Obviously you also use this command to set an option.</li>\n</ul>\n<h3 id=\"option-sources-moduledatastore-active_module-session-and-framework\" style=\"position:relative;\"><a href=\"#option-sources-moduledatastore-active_module-session-and-framework\" aria-label=\"option sources moduledatastore active_module session and framework permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Option sources: ModuleDataStore, active_module, session, and framework</h3>\n<p><strong>How users look at datastore options:</strong></p>\n<p>On the user's side, datastore options are seen as global or module-level: Global means all the modules can use that option, which can be set by using the <code class=\"language-text\">setg</code> command. Module-level means only that particular module you're using remembers that datastore option, no other components will know about it. You are setting a module-level option if you load a module first, and then use the <code class=\"language-text\">set</code> command, like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; use exploit/windows/smb/ms08_067_netapi \nmsf exploit(ms08_067_netapi) &gt; set rhost 10.0.1.3\nrhost =&gt; 10.0.1.3</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p><strong>How Metasploit developers look at datastore options:</strong></p>\n<p>On the development side, things are a little crazier. Datastore options actually can be found in at least four different sources: the ModuleDataStore object, active_module, session object, or the framework object.</p>\n<p>If you're just doing module development, the best source you can trust is the ModuleDataStore object. This object has a specific load order before handing you the option you want: if the option can be found in the module's datastore, it will give you that. If not found, it will give you the one from framework. The following is an example of how to read a datastore option in a module:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">current_host <span class=\"token operator\">=</span> datastore<span class=\"token punctuation\">[</span><span class=\"token string\">'RHOST'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If your dev work is outside the module realm, there is a good possibility that you don't even have the ModuleDataStore object. But in some cases, you still might be able to read from the <a href=\"https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/ui/console/driver.rb#L607\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">active_module accessor</a> from the driver. Or if you have access to <a href=\"https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/ui/console/module_command_dispatcher.rb#L28\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ModuleCommandDispatcher</a>, there is a <code class=\"language-text\">mod</code> method too that gives you the same thing, and sometimes mixins pass this around in a <code class=\"language-text\">run_simple</code> method while dispatching a module. One example you can look at is the <a href=\"https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/ui/console/command_dispatcher/auxiliary.rb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Msf::Ui::Console::CommandDispatcher::Auxiliary</a> class.</p>\n<p>In some cases such as running a script in post exploitation, you might not have ModuleDataStore or even active<em>module, but you should still have a session object. There should be an `<code class=\"language-text\"></code>exploit</em>datastore`<code class=\"language-text\"></code> that gives you all the datastore options:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">session<span class=\"token punctuation\">.</span>exploit_datastore</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you don't have access to the module, or to a session object, the last source is obviously the framework object, and there is ALWAYS a framework object. However, like we said earlier, if the user sets a module-level option, no other components will see it, this includes the framework object:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">framework<span class=\"token punctuation\">.</span>datastore</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>So now you know there are multiple sources of datastore options. And hopefully at this point you are well aware that not all sources necessarily share the same thing. If you have to try everything, as a general rule, this should be your load order:</p>\n<ol>\n<li>Try from the ModuleDataStore</li>\n<li>Try from active_module</li>\n<li>Try from session</li>\n<li>Try from framework</li>\n</ol>\n<h3 id=\"core-option-types\" style=\"position:relative;\"><a href=\"#core-option-types\" aria-label=\"core option types permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Core option types</h3>\n<p>All all core datastore option types are defined in the <a href=\"https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/option_container.rb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">option_container.rb</a> file as classes. You should always pick the most appropriate one because each has its own input validator.</p>\n<p>When you initialize an option during datastore registration, it should be in the following format:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptSomething</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>option_name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>boolean<span class=\"token punctuation\">,</span> description<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>option_name</strong> - Clearly means the name of the datastore option.</li>\n<li><strong>boolean</strong> - The first attribute, true means this is a required option, false means optional.</li>\n<li><strong>description</strong> - A short description about this option</li>\n<li><strong>value</strong> - A default value. Note if the first attribute is false, you don't need to provide a value, it'll be set to nil automatically.</li>\n</ul>\n<p>Now let's talk about what classes are available:</p>\n<ul>\n<li><strong>OptString</strong> - Typically for a string option. If the input begins with \"file://\", OptString will also automatically assume this is a file, and read from it. However, there is no file path validation when this happens, so if you want to load a file, you should use the OptPath instead, and then read the file yourself. Code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptString</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MYTEST'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a MYTEST option'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'This is a default value'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptRaw</strong> - It actually functions exactly the same as OptString.</li>\n<li><strong>OptBool</strong> - Boolean option. It will validate if the input is a variant of either true or false. For example: y, yes, n, no, 0, 1, etc. Code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptBool</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BLAH'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a BLAH option'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptEnum</strong> - Basically this will limit the input to specific choices. For example, if you want the input to be either \"apple\", or \"orange\", and nothing else, then OptEnum is the one for you. Code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token comment\"># Choices are: apple or range, defaults to apple</span>\n<span class=\"token constant\">OptEnum</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FRUIT'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a fruit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'apple'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'orange'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li><strong>OptPort</strong> - For an input that's meant to be used as a port number. This number should be between 0 - 65535. Code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptPort</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RPORT'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a port'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptAddress</strong> - An input that is an IPv4 address. Code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptAddress</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IP'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set an IP'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10.0.1.3'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li>OptAddressRange - An input that is a range of IPv4 addresses, for example: 10.0.1.1-10.0.1.20, or 10.0.1.1/24. You can also supply a file path instead of a range, and it will automatically treat that file as a list of IPs. Or, if you do the rand:3 syntax, with 3 meaning 3 times, it will generate 3 random IPs for you. Basic code example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptAddressRange</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Range'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set an IP range'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10.0.1.3-10.0.1.23'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptPath</strong> - If your datastore option is asking for a local file path, then use this.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptPath</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FILE'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Load a local file'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptInt</strong> - This can be either a hex value, or decimal.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptInt</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FILE'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'A hex or decimal'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><strong>OptRegexp</strong> - Datastore option is a regular expression.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token constant\">OptRegexp</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PATTERN'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Match a name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'^alien'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><strong>Other types:</strong></p>\n<p>In some cases, there might not be a well-suited datastore option type for you. The best example is an URL: even though there's no such thing as a OptUrl, what you can do is use the OptString type, and then in your module, do some validation for it, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">valid</span></span><span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> input <span class=\"token operator\">=</span><span class=\"token operator\">~</span> <span class=\"token regex\">/^http:\\/\\/.+/i</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n\t<span class=\"token keyword\">else</span>\n\t\t<span class=\"token comment\"># Here you can consider raising OptionValidateError</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">if</span> valid<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>datastore<span class=\"token punctuation\">[</span><span class=\"token string\">'URL'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># We can do something with the URL</span>\n<span class=\"token keyword\">else</span>\n\t<span class=\"token comment\"># Not the format we're looking for. Refuse to do anything.</span>\n<span class=\"token keyword\">end</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"the-register_options-method\" style=\"position:relative;\"><a href=\"#the-register_options-method\" aria-label=\"the register_options method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The register_options method</h3>\n<p>The <code class=\"language-text\">register_options</code> method can register multiple basic datastore options. Basic datastore options are the ones that either must be configured, such as the RHOST option in a server-side exploit. Or it's very commonly used, such as various username/password options found in a login module.</p>\n<p>The following is an example of registering multiple datastore options in a module:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">register_options<span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token constant\">OptString</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SUBJECT'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a subject'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">OptString</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MESSAGE'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a message'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"the-registeradvancedoptions-method\" style=\"position:relative;\"><a href=\"#the-registeradvancedoptions-method\" aria-label=\"the registeradvancedoptions method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The register<em>advanced</em>options method</h3>\n<p>The <code class=\"language-text\">register_advanced_options</code> method can register multiple advanced datastore options. Advanced datastore options are the ones that never require the user to configure before using the module. For example, the Proxies option is almost always considered as \"advanced\". But of course, it can also mean that's something that most user will find difficult to configure.</p>\n<p>An example of register an advanced option:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">register_advanced_options<span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span>\n    <span class=\"token constant\">OptInt</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token string\">'TIMEOUT'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Set a timeout, in seconds'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"changing-the-default-value-for-a-datastore-option\" style=\"position:relative;\"><a href=\"#changing-the-default-value-for-a-datastore-option\" aria-label=\"changing the default value for a datastore option permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Changing the default value for a datastore option</h3>\n<p>When a datastore option is already registered by a mixin, there are still ways to change the default value from the module. You can either use the <code class=\"language-text\">register_options</code> method, or adding a DefaultOptions key in the module's metadata.</p>\n<p><strong>Using register_options to change the default value:</strong></p>\n<p>One of the advantages of using <code class=\"language-text\">register_options</code> is that if the datastore option is advanced, this allows it to be on the basic option menu, meaning when people do \"show options\" on msfconsole, that option will be there instead. You also get to change the option description, and whether it should be required or not with this method.</p>\n<p><strong>Using DefaultOptions to change the default value:</strong></p>\n<p>When Metasploit initializes a module, an <code class=\"language-text\">import_defaults</code> method is <a href=\"https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/module.rb#L581\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">called</a>. This method will update all existing datastore options (which is why <code class=\"language-text\">register_options</code> can be used to update default values), and then it will specifically check the DefaultOptions key from the module's metadata, and update again.</p>\n<p>Here's an example of an exploit module's initialize portion with the DefaultOptions key:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span>info<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>update_info<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Name'</span>           <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"Module name\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Description'</span>    <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">%q{\n      This is an example of setting the default value of RPORT using the DefaultOptions key\n    }</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'License'</span>        <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token constant\">MSF_LICENSE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Author'</span>         <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'Name'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'References'</span>     <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span> <span class=\"token string\">'URL'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Platform'</span>       <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">'win'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Targets'</span>        <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span> <span class=\"token string\">'Windows'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'Ret'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">0x41414141</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Payload'</span>        <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'BadChars'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"\\x00\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'DefaultOptions'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'RPORT'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">8080</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Privileged'</span>     <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'DisclosureDate'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'DefaultTarget'</span>  <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"the-deregister_options-method\" style=\"position:relative;\"><a href=\"#the-deregister_options-method\" aria-label=\"the deregister_options method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The deregister_options method</h3>\n<p>The <code class=\"language-text\">deregister_options</code> method can deregister either basic or advanced options. Usage is really straight-forward:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\">deregister_options<span class=\"token punctuation\">(</span><span class=\"token string\">'OPTION1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPTION2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'OPTION3'</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h3 id=\"modifying-datastore-options-at-run-time\" style=\"position:relative;\"><a href=\"#modifying-datastore-options-at-run-time\" aria-label=\"modifying datastore options at run time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Modifying datastore options at run-time</h3>\n<p>Currently, the safest way to modify a datastore option at run-time is to override a method. For example, some mixins retrieve the RPORT option like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">rport</span></span>\n\tdatastore<span class=\"token punctuation\">[</span><span class=\"token string\">'RPORT'</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">end</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>In that scenario, you can override this rport method from your module, and return a different value:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-ruby line-numbers\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">rport</span></span>\n\t<span class=\"token number\">80</span>\n<span class=\"token keyword\">end</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>This way, when a mixin wants that information, it will end up with the value 80, and not whatever is actually in <code class=\"language-text\">datastore[&#39;RPORT&#39;]</code>.</p>\n<h3 id=\"ideal-datastore-naming\" style=\"position:relative;\"><a href=\"#ideal-datastore-naming\" aria-label=\"ideal datastore naming permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ideal datastore naming</h3>\n<p>Normal options are always UPPERCASE, advanced options are CamelCase, evasion options are Prefixed::CamelCase</p>"}},"pageContext":{"id":"ef1450dc-7bd3-5f3f-bc74-9156a9cacf3c"}}}