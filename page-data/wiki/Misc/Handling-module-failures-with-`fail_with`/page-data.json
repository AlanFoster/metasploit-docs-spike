{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/wiki/Misc/Handling-module-failures-with-`fail_with`","result":{"data":{"markdownRemark":{"id":"3b260cb9-659a-5381-a645-126b97d34c1f","frontmatter":{"title":"Handling module failures with `fail_with`","root":null},"html":"<p>When a module fails, the <code class=\"language-text\">fail_with</code> method provides a standardized way to describe the reason for the failure.  The first parameter depends on the cause of the failure.</p>\n<h2 id=\"example-uses\" style=\"position:relative;\"><a href=\"#example-uses\" aria-label=\"example uses permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example uses</h2>\n<p><code class=\"language-text\">modules/exploits/osx/local/sudo_password_bypass.rb</code> fails using <code class=\"language-text\">Failure::NotVulnerable</code> if the <code class=\"language-text\">check</code> method does not indicate that the target is indeed vulnerable:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  if check != CheckCode::Vulnerable\n    fail_with Failure::NotVulnerable, &#39;Target is not vulnerable&#39;\n  end</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">modules/exploits/multi/http/struts2_namespace_ognl.rb</code> fails using the <code class=\"language-text\">Failure::PayloadFailed</code> if the target's response does not include a string indicating that the payload successfully executed.  Alternatively, if the target responds with an HTTP error, the module invokes <code class=\"language-text\">fail_with</code> using the <code class=\"language-text\">Failure::UnexpectedReply</code> parameter:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">  if r &amp;&amp; r.headers &amp;&amp; r.headers[&#39;Location&#39;].split(&#39;/&#39;)[1] == success_string\n    print_good(&quot;Payload successfully dropped and executed.&quot;)\n  elsif r &amp;&amp; r.headers[&#39;Location&#39;]\n    vprint_error(&quot;RESPONSE: &quot; + r.headers[&#39;Location&#39;])\n    fail_with(Failure::PayloadFailed, &quot;Target did not successfully execute the request&quot;)\n  elsif r &amp;&amp; r.code == 400\n    fail_with(Failure::UnexpectedReply, &quot;Target reported an unspecified error while executing the payload&quot;)\n  end</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"comprehensive-list-of-fail_with-parameters\" style=\"position:relative;\"><a href=\"#comprehensive-list-of-fail_with-parameters\" aria-label=\"comprehensive list of fail_with parameters permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Comprehensive list of <code class=\"language-text\">fail_with</code> parameters</h2>\n<p>The following are currently used <code class=\"language-text\">fail_with</code> parameters, and a brief description of common uses.</p>\n<table>\n<thead>\n<tr>\n<th><code class=\"language-text\">fail_with</code> parameter</th>\n<th>Reason for failure</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Failure::BadConfig</td>\n<td>The user-provided parameters are invalid and must be corrected.</td>\n</tr>\n<tr>\n<td>Failure::Disconnected</td>\n<td>The target closed the connection forcibly.</td>\n</tr>\n<tr>\n<td>Failure::NoAccess</td>\n<td>An attempt to authenticate failed, likely due to invalid credentials.</td>\n</tr>\n<tr>\n<td>Failure::None</td>\n<td>The outcome for the module has already been met (eg. a privilege escalation is already in an elevated context)</td>\n</tr>\n<tr>\n<td>Failure::NoTarget</td>\n<td>The specified TARGET or PAYLOAD variables are misconfigured or the target environment is unsupported.</td>\n</tr>\n<tr>\n<td>Failure::NotFound</td>\n<td>A preexisting file or resource on target is missing.</td>\n</tr>\n<tr>\n<td>Failure::NotVulnerable</td>\n<td>The target returned a response indicative of being patched or otherwise mitigated.</td>\n</tr>\n<tr>\n<td>Failure::PayloadFailed</td>\n<td>A return code from payload execution indicates the payload did not execute or terminated unexpectedly.</td>\n</tr>\n<tr>\n<td>Failure::TimeoutExpired</td>\n<td>The target did not respond to the connection request in a timely manner.  Check RHOSTS and RPORT, then consider increasing WFSDelay.</td>\n</tr>\n<tr>\n<td>Failure::UnexpectedReply</td>\n<td>The target responded in an entirely unexpected way, and may not be running the vulnerable service at all.</td>\n</tr>\n<tr>\n<td>Failure::Unknown</td>\n<td>An entirely unexpected exception occurred, and the target may not be running the expected services at all.</td>\n</tr>\n<tr>\n<td>Failure::Unreachable</td>\n<td>The host or service is not reachable, often indicated by a refused connection or ICMP \"unreachable\" message.</td>\n</tr>\n</tbody>\n</table>"}},"pageContext":{"id":"3b260cb9-659a-5381-a645-126b97d34c1f"}}}