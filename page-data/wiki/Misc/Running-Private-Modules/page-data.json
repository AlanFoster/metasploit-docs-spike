{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/wiki/Misc/Running-Private-Modules","result":{"data":{"markdownRemark":{"id":"7840fd93-65f9-5bd6-bf1f-6d08253c13a3","frontmatter":{"title":"Running Private Modules","root":null},"html":"<p>If you're in the business of writing or collecting Metasploit modules that aren't part of the standard distribution, then you need a convenient way to load those modules in Metasploit. Never fear, it's pretty easy, using Metasploit's default local module search path, <code class=\"language-text\">$HOME/.msf4/modules</code>, and there are just a couple caveats:</p>\n<h2 id=\"mirror-the-real-metasploit-module-paths\" style=\"position:relative;\"><a href=\"#mirror-the-real-metasploit-module-paths\" aria-label=\"mirror the real metasploit module paths permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mirror the \"real\" Metasploit module paths</h2>\n<p>You must first set up a directory structure that fits with Metasploit's expectations of path names. What this typically means is that you should first create an \"exploits\" directory structure, like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.msf4/modules/exploits</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you are using <code class=\"language-text\">auxiliary</code> or <code class=\"language-text\">post</code> modules, or are writing <code class=\"language-text\">payloads</code> you'll want to <code class=\"language-text\">mkdir</code> those as well.</p>\n<h2 id=\"create-an-appropriate-category\" style=\"position:relative;\"><a href=\"#create-an-appropriate-category\" aria-label=\"create an appropriate category permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create an appropriate category</h2>\n<p>Modules are sorted by (somewhat arbitrary) categories. These can be anything you like; I usually use <code class=\"language-text\">test</code> or <code class=\"language-text\">private</code>, but if you are developing a module with an eye toward providing it to the main Metasploit distribution, you will want to mirror the real module path. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.msf4/modules/exploits/windows/fileformat</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>... if you are developing a file format exploit for Windows.</p>\n<h2 id=\"create-the-module\" style=\"position:relative;\"><a href=\"#create-the-module\" aria-label=\"create the module permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create the module</h2>\n<p>Once you have a directory to place it in, feel free to download or start writing your module.</p>\n<h2 id=\"test-it-all-out\" style=\"position:relative;\"><a href=\"#test-it-all-out\" aria-label=\"test it all out permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test it all out</h2>\n<p>If you already have msfconsole running, use a <code class=\"language-text\">reload_all</code> command to pick up your new modules. If not, just start msfconsole and they'll be picked up automatically. If you'd like to test with something generic, I have a module posted up as a gist, here: <a href=\"https://gist.github.com/todb-r7/5935519\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://gist.github.com/todb-r7/5935519</a> , so let's give it a shot:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.msf4/modules/exploits/test\n<span class=\"token function\">curl</span> -Lo ~/.msf4/modules/exploits/test/test_module.rb https://gist.github.com/todb-r7/5935519/raw/17f7e40ab9054051c1f7e0655c6f8c8a1787d4f5/test_module.rb\ntodb@ubuntu:~$ <span class=\"token function\">mkdir</span> -p <span class=\"token environment constant\">$HOME</span>/.msf4/modules/exploits/test\ntodb@ubuntu:~$ <span class=\"token function\">curl</span> -Lo ~/.msf4/modules/exploits/test/test_module.rb https://gist.github.com/todb-r7/5935519/raw/6e5d2da61c82b0aa8cec36825363118e9dd5f86b/test_module.rb \n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n<span class=\"token number\">100</span>  <span class=\"token number\">1140</span>    <span class=\"token number\">0</span>  <span class=\"token number\">1140</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">3607</span>      <span class=\"token number\">0</span> --:--:-- --:--:-- --:--:--  <span class=\"token number\">7808</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Then, in my msfconsole window:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">msf &gt; reload_all\n[*] Reloading modules from all module paths...\nIIIIII    dTb.dTb        _.---._\n  II     4&#39;  v  &#39;B   .&#39;&quot;&quot;.&#39;/|\\`.&quot;&quot;&#39;.\n  II     6.     .P  :  .&#39; / | \\ `.  :\n  II     &#39;T;. .;P&#39;  &#39;.&#39;  /  |  \\  `.&#39;\n  II      &#39;T; ;P&#39;    `. /   |   \\ .&#39;\nIIIIII     &#39;YvP&#39;       `-.__|__.-&#39;\n\nI love shells --egypt\n\n\n       =[ metasploit v4.6.2-2013052901 [core:4.6 api:1.0]\n+ -- --=[ 1122 exploits - 707 auxiliary - 192 post\n+ -- --=[ 307 payloads - 30 encoders - 8 nops\n\nmsf &gt; use exploit/test/test_module \nmsf exploit(test_module) &gt; info\n\n       Name: Fake Test Module\n     Module: exploit/test/test_module\n    Version: 0\n   Platform: Windows\n Privileged: No\n    License: Metasploit Framework License (BSD)\n       Rank: Excellent\n\nProvided by:\n  todb &lt;todb@metasploit.com&gt;\n\nAvailable targets:\n  Id  Name\n  --  ----\n  0   Universal\n\nBasic options:\n  Name  Current Setting  Required  Description\n  ----  ---------------  --------  -----------\n  DATA  Hello, world!    yes       The output data\n\nPayload information:\n\nDescription:\n  If this module loads, you know you&#39;re doing it right.\n\nReferences:\n  http://cvedetails.com/cve/1970-0001/\n\nmsf exploit(test_module) &gt; exploit\n\n[*] Started reverse handler on 192.168.145.1:4444 \n[+] Hello, world!\nmsf exploit(test_module) &gt; </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h2>\n<p>That's really all there is to it. The most common problems that people (including myself) run into are:</p>\n<ul>\n<li>Attempting to create a module in <code class=\"language-text\">$HOME/.msf4/modules/</code>. This won't work because you need to specify if it's an exploit or a payload or something. Check <code class=\"language-text\">ls /opt/metasploit/apps/pro/msf3/modules/</code> (or where your install of Metasploit lives).</li>\n<li>Attempting to create a module in <code class=\"language-text\">$HOME/.msf4/modules/auxiliary/</code>. This won't work because you need at least one level of categorization. It can be new, like <code class=\"language-text\">auxiliary/0day/</code>, or existing, like <code class=\"language-text\">auxiliary/scanner/scada/</code>.</li>\n<li>Attempting to create a module in <code class=\"language-text\">$HOME/.msf4/exploit/</code> or <code class=\"language-text\">$HOME/.msf4/posts/</code>. Note the pluralization of the directory names; they're different for different things. Exploits, payloads, encoders, and nops are plural, while auxiliary and post are singular.</li>\n</ul>\n<h3 id=\"metasploit-community-and-pro-editions\" style=\"position:relative;\"><a href=\"#metasploit-community-and-pro-editions\" aria-label=\"metasploit community and pro editions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metasploit Community and Pro editions</h3>\n<p>Note that the <code class=\"language-text\">$HOME</code> directory for Metasploit Community Edition is going to be <code class=\"language-text\">root</code> and not your own user directory, so if you are expecting modules to show up in the Metasploit CE (or Express, or Pro) web UIs, you will want to stash your external modules in <code class=\"language-text\">/root/.msf4/modules</code>. Of course, this means you need root access to the machine in question, but hey, you're a l33t Metasploit user, so that shouldn't be too hard.</p>\n<p>Also note that if your modules are not displaying in the web UI, you should restart Pro service.  </p>\n<h3 id=\"windows\" style=\"position:relative;\"><a href=\"#windows\" aria-label=\"windows permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Windows</h3>\n<p>For Windows users, the above is all true, except for accessing the modules from the web GUI. Sadly, you're a little out of luck; the module load paths on Windows are a little more restrictive and don't allow for external modules. However, the Console2-based Metasploit Console (Start > Programs > Metasploit > Metasploit Console) will work out just fine.</p>\n<h3 id=\"new-mixins-and-protocols\" style=\"position:relative;\"><a href=\"#new-mixins-and-protocols\" aria-label=\"new mixins and protocols permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>New mixins and protocols</h3>\n<p>Any module that requires on changes to core library functions, such as new protocol parsers or other library mixins, aren't going to work out for you this way -- you're going to end up spewing errors all over the place as your module tries to load these classes. It's possible to write modules as completely self-contained in nearly all cases (thanks to Ruby's open class architecture), but such modules nearly always get refactored later to make the protocol and other mixin bits available to other modules.</p>\n<p>In this case, it would be better to work with modules like that using a proper GitHub checkout with a development branch -- see the <a href=\"https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dev environment setup docs</a> for tons more on that.</p>\n<h2 id=\"a-final-warning\" style=\"position:relative;\"><a href=\"#a-final-warning\" aria-label=\"a final warning permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A final warning</h2>\n<p>If you are loading new and exciting Metasploit modules, know that these things will tend to have access to anything you have access to; doubly so if you're dropping them in root. Metasploit modules are plain text Ruby, so you can read them -- but please be careful, and only add external modules from trusted sources; don't just go grabbing any old thing you see on the Internet, because you may find yourself backdoored (or worse) in short order.</p>"}},"pageContext":{"id":"7840fd93-65f9-5bd6-bf1f-6d08253c13a3"}}}