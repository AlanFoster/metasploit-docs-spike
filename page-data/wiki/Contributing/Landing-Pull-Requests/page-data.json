{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/wiki/Contributing/Landing-Pull-Requests","result":{"data":{"markdownRemark":{"id":"71f11b09-5976-57cc-babd-599c83ad6bb4","frontmatter":{"title":"Landing Pull Requests","root":null},"html":"<p><strong>This page is meant for Committers. If you are unsure whether you are a committer, you are not.</strong></p>\n<p>Metasploit is built incrementally by the community through GitHub's <a href=\"https://github.com/rapid7/metasploit-framework/pulls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pull Request</a> mechanism. Submitting pull requests (or PRs) is already discussed in the <a href=\"https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dev environment setup</a> documentation. It's important to realize that PRs are a feature of GitHub, not git, so this document will take a look at how to get your git environment to deal with them sensibly.</p>\n<h1 id=\"the-short-story\" style=\"position:relative;\"><a href=\"#the-short-story\" aria-label=\"the short story permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The short story</h1>\n<ul>\n<li>Configure your git environment as described <a href=\"https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment#keeping-in-sync\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</li>\n<li>Add the <code class=\"language-text\">fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*</code> line to your <code class=\"language-text\">.git/config</code>.</li>\n<li>Add your signing key: <code class=\"language-text\">git config --global user.signingkey</code></li>\n<li>When merging code from a pull request, always, always <code class=\"language-text\">merge -S --no-ff --edit</code>, and write a meaningful <a href=\"http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">50/72</a> commit message that references the original PR as <code class=\"language-text\">#1234</code> (not PR1234, not PR#1234, not 1234). For example, your message should look like this:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">Land #1234, a whizbang bug fix\n\nAdds a whiz to the existing bang. It appears that without this,\nbad things can occasionally happen. Thanks [@mcfakepants](@mcfakepants)!\n\nFixes #1024, also see #999.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>The <code class=\"language-text\">--no-ff</code> flag goes for PRs that go back to a contributor's branch as well as PRs that land in rapid7's master branch.</li>\n<li>The <code class=\"language-text\">-S</code> indicates that you're going to sign the merge with your PGP/GPG key, which is a nice assurance that you're really you.</li>\n<li>If you're making changes (often the case), merge to a landing branch, then merge <strong>that</strong> branch to upstream/master with the <code class=\"language-text\">-S --no-ff --edit</code> options.</li>\n</ul>\n<h1 id=\"handy-git-aliases\" style=\"position:relative;\"><a href=\"#handy-git-aliases\" aria-label=\"handy git aliases permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Handy Git aliases</h1>\n<p>Check out <a href=\"https://gist.github.com/todb-r7/3fbee1a9e7b36d82ca55\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this gist</a> that automates (mostly) landing pull requests, signing the merge commit, all while rarely losing a race with other committers.</p>\n<h1 id=\"fork-and-clone\" style=\"position:relative;\"><a href=\"#fork-and-clone\" aria-label=\"fork and clone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fork and clone</h1>\n<p>First, fork and clone the <code class=\"language-text\">rapid7/metasploit-framework</code> repo, <a href=\"https://help.github.com/articles/fork-a-repo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">following these instructions</a>. I like using ssh with <code class=\"language-text\">~/.ssh/config</code> aliases <a href=\"https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment#wiki-ssh\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">as described here</a>, but the https method will work, too.</p>\n<p>Once this is done, you will have a remote repository called \"origin,\" which points to your forked repository on GitHub. You will be doing most of your work in your own fork of Metasploit, even if you have commit rights to Rapid7's fork. Now, we're going to add an \"upstream\" repository to talk to the Rapid7 repository.</p>\n<p>In addition, we're going to add a magical line to the config file that will let us see all pull requests against the Rapid7 repo (both open and closed). Note that this will take a minute since you're adding some hundreds of megs to your clone's refs.</p>\n<p>So, open up <code class=\"language-text\">metasploit-framework/.git/config</code> with your favorite editor, add an upstream remote, and add the pull request refs for both your and Rapid7's forks. In the end, you should have a section that started off like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"config\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-config line-numbers\"><code class=\"language-config\">[remote &quot;upstream&quot;]\n  fetch = +refs/heads/*:refs/remotes/upstream/*\n  fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*\n  url = https://github.com/rapid7/metasploit-framework</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>And now it looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"config\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-config line-numbers\"><code class=\"language-config\">[remote &quot;upstream&quot;]\n  fetch = +refs/heads/*:refs/remotes/upstream/*\n  fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*\n  url = git@github.com:rapid7/metasploit-framework.git\n[remote &quot;origin&quot;]\n  fetch = +refs/heads/*:refs/remotes/origin/*\n  fetch = +refs/pull/*/head:refs/remotes/origin/pr/*\n  url = https://github.com/YOURNAME/metasploit-framework</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Some people like to copy these over into remotes named \"rapid7\" and \"yourusername\" just so they don't have to remember about \"origin\" and \"upstream,\" but for this doc, we'll just assume you have \"origin\" and \"upstream\" defined like this.</p>\n<p>Now, you can git fetch the remote PRs. This will take a little bit, since we have a couple dozen MBs of pull request data. Storage is cheap, though, right?</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git fetch --all\nFetching todb-r7\nremote: Counting objects: 13, done.\nremote: Compressing objects: 100% (1/1), done.\nremote: Total 7 (delta 6), reused 7 (delta 6)\nUnpacking objects: 100% (7/7), done.\nFrom https://github.com/todb-r7/metasploit-framework\n * [new ref]         refs/pull/1/head -&gt; origin/pr/1\n * [new ref]         refs/pull/2/head -&gt; origin/pr/2\nFetching upstream\nremote: Counting objects: 91, done.\nremote: Compressing objects: 100% (29/29), done.\nremote: Total 59 (delta 47), reused 42 (delta 30)\nUnpacking objects: 100% (59/59), done.\nFrom https://github.com/rapid7/metasploit-framework\n [... bunches of tags and PRs ...]\n * [new ref]         refs/pull/1701/head -&gt; upstream/pr/1701\n * [new ref]         refs/pull/1702/head -&gt; upstream/pr/1702</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You can <code class=\"language-text\">git fetch</code> a remote any time, and you'll get access to the latest changes to all branches and pull requests.</p>\n<h1 id=\"branching-from-prs\" style=\"position:relative;\"><a href=\"#branching-from-prs\" aria-label=\"branching from prs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Branching from PRs</h1>\n<p>A manageable strategy for dealing with outstanding PRs is to start pre-merge testing on the pull request in isolation. For example, to work on PR #1217, we would:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git checkout upstream/pr/1217\nNote: checking out &#39;upstream/pr/1217&#39;.\n\nYou are in &#39;detached HEAD&#39; state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b new_branch_name\n\nHEAD is now at 9e499e5... Make BindTCP test more robust\n((no branch)) todb@mazikeen:~/git/rapid7/metasploit-framework\n```\n```\n$ git checkout -b landing-1217</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now, we're on a local branch identical to the original pull request, and can move on from there. We can make our changes, isolated from master, and then either send them back to the contributor (this requires looking up the original contributor's GitHub username and branch name on GitHub), or if there aren't any changes or the changes are trivial, we can land them (if you have committer rights to Rapid7's repo, this is where you land them to the upstream repo).</p>\n<p>In this particular case with PR #1217, I did want to send some changes back to the contributor.</p>\n<p><strong>Important</strong>: If the codebase the contributor's PR is based on is severely outdated (e.g., they branched off an outdated <code class=\"language-text\">master</code>), you should not test their PR in isolation as described above. Instead, you should create a test branch that is identical to the latest codebase, merge the contributor's PR into the test branch, and then start your testing.</p>\n<p>Here's an example with #6954 (your workflow may vary):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git checkout upstream/master \nNote: checking out &#39;upstream/master&#39;.\n\nYou are in &#39;detached HEAD&#39; state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b &lt;new-branch-name&gt;\n\nHEAD is now at afbeb2b... Land #7023, fixes for swagger exploit\n$ git merge --no-ff --no-edit upstream/pr/6954\nMerge made by the &#39;recursive&#39; strategy.\n modules/exploits/windows/local/payload_inject.rb | 5 +++++\n 1 file changed, 5 insertions(+)\n[*] Running msftidy.rb in .git/hooks/post-merge mode\n--- Checking new and changed module syntax with tools/dev/msftidy.rb ---\nmodules/exploits/windows/local/payload_inject.rb - msftidy check passed\n------------------------------------------------------------------------</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This ensures that the contributor's PR is being tested against the latest codebase and not an outdated one. <strong>If you do not do this</strong>, when you land the PR, you may end up breaking Metasploit.</p>\n<h2 id=\"checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo\" style=\"position:relative;\"><a href=\"#checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo\" aria-label=\"checking out branches from a remote forked repo in your forked repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checking out branches from a remote forked repo in your forked repo</h2>\n<p>After your .git/config is set up per the above, and you successfully run <code class=\"language-text\">git fetch --all</code>, you are two steps away from being able to check out a branch from a contributor's forked repo.</p>\n<p>You need to add their fork once as a remote: <code class=\"language-text\">git remote add OTHER_USER git://github.com/OTHER_USER/metasploit-framework.git</code>. Now pull down the latest from them: <code class=\"language-text\">git fetch OTHER_USER</code>. Now you can check out branches from OTHER_USER per usual, e.g. <code class=\"language-text\">git checkout bug/foo</code>.</p>\n<h1 id=\"making-changes\" style=\"position:relative;\"><a href=\"#making-changes\" aria-label=\"making changes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making changes</h1>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ gvim .gitignore\n[... make some changes and some commits ...]\n(landing-1217) todb@mazikeen:~/git/rapid7/metasploit-framework\n$ git checkout -b pr1217-fix-gitignore-conflict\nSwitched to a new branch &#39;pr1217-fix-gitignore-conflict&#39;\n(pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework\n$ git push origin pr1271-fix-gitignore-conflict\n(pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework\n$ git pr-url schierlm javapayload-maven\nCreated new window in existing browser session.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This sequence does a few things after editing the .gitconfig. It creates another copy of landing-1217 (which is itself a copy of upstream/pr/1217)). Next, I push those changes to my branch (todb-r7, aka \"origin\"). Finally, I have a mighty <a href=\"https://gist.github.com/todb-r7/5438391\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.gitconfig alias here</a> to open a browser window to send a pull request to the original contributor's branch (you will want to edit yours to reflect your real GitHub username, of course).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">pr-url = !&quot;echo https://github.com/YOURNAME/metasploit-framework/pull/new/HISNAME:HISBRANCH...YOURBRANCH&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Filling in the blanks (provided by the original PR's information from GitHub) gets me:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">https://github.com/todb-r7/metasploit-framework/pull/new/schierlm:javapayload-maven...pr1217-fix-gitignore-conflict</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>I opened that in a browser, and ended up with <a href=\"https://github.com/schierlm/metasploit-framework/pull/1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/schierlm/metasploit-framework/pull/1</a> . Once <a href=\"@schierlm\">@schierlm</a> landed it on his branch (again, using <code class=\"language-text\">git merge --no-ff</code> and a short, informational merge commit message), all I (or anyone) had to do was <code class=\"language-text\">git fetch</code> to get the change reflected in upstream/pr/1217, and then the integration of the PR could continue.</p>\n<h1 id=\"collaboration-between-contributors\" style=\"position:relative;\"><a href=\"#collaboration-between-contributors\" aria-label=\"collaboration between contributors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Collaboration between contributors</h1>\n<p>Note the important bit here: <strong>you do not need commit rights to Rapid7 to branch pull requests</strong>. If Alice knows a solution to Bob's pull request that Juan pointed out, it is <strong>easy</strong> for Alice to provide that solution by following the procedure above. <code class=\"language-text\">git blame</code> will still work correctly, commit histories will all be accurate, everyone on the pull request will be notified of Alice's changes, and Juan doesn't have to wait around for Bob to figure out how to use <code class=\"language-text\">send_request_cgi()</code> or whatever the problem was. The hardest part is remembering how to construct the pull request to Bob -- lucky for you, <a href=\"https://gist.github.com/todb-r7/5438391\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this .git/config alias</a> makes that part pretty push-button.</p>\n<h1 id=\"landing-to-upstream\" style=\"position:relative;\"><a href=\"#landing-to-upstream\" aria-label=\"landing to upstream permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Landing to upstream</h1>\n<p>Back to PR #1217. Turns out, my change was enough to land the original chunk of work. So, someone else (<a href=\"@jlee-r7\">@jlee-r7</a>) was able to to do something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git fetch upstream\nremote: Counting objects: 12, done.\nremote: Compressing objects: 100% (2/2), done.\nremote: Total 7 (delta 5), reused 7 (delta 5)\nUnpacking objects: 100% (7/7), done.\nFrom https://github.com/rapid7/metasploit-framework\n   9e499e5..263e967  refs/pull/1651/head -&gt; upstream/pr/1651</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This all looked good, so he could land this to Rapid7's repo with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git checkout -b upstream-master --track upstream/master\n$ git merge -S --no-ff --edit landing-1217\n$ git push upstream upstream-master:master</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Or, if he already have upstream-master checked out:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ git checkout upstream-master\n$ git rebase upstream/master\n$ git merge -S --no-ff --edit landing-1217\n$ git push upstream upstream-master:master</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The <code class=\"language-text\">--edit</code> is optional if we have our editor configured correctly in <code class=\"language-text\">$HOME/.gitconfig</code>. The point here is that we <em>always</em> want a merge commit, and we <em>never</em> want to use the (often useless) default merge commit message. For #1217, this was changed to:</p>\n<div class=\"gatsby-highlight\" data-language=\"commit\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-commit line-numbers\"><code class=\"language-commit\">Land #1217, java payload build system refactor</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Note that you should rebase <em>before</em> landing -- otherwise, your merge commit will be lost in the rebase.</p>\n<p>Finally, the -S indicates we are going to sign the merge, using our GPG key. This is a nice way to prove in a secure way that this merge is, in fact, coming from you, and not someone impersonating you. For more on signing merges, see <a href=\"http://mikegerwitz.com/papers/git-horror-story.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">A Git Horror Story: Repository Integrity With Signed Commits</a>.</p>\n<p>To set yourself up for signing, your .gitconfig (or metasploit-framework/git/.config) file should have these entries:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">[user]\nname = Your Name\nemail = your@email.xxx\nsigningkey = DEADBEEF # Must match exactly with your key for &quot;Your Name &lt;your@email.xxx&gt;&quot;\n[alias]\nc = commit -S --edit\nm = merge -S --no-ff --edit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>People with commit rights to rapid7/metasploit-framework will have their <a href=\"https://github.com/rapid7/metasploit-framework/wiki/Committer-Keys\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">keys listed here</a>.</p>\n<h1 id=\"post-merge\" style=\"position:relative;\"><a href=\"#post-merge\" aria-label=\"post merge permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post-Merge</h1>\n<p>After a pull request has been merged, release notes should be added to the pull request in the form of a comment. These release notes will automatically be extracted and used as documentation when creating the <a href=\"https://help.rapid7.com/metasploit/release-notes/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">metasploit release notes</a>.</p>\n<p>Release note examples:</p>\n<ul>\n<li><a href=\"https://github.com/rapid7/metasploit-framework/pull/12873#issuecomment-577247684\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">12873 Release notes</a></li>\n<li><a href=\"https://github.com/rapid7/metasploit-framework/pull/12831#issuecomment-577399914\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">12831 Release notes</a></li>\n</ul>\n<p>The <a href=\"https://github.com/rapid7/metasploit-framework/issues?utf8=%E2%9C%93&#x26;q=label%3Arn-no-release-notes+\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rn-no-release-notes</a> label must be added if there are no release notes for the merged pull request.</p>\n<h1 id=\"cross-linking-prs-bugs-and-commits\" style=\"position:relative;\"><a href=\"#cross-linking-prs-bugs-and-commits\" aria-label=\"cross linking prs bugs and commits permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cross-linking PRs, Bugs, and Commits</h1>\n<p>TODO: Update in this new post-Redmine, GitHub issues world</p>\n<h1 id=\"merge-conflicts\" style=\"position:relative;\"><a href=\"#merge-conflicts\" aria-label=\"merge conflicts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Merge conflicts</h1>\n<p>The nice thing about this strategy is that you can test for merge conflicts straight away. You'd use a sequence like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">git checkout upstream/pr/1234\ngit checkout -b landing-1234\ngit checkout master\ngit checkout -b master-temp\ngit merge landing-1234 master-temp</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If that works, great, you know you don't have any merge conflicts right now.</p>\n<h1 id=\"questions-and-corrections\" style=\"position:relative;\"><a href=\"#questions-and-corrections\" aria-label=\"questions and corrections permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Questions and Corrections</h1>\n<p>Reach out in #contributors on <a href=\"https://metasploit.com/slack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Metasploit Slack</a>, or by e-mailing msfdev at metasploit dot com. </p>"}},"pageContext":{"id":"71f11b09-5976-57cc-babd-599c83ad6bb4"}}}